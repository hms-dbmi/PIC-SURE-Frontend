var Be=Object.defineProperty;var Ne=f=>{throw TypeError(f)};var Ue=(f,e,c)=>e in f?Be(f,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):f[e]=c;var be=(f,e,c)=>Ue(f,typeof e!="symbol"?e+"":e,c),Xe=(f,e,c)=>e.has(f)||Ne("Cannot "+c);var D=(f,e,c)=>(Xe(f,e,"read from private field"),c?c.call(f):e.get(f)),de=(f,e,c)=>e.has(f)?Ne("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(f):e.set(f,c);import"./Bzak7iHL.js";import{w as ue,g as ie,o as Ge}from"./B9BhT3Ut.js";import{p as se,f as y,d as l,a as ae,s as d,k as t,r as n,b as u,t as H,c as oe,e as he,u as le,i as $,h as q,l as v,n as Je}from"./pV5yBOfK.js";import{s as X,d as we}from"./D3FUfhzK.js";import{i as A}from"./BAa5cEXk.js";import{s as Z,r as ge,a as Le,d as Ke,h as Qe,b as Ye,c as Ze}from"./B3YVaWvx.js";import{b as Ce}from"./CMMNa4Y8.js";import{p as Q,s as Pe,c as ve}from"./C2caA9Pm.js";import{t as xe}from"./tvkVmxlD.js";import{a as Ve}from"./Drejzb63.js";import{b as Re,A as De,d as $e,e as et,f as tt,O as at}from"./DTj_CgQu.js";import{c as Me,d as rt}from"./D3-cXwBU.js";import{p as je}from"./DjPQy4x5.js";import{L as Fe}from"./BK-nQ0m1.js";import{a as it}from"./CF-XIK1E.js";import{e as Ie,i as ze}from"./CFqqwPkz.js";import{M as nt}from"./DBMsBZi4.js";import{p as lt}from"./B9OKY7FI.js";import{E as st}from"./C6RsMIt9.js";var ot=y('<div><span class="font-bold">Name:</span> </div>'),dt=y('<div><span class="font-bold mb-1">Accession:</span> </div>'),ct=y('<div><span class="font-bold mb-1">Type:</span> </div>'),vt=y('<div><span class="font-bold">Description:</span> </div>'),ft=y('<div><span class="font-bold mb-1">Name:</span> </div>'),ut=y('<div><span class="font-bold">Accession:</span> </div>'),mt=y('<div><span class="font-bold">Description:</span> </div>'),_t=y('<section data-testid="dataset-info" class="flex flex-col w-3/4 p-4"><h3 class="text-primary-500">Dataset Information</h3> <div class="w-full flex flex-row justify-between"><!> <!></div> <!></section>'),pt=y('<div><span class="font-bold mb-1">Study Name:</span> </div>'),yt=y('<div><span class="font-bold">Study Accession:</span> </div>'),bt=y('<section data-testid="study-info" class="flex flex-col w-3/4 p-4"><h3 class="text-primary-500">Study Information</h3> <div class="w-full flex flex-col"><!> <!></div></section>'),gt=y('<section data-testid="variable-info" class="flex flex-col w-3/4 p-4"><h3 class="text-primary-500">Variable Information</h3> <div class="w-full flex flex-row justify-between"><!> <!> <!></div> <!></section> <!> <!>',1),xt=y('<div class="card bg-surface-100 min-h-60 p-4"><div class="card-body"><!></div></div>');function ht(f,e){se(e,!0);let c=Q(e,"data",19,()=>({})),P=Me(c().conceptPath,c().dataset);var a=xt(),k=l(a),B=l(k);it(B,()=>P,F=>{Fe(F,{ring:!0,size:"medium"})},(F,r)=>{var O=gt(),S=ae(O),_=d(l(S),2),N=l(_);{var C=b=>{var x=ot(),E=d(l(x));n(x),H(()=>X(E,` ${t(r).display??""}`)),u(b,x)};A(N,b=>{t(r).display&&b(C)})}var m=d(N,2);{var g=b=>{var x=dt(),E=d(l(x));n(x),H(()=>X(E,` ${t(r).name??""}`)),u(b,x)};A(m,b=>{t(r).name&&b(g)})}var V=d(m,2);{var U=b=>{var x=ct(),E=d(l(x));n(x),H(()=>X(E,` ${t(r).type??""}`)),u(b,x)};A(V,b=>{t(r).type&&b(U)})}n(_);var J=d(_,2);{var R=b=>{var x=vt(),E=d(l(x));n(x),H(()=>X(E,` ${t(r).description??""}`)),u(b,x)};A(J,b=>{t(r).description&&b(R)})}n(S);var ee=d(S,2);{var re=b=>{var x=_t(),E=d(l(x),2),s=l(E);{var T=p=>{var w=ft(),W=d(l(w));n(w),H(()=>X(W,` ${t(r).table.display??""}`)),u(p,w)};A(s,p=>{t(r).table.display&&p(T)})}var M=d(s,2);{var i=p=>{var w=ut(),W=d(l(w));n(w),H(()=>X(W,` ${t(r).table.name??""}`)),u(p,w)};A(M,p=>{t(r).table.name&&p(i)})}n(E);var h=d(E,2);{var o=p=>{var w=mt(),W=d(l(w));n(w),H(()=>X(W,` ${t(r).table.description??""}`)),u(p,w)};A(h,p=>{t(r).table.description&&p(o)})}n(x),u(b,x)};A(ee,b=>{t(r).table&&b(re)})}var Y=d(ee,2);{var K=b=>{var x=bt(),E=d(l(x),2),s=l(E);{var T=h=>{var o=pt(),p=d(l(o));n(o),H(()=>{var w;return X(p,` ${(t(r).study.fullName||t(r).study.display||t(r).study.studyAcronym||((w=t(r))==null?void 0:w.studyAcronym))??""}`)}),u(h,o)};A(s,h=>{var o;(t(r).study.fullName||t(r).study.display||t(r).study.studyAcronym||(o=t(r))!=null&&o.studyAcronym)&&h(T)})}var M=d(s,2);{var i=h=>{var o=yt(),p=d(l(o));n(o),H(()=>X(p,` ${t(r).study.ref??""}`)),u(h,o)};A(M,h=>{t(r).study.ref&&h(i)})}n(E),n(x),u(b,x)};A(Y,b=>{t(r).study&&b(K)})}u(F,O)}),n(k),n(a),u(f,a),oe()}var wt=y('<i class="fa-solid fa-angle-left fa-xl -rotate-45 self-center"></i>'),Ft=(f,e)=>e.node.select(),At=y('<details class="tree-item" open><summary class="tree-item-summary list-none [&amp;::-webkit-details-marker]:hidden flex items-center cursor-pointer rounded-container p-0 hover:preset-tonal-primary space-x-1 w-full mr-2" role="treeitem"><!> <input type="radio" name="tree-radio"/> <label class="w-full"> </label></summary> <div class="tree-item-children ml-4" role="group"><!></div></details>');function He(f,e){se(e,!0);const c=Q(e,"isRoot",3,!1),P=Q(e,"disabled",3,!1);var a=At(),k=l(a);Z(k,"aria-expanded",!0);var B=l(k);{var F=m=>{var g=wt();H(()=>Ye(g,`margin-left: ${(e.index+1)*9}px;`)),u(m,g)};A(B,m=>{c()||m(F)})}var r=d(B,2);ge(r),r.__click=[Ft,e];var O=d(r,2),S=l(O,!0);n(O),n(k);var _=d(k,2),N=l(_);{var C=m=>{var g=he(),V=ae(g);Ie(V,17,()=>e.node.children,ze,(U,J)=>{{let R=le(()=>e.index+1);He(U,{get node(){return t(J)},get index(){return t(R)},get disabled(){return P()}})}}),u(m,g)};A(N,m=>{e.node.isLeaf||m(C)})}n(_),n(a),H(()=>{Z(a,"data-testid",`tree-item:${e.node.name??""}-${e.node.value??""}`),Z(a,"aria-disabled",e.node.disabled||P()),Z(k,"aria-selected",e.node.selected),Z(r,"id",`radio:${e.node.name??""}`),Z(r,"data-testid",`radio:${e.node.name??""}`),Le(r,1,`radio tree-item-radio self-center ${c()?"ml-[28px]":""}`),Ke(r,e.node.value),r.disabled=e.node.disabled||P(),Qe(r,e.node.selected),Z(O,"for",`${e.node.isLeaf?"radio:":"tree-item-btn:"}${e.node.name??""}`),X(S,e.node.name),Z(_,"data-testid",`tree-item-children:${e.node.name??""}`)}),u(f,a),oe()}we(["click"]);var Ot=y("<div></div>");function kt(f,e){var S,_,N;se(e,!0);let c=Q(e,"nodes",19,()=>[]),P=Q(e,"fullWidth",3,!1),a=Q(e,"onselect",3,()=>{}),k=Q(e,"disableTree",3,!1);class B{constructor(m,g,V=[],U=!1,J=!1){be(this,"name","");be(this,"value","");de(this,S,q(!1));de(this,_,q(k()));de(this,N,q($([])));this.name=m,this.value=g,this.children=V,this.selected=U||this.isLeaf,this.disabled=J}get selected(){return t(D(this,S))}set selected(m){v(D(this,S),m,!0)}get disabled(){return t(D(this,_))}set disabled(m){v(D(this,_),m,!0)}get children(){return t(D(this,N))}set children(m){v(D(this,N),m,!0)}get isLeaf(){return this.children.length===0}select(){this.disabled||(r.forEach(m=>{const g=V=>{V!==this&&(V.selected=!1,V.children.forEach(g))};g(m)}),this.selected=!0,a()(this.value))}}S=new WeakMap,_=new WeakMap,N=new WeakMap;function F(C){const{name:m,value:g,selected:V}=C;let U=[];return C.children.length>0&&(U=C.children.map(F)),new B(m,g,U,V)}let r=$(c().map(F));var O=Ot();Ie(O,21,()=>r,ze,(C,m,g)=>{He(C,{get node(){return t(m)},index:g,get disabled(){return k()},isRoot:g===0})}),n(O),H(()=>Le(O,1,Ze(P()?"w-full":""))),u(f,O),oe()}async function Tt(f,e,c,P,a,k,B){if(!t(e)){v(e,!0);try{const F=await rt(c().dataset,P,t(a));let r;const O={conceptPath:t(a),display:t(a).split("\\").filter(Boolean).pop()||t(a),name:t(a),allowFiltering:!0,dataset:c().dataset,studyAcronym:c().studyAcronym,description:`Any Record of ${t(a)}`,meta:c().meta,study:c().study,table:c().table,type:"AnyRecordOf"};r=Re(O,F),Ve(r),k()}catch(F){F instanceof De&&F.message==="Too many concept paths found"?v(B,!0):(console.error("Error adding selection: ",F instanceof Error?F.message:F),xe.error({description:"Something went wrong when adding the filter. If the problem persists, please contact your administrator."}))}finally{v(e,!1)}}}var Nt=(f,e)=>v(e,!1),Ct=y(`<div data-testid="hierarchy-component-error-modal-content"><p class="m-0">The level of the data tree you selected exceeds 9,500 variables. This was not added as a
      filter to your query. Please make a selection lower in the data tree and try again.</p> <div class="flex justify-center mt-4"><button class="btn preset-filled-primary-500">Okay</button></div></div>`),St=y('<p class="m-0">Filtering is not available for this variable</p>'),Et=y('<i class="fas fa-warning"></i> <span class="sr-only">Filtering is not available for this variable</span>',1),Lt=y('<i class="fas fa-plus"></i>'),Pt=y('<!> <div data-testid="hierarchy-component" class="flex flex-row justify-between bg-surface-100 p-4 rounded-container"><div class="flex flex-col gap-2"><!> <!></div> <button class="btn btn-icon preset-filled-primary-500 m-1" data-testid="add-filter"><!></button></div>',1);function Vt(f,e){se(e,!0);const[c,P]=Pe(),a=100;let k=Q(e,"data",19,()=>({})),B=Q(e,"onclose",3,()=>{}),F=q(!1),r=le(()=>{var s;return!((s=k())!=null&&s.allowFiltering)&&lt.url.pathname.includes("/discover")}),O=$(k().conceptPath.split("\\").reduce((s,T,M,i)=>M===0&&T===""||M===i.length-1&&T===""?s:[...s,T],[])),S=$(_());function _(){if(!O.length)return null;let s=null;for(let T=O.length-1;T>=0;T--)s={name:O[T],value:`\\${O.slice(0,T+1).join("\\")}\\`,children:s?[s]:[],open:!0,selected:!1};return s}let N=q($(k().conceptPath)),C=q(!1);function m(){ve(ne,""),ve(je,!0),B()()}var g=Pt(),V=ae(g);nt(V,{"data-testid":"hierarchy-component-error-modal",title:"Data tree selection too large",closeable:!0,width:"w-1/2",get open(){return t(F)},set open(s){v(F,s,!0)},children:(s,T)=>{var M=Ct(),i=d(l(M),2),h=l(i);h.__click=[Nt,F],n(i),n(M),u(s,M)},$$slots:{default:!0}});var U=d(V,2),J=l(U),R=l(J);{var ee=s=>{st(s,{color:"warning",children:(T,M)=>{var i=St();u(T,i)},$$slots:{default:!0}})};A(R,s=>{t(r)&&s(ee)})}var re=d(R,2);{var Y=s=>{{let T=le(()=>[S]);kt(s,{fullWidth:!0,get nodes(){return t(T)},get disableTree(){return t(r)},onselect:M=>v(N,M,!0)})}};A(re,s=>{S&&s(Y)})}n(J);var K=d(J,2);K.__click=[Tt,C,k,a,N,m,F];var b=l(K);{var x=s=>{Fe(s,{size:"micro",color:"white"})},E=s=>{var T=he(),M=ae(T);{var i=o=>{var p=Et();Je(2),u(o,p)},h=o=>{var p=Lt();u(o,p)};A(M,o=>{t(r)?o(i):o(h,!1)},!0)}u(s,T)};A(b,s=>{t(C)?s(x):s(E,!1)})}n(K),n(U),H(()=>{Z(K,"aria-label",t(C)?"Adding Filter...":"Add Filter"),K.disabled=t(C)||t(r)}),u(f,g),oe(),P()}we(["click"]);const fe={filter:()=>Ut,info:()=>ht,hierarchy:()=>Vt},Se=ue(""),ne=ue(""),Ee=ue(fe.info()),ce=ue(fe.info());function ca(f){const{row:e,table:c,component:P}=f,a=ie(ne)===e,k=!P||ie(ce)===fe[P](),B=!c||ie(Se)===c;a&&k&&B?(ne.set(""),ce.set(ie(Ee))):(ne.set(e),c&&Se.set(c),P?ce.set(fe[P]()):ce.set(ie(Ee)))}var Mt=y('<div class="variable-name"> </div>'),jt=y('<div class="variable-desc"> </div>'),It=y('<div class="variable-study"> </div>'),zt=y('<div class="variable-info"><!> <!> <!></div>'),Ht=y('<div data-testid="categoical-filter" class="w-full"><!></div>'),Wt=y('<div class="card bg-surface-100 p-3 m-1 w-full"><section class="card-body flex grow gap-4" data-testid="numerical-filter"><label class="flex-auto flex-col"><span> </span> <input id="min" data-testid="min-input" type="text" placeholder="Enter value or leave blank for variable min" class="input"/></label> <label class="flex-auto flex-col"><span> </span> <input id="max" data-testid="max-input" type="text" placeholder="Enter value or leave blank for variable max" class="input"/></label></section></div>'),qt=y('<!> <button class="btn btn-icon preset-filled-primary-500 m-1 svelte-ioyacr" data-testid="add-filter" aria-label="Add Filter"><i class="fas fa-plus"></i></button>',1),Bt=y('<div><!> <div class="flex justify-between" data-testid="filter-component"><!></div></div>');function Ut(f,e){se(e,!0);const[c,P]=Pe();let a=Q(e,"data",23,()=>({})),k=Q(e,"onclose",3,()=>{}),B=q(""),F=q(""),r=q(""),O=q(""),S=20,_=q($([])),N=q($([])),C=S,m="",g=q(!1),V=q(""),U=q(""),J=q("");Ge(async()=>{var i,h,o,p,w,W,G;if(e.existingFilter)v(V,((i=a())==null?void 0:i.display)||"",!0),v(U,((h=a())==null?void 0:h.description)||"",!0),v(J,a().studyAcronym&&a().dataset?`${a().studyAcronym} (${a().dataset})`:a().studyAcronym||a().dataset||"",!0),e.existingFilter.filterType==="Categorical"?(e.existingFilter.categoryValues.length===0?v(N,((o=a())==null?void 0:o.values)||[],!0):v(N,e.existingFilter.categoryValues,!0),v(_,((w=(p=a())==null?void 0:p.values)==null?void 0:w.filter(j=>!t(N).find(L=>L===j)))||[],!0),t(_).length>=50&&v(_,t(_).slice(0,S),!0)):e.existingFilter.filterType==="numeric"&&(v(r,e.existingFilter.min!==void 0&&e.existingFilter.min!==null?e.existingFilter.min.toString():"",!0),v(O,e.existingFilter.max!==void 0&&e.existingFilter.max!==null?e.existingFilter.max.toString():"",!0));else if(((W=a())==null?void 0:W.type)==="Categorical")try{v(g,!0),a(await Me(a().conceptPath,a().dataset)),v(g,!1),v(_,((G=a())==null?void 0:G.values)||[],!0),t(_).length>=50&&v(_,t(_).slice(0,S),!0)}catch(j){console.error(j),xe.error({title:"An error occured while loading the filter. Please try again later."})}v(F,a().min!==void 0&&a().min!==null?a().min.toString():"",!0),v(B,a().max!==void 0&&a().max!==null?a().max.toString():"",!0)});function R(){var h,o;let i;if(a().type==="Categorical"){if(!t(Y)||t(Y).length===0)return;t(Y).length===((o=(h=a())==null?void 0:h.values)==null?void 0:o.length)?i=$e(a()):i=et(a(),t(Y))}else i=tt(a(),t(r)||void 0,t(O)||void 0);i&&(Ve(i),ee())}function ee(){ve(ne,""),ve(je,!0),k()()}function re(i=""){var o,p,w;if((((p=(o=a())==null?void 0:o.values)==null?void 0:p.length)||0)!==0){v(g,!0);try{let W=((w=a())==null?void 0:w.values)||[];(i!==m||!m.includes(i))&&(C=0,v(_,[],!0),m=i);let G=W.filter(I=>!t(N).includes(I)&&(!i||I.toLowerCase().includes(i.toLowerCase())));const j=Math.min(C+S,G.length),L=G.slice(C,j);v(_,[...t(_),...L],!0),C=j}catch(W){console.error(W),xe.error({title:"An error occurred while loading more options. Please try again later."})}v(g,!1)}}let Y=le(()=>t(N).map(i=>i));var K=Bt(),b=l(K);{var x=i=>{var h=zt(),o=l(h);{var p=L=>{var I=Mt(),z=l(I);n(I),H(()=>X(z,`Variable Name: ${t(V)??""}`)),u(L,I)};A(o,L=>{t(V)&&L(p)})}var w=d(o,2);{var W=L=>{var I=jt(),z=l(I);n(I),H(()=>X(z,`Variable Description: ${t(U)??""}`)),u(L,I)};A(w,L=>{t(U)&&L(W)})}var G=d(w,2);{var j=L=>{var I=It(),z=l(I);n(I),H(()=>X(z,`Study: ${t(J)??""}`)),u(L,I)};A(G,L=>{t(J)&&L(j)})}n(h),u(i,h)};A(b,i=>{a()&&i(x)})}var E=d(b,2),s=l(E);{var T=i=>{Fe(i,{ring:!0,size:"medium"})},M=i=>{var h=qt(),o=ae(h);{var p=G=>{var j=Ht(),L=l(j);{let I=le(()=>{var z;return(z=a())==null?void 0:z.values});at(L,{get allOptions(){return t(I)},onscroll:re,get unselectedOptions(){return t(_)},set unselectedOptions(z){v(_,z,!0)},get selectedOptions(){return t(N)},set selectedOptions(z){v(N,z,!0)},get currentlyLoading(){return t(g)},set currentlyLoading(z){v(g,z,!0)}})}n(j),u(G,j)},w=G=>{var j=he(),L=ae(j);{var I=z=>{var te=Wt(),Ae=l(te),me=l(Ae),_e=l(me),We=l(_e);n(_e);var Oe=d(_e,2);ge(Oe),n(me);var ke=d(me,2),pe=l(ke),qe=l(pe);n(pe);var Te=d(pe,2);ge(Te),n(ke),n(Ae),n(te),H(()=>{X(We,`Min: ${t(F)??""}`),X(qe,`Max: ${t(B)??""}`)}),Ce(Oe,()=>t(r),ye=>v(r,ye)),Ce(Te,()=>t(O),ye=>v(O,ye)),u(z,te)};A(L,z=>{var te;((te=a())==null?void 0:te.type)==="Continuous"&&z(I)},!0)}u(G,j)};A(o,G=>{var j;((j=a())==null?void 0:j.type)==="Categorical"?G(p):G(w,!1)})}var W=d(o,2);W.__click=R,H(()=>W.disabled=a().type==="Categorical"&&t(Y).length===0),u(i,h)};A(s,i=>{a()?i(M,!1):i(T)})}n(E),n(K),u(f,K),oe(),P()}we(["click"]);export{Ut as A,ne as a,Se as b,ce as c,ca as s};
