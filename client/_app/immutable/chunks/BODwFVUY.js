import"./Bzak7iHL.js";import{aO as $e,p as He,f as B,k as s,u as w,d as h,s as g,r as m,b as x,c as De,t as D,h as $,i as ee,l as q,n as fe,j as Te,a as et,m as tt}from"./pV5yBOfK.js";import{s as te,e as at}from"./D3FUfhzK.js";import{i as J}from"./BAa5cEXk.js";import{e as we,i as Le}from"./CFqqwPkz.js";import{f as j,a as se,c as xe,r as ae,g as Pe,e as rt,d as Ie}from"./B3YVaWvx.js";import{b as st,a as nt}from"./CMMNa4Y8.js";import{p as i,r as it}from"./C2caA9Pm.js";import{g as ot}from"./BLfKYx2_.js";import{C as Y,D as ke,E as lt,F as ye,G as ct,H as dt,I as ut,J as vt,K as ft,L as ht,M as mt,N as H,O as bt,Q as pt,R as gt,t as he}from"./tvkVmxlD.js";import{s as me}from"./CPDBQclr.js";import{c as Et,u as kt,n as yt}from"./BK-nQ0m1.js";import{u as Ct,a as _t,b as Tt}from"./6BAdrzZG.js";import{g as wt}from"./BJn3HusL.js";import{g as Lt}from"./CBcC3yPH.js";import{g as xt}from"./BOOtCoKZ.js";import{E as Pt}from"./C6RsMIt9.js";function It(t){return!(t.metaKey||!ct()&&t.altKey||t.ctrlKey||t.key==="Control"||t.key==="Shift"||t.key==="Meta")}var St=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function Ft(t,e,a){const r=a?ye(a):null,n=Y(r);return t=t||r instanceof n.HTMLInputElement&&!St.has(r==null?void 0:r.type)||r instanceof n.HTMLTextAreaElement||r instanceof n.HTMLElement&&r.isContentEditable,!(t&&e==="keyboard"&&a instanceof n.KeyboardEvent&&!Reflect.has(Ht,a.key))}var M=null,be=new Set,Q=new Map,R=!1,pe=!1,Ht={Tab:!0,Escape:!0};function ie(t,e){for(let a of be)a(t,e)}function ne(t){R=!0,It(t)&&(M="keyboard",ie("keyboard",t))}function L(t){M="pointer",(t.type==="mousedown"||t.type==="pointerdown")&&(R=!0,ie("pointer",t))}function Be(t){lt(t)&&(R=!0,M="virtual")}function Ve(t){const e=ye(t);e===Y(e)||e===ke(e)||(!R&&!pe&&(M="virtual",ie("virtual",t)),R=!1,pe=!1)}function Ae(){R=!1,pe=!0}function Dt(t){if(typeof window>"u"||Q.get(Y(t)))return;const e=Y(t),a=ke(t);let r=e.HTMLElement.prototype.focus;function n(){M="virtual",ie("virtual",null),R=!0,r.apply(this,arguments)}Object.defineProperty(e.HTMLElement.prototype,"focus",{configurable:!0,value:n}),a.addEventListener("keydown",ne,!0),a.addEventListener("keyup",ne,!0),a.addEventListener("click",Be,!0),e.addEventListener("focus",Ve,!0),e.addEventListener("blur",Ae,!1),typeof e.PointerEvent<"u"?(a.addEventListener("pointerdown",L,!0),a.addEventListener("pointermove",L,!0),a.addEventListener("pointerup",L,!0)):(a.addEventListener("mousedown",L,!0),a.addEventListener("mousemove",L,!0),a.addEventListener("mouseup",L,!0)),e.addEventListener("beforeunload",()=>{Bt(t)},{once:!0}),Q.set(e,{focus:r})}var Bt=(t,e)=>{const a=Y(t),r=ke(t);Q.has(a)&&(a.HTMLElement.prototype.focus=Q.get(a).focus,r.removeEventListener("keydown",ne,!0),r.removeEventListener("keyup",ne,!0),r.removeEventListener("click",Be,!0),a.removeEventListener("focus",Ve,!0),a.removeEventListener("blur",Ae,!1),typeof a.PointerEvent<"u"?(r.removeEventListener("pointerdown",L,!0),r.removeEventListener("pointermove",L,!0),r.removeEventListener("pointerup",L,!0)):(r.removeEventListener("mousedown",L,!0),r.removeEventListener("mousemove",L,!0),r.removeEventListener("mouseup",L,!0)),Q.delete(a))};function ge(){return M==="keyboard"}function Vt(t={}){const{isTextInput:e,autoFocus:a,onChange:r,root:n}=t;Dt(n),r==null||r({isFocusVisible:a||ge(),modality:M});const c=(v,_)=>{Ft(!!e,v,_)&&(r==null||r({isFocusVisible:ge(),modality:v}))};return be.add(c),()=>{be.delete(c)}}var At=pt("switch").parts("root","label","control","thumb"),re=At.build(),Re=t=>{var e;return((e=t.ids)==null?void 0:e.root)??`switch:${t.id}`},Se=t=>{var e;return((e=t.ids)==null?void 0:e.label)??`switch:${t.id}:label`},Rt=t=>{var e;return((e=t.ids)==null?void 0:e.thumb)??`switch:${t.id}:thumb`},Mt=t=>{var e;return((e=t.ids)==null?void 0:e.control)??`switch:${t.id}:control`},Ee=t=>{var e;return((e=t.ids)==null?void 0:e.hiddenInput)??`switch:${t.id}:input`},Kt=t=>t.getById(Re(t)),X=t=>t.getById(Ee(t));function Ot(t,e){const{context:a,send:r,prop:n,scope:c}=t,v=!!n("disabled"),_=!!n("readOnly"),K=!!n("required"),T=!!a.get("checked"),V=!v&&a.get("focused"),O=!v&&a.get("focusVisible"),P={"data-active":H(a.get("active")),"data-focus":H(V),"data-focus-visible":H(O),"data-readonly":H(_),"data-hover":H(a.get("hovered")),"data-disabled":H(v),"data-state":T?"checked":"unchecked","data-invalid":H(n("invalid")),"data-required":H(K)};return{checked:T,disabled:v,focused:V,setChecked(y){r({type:"CHECKED.SET",checked:y,isTrusted:!1})},toggleChecked(){r({type:"CHECKED.TOGGLE",checked:T,isTrusted:!1})},getRootProps(){return e.label({...re.root.attrs,...P,dir:n("dir"),id:Re(c),htmlFor:Ee(c),onPointerMove(){v||r({type:"CONTEXT.SET",context:{hovered:!0}})},onPointerLeave(){v||r({type:"CONTEXT.SET",context:{hovered:!1}})},onClick(y){var F;if(v)return;ye(y)===X(c)&&y.stopPropagation(),gt()&&((F=X(c))==null||F.focus())}})},getLabelProps(){return e.element({...re.label.attrs,...P,dir:n("dir"),id:Se(c)})},getThumbProps(){return e.element({...re.thumb.attrs,...P,dir:n("dir"),id:Rt(c),"aria-hidden":!0})},getControlProps(){return e.element({...re.control.attrs,...P,dir:n("dir"),id:Mt(c),"aria-hidden":!0})},getHiddenInputProps(){return e.input({id:Ee(c),type:"checkbox",required:n("required"),defaultChecked:T,disabled:v,"aria-labelledby":Se(c),"aria-invalid":n("invalid"),name:n("name"),form:n("form"),value:n("value"),style:bt,onFocus(){const y=ge();r({type:"CONTEXT.SET",context:{focused:!0,focusVisible:y}})},onBlur(){r({type:"CONTEXT.SET",context:{focused:!1,focusVisible:!1}})},onClick(y){if(_){y.preventDefault();return}const I=y.currentTarget.checked;r({type:"CHECKED.SET",checked:I,isTrusted:!0})}})}}}var{not:Fe}=ut(),Nt=dt({props({props:t}){return{defaultChecked:!1,label:"switch",value:"on",...t}},initialState(){return"ready"},context({prop:t,bindable:e}){return{checked:e(()=>({defaultValue:t("defaultChecked"),value:t("checked"),onChange(a){var r;(r=t("onCheckedChange"))==null||r({checked:a})}})),fieldsetDisabled:e(()=>({defaultValue:!1})),focusVisible:e(()=>({defaultValue:!1})),active:e(()=>({defaultValue:!1})),focused:e(()=>({defaultValue:!1})),hovered:e(()=>({defaultValue:!1}))}},computed:{isDisabled:({context:t,prop:e})=>e("disabled")||t.get("fieldsetDisabled")},watch({track:t,prop:e,context:a,action:r}){t([()=>e("disabled")],()=>{r(["removeFocusIfNeeded"])}),t([()=>a.get("checked")],()=>{r(["syncInputElement"])})},effects:["trackFormControlState","trackPressEvent","trackFocusVisible"],on:{"CHECKED.TOGGLE":[{guard:Fe("isTrusted"),actions:["toggleChecked","dispatchChangeEvent"]},{actions:["toggleChecked"]}],"CHECKED.SET":[{guard:Fe("isTrusted"),actions:["setChecked","dispatchChangeEvent"]},{actions:["setChecked"]}],"CONTEXT.SET":{actions:["setContext"]}},states:{ready:{}},implementations:{guards:{isTrusted:({event:t})=>!!t.isTrusted},effects:{trackPressEvent({computed:t,scope:e,context:a}){if(!t("isDisabled"))return mt({pointerNode:Kt(e),keyboardNode:X(e),isValidKey:r=>r.key===" ",onPress:()=>a.set("active",!1),onPressStart:()=>a.set("active",!0),onPressEnd:()=>a.set("active",!1)})},trackFocusVisible({computed:t,scope:e}){if(!t("isDisabled"))return Vt({root:e.getRootNode()})},trackFormControlState({context:t,send:e,scope:a}){return ht(X(a),{onFieldsetDisabledChange(r){t.set("fieldsetDisabled",r)},onFormReset(){const r=t.initial("checked");e({type:"CHECKED.SET",checked:!!r,src:"form-reset"})}})}},actions:{setContext({context:t,event:e}){for(const a in e.context)t.set(a,e.context[a])},syncInputElement({context:t,scope:e}){const a=X(e);a&&ft(a,!!t.get("checked"))},removeFocusIfNeeded({context:t,prop:e}){e("disabled")&&t.set("focused",!1)},setChecked({context:t,event:e}){t.set("checked",e.checked)},toggleChecked({context:t}){t.set("checked",!t.get("checked"))},dispatchChangeEvent({context:t,scope:e}){const a=X(e);vt(a,{checked:t.get("checked")})}}}});Et()(["checked","defaultChecked","dir","disabled","form","getRootNode","id","ids","invalid","label","name","onCheckedChange","readOnly","required","value"]);var Ut=B('<span data-testid="switch-icon-inactive"><!></span>'),qt=B('<span data-testid="switch-icon-active"><!></span>'),Xt=B("<span><!></span>"),Gt=B("<label><input/> <span><span><!> <!></span></span> <!></label>");function Wt(t,e){const a=$e();He(e,!0);const r=i(e,"compact",3,!1),n=i(e,"base",3,"inline-flex items-center gap-4"),c=i(e,"classes",3,""),v=i(e,"stateFocused",3,"data-[focus-visible]:focused"),_=i(e,"controlBase",3,"cursor-pointer transition duration-200"),K=i(e,"controlInactive",3,"preset-filled-surface-200-800"),T=i(e,"controlActive",3,"preset-filled-primary-500"),V=i(e,"controlDisabled",3,"opacity-50 cursor-not-allowed"),O=i(e,"controlWidth",3,"w-10"),P=i(e,"controlHeight",3,"h-6"),y=i(e,"controlPadding",3,"p-0.5"),I=i(e,"controlRounded",3,"rounded-full"),F=i(e,"controlHover",3,"hover:brightness-90 dark:hover:brightness-110"),N=i(e,"controlClasses",3,""),A=i(e,"thumbBase",3,"right-0 aspect-square h-full flex justify-center items-center text-right cursor-pointer"),U=i(e,"thumbInactive",3,"preset-filled-surface-50-950"),oe=i(e,"thumbActive",3,"bg-surface-50 text-surface-contrast-50"),G=i(e,"thumbRounded",3,"rounded-full"),le=i(e,"thumbTranslateX",3,"translate-x-4 rtl:-translate-x-4"),ce=i(e,"thumbTransition",3,"transition"),de=i(e,"thumbEase",3,"ease-in-out"),l=i(e,"thumbDuration",3,"duration-200"),o=i(e,"thumbClasses",3,""),d=i(e,"labelBase",3,""),b=i(e,"labelClasses",3,""),p=i(e,"iconInactiveBase",3,"pointer-events-none"),f=i(e,"iconActiveBase",3,"pointer-events-none"),E=it(e,["$$slots","$$events","$$legacy","compact","base","classes","stateFocused","controlBase","controlInactive","controlActive","controlDisabled","controlWidth","controlHeight","controlPadding","controlRounded","controlHover","controlClasses","thumbBase","thumbInactive","thumbActive","thumbRounded","thumbTranslateX","thumbTransition","thumbEase","thumbDuration","thumbClasses","labelBase","labelClasses","iconInactiveBase","iconActiveBase","children","inactiveChild","activeChild"]),S=kt(Nt,()=>({id:a,...E})),C=w(()=>Ot(S,yt)),ue=w(()=>r()?A():_()),Me=w(()=>r()?"":P()),Ke=w(()=>r()?"":y()),Oe=w(()=>r()?K():U()),Ne=w(()=>r()?T():oe()),Ue=w(()=>r()?"":le()),qe=w(()=>s(C).checked?T():K()),Xe=w(()=>s(C).checked?`${s(Ne)} ${s(Ue)}`:s(Oe)),Ge=w(()=>s(C).disabled?V():""),We=w(()=>s(C).focused?v():"");var Z=Gt();j(Z,u=>({...u,class:`${n()??""} ${c()??""}`,"data-testid":"switch"}),[()=>s(C).getRootProps()]);var Ce=h(Z);j(Ce,u=>({...u,"data-testid":"switch-input"}),[()=>s(C).getHiddenInputProps()],void 0,void 0,!0);var z=g(Ce,2);j(z,u=>({...u,class:`${s(ue)??""} ${s(qe)??""} ${s(We)??""} ${O()??""} ${s(Me)??""} ${s(Ke)??""} ${I()??""} ${F()??""} ${s(Ge)??""} ${N()??""}`,"data-testid":"switch-control"}),[()=>s(C).getControlProps()]);var ve=h(z);j(ve,u=>({...u,class:`${A()??""} ${s(Xe)??""} ${G()??""} ${ce()??""} ${de()??""} ${l()??""} ${o()??""}`,"data-testid":"switch-thumb"}),[()=>s(C).getThumbProps()]);var _e=h(ve);{var je=u=>{var k=Ut(),W=h(k);me(W,()=>e.inactiveChild),m(k),D(()=>se(k,1,xe(p()))),x(u,k)};J(_e,u=>{!s(C).checked&&e.inactiveChild&&u(je)})}var Je=g(_e,2);{var Qe=u=>{var k=qt(),W=h(k);me(W,()=>e.activeChild),m(k),D(()=>se(k,1,xe(f()))),x(u,k)};J(Je,u=>{s(C).checked&&e.activeChild&&u(Qe)})}m(ve),m(z);var Ye=g(z,2);{var Ze=u=>{var k=Xt();j(k,ze=>({...ze,class:`${d()??""} ${b()??""}`,"data-testid":"switch-label"}),[()=>s(C).getLabelProps()]);var W=h(k);me(W,()=>e.children),m(k),x(u,k)};J(Ye,u=>{e.children&&u(Ze)})}m(Z),x(t,Z),De()}var jt=B('<label class="label"><span>UUID:</span> <input type="text" class="input" disabled/></label> <label class="label"><span>Subject:</span> <input type="text" class="input" disabled/></label>',1),Jt=B("<option> </option>"),Qt=B('<label class="flex items-center space-x-2"><input class="checkbox" type="checkbox"/> <div> </div></label>'),Yt=B('<form><fieldset data-testid="user-form" class="grid gap-4 my-3"><!> <!> <label><span>Email:</span> <input type="email" class="input" required minlength="1" maxlength="255"/></label> <label><span>Connection:</span> <select required><option disabled>none</option><!></select></label> <fieldset data-testid="privilege-checkboxes"><legend class="required">Roles:</legend> <!></fieldset> <!> <div class="mt-2"><button type="submit" class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500">Save</button> <a href="/admin/users" class="btn preset-tonal-secondary border border-secondary-500 hover:preset-filled-secondary-500">Cancel</a></div></fieldset></form>');function ha(t,e){He(e,!0);let a=i(e,"user",3,void 0),r=$(ee(a()&&a().email?a().email:"")),n=$(ee(a()&&a().connection?a().connection:"")),c=$(ee(a()?a().active:!0)),v=ee(e.roleList.map(([l,o])=>({uuid:o,checked:a()?a().roles.includes(o):!1}))),_=$("");async function K(l){var p;l.preventDefault();const o=v.filter(f=>f.checked);if(o.length===0){q(_,"At least one role must be selected.");return}else q(_,"");const d=JSON.parse(((p=a())==null?void 0:p.generalMetadata)||'{"email":""}');d.email=s(r);let b={email:s(r),connection:await wt(s(n)),generalMetadata:JSON.stringify(d),active:s(c),roles:await Promise.all(o.map(f=>Lt(f.uuid).then(E=>({...E,privileges:E.privileges.map(S=>xt(S))}))))};try{if(a())await Ct({...b,uuid:a().uuid});else{if(await _t(s(r),s(n))){he.error({title:"Cannot add a user and connection pair that already exists."});return}await Tt(b)}he.success({title:`Successfully saved ${a()?"":"new "}user '${s(r)}'`}),ot("/admin/users")}catch(f){console.error(f),he.error({title:`An error occured while saving ${a()?"":"new "}user '${s(r)}'`})}}var T=Yt(),V=h(T),O=h(V);Wt(O,{name:"Active",controlActive:"bg-success-500",label:"Status",get checked(){return s(c)},onCheckedChange:()=>q(c,!s(c)),children:(l,o)=>{fe();var d=Te();D(()=>te(d,s(c)?"Active":"Inactive")),x(l,d)},$$slots:{default:!0}});var P=g(O,2);{var y=l=>{var o=jt(),d=et(o),b=g(h(d),2);ae(b),m(d);var p=g(d,2),f=g(h(p),2);ae(f),m(p),D(()=>{var E,S;Ie(b,(E=a())==null?void 0:E.uuid),Ie(f,(S=a())==null?void 0:S.subject)}),x(l,o)};J(P,l=>{var o;(o=a())!=null&&o.uuid&&l(y)})}var I=g(P,2),F=g(h(I),2);ae(F),m(I);var N=g(I,2),A=g(h(N),2),U=h(A);U.value=U.__value=!0;var oe=g(U);we(oe,17,()=>e.connections,Le,(l,o,d,b)=>{var p=Jt(),f=h(p,!0);m(p);var E={};D(()=>{Pe(p,a()&&a().connection===s(o).uuid),te(f,s(o).label),E!==(E=s(o).uuid)&&(p.value=(p.__value=s(o).uuid)??"")}),x(l,p)}),m(A),m(N);var G=g(N,2),le=g(h(G),2);we(le,17,()=>e.roleList,Le,(l,o,d)=>{var b=w(()=>tt(s(o),1));let p=()=>s(b)[0];var f=Qt(),E=h(f);ae(E);var S=g(E,2),C=h(S,!0);m(S),m(f),D(()=>te(C,p())),nt(E,()=>v[d].checked,ue=>v[d].checked=ue),x(l,f)}),m(G);var ce=g(G,2);{var de=l=>{Pt(l,{"data-testid":"validation-error",onclose:()=>q(_,""),children:(o,d)=>{fe();var b=Te();D(()=>te(b,s(_))),x(o,b)},$$slots:{default:!0}})};J(ce,l=>{s(_)&&l(de)})}fe(2),m(V),m(T),D(()=>{var l,o,d,b;se(I,1,`label ${((l=a())==null?void 0:l.email)??"required"??""}`),F.disabled=!!((o=a())!=null&&o.email),se(N,1,`label ${((d=a())==null?void 0:d.email)??"required"??""}`),A.disabled=!!((b=a())!=null&&b.connection),Pe(U,!a()||!a().connection)}),at("submit",T,K),st(F,()=>s(r),l=>q(r,l)),rt(A,()=>s(n),l=>q(n,l)),x(t,T),De()}export{ha as U};
