import{p as rt,f as B,a as x,t as Pe}from"./CtfeAAbw.js";import{p as Ae,c as h,s as g,g as r,h as w,r as m,t as P,a as Me,b as ee,d as te,e as q,n as he,f as nt}from"./B4GrenNm.js";import{s as ae}from"./DxSOTiY2.js";import{i as Q}from"./CSsnQ7i2.js";import{e as Ie,i as Se}from"./BdG0KSB2.js";import{r as J,e as j,b as re,c as Fe,f as He,d as De}from"./BPiAbArq.js";import{e as it}from"./D7VV4X-8.js";import{b as ot,a as lt}from"./CJCVGGPV.js";import{b as ct}from"./BCz5OXXD.js";import{p as i,r as dt}from"./DvPjbdiY.js";import{g as ut}from"./CsA2x4iF.js";import{B as Z,C as ye,D as vt,E as Ce,F as ft,G as ht,H as mt,I as bt,J as pt,K as gt,L as Et,M as A,N as kt,O as yt,Q as Ct,t as me}from"./yAhaO9Md.js";import{s as be}from"./BWMYve5J.js";import{c as _t,u as Tt,n as wt}from"./B7pZD2Tm.js";import{u as Lt,a as xt,b as Pt}from"./CPXbGNdm.js";import{g as It}from"./Y_ekip_5.js";import{g as St}from"./D62jt1bd.js";import{g as Ft}from"./Cw-iVSwx.js";import{E as Ht}from"./BVg5wqNm.js";function Dt(t){return!(t.metaKey||!ft()&&t.altKey||t.ctrlKey||t.key==="Control"||t.key==="Shift"||t.key==="Meta")}var Bt=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function Vt(t,e,a){const s=a?Ce(a):null,n=Z(s);return t=t||s instanceof n.HTMLInputElement&&!Bt.has(s==null?void 0:s.type)||s instanceof n.HTMLTextAreaElement||s instanceof n.HTMLElement&&s.isContentEditable,!(t&&e==="keyboard"&&a instanceof n.KeyboardEvent&&!Reflect.has(At,a.key))}var R=null,pe=new Set,Y=new Map,M=!1,ge=!1,At={Tab:!0,Escape:!0};function ie(t,e){for(let a of pe)a(t,e)}function ne(t){M=!0,Dt(t)&&(R="keyboard",ie("keyboard",t))}function T(t){R="pointer",(t.type==="mousedown"||t.type==="pointerdown")&&(M=!0,ie("pointer",t))}function Re(t){vt(t)&&(M=!0,R="virtual")}function Ke(t){const e=Ce(t);e===Z(e)||e===ye(e)||(!M&&!ge&&(R="virtual",ie("virtual",t)),M=!1,ge=!1)}function Ne(){M=!1,ge=!0}function Mt(t){if(typeof window>"u"||Y.get(Z(t)))return;const e=Z(t),a=ye(t);let s=e.HTMLElement.prototype.focus;function n(){R="virtual",ie("virtual",null),M=!0,s.apply(this,arguments)}Object.defineProperty(e.HTMLElement.prototype,"focus",{configurable:!0,value:n}),a.addEventListener("keydown",ne,!0),a.addEventListener("keyup",ne,!0),a.addEventListener("click",Re,!0),e.addEventListener("focus",Ke,!0),e.addEventListener("blur",Ne,!1),typeof e.PointerEvent<"u"?(a.addEventListener("pointerdown",T,!0),a.addEventListener("pointermove",T,!0),a.addEventListener("pointerup",T,!0)):(a.addEventListener("mousedown",T,!0),a.addEventListener("mousemove",T,!0),a.addEventListener("mouseup",T,!0)),e.addEventListener("beforeunload",()=>{Rt(t)},{once:!0}),Y.set(e,{focus:s})}var Rt=(t,e)=>{const a=Z(t),s=ye(t);Y.has(a)&&(a.HTMLElement.prototype.focus=Y.get(a).focus,s.removeEventListener("keydown",ne,!0),s.removeEventListener("keyup",ne,!0),s.removeEventListener("click",Re,!0),a.removeEventListener("focus",Ke,!0),a.removeEventListener("blur",Ne,!1),typeof a.PointerEvent<"u"?(s.removeEventListener("pointerdown",T,!0),s.removeEventListener("pointermove",T,!0),s.removeEventListener("pointerup",T,!0)):(s.removeEventListener("mousedown",T,!0),s.removeEventListener("mousemove",T,!0),s.removeEventListener("mouseup",T,!0)),Y.delete(a))};function Ee(){return R==="keyboard"}function Kt(t={}){const{isTextInput:e,autoFocus:a,onChange:s,root:n}=t;Mt(n),s==null||s({isFocusVisible:a||Ee(),modality:R});const c=(f,C)=>{Vt(!!e,f,C)&&(s==null||s({isFocusVisible:Ee(),modality:f}))};return pe.add(c),()=>{pe.delete(c)}}var Nt=yt("switch").parts("root","label","control","thumb"),se=Nt.build(),Oe=t=>{var e;return((e=t.ids)==null?void 0:e.root)??`switch:${t.id}`},Be=t=>{var e;return((e=t.ids)==null?void 0:e.label)??`switch:${t.id}:label`},Ot=t=>{var e;return((e=t.ids)==null?void 0:e.thumb)??`switch:${t.id}:thumb`},Ut=t=>{var e;return((e=t.ids)==null?void 0:e.control)??`switch:${t.id}:control`},ke=t=>{var e;return((e=t.ids)==null?void 0:e.hiddenInput)??`switch:${t.id}:input`},qt=t=>t.getById(Oe(t)),X=t=>t.getById(ke(t));function Xt(t,e){const{context:a,send:s,prop:n,scope:c}=t,f=n("disabled"),C=n("readOnly"),I=!!a.get("checked"),L=!f&&a.get("focused"),K=!f&&a.get("focusVisible"),S={"data-active":A(a.get("active")),"data-focus":A(L),"data-focus-visible":A(K),"data-readonly":A(C),"data-hover":A(a.get("hovered")),"data-disabled":A(f),"data-state":I?"checked":"unchecked","data-invalid":A(n("invalid"))};return{checked:I,disabled:f,focused:L,setChecked(E){s({type:"CHECKED.SET",checked:E,isTrusted:!1})},toggleChecked(){s({type:"CHECKED.TOGGLE",checked:I,isTrusted:!1})},getRootProps(){return e.label({...se.root.attrs,...S,dir:n("dir"),id:Oe(c),htmlFor:ke(c),onPointerMove(){f||s({type:"CONTEXT.SET",context:{hovered:!0}})},onPointerLeave(){f||s({type:"CONTEXT.SET",context:{hovered:!1}})},onClick(E){var F;if(f)return;Ce(E)===X(c)&&E.stopPropagation(),Ct()&&((F=X(c))==null||F.focus())}})},getLabelProps(){return e.element({...se.label.attrs,...S,dir:n("dir"),id:Be(c)})},getThumbProps(){return e.element({...se.thumb.attrs,...S,dir:n("dir"),id:Ot(c),"aria-hidden":!0})},getControlProps(){return e.element({...se.control.attrs,...S,dir:n("dir"),id:Ut(c),"aria-hidden":!0})},getHiddenInputProps(){return e.input({id:ke(c),type:"checkbox",required:n("required"),defaultChecked:I,disabled:f,"aria-labelledby":Be(c),"aria-invalid":n("invalid"),name:n("name"),form:n("form"),value:n("value"),style:kt,onFocus(){const E=Ee();s({type:"CONTEXT.SET",context:{focused:!0,focusVisible:E}})},onBlur(){s({type:"CONTEXT.SET",context:{focused:!1,focusVisible:!1}})},onClick(E){if(C){E.preventDefault();return}const N=E.currentTarget.checked;s({type:"CHECKED.SET",checked:N,isTrusted:!0})}})}}}var{not:Ve}=mt(),Gt=ht({props({props:t}){return{defaultChecked:!1,label:"switch",value:"on",...t}},initialState(){return"ready"},context({prop:t,bindable:e}){return{checked:e(()=>({defaultValue:t("defaultChecked"),value:t("checked"),onChange(a){var s;(s=t("onCheckedChange"))==null||s({checked:a})}})),fieldsetDisabled:e(()=>({defaultValue:!1})),focusVisible:e(()=>({defaultValue:!1})),active:e(()=>({defaultValue:!1})),focused:e(()=>({defaultValue:!1})),hovered:e(()=>({defaultValue:!1}))}},computed:{isDisabled:({context:t,prop:e})=>e("disabled")||t.get("fieldsetDisabled")},watch({track:t,prop:e,context:a,action:s}){t([()=>e("disabled")],()=>{s(["removeFocusIfNeeded"])}),t([()=>a.get("checked")],()=>{s(["syncInputElement"])})},effects:["trackFormControlState","trackPressEvent","trackFocusVisible"],on:{"CHECKED.TOGGLE":[{guard:Ve("isTrusted"),actions:["toggleChecked","dispatchChangeEvent"]},{actions:["toggleChecked"]}],"CHECKED.SET":[{guard:Ve("isTrusted"),actions:["setChecked","dispatchChangeEvent"]},{actions:["setChecked"]}],"CONTEXT.SET":{actions:["setContext"]}},states:{ready:{}},implementations:{guards:{isTrusted:({event:t})=>!!t.isTrusted},effects:{trackPressEvent({computed:t,scope:e,context:a}){if(!t("isDisabled"))return Et({pointerNode:qt(e),keyboardNode:X(e),isValidKey:s=>s.key===" ",onPress:()=>a.set("active",!1),onPressStart:()=>a.set("active",!0),onPressEnd:()=>a.set("active",!1)})},trackFocusVisible({computed:t,scope:e}){if(!t("isDisabled"))return Kt({root:e.getRootNode()})},trackFormControlState({context:t,send:e,scope:a}){return gt(X(a),{onFieldsetDisabledChange(s){t.set("fieldsetDisabled",s)},onFormReset(){const s=t.initial("checked");e({type:"CHECKED.SET",checked:!!s,src:"form-reset"})}})}},actions:{setContext({context:t,event:e}){for(const a in e.context)t.set(a,e.context[a])},syncInputElement({context:t,scope:e}){const a=X(e);a&&pt(a,!!t.get("checked"))},removeFocusIfNeeded({context:t,prop:e}){e("disabled")&&t.set("focused",!1)},setChecked({context:t,event:e}){t.set("checked",e.checked)},toggleChecked({context:t}){t.set("checked",!t.get("checked"))},dispatchChangeEvent({context:t,scope:e}){const a=X(e);bt(a,{checked:t.get("checked")})}}}});_t()(["checked","defaultChecked","dir","disabled","form","getRootNode","id","ids","invalid","label","name","onCheckedChange","readOnly","required","value"]);var Wt=B('<span data-testid="switch-icon-inactive"><!></span>'),jt=B('<span data-testid="switch-icon-active"><!></span>'),Jt=B("<span><!></span>"),Qt=B("<label><input/> <span><span><!> <!></span></span> <!></label>");function Yt(t,e){const a=rt();Ae(e,!0);const s=i(e,"compact",3,!1),n=i(e,"base",3,"inline-flex items-center gap-4"),c=i(e,"classes",3,""),f=i(e,"stateFocused",3,"data-[focus-visible]:focused"),C=i(e,"controlBase",3,"cursor-pointer transition duration-200"),I=i(e,"controlInactive",3,"preset-filled-surface-200-800"),L=i(e,"controlActive",3,"preset-filled-primary-500"),K=i(e,"controlDisabled",3,"opacity-50 cursor-not-allowed"),S=i(e,"controlWidth",3,"w-10"),E=i(e,"controlHeight",3,"h-6"),N=i(e,"controlPadding",3,"p-0.5"),F=i(e,"controlRounded",3,"rounded-full"),G=i(e,"controlHover",3,"hover:brightness-90 dark:hover:brightness-110"),O=i(e,"controlClasses",3,""),V=i(e,"thumbBase",3,"right-0 aspect-square h-full flex justify-center items-center text-right cursor-pointer"),U=i(e,"thumbInactive",3,"preset-filled-surface-50-950"),oe=i(e,"thumbActive",3,"bg-surface-50 text-surface-contrast-50"),W=i(e,"thumbRounded",3,"rounded-full"),le=i(e,"thumbTranslateX",3,"translate-x-4 rtl:-translate-x-4"),ce=i(e,"thumbTransition",3,"transition"),de=i(e,"thumbEase",3,"ease-in-out"),l=i(e,"thumbDuration",3,"duration-200"),o=i(e,"thumbClasses",3,""),d=i(e,"labelBase",3,""),b=i(e,"labelClasses",3,""),u=i(e,"iconInactiveBase",3,"pointer-events-none"),v=i(e,"iconActiveBase",3,"pointer-events-none"),_=dt(e,["$$slots","$$events","$$legacy","compact","base","classes","stateFocused","controlBase","controlInactive","controlActive","controlDisabled","controlWidth","controlHeight","controlPadding","controlRounded","controlHover","controlClasses","thumbBase","thumbInactive","thumbActive","thumbRounded","thumbTranslateX","thumbTransition","thumbEase","thumbDuration","thumbClasses","labelBase","labelClasses","iconInactiveBase","iconActiveBase","children","inactiveChild","activeChild"]),H=Tt(Gt,()=>({id:a,..._})),k=w(()=>Xt(H,wt)),Ue=w(()=>s()?V():C()),qe=w(()=>s()?"":E()),Xe=w(()=>s()?"":N()),Ge=w(()=>s()?I():U()),We=w(()=>s()?L():oe()),je=w(()=>s()?"":le()),Je=w(()=>r(k).checked?L():I()),Qe=w(()=>r(k).checked?`${r(We)} ${r(je)}`:r(Ge)),Ye=w(()=>r(k).disabled?K():""),Ze=w(()=>r(k).focused?f():"");var z=Qt();let _e;var ue=h(z);J(ue);let Te;var $=g(ue,2);let we;var ve=h($);let Le;var xe=h(ve);{var ze=y=>{var p=Wt(),D=h(p);be(D,()=>e.inactiveChild),m(p),P(()=>re(p,1,Fe(u()))),x(y,p)};Q(xe,y=>{!r(k).checked&&e.inactiveChild&&y(ze)})}var $e=g(xe,2);{var et=y=>{var p=jt(),D=h(p);be(D,()=>e.activeChild),m(p),P(()=>re(p,1,Fe(v()))),x(y,p)};Q($e,y=>{r(k).checked&&e.activeChild&&y(et)})}m(ve),m($);var tt=g($,2);{var at=y=>{var p=Jt();let D;var fe=h(p);be(fe,()=>e.children),m(p),P(st=>D=j(p,D,{...st,class:`${d()??""} ${b()??""}`,"data-testid":"switch-label"}),[()=>r(k).getLabelProps()]),x(y,p)};Q(tt,y=>{e.children&&y(at)})}m(z),P((y,p,D,fe)=>{_e=j(z,_e,{...y,class:`${n()??""} ${c()??""}`,"data-testid":"switch"}),Te=j(ue,Te,{...p,"data-testid":"switch-input"}),we=j($,we,{...D,class:`${r(Ue)??""} ${r(Je)??""} ${r(Ze)??""} ${S()??""} ${r(qe)??""} ${r(Xe)??""} ${F()??""} ${G()??""} ${r(Ye)??""} ${O()??""}`,"data-testid":"switch-control"}),Le=j(ve,Le,{...fe,class:`${V()??""} ${r(Qe)??""} ${W()??""} ${ce()??""} ${de()??""} ${l()??""} ${o()??""}`,"data-testid":"switch-thumb"})},[()=>r(k).getRootProps(),()=>r(k).getHiddenInputProps(),()=>r(k).getControlProps(),()=>r(k).getThumbProps()]),x(t,z),Me()}var Zt=B('<label class="label"><span>UUID:</span> <input type="text" class="input" disabled/></label> <label class="label"><span>Subject:</span> <input type="text" class="input" disabled/></label>',1),zt=B("<option> </option>"),$t=B('<label class="flex items-center space-x-2"><input class="checkbox" type="checkbox"/> <div> </div></label>'),ea=B('<form><fieldset data-testid="user-form" class="grid gap-4 my-3"><!> <!> <label><span>Email:</span> <input type="email" class="input" required minlength="1" maxlength="255"/></label> <label><span>Connection:</span> <select required><option disabled>none</option><!></select></label> <fieldset data-testid="privilege-checkboxes"><legend class="required">Roles:</legend> <!></fieldset> <!> <div class="mt-2"><button type="submit" class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500">Save</button> <a href="/admin/users" class="btn preset-tonal-secondary border border-secondary-500 hover:preset-filled-secondary-500">Cancel</a></div></fieldset></form>');function ka(t,e){Ae(e,!0);let a=i(e,"user",3,void 0),s=ee(te(a()&&a().email?a().email:"")),n=ee(te(a()&&a().connection?a().connection:"")),c=ee(te(a()?a().active:!0)),f=te(e.roleList.map(([l,o])=>({uuid:o,checked:a()?a().roles.includes(o):!1}))),C=ee("");async function I(l){var u;l.preventDefault();const o=f.filter(v=>v.checked);if(o.length===0){q(C,"At least one role must be selected.");return}else q(C,"");const d=JSON.parse(((u=a())==null?void 0:u.generalMetadata)||'{"email":""}');d.email=r(s);let b={email:r(s),connection:await It(r(n)),generalMetadata:JSON.stringify(d),active:r(c),roles:await Promise.all(o.map(v=>St(v.uuid).then(_=>({..._,privileges:_.privileges.map(H=>Ft(H))}))))};try{if(a())await Lt({...b,uuid:a().uuid});else{if(await xt(r(s),r(n))){me.error({title:"Cannot add a user and connection pair that already exists."});return}await Pt(b)}me.success({title:`Successfully saved ${a()?"":"new "}user '${r(s)}'`}),ut("/admin/users")}catch(v){console.error(v),me.error({title:`An error occured while saving ${a()?"":"new "}user '${r(s)}'`})}}var L=ea(),K=h(L),S=h(K);Yt(S,{name:"Active",controlActive:"bg-success-500",label:"Status",get checked(){return r(c)},onCheckedChange:()=>q(c,!r(c)),children:(l,o)=>{he();var d=Pe();P(()=>ae(d,r(c)?"Active":"Inactive")),x(l,d)},$$slots:{default:!0}});var E=g(S,2);{var N=l=>{var o=Zt(),d=nt(o),b=g(h(d),2);J(b),m(d);var u=g(d,2),v=g(h(u),2);J(v),m(u),P(()=>{var _,H;De(b,(_=a())==null?void 0:_.uuid),De(v,(H=a())==null?void 0:H.subject)}),x(l,o)};Q(E,l=>{var o;(o=a())!=null&&o.uuid&&l(N)})}var F=g(E,2),G=g(h(F),2);J(G),m(F);var O=g(F,2),V=g(h(O),2),U=h(V);U.value=U.__value=!0;var oe=g(U);Ie(oe,17,()=>e.connections,Se,(l,o,d,b)=>{var u=zt(),v={},_=h(u,!0);m(u),P(()=>{v!==(v=r(o).uuid)&&(u.value=(u.__value=r(o).uuid)??""),He(u,a()&&a().connection===r(o).uuid),ae(_,r(o).label)}),x(l,u)}),m(V),m(O);var W=g(O,2),le=g(h(W),2);Ie(le,17,()=>e.roleList,Se,(l,o,d)=>{let b=()=>r(o)[0];var u=$t(),v=h(u);J(v);var _=g(v,2),H=h(_,!0);m(_),m(u),P(()=>ae(H,b())),lt(v,()=>f[d].checked,k=>f[d].checked=k),x(l,u)}),m(W);var ce=g(W,2);{var de=l=>{Ht(l,{"data-testid":"validation-error",onclose:()=>q(C,""),children:(o,d)=>{he();var b=Pe();P(()=>ae(b,r(C))),x(o,b)},$$slots:{default:!0}})};Q(ce,l=>{r(C)&&l(de)})}he(2),m(K),m(L),P(()=>{var l,o,d,b;re(F,1,`label ${((l=a())==null?void 0:l.email)??"required"??""}`),G.disabled=!!((o=a())!=null&&o.email),re(O,1,`label ${((d=a())==null?void 0:d.email)??"required"??""}`),V.disabled=!!((b=a())!=null&&b.connection),He(U,!a()||!a().connection)}),it("submit",L,I),ot(G,()=>r(s),l=>q(s,l)),ct(V,()=>r(n),l=>q(n,l)),x(t,L),Me()}export{ka as U};
