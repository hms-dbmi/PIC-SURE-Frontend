import{s as me,e as d,a as w,t as le,c as _,b as I,g as A,l as J,f as y,d as ne,m as f,U as W,P as ve,i as ae,h as o,V as ce,O as V,W as be,n as ue,R as he,w as ke,j as pe,X as Ce}from"./scheduler.bui7uCNy.js";import{e as Q}from"./each.VHlBgARd.js";import{S as Ee,i as Se}from"./index.CNwEczq-.js";import{g as Le}from"./entry.A9MTiJM-.js";import{g as Pe}from"./stores.SG0YUSz5.js";import"./ProgressBar.svelte_svelte_type_style_lang.BKgxDQCH.js";import{U as ye,C as Ue}from"./Connections.DLwCnRzZ.js";import{R as Ne}from"./Roles.CynUmLYc.js";import{P as Te}from"./Privileges.BDpTBwDx.js";function fe(l,e,n){const r=l.slice();return r[18]=e[n][0],r[19]=e,r[20]=n,r}function de(l,e,n){const r=l.slice();return r[6]=e[n],r}function _e(l){let e,n=l[6].label+"",r,b,h;return{c(){e=d("option"),r=le(n),this.h()},l(u){e=_(u,"OPTION",{});var g=I(e);r=ne(g,n),g.forEach(y),this.h()},h(){e.__value=b=l[6].uuid,W(e,e.__value),e.selected=h=l[0]&&l[0].connection===l[6].uuid},m(u,g){ae(u,e,g),o(e,r)},p(u,g){g&4&&n!==(n=u[6].label+"")&&pe(r,n),g&4&&b!==(b=u[6].uuid)&&(e.__value=b,W(e,e.__value)),g&5&&h!==(h=u[0]&&u[0].connection===u[6].uuid)&&(e.selected=h)},d(u){u&&y(e)}}}function ge(l){let e,n,r,b,h=l[18]+"",u,g,S,i;function q(){l[11].call(n,l[20])}return{c(){e=d("label"),n=d("input"),r=w(),b=d("p"),u=le(h),g=w(),this.h()},l(C){e=_(C,"LABEL",{class:!0});var s=I(e);n=_(s,"INPUT",{class:!0,type:!0}),r=A(s),b=_(s,"P",{});var U=I(b);u=ne(U,h),U.forEach(y),g=A(s),s.forEach(y),this.h()},h(){f(n,"class","checkbox"),f(n,"type","checkbox"),f(e,"class","flex items-center space-x-2 svelte-1hg36ee")},m(C,s){ae(C,e,s),o(e,n),n.checked=l[5][l[20]].checked,o(e,r),o(e,b),o(b,u),o(e,g),S||(i=V(n,"change",q),S=!0)},p(C,s){l=C,s&32&&(n.checked=l[5][l[20]].checked),s&2&&h!==(h=l[18]+"")&&pe(u,h)},d(C){C&&y(e),S=!1,i()}}}function we(l){let e,n,r,b,h,u="Active",g,S,i,q="Email:",C,s,U,L,N,X="Connection:",j,E,P,G,p,T,k,R,z="Roles:",Y,Z,B,se="Save",$,M,oe="Cancel",ee,re,x=Q(l[2]),m=[];for(let a=0;a<x.length;a+=1)m[a]=_e(de(l,x,a));let D=Q(l[1]),v=[];for(let a=0;a<D.length;a+=1)v[a]=ge(fe(l,D,a));return{c(){e=d("form"),n=d("label"),r=d("input"),b=w(),h=d("p"),h.textContent=u,g=w(),S=d("label"),i=d("span"),i.textContent=q,C=w(),s=d("input"),U=w(),L=d("label"),N=d("span"),N.textContent=X,j=w(),E=d("select"),P=d("option"),G=le("none");for(let a=0;a<m.length;a+=1)m[a].c();T=w(),k=d("fieldset"),R=d("legend"),R.textContent=z,Y=w();for(let a=0;a<v.length;a+=1)v[a].c();Z=w(),B=d("button"),B.textContent=se,$=w(),M=d("a"),M.textContent=oe,this.h()},l(a){e=_(a,"FORM",{});var c=I(e);n=_(c,"LABEL",{class:!0});var t=I(n);r=_(t,"INPUT",{class:!0,type:!0}),b=A(t),h=_(t,"P",{"data-svelte-h":!0}),J(h)!=="svelte-9a8exy"&&(h.textContent=u),t.forEach(y),g=A(c),S=_(c,"LABEL",{class:!0});var O=I(S);i=_(O,"SPAN",{"data-svelte-h":!0}),J(i)!=="svelte-1s4kc5o"&&(i.textContent=q),C=A(O),s=_(O,"INPUT",{type:!0,class:!0,minlength:!0,maxlength:!0}),O.forEach(y),U=A(c),L=_(c,"LABEL",{class:!0});var H=I(L);N=_(H,"SPAN",{"data-svelte-h":!0}),J(N)!=="svelte-ir2yyg"&&(N.textContent=X),j=A(H),E=_(H,"SELECT",{class:!0});var te=I(E);P=_(te,"OPTION",{});var ie=I(P);G=ne(ie,"none"),ie.forEach(y);for(let F=0;F<m.length;F+=1)m[F].l(te);te.forEach(y),H.forEach(y),T=A(c),k=_(c,"FIELDSET",{"data-testid":!0,class:!0});var K=I(k);R=_(K,"LEGEND",{"data-svelte-h":!0}),J(R)!=="svelte-1uxa1d9"&&(R.textContent=z),Y=A(K);for(let F=0;F<v.length;F+=1)v[F].l(K);K.forEach(y),Z=A(c),B=_(c,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),J(B)!=="svelte-uo67us"&&(B.textContent=se),$=A(c),M=_(c,"A",{href:!0,class:!0,"data-svelte-h":!0}),J(M)!=="svelte-13l4n87"&&(M.textContent=oe),c.forEach(y),this.h()},h(){f(r,"class","checkbox"),f(r,"type","checkbox"),f(n,"class","flex items-center space-x-2 svelte-1hg36ee"),f(s,"type","email"),f(s,"class","input"),s.required=!0,f(s,"minlength","1"),f(s,"maxlength","255"),f(S,"class","label required svelte-1hg36ee"),P.selected=p=!l[0]||!l[0].connection,P.disabled=!0,P.__value="",W(P,P.__value),f(E,"class","select"),E.required=!0,l[6]===void 0&&ve(()=>l[10].call(E)),f(L,"class","label required svelte-1hg36ee"),f(k,"data-testid","privilege-checkboxes"),f(k,"class","svelte-1hg36ee"),f(B,"type","submit"),f(B,"class","btn variant-ghost-primary hover:variant-filled-primary"),f(M,"href","/admin/users"),f(M,"class","btn variant-ghost-secondary hover:variant-filled-secondary")},m(a,c){ae(a,e,c),o(e,n),o(n,r),r.checked=l[4],o(n,b),o(n,h),o(e,g),o(e,S),o(S,i),o(S,C),o(S,s),W(s,l[3]),o(e,U),o(e,L),o(L,N),o(L,j),o(L,E),o(E,P),o(P,G);for(let t=0;t<m.length;t+=1)m[t]&&m[t].m(E,null);ce(E,l[6],!0),o(e,T),o(e,k),o(k,R),o(k,Y);for(let t=0;t<v.length;t+=1)v[t]&&v[t].m(k,null);o(e,Z),o(e,B),o(e,$),o(e,M),ee||(re=[V(r,"change",l[8]),V(s,"input",l[9]),V(E,"change",l[10]),V(e,"submit",be(l[7]))],ee=!0)},p(a,[c]){if(c&16&&(r.checked=a[4]),c&8&&s.value!==a[3]&&W(s,a[3]),c&1&&p!==(p=!a[0]||!a[0].connection)&&(P.selected=p),c&5){x=Q(a[2]);let t;for(t=0;t<x.length;t+=1){const O=de(a,x,t);m[t]?m[t].p(O,c):(m[t]=_e(O),m[t].c(),m[t].m(E,null))}for(;t<m.length;t+=1)m[t].d(1);m.length=x.length}if(c&68&&ce(E,a[6]),c&34){D=Q(a[1]);let t;for(t=0;t<D.length;t+=1){const O=fe(a,D,t);v[t]?v[t].p(O,c):(v[t]=ge(O),v[t].c(),v[t].m(k,null))}for(;t<v.length;t+=1)v[t].d(1);v.length=D.length}},i:ue,o:ue,d(a){a&&y(e),he(m,a),he(v,a),ee=!1,ke(re)}}}function Ae(l,e,n){const r=Pe(),{addUser:b,updateUser:h}=ye,{getConnection:u}=Ue,{getRole:g}=Ne,{getPrivilege:S}=Te;let{user:i=void 0}=e,{roleList:q}=e,{connections:C}=e,s=i?i.email:"",U=i?i.connection:"",L=i?i.active:!0,N=q.map(([p,T])=>({uuid:T,checked:i?i.roles.includes(T):!1}));async function X(){const p=JSON.parse((i==null?void 0:i.generalMetadata)||'{"email":""}');p.email=s;let T={email:s,connection:await u(U),generalMetadata:JSON.stringify(p),active:L,roles:await Promise.all(N.filter(k=>k.checked).map(k=>g(k.uuid).then(R=>({...R,privileges:R.privileges.map(z=>S(z))}))))};try{i?await h({...T,uuid:i.uuid}):await b(T),r.trigger({message:`Successfully saved ${T?"new user":"user"} '${s}'`,background:"variant-filled-success"}),Le("/admin/users")}catch(k){console.error(k),r.trigger({message:`An error occured while saving ${T?"new user":"user"} '${s}'`,background:"variant-filled-error"})}}function j(){L=this.checked,n(4,L)}function E(){s=this.value,n(3,s)}function P(){U=Ce(this),n(6,U),n(2,C)}function G(p){N[p].checked=this.checked,n(5,N)}return l.$$set=p=>{"user"in p&&n(0,i=p.user),"roleList"in p&&n(1,q=p.roleList),"connections"in p&&n(2,C=p.connections)},[i,q,C,s,L,N,U,X,j,E,P,G]}class Je extends Ee{constructor(e){super(),Se(this,e,Ae,we,me,{user:0,roleList:1,connections:2})}}export{Je as U};
