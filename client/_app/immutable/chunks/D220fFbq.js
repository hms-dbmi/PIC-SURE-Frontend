var d=Object.defineProperty;var l=(s,i,t)=>i in s?d(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t;var e=(s,i,t)=>l(s,typeof i!="symbol"?i+"":i,t);import{A as u}from"./DExt_NHW.js";import{c as p,P as g}from"./M2p3ZkHt.js";class I extends u{constructor(t){super(t);e(this,"uri");e(this,"clientid");e(this,"state");e(this,"oktaidpid");e(this,"oktalogouturl");e(this,"idp");e(this,"authenticate",async t=>{const n=this.getResponseMap(t),o=n.get("code"),a=n.get("state")||"",c=this.state;if(!o||c!==a){console.debug("RAS authentication failed code: ",o," state: ",a," localState: ",c);return}const r=await p(`${g.Auth}/ras`,{code:o});if(r&&(r!=null&&r.oktaIdToken))return r.oktaIdToken&&localStorage.setItem("oktaIdToken",r.oktaIdToken),r;throw new Error("RAS authentication failed. Missing Okta ID token.")});e(this,"login",async(t,n)=>{let o="/";{o=this.getRedirectURI(),o=o.replace(/\/$/,""),this.saveState(t,n,this.idp);const a=encodeURIComponent(this.clientid),c=encodeURIComponent(this.oktaidpid);window.location.href=`${this.uri}?response_type=code&scope=openid&client_id=${a}&idp=${c}&redirect_uri=${o}&state=${this.state}`}});e(this,"logout",()=>{localStorage.removeItem("state");const t=encodeURI(`${window.location.protocol}//${window.location.hostname}${window.location.port?":"+window.location.port:""}/login`),n=localStorage.getItem("oktaIdToken"),o=this.oktalogouturl+"?id_token_hint="+n+"&post_logout_redirect_uri="+t,a=encodeURIComponent(o),c=this.logouturl+a;return Promise.resolve(c)});if(this.state=localStorage.getItem("state")||"ras-"+this.generateRandomState(),localStorage.setItem("state",this.state),t.uri===void 0||t.clientid===void 0||t.oktaidpid===void 0||t.logouturl===void 0||t.oktalogouturl===void 0)throw new Error("Missing required RAS parameter(s).");this.uri=t.uri,this.clientid=t.clientid,this.oktaidpid=t.oktaidpid,this.idp=t.idp,this.oktalogouturl=t.oktalogouturl}generateRandomState(){const t=Math.random().toString(36).substring(2,15),n=new Date().getTime().toString(36);return t+n}}export{I as default};
