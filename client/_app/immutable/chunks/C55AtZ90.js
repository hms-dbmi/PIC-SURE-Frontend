import{Q as _,g as l,f as m,b as y,c as g,h as v}from"./Bji3XOvx.js";import"./BOAiLg0g.js";import{g as c}from"./xU7jw7XU.js";import{r as i}from"./M2p3ZkHt.js";import{e as F}from"./eUoM9-xI.js";const h="\\DCC Harmonized data set",T="\\_harmonized_consent\\",C="\\_topmed_consents\\";function k(e=!0,n=c(i).hpdsAuth,a="COUNT",r=t=>t){return V(!e,n,a,t=>([...c(l),...c(m)].forEach(s=>{s.filterType==="Categorical"?s.displayType==="restrict"?t.addCategoryFilter(s.id,s.categoryValues):t.addRequiredField(s.id):s.filterType==="numeric"?t.addNumericFilter(s.id,s.min||"",s.max||""):s.filterType==="genomic"?t.addCategoryVariantInfoFilters({Gene_with_variant:s.Gene_with_variant,Variant_consequence_calculated:s.Variant_consequence_calculated,Variant_frequency_as_text:s.Variant_frequency_as_text}):s.filterType==="snp"?t.addSnpFilter(s.snpValues):s.filterType==="AnyRecordOf"&&t.addAnyRecordOfMulti(s.concepts)}),c(F).forEach(s=>{s.conceptPath&&t.addField(s.conceptPath)}),r(t)))}function V(e=!1,n=c(i).hpdsAuth,a="COUNT",r=t=>t){let t=new _;return t=r(t),t.expectedResultType=a,{query:t,resourceUUID:n}}const I=e=>(!p(e.categoryFilters)&&!p(e.numericFilters)&&!d(e.fields)&&!d(e.requiredFields)&&e.removeCategoryFilter(T),c(v)||e.removeCategoryFilter(C),e),p=e=>Object.keys(e).some(n=>n.includes(h)),d=e=>e.some(n=>n.includes(h)),o=e=>{if(e==null)return;if(typeof e=="number")return Number.isFinite(e)?e:void 0;const n=e.trim();if(n==="")return;const a=n.replace(/[,_\s\u00A0\u202F]/g,""),r=Number(a);return Number.isFinite(r)?r:void 0};function f(e){return JSON.parse(JSON.stringify(e,(n,a)=>{if(n!=="type")return a}))}function R(e){if(e.root.children.length===0)return null;const n=r=>({type:"PhenotypicSubquery",operator:r,phenotypicClauses:[],not:!1}),a=r=>{if(e.isGroup(r)){const t=n(r.operator);return t.phenotypicClauses=r.children.map(a),t}return E(r)};return a(e.root)}function z(e=!0,n=c(i).hpdsAuth,a="COUNT",r=t=>t){return x(!e,n,a,t=>(t.phenotypicClause=R(c(g)),c(l).forEach(s=>{s.filterType==="snp"?N(s).forEach(u=>{t.genomicFilters.push(u)}):s.filterType==="genomic"&&O(s).forEach(u=>{t.genomicFilters.push(u)})}),r(t)))}function x(e=!1,n=c(i).hpdsAuth,a="COUNT",r=t=>t){let t=new y;return t.expectedResultType=a,t=r(t),{query:f(t),resourceUUID:n}}const E=e=>{var a;const n={type:"PhenotypicFilter",phenotypicFilterType:b(e.filterType),conceptPath:e.id,not:!1};switch(e.filterType){case"AnyRecordOf":n.phenotypicFilterType="ANY_RECORD_OF",n.values=e.concepts;break;case"required":n.phenotypicFilterType="REQUIRED";break;case"numeric":e.min===void 0&&e.max===void 0&&(n.phenotypicFilterType="REQUIRED"),e.min!==void 0&&(n.min=o(e.min)),e.max!==void 0&&(n.max=o(e.max));break;case"Categorical":(a=e.categoryValues)!=null&&a.length?n.values=e.categoryValues:n.phenotypicFilterType="REQUIRED";break}return n},O=e=>{const n=[],a=e.min!==void 0&&e.min!==""||e.max!==void 0&&e.max!=="",r=e.Gene_with_variant&&e.Gene_with_variant.length>0||e.Variant_consequence_calculated&&e.Variant_consequence_calculated.length>0||e.Variant_frequency_as_text&&e.Variant_frequency_as_text.length>0;if(a&&!r){const t=e.min?o(e.min):void 0,s=e.max?o(e.max):void 0;return w("genomic_range",t,s)}return e.Gene_with_variant&&e.Gene_with_variant.length>0&&n.push({key:"Gene_with_variant",values:e.Gene_with_variant}),e.Variant_consequence_calculated&&e.Variant_consequence_calculated.length>0&&n.push({key:"Variant_consequence_calculated",values:e.Variant_consequence_calculated}),e.Variant_frequency_as_text&&e.Variant_frequency_as_text.length>0&&n.push({key:"Variant_frequency_as_text",values:e.Variant_frequency_as_text}),n},N=e=>{const n=[];return(e.snpValues||[]).forEach(a=>{n.push({key:a.search,values:a.constraint.split(",")})}),n},w=(e,n,a)=>n!==void 0&&a!==void 0?[{key:e,min:n,max:a}]:n!==void 0?[{key:e,min:n}]:a!==void 0?[{key:e,max:a}]:[];function b(e){switch(e){case"Categorical":case"numeric":return"FILTER";case"AnyRecordOf":return"ANY_RECORD_OF";case"required":return"REQUIRED";case"snp":return"FILTER"}return"FILTER"}export{V as a,z as b,x as c,k as g,I as u};
