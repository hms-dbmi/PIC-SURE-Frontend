var c=Object.defineProperty;var d=(n,e,t)=>e in n?c(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var s=(n,e,t)=>d(n,typeof e!="symbol"?e+"":e,t);import{w as o,d as h}from"./Dx2jxSvH.js";import{r as l}from"./CseAM1pm.js";class u{constructor(){s(this,"events",{change:[],clearFilters:[],clearSearch:[]});s(this,"triggerChange",o(0))}add(e,t){this.events[e].push(t)}trigger(e){for(const t of this.events[e])t();e==="change"&&this.triggerChange.update(t=>t+1)}}class g{constructor(e,t){s(this,"totalRows");s(this,"rowsPerPage");s(this,"pageNumber");s(this,"event");s(this,"search");s(this,"filters");s(this,"rows");s(this,"rowCount");s(this,"pages");s(this,"pagesWithEllipsis");s(this,"pageCount");s(this,"sort");s(this,"selected");s(this,"isAllSelected");s(this,"selectedCount");s(this,"selectBy");this.totalRows=o(t.totalRows),this.rowsPerPage=o(t.rowsPerPage),this.pageNumber=o(1),this.event=new u,this.search=o(""),this.filters=o([]),this.rows=o(e),this.rowCount=this.createRowCount(),this.pages=this.createPages(),this.pagesWithEllipsis=this.createPagesWithEllipsis(),this.pageCount=this.createPageCount(),this.sort=o(void 0),this.selected=o([]),this.isAllSelected=this.createIsAllSelected(),this.selectedCount=this.createSelectedCount(),this.selectBy=t.selectBy??void 0}getState(){const e=l(this.pageNumber),t=l(this.rowsPerPage),r=l(this.sort),i=l(this.filters);return{pageNumber:e,rowsPerPage:t,offset:t*(e-1),search:l(this.search),sorted:r??void 0,sort:r??void 0,filters:i.length>0?i:void 0,setTotalRows:a=>this.totalRows.set(a)}}createPages(){return h([this.rowsPerPage,this.totalRows],([e,t])=>!e||!t?void 0:Array.from(Array(Math.ceil(t/e))).map((i,a)=>a+1))}createPagesWithEllipsis(){return h([this.pages,this.pageNumber],([e,t])=>{if(!e)return;if(e.length<=7)return e;const r=null,i=1,a=e.length;return t<=4?[...e.slice(0,5),r,a]:t<e.length-3?[i,r,...e.slice(t-2,t+1),r,a]:[i,r,...e.slice(e.length-5,e.length)]})}createPageCount(){return h(this.pages,e=>{if(e)return e.length})}createRowCount(){return h([this.totalRows,this.pageNumber,this.rowsPerPage],([e,t,r])=>{if(!(!r||!e))return{total:e,start:t*r-r+1,end:Math.min(t*r,e)}})}createIsAllSelected(){return h([this.selected,this.rows],([e,t])=>t.length===0?!1:this.selectBy?t.map(i=>i[this.selectBy]).every(i=>e.includes(i)):t.every(r=>e.includes(r)))}createSelectedCount(){return h([this.selected,this.totalRows],([e,t])=>({count:e.length,total:t}))}}class f{constructor(e){s(this,"context");s(this,"reload");this.context=e}set(e){this.reload=e}async invalidate(){if(!this.reload)return;const e=this.context.getState(),t=await this.reload(e);t&&this.context.rows.set(t)}}class w{constructor(e){s(this,"event");s(this,"hasMultipleSort");s(this,"sort");this.event=e.event,this.hasMultipleSort=!1,this.sort=e.sort}set(e=null){if(!e)return;const t=l(this.sort);!t||t.orderBy!==e?this.asc(e):t.direction==="asc"?this.desc(t.orderBy):t.direction==="desc"&&this.asc(e)}asc(e){e&&(this.sort.set({orderBy:e,direction:"asc"}),this.event.trigger("change"))}desc(e){e&&(this.sort.set({orderBy:e,direction:"desc"}),this.event.trigger("change"))}apply(e=null){if(e)switch(e.direction){case"asc":return this.asc(e.orderBy);case"desc":return this.desc(e.orderBy);default:return this.set(e.orderBy)}const t=l(this.sort);if(t)return this.apply({orderBy:t.orderBy,direction:t.direction})}}class p{constructor(e){s(this,"rows");s(this,"selected");s(this,"isAllSelected");s(this,"selectBy");this.rows=e.rows,this.selected=e.selected,this.isAllSelected=e.isAllSelected,this.selectBy=e.selectBy}set(e){const t=l(this.selected);t.includes(e)?this.selected.set(t.filter(r=>r!==e)):this.selected.set([e,...t])}all(){const e=l(this.rows),t=l(this.isAllSelected);this.selected.update(r=>this.selectBy?r=r.filter(i=>!e.map(a=>a[this.selectBy]).includes(i)):r=r.filter(i=>!e.includes(i))),t||this.selected.update(r=>(this.selectBy?r=[...e.map(i=>i[this.selectBy]),...r]:r=[...e,...r],r))}clear(){this.selected.set([])}}class P{constructor(e){s(this,"totalRows");s(this,"pageNumber");s(this,"rowCount");s(this,"rowsPerPage");s(this,"event");s(this,"pages");s(this,"selected");this.totalRows=e.totalRows,this.pageNumber=e.pageNumber,this.rowCount=e.rowCount,this.rowsPerPage=e.rowsPerPage,this.event=e.event,this.pages=e.pages,this.selected=e.selected}get(){return this.pages}goto(e){const t=l(this.rowsPerPage),r=l(this.totalRows);this.pageNumber.update(i=>t&&r?(e>=1&&e<=Math.ceil(r/t)&&(i=e,this.event.trigger("change")),i):(e>=1&&(i=e,this.event.trigger("change")),i))}previous(){const e=l(this.pageNumber)-1;this.goto(e)}next(){const e=l(this.pageNumber)+1;this.goto(e)}}class H{constructor(e){s(this,"search");this.search=e.search}set(e){this.search.set(e??null)}remove(){this.search.set(null)}}class S{constructor(e){s(this,"filters");this.filters=e.filters}set(e,t){const r={filterBy:t,value:e};this.filters.update(i=>(i=i.filter(a=>a.filterBy!==t&&a.value),e&&i.push(r),i))}remove(){this.filters.set([])}}class y{constructor(e=[],t={rowsPerPage:5}){s(this,"context");s(this,"triggerHandler");s(this,"sortHandler");s(this,"selectHandler");s(this,"pageHandler");s(this,"searchHandler");s(this,"filterHandler");s(this,"i18n");this.i18n=this.translate(t.i18n),this.context=new g(e,t),this.triggerHandler=new f(this.context),this.sortHandler=new w(this.context),this.selectHandler=new p(this.context),this.pageHandler=new P(this.context),this.searchHandler=new H(this.context),this.filterHandler=new S(this.context)}onChange(e){this.triggerHandler.set(e)}invalidate(){this.triggerHandler.invalidate()}setRows(e){this.context.rows.set(e)}setTotalRows(e){this.context.totalRows.set(e)}getRows(){return this.context.rows}select(e){this.selectHandler.set(e)}getSelected(){return this.context.selected}selectAll(){this.selectHandler.all()}isAllSelected(){return this.context.isAllSelected}getSelectedCount(){return this.context.selectedCount}clearSelection(){this.selectHandler.clear()}getRowsPerPage(){return this.context.rowsPerPage}sort(e){this.setPage(1),this.sortHandler.set(e)}applySort(e=null){this.sortHandler.apply(e)}sortAsc(e){this.setPage(1),this.sortHandler.asc(e)}sortDesc(e){this.setPage(1),this.sortHandler.desc(e)}getSort(){return this.context.sort}search(e){this.setPage(1),this.context.search.set(e)}clearSearch(){this.searchHandler.remove()}filter(e,t){return this.setPage(1),this.filterHandler.set(e,t)}clearFilters(){this.filterHandler.remove()}getPages(e={ellipsis:!1}){return e.ellipsis?this.context.pagesWithEllipsis:this.context.pages}getPageCount(){return this.context.pageCount}getPageNumber(){return this.context.pageNumber}setPage(e){switch(e){case"previous":return this.pageHandler.previous();case"next":return this.pageHandler.next();default:return this.pageHandler.goto(e)}}getRowCount(){return this.context.rowCount}on(e,t){this.context.event.add(e,t)}translate(e){return{search:"Search...",show:"Show",entries:"entries",filter:"Filter",rowCount:"Showing {start} to {end} of {total} entries",noRows:"No entries found",previous:"Previous",next:"Next",selectedCount:"{count} of {total} row(s).",...e}}getTriggerChange(){return this.context.event.triggerChange}applySorting(e=null){this.applySort(e)}getSorted(){return this.getSort()}}export{y as D};
