import"./Bzak7iHL.js";import{p as W,h as A,i as R,f as q,d as o,s as l,r as n,k as i,n as L,t as v,l as c,b as f,c as X,j as Y,u as Z,m as ee}from"./DhSNEPDw.js";import{e as ae,s as S}from"./DVtHS8ol.js";import{i as U}from"./BG76zvuN.js";import{e as te,i as re}from"./ByI6iVq5.js";import{r as b,d as se}from"./aV0zye_u.js";import{b as j,a as ie}from"./DPXw0ygh.js";import{p as le,a as oe,s as ne}from"./DpjY2ypC.js";import{g as de}from"./Dkbkn6HV.js";import{u as pe,a as ce}from"./z6JXWtIA.js";import{a as me,t as C}from"./M2p3ZkHt.js";import{E as ue}from"./CQQkdEes.js";var ve=q('<label class="label"><span>UUID:</span> <input type="text" class="input"/></label>'),fe=q('<label class="flex items-center space-x-2"><input class="checkbox" type="checkbox"/> <div> </div></label>'),be=q('<form><fieldset data-testid="role-form" class="grid gap-4 my-3"><!> <label class="label required"><span>Name:</span> <input type="text" class="input" required minlength="1" maxlength="255"/></label> <label class="label required"><span>Description:</span> <input type="text" class="input" required minlength="1" maxlength="255"/></label> <fieldset data-testid="privilege-checkboxes"><legend class="required">Privileges:</legend> <!></fieldset> <!> <div class="mt-2"><button type="submit" data-testid="role-save-btn" class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500">Save</button> <a href="/admin/configuration" data-testid="role-cancel-btn" class="btn preset-tonal-secondary border border-secondary-500 hover:preset-filled-secondary-500">Cancel</a></div></fieldset></form>');function Ee(F,m){W(m,!0);const I=()=>oe(me,"$isTopAdmin",N),[N,O]=ne();let s=le(m,"role",3,void 0),d=A(R(s()?s().name:"")),_=A(R(s()?s().description:"")),g=R(m.privilegeList.map(([e,a])=>({uuid:a,checked:s()?s().privileges.includes(a):!1}))),p=A("");async function z(e){e.preventDefault();const a=g.filter(r=>r.checked).map(r=>r.uuid);if(a.length===0){c(p,"At least one privilege must be selected.");return}else c(p,"");let t={name:i(d),description:i(_),privileges:a};try{s()?(t={...t,uuid:s().uuid},await pe(t)):await ce(t),C.success({title:`Successfully saved ${t&&"new "}role '${i(d)}'`}),de("/admin/configuration")}catch(r){console.error(r),C.error({title:`An error occured while saving ${t&&"new "}role '${i(d)}'`})}}var u=be(),h=o(u),D=o(h);{var B=e=>{var a=ve(),t=l(o(a),2);b(t),t.readOnly=!0,n(a),v(()=>{var r;return se(t,(r=s())==null?void 0:r.uuid)}),f(e,a)};U(D,e=>{var a;(a=s())!=null&&a.uuid&&e(B)})}var y=l(D,2),E=l(o(y),2);b(E),n(y);var x=l(y,2),P=l(o(x),2);b(P),n(x);var $=l(x,2),G=l(o($),2);te(G,17,()=>m.privilegeList,re,(e,a,t,r)=>{var K=Z(()=>ee(i(a),1));let M=()=>i(K)[0];var k=fe(),w=o(k);b(w);var T=l(w,2),Q=o(T,!0);n(T),n(k),v(()=>S(Q,M())),ie(w,()=>g[t].checked,V=>g[t].checked=V),f(e,k)}),n($);var H=l($,2);{var J=e=>{ue(e,{"data-testid":"validation-error",onclose:()=>c(p,""),children:(a,t)=>{L();var r=Y();v(()=>S(r,i(p))),f(a,r)},$$slots:{default:!0}})};U(H,e=>{i(p)&&e(J)})}L(2),n(h),n(u),v(()=>h.disabled=!I()),ae("submit",u,z),j(E,()=>i(d),e=>c(d,e)),j(P,()=>i(_),e=>c(_,e)),f(F,u),X(),O()}export{Ee as R};
