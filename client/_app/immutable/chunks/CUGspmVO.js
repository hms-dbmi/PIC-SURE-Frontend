import{g as h}from"./xU7jw7XU.js";import{c as i,k as f,r as y,K as V,j as O}from"./BNC-bmXQ.js";import{f as S,b as C}from"./BZHGrlEE.js";import{b as _}from"./CD4Ar3Xi.js";import{a as P}from"./DA3-ipRP.js";import{g as d,a as p,b as j,c as F}from"./CkgF4xEV.js";async function N(){var n;const e=await i(`${f.Search}/${h(y).hpdsOpen}`,{query:"\\_studies_consents\\"});return Object.keys((n=e==null?void 0:e.results)==null?void 0:n.phenotypes)}const b="Â±";function T(e){let t,n;if(String(e).startsWith("<"))n=3,t=0;else{const[r,u]=String(e).split(b);t=parseInt(r.replaceAll(",",""))||0,n=parseInt(u??"")||0}return{value:t,suffix:n}}function Q(e){return e.flatMap(t=>typeof t=="object"?Object.values(t):t)}function v(e,t=!0){var o;const n=Q(e);if(n.length===0)return S.federated?t?"0":0:void 0;if(n.length===1&&((o=n[0])!=null&&o.toString().startsWith("<")))return n[0];const r=n.map(T),u=r.reduce((s,{value:c})=>c>0?s+c:s,0),a=Math.max(...r.map(({suffix:s})=>s),0);return t?a>0?`${u.toLocaleString()}${b}${a}`:u.toLocaleString():u}function l(e){return e!=null&&e.errorType?Promise.reject("api error"):e}const G={list:e=>Object.entries(e.result).map(([t,n])=>({promise:n,resourceName:t})),rejected:e=>e.status==="rejected",fullfiled:e=>e.status==="fulfilled",valueOrZero:e=>e.status==="fulfilled"?e.value:0};function U(e){var n,r,u;return((n=C)!=null&&n.statFields?Object.keys((r=C)==null?void 0:r.statFields):[]).includes(e)?(u=C)==null?void 0:u.statFields[e]:[]}function R(e=!1){const t={facets:[],search:"",consents:[]};return e?t:_(t)}function k(e){return function({isOpenAccess:t}){const n=R(t);return i(f.Facets,n).then(r=>{const u=r.find(o=>o.name===e);return u?t?u.facets.length:u.facets.filter(o=>o.count>0).length:0}).then(l)}}function w({isOpenAccess:e}){const t=R(e);return i(`${f.Concepts}?page_number=1&page_size=1`,t).then(n=>n.totalElements||Promise.reject("total not found"))}function L({addFilters:e,isOpenAccess:t,resource:n}){const r=e?d(!t,n,"COUNT"):p(t,n,"COUNT");return i(f.QueryV2Sync,r).then(l)}function M({stat:e}){return Promise.resolve((e==null?void 0:e.value)||0)}async function $({addFilters:e,isOpenAccess:t,resource:n}){let r;const u=await N(),a=s=>(s.select=u,s),o=s=>(s.setCrossCountFields(u),s);return t&&S.explorer.enableOrQueries&&h(P)?r=e?j(!t,h(y).hpdsOpenV3,"CROSS_COUNT",a):F(t,h(y).hpdsOpenV3,"CROSS_COUNT",a):r=e?d(!t,n,"CROSS_COUNT",o):p(t,n,"CROSS_COUNT",o),i(f.QueryV2Sync,r).then(l).then(s=>v([s["\\_studies_consents\\"]||0]))}function I({addFilters:e,isOpenAccess:t,resource:n}){const r=e?d(!t,n,"COUNT"):p(t,n,"COUNT");return i(f.QueryV2Sync,r).then(l)}function x(e){return e.isOpenAccess?$(e):I(e)}function q(e,t){return function({addFilters:n,isOpenAccess:r,resource:u}){const a=U(e).map(c=>c.conceptPath);if(a.length===0)return Promise.reject(`${e} feilds were not configured`);const o=n?d(!r,u,t):p(r,u,t);return o.query.setCrossCountFields(a),i(f.QueryV2Sync,o).then(l)}}function E(e){return function({addFilters:t,isOpenAccess:n,resource:r}){const u=U("query:consent");if(u.length===0)return Promise.reject("consent feilds were not configured");const a=u.reduce((s,c)=>({...s,[c.conceptPath]:[...s[c.conceptPath]||[],c.id]}),{}),o=t?d(!n,r,e):p(n,r,e);return Object.entries(a).forEach(([s,c])=>o.query.addCategoryFilter(s,c)),i(f.QueryV2Sync,o).then(l)}}const g={"dict:facets:dataset_id":k("dataset_id"),"dict:concepts":w,"query:blank":L,"query:biosample":q("query:biosample","OBSERVATION_CROSS_COUNT"),"query:genomic":q("query:genomic","CROSS_COUNT"),"query:consent":E("COUNT"),"query:patientCount":x,hardcoded:M};function H(e){const t=e.filter(n=>!!g[n.key]);return e.length===0?[]:t.reduce((n,r)=>{const u=[...n],a=(r==null?void 0:r.auth)===void 0?!0:r.auth,o=(r==null?void 0:r.auth)===void 0?!0:!r.auth;return a&&V()&&u.push({...r,auth:!0,result:{}}),S.login.open&&o&&u.push({...r,auth:!1,result:{}}),u},[])}function J(e){return e.map(t=>{const n=!t.auth;return{...t,result:O(n).reduce((r,{name:u,uuid:a})=>{const o={...r};return o[u]=g[t.key]({isOpenAccess:n,stat:t,resource:a,addFilters:!1}),o},{})}})}function X(e,t){const n=t.filter(r=>!!g[r.key]);return n.length===0?[]:n.reduce((r,u)=>{const a=[...r];return a.push({...u,auth:!e,result:O(e).reduce((o,{name:s,uuid:c})=>{const m={...o};return m[s]=g[u.key]({isOpenAccess:e,stat:u,resource:c,addFilters:!0}),m},{})}),a},[])}export{G as S,U as a,H as b,v as c,X as g,J as p};
