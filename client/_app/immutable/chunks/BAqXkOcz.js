import{s as we,M as pe,e as E,a as q,c as C,b as y,g as M,f as I,Y as Ce,m as _,J as ge,i as G,h as f,v as R,y as qe,Z as Te,K as ze,S as Ve,N as Le,O as Re,P as je,Q as He,R as Fe,_ as X,$ as Je,t as ue,l as Z,d as de,u as oe,T as Ke,W as Se,w as Ge,a0 as Qe,x as Ie,j as ve,X as We}from"./CseAM1pm.js";import{S as Me,i as Oe,t as ce,g as Xe,a as me,b as Ye,j as Ze,d as xe,e as $e,m as el,f as ll}from"./CUD_i9MT.js";import{e as be}from"./Ba1MNdbe.js";import{g as tl}from"./zOfZnRfh.js";import{g as al}from"./NhmsAo-M.js";import"./C8tRaeKn.js";import{g as sl}from"./CgU5AtxT.js";import{u as nl,g as il,a as rl}from"./bejl0vF4.js";import{g as ol}from"./CbUCrC8h.js";import{g as cl}from"./BsuthN-F.js";import{g as ul}from"./Bpei5vQt.js";function Pe(l){let e,t;const s=l[22].default,a=Re(s,l,l[21],null);return{c(){e=E("div"),a&&a.c(),this.h()},l(r){e=C(r,"DIV",{class:!0});var n=y(e);a&&a.l(n),n.forEach(I),this.h()},h(){_(e,"class","slide-toggle-text ml-3")},m(r,n){G(r,e,n),a&&a.m(e,null),t=!0},p(r,n){a&&a.p&&(!t||n[0]&2097152)&&je(a,s,r,r[21],t?Fe(s,r[21],n,null):He(r[21]),null)},i(r){t||(ce(a,r),t=!0)},o(r){me(a,r),t=!1},d(r){r&&I(e),a&&a.d(r)}}}function dl(l){let e,t,s,a,r,n,c,p,L,k,g,d,m,b,T,N=[{type:"checkbox"},{class:"slide-toggle-input hidden"},{name:l[1]},l[8](),{disabled:a=l[9].disabled}],O={};for(let u=0;u<N.length;u+=1)O=pe(O,N[u]);let i=l[10].default&&Pe(l);return{c(){e=E("div"),t=E("label"),s=E("input"),r=q(),n=E("div"),c=E("div"),k=q(),i&&i.c(),this.h()},l(u){e=C(u,"DIV",{id:!0,class:!0,"data-testid":!0,role:!0,"aria-label":!0,"aria-checked":!0,tabindex:!0});var S=y(e);t=C(S,"LABEL",{class:!0});var A=y(t);s=C(A,"INPUT",{type:!0,class:!0,name:!0}),r=M(A),n=C(A,"DIV",{class:!0});var j=y(n);c=C(j,"DIV",{class:!0}),y(c).forEach(I),j.forEach(I),k=M(A),i&&i.l(A),A.forEach(I),S.forEach(I),this.h()},h(){Ce(s,O),_(c,"class",p="slide-toggle-thumb "+l[3]),ge(c,"cursor-not-allowed",l[9].disabled),_(n,"class",L="slide-toggle-track "+l[4]),ge(n,"cursor-not-allowed",l[9].disabled),_(t,"class",g="slide-toggle-label "+l[5]),_(e,"id",l[2]),_(e,"class",d="slide-toggle "+l[6]),_(e,"data-testid","slide-toggle"),_(e,"role","switch"),_(e,"aria-label",l[2]),_(e,"aria-checked",l[0]),_(e,"tabindex","0")},m(u,S){G(u,e,S),f(e,t),f(t,s),s.autofocus&&s.focus(),s.checked=l[0],f(t,r),f(t,n),f(n,c),f(t,k),i&&i.m(t,null),m=!0,b||(T=[R(s,"change",l[31]),R(s,"click",l[23]),R(s,"keydown",l[24]),R(s,"keyup",l[25]),R(s,"keypress",l[26]),R(s,"mouseover",l[27]),R(s,"change",l[28]),R(s,"focus",l[29]),R(s,"blur",l[30]),R(e,"keydown",l[7])],b=!0)},p(u,S){Ce(s,O=sl(N,[{type:"checkbox"},{class:"slide-toggle-input hidden"},(!m||S[0]&2)&&{name:u[1]},u[8](),(!m||S[0]&512&&a!==(a=u[9].disabled))&&{disabled:a}])),S[0]&1&&(s.checked=u[0]),(!m||S[0]&8&&p!==(p="slide-toggle-thumb "+u[3]))&&_(c,"class",p),(!m||S[0]&520)&&ge(c,"cursor-not-allowed",u[9].disabled),(!m||S[0]&16&&L!==(L="slide-toggle-track "+u[4]))&&_(n,"class",L),(!m||S[0]&528)&&ge(n,"cursor-not-allowed",u[9].disabled),u[10].default?i?(i.p(u,S),S[0]&1024&&ce(i,1)):(i=Pe(u),i.c(),ce(i,1),i.m(t,null)):i&&(Xe(),me(i,1,1,()=>{i=null}),Ye()),(!m||S[0]&32&&g!==(g="slide-toggle-label "+u[5]))&&_(t,"class",g),(!m||S[0]&4)&&_(e,"id",u[2]),(!m||S[0]&64&&d!==(d="slide-toggle "+u[6]))&&_(e,"class",d),(!m||S[0]&4)&&_(e,"aria-label",u[2]),(!m||S[0]&1)&&_(e,"aria-checked",u[0])},i(u){m||(ce(i),m=!0)},o(u){me(i),m=!1},d(u){u&&I(e),i&&i.d(),b=!1,qe(T)}}}const fl="inline-block",hl="unstyled flex items-center",_l="flex transition-all duration-[200ms] cursor-pointer",gl="w-[50%] h-full scale-[0.8] transition-all duration-[200ms] shadow";function bl(l,e,t){let s,a,r,n,c,p,L,k;const g=["name","checked","size","background","active","border","rounded","label"];let d=Te(e,g),{$$slots:m={},$$scope:b}=e;const T=ze(m),N=Ve();let{name:O}=e,{checked:i=!1}=e,{size:u="md"}=e,{background:S="bg-surface-400 dark:bg-surface-700"}=e,{active:A="bg-surface-900 dark:bg-surface-300"}=e,{border:j=""}=e,{rounded:H="rounded-full"}=e,{label:x=""}=e,V;switch(u){case"sm":V="w-12 h-6";break;case"lg":V="w-20 h-10";break;default:V="w-16 h-8"}function Q(h){["Enter","Space"].includes(h.code)&&(h.preventDefault(),N("keyup",h),h.currentTarget.firstChild.click())}function fe(){return delete d.class,d}function ae(h){X.call(this,l,h)}function se(h){X.call(this,l,h)}function $(h){X.call(this,l,h)}function W(h){X.call(this,l,h)}function he(h){X.call(this,l,h)}function F(h){X.call(this,l,h)}function ne(h){X.call(this,l,h)}function _e(h){X.call(this,l,h)}function ke(){i=this.checked,t(0,i)}return l.$$set=h=>{t(9,e=pe(pe({},e),Le(h))),t(33,d=Te(e,g)),"name"in h&&t(1,O=h.name),"checked"in h&&t(0,i=h.checked),"size"in h&&t(11,u=h.size),"background"in h&&t(12,S=h.background),"active"in h&&t(13,A=h.active),"border"in h&&t(14,j=h.border),"rounded"in h&&t(15,H=h.rounded),"label"in h&&t(2,x=h.label),"$$scope"in h&&t(21,b=h.$$scope)},l.$$.update=()=>{l.$$.dirty[0]&12289&&t(19,s=i?A:`${S} cursor-pointer`),l.$$.dirty[0]&1&&t(18,a=i?"bg-white/75":"bg-white"),l.$$.dirty[0]&1&&t(17,r=i?"translate-x-full":""),t(20,n=e.disabled===!0?"opacity-50":"hover:brightness-[105%] dark:hover:brightness-110 cursor-pointer"),t(6,c=`${fl} ${H} ${n} ${e.class??""}`),l.$$.dirty[0]&638976&&t(4,L=`${_l} ${j} ${H} ${V} ${s}`),l.$$.dirty[0]&425984&&t(3,k=`${gl} ${H} ${a} ${r}`)},t(5,p=`${hl}`),e=Le(e),[i,O,x,k,L,p,c,Q,fe,e,T,u,S,A,j,H,V,r,a,s,n,b,m,ae,se,$,W,he,F,ne,_e,ke]}class ml extends Me{constructor(e){super(),Oe(this,e,bl,dl,we,{name:1,checked:0,size:11,background:12,active:13,border:14,rounded:15,label:2},null,[-1,-1])}}function Ae(l,e,t){const s=l.slice();return s[15]=e[t][0],s[16]=e,s[17]=t,s}function Ue(l,e,t){const s=l.slice();return s[7]=e[t],s}function vl(l){let e=l[4]?"Active":"Inactive",t;return{c(){t=ue(e)},l(s){t=de(s,e)},m(s,a){G(s,t,a)},p(s,a){a&16&&e!==(e=s[4]?"Active":"Inactive")&&ve(t,e)},d(s){s&&I(t)}}}function ye(l){let e,t,s="UUID:",a,r,n,c,p,L,k="Subject:",g,d,m;return{c(){e=E("label"),t=E("span"),t.textContent=s,a=q(),r=E("input"),c=q(),p=E("label"),L=E("span"),L.textContent=k,g=q(),d=E("input"),this.h()},l(b){e=C(b,"LABEL",{class:!0});var T=y(e);t=C(T,"SPAN",{"data-svelte-h":!0}),Z(t)!=="svelte-xruxbf"&&(t.textContent=s),a=M(T),r=C(T,"INPUT",{type:!0,class:!0}),T.forEach(I),c=M(b),p=C(b,"LABEL",{class:!0});var N=y(p);L=C(N,"SPAN",{"data-svelte-h":!0}),Z(L)!=="svelte-1bo23h8"&&(L.textContent=k),g=M(N),d=C(N,"INPUT",{type:!0,class:!0}),N.forEach(I),this.h()},h(){var b,T;_(r,"type","text"),_(r,"class","input"),r.value=n=(b=l[0])==null?void 0:b.uuid,r.disabled=!0,_(e,"class","label"),_(d,"type","text"),_(d,"class","input"),d.value=m=(T=l[0])==null?void 0:T.subject,d.disabled=!0,_(p,"class","label")},m(b,T){G(b,e,T),f(e,t),f(e,a),f(e,r),G(b,c,T),G(b,p,T),f(p,L),f(p,g),f(p,d)},p(b,T){var N,O;T&1&&n!==(n=(N=b[0])==null?void 0:N.uuid)&&r.value!==n&&(r.value=n),T&1&&m!==(m=(O=b[0])==null?void 0:O.subject)&&d.value!==m&&(d.value=m)},d(b){b&&(I(e),I(c),I(p))}}}function Ne(l){let e,t=l[7].label+"",s,a,r;return{c(){e=E("option"),s=ue(t),this.h()},l(n){e=C(n,"OPTION",{});var c=y(e);s=de(c,t),c.forEach(I),this.h()},h(){e.__value=a=l[7].uuid,oe(e,e.__value),e.selected=r=l[0]&&l[0].connection===l[7].uuid},m(n,c){G(n,e,c),f(e,s)},p(n,c){c&4&&t!==(t=n[7].label+"")&&ve(s,t),c&4&&a!==(a=n[7].uuid)&&(e.__value=a,oe(e,e.__value)),c&5&&r!==(r=n[0]&&n[0].connection===n[7].uuid)&&(e.selected=r)},d(n){n&&I(e)}}}function De(l){let e,t,s,a,r=l[15]+"",n,c,p,L;function k(){l[12].call(t,l[17])}return{c(){e=E("label"),t=E("input"),s=q(),a=E("p"),n=ue(r),c=q(),this.h()},l(g){e=C(g,"LABEL",{class:!0});var d=y(e);t=C(d,"INPUT",{class:!0,type:!0}),s=M(d),a=C(d,"P",{});var m=y(a);n=de(m,r),m.forEach(I),c=M(d),d.forEach(I),this.h()},h(){_(t,"class","checkbox"),_(t,"type","checkbox"),_(e,"class","flex items-center space-x-2")},m(g,d){G(g,e,d),f(e,t),t.checked=l[5][l[17]].checked,f(e,s),f(e,a),f(a,n),f(e,c),p||(L=R(t,"change",k),p=!0)},p(g,d){l=g,d&32&&(t.checked=l[5][l[17]].checked),d&2&&r!==(r=l[15]+"")&&ve(n,r)},d(g){g&&I(e),p=!1,L()}}}function Be(l){let e,t,s,a,r,n,c,p='<i class="fa-solid fa-xmark"></i> <span class="sr-only">Close</span>',L,k;return{c(){e=E("aside"),t=E("div"),s=E("p"),a=ue(l[6]),r=q(),n=E("div"),c=E("button"),c.innerHTML=p,this.h()},l(g){e=C(g,"ASIDE",{"data-testid":!0,class:!0});var d=y(e);t=C(d,"DIV",{class:!0});var m=y(t);s=C(m,"P",{});var b=y(s);a=de(b,l[6]),b.forEach(I),m.forEach(I),r=M(d),n=C(d,"DIV",{class:!0});var T=y(n);c=C(T,"BUTTON",{"data-svelte-h":!0}),Z(c)!=="svelte-14sn3fl"&&(c.innerHTML=p),T.forEach(I),d.forEach(I),this.h()},h(){_(t,"class","alert-message"),_(n,"class","alert-actions"),_(e,"data-testid","validation-error"),_(e,"class","alert variant-ghost-error")},m(g,d){G(g,e,d),f(e,t),f(t,s),f(s,a),f(e,r),f(e,n),f(n,c),L||(k=R(c,"click",l[13]),L=!0)},p(g,d){d&64&&ve(a,g[6])},d(g){g&&I(e),L=!1,k()}}}function kl(l){var Ee;let e,t,s,a,r,n,c,p="Email:",L,k,g,d,m,b,T,N="Connection:",O,i,u,S,A,j,H,x,V,Q,fe="Roles:",ae,se,$,W,he='<button type="submit" class="btn variant-ghost-primary hover:variant-filled-primary">Save</button> <a href="/admin/users" class="btn variant-ghost-secondary hover:variant-filled-secondary">Cancel</a>',F,ne,_e;function ke(o){l[9](o)}let h={name:"Active",size:"sm",active:"bg-success-500",label:"Status",$$slots:{default:[vl]},$$scope:{ctx:l}};l[4]!==void 0&&(h.checked=l[4]),t=new ml({props:h}),Je.push(()=>Ze(t,"checked",ke));let D=((Ee=l[0])==null?void 0:Ee.uuid)&&ye(l),ee=be(l[2]),B=[];for(let o=0;o<ee.length;o+=1)B[o]=Ne(Ue(l,ee,o));let le=be(l[1]),w=[];for(let o=0;o<le.length;o+=1)w[o]=De(Ae(l,le,o));let z=l[6]&&Be(l);return{c(){e=E("form"),xe(t.$$.fragment),a=q(),D&&D.c(),r=q(),n=E("label"),c=E("span"),c.textContent=p,L=q(),k=E("input"),m=q(),b=E("label"),T=E("span"),T.textContent=N,O=q(),i=E("select"),u=E("option"),S=ue("none");for(let o=0;o<B.length;o+=1)B[o].c();x=q(),V=E("fieldset"),Q=E("legend"),Q.textContent=fe,ae=q();for(let o=0;o<w.length;o+=1)w[o].c();se=q(),z&&z.c(),$=q(),W=E("div"),W.innerHTML=he,this.h()},l(o){e=C(o,"FORM",{class:!0});var v=y(e);$e(t.$$.fragment,v),a=M(v),D&&D.l(v),r=M(v),n=C(v,"LABEL",{class:!0});var U=y(n);c=C(U,"SPAN",{"data-svelte-h":!0}),Z(c)!=="svelte-1s4kc5o"&&(c.textContent=p),L=M(U),k=C(U,"INPUT",{type:!0,class:!0,minlength:!0,maxlength:!0}),U.forEach(I),m=M(v),b=C(v,"LABEL",{class:!0});var J=y(b);T=C(J,"SPAN",{"data-svelte-h":!0}),Z(T)!=="svelte-ir2yyg"&&(T.textContent=N),O=M(J),i=C(J,"SELECT",{class:!0});var te=y(i);u=C(te,"OPTION",{});var ie=y(u);S=de(ie,"none"),ie.forEach(I);for(let K=0;K<B.length;K+=1)B[K].l(te);te.forEach(I),J.forEach(I),x=M(v),V=C(v,"FIELDSET",{"data-testid":!0});var Y=y(V);Q=C(Y,"LEGEND",{class:!0,"data-svelte-h":!0}),Z(Q)!=="svelte-12sbs1l"&&(Q.textContent=fe),ae=M(Y);for(let K=0;K<w.length;K+=1)w[K].l(Y);Y.forEach(I),se=M(v),z&&z.l(v),$=M(v),W=C(v,"DIV",{"data-svelte-h":!0}),Z(W)!=="svelte-g6nnqz"&&(W.innerHTML=he),v.forEach(I),this.h()},h(){var o,v,U,J;_(k,"type","email"),_(k,"class","input"),k.required=!0,k.disabled=g=!!((o=l[0])!=null&&o.email),_(k,"minlength","1"),_(k,"maxlength","255"),_(n,"class",d="label "+(((v=l[0])==null?void 0:v.email)??"required")),u.selected=A=!l[0]||!l[0].connection,u.disabled=!0,u.__value="",oe(u,u.__value),_(i,"class","select"),i.required=!0,i.disabled=j=!!((U=l[0])!=null&&U.connection),l[7]===void 0&&Ke(()=>l[11].call(i)),_(b,"class",H="label "+(((J=l[0])==null?void 0:J.email)??"required")),_(Q,"class","required"),_(V,"data-testid","privilege-checkboxes"),_(e,"class","grid gap-4 my-3")},m(o,v){G(o,e,v),el(t,e,null),f(e,a),D&&D.m(e,null),f(e,r),f(e,n),f(n,c),f(n,L),f(n,k),oe(k,l[3]),f(e,m),f(e,b),f(b,T),f(b,O),f(b,i),f(i,u),f(u,S);for(let U=0;U<B.length;U+=1)B[U]&&B[U].m(i,null);Se(i,l[7],!0),f(e,x),f(e,V),f(V,Q),f(V,ae);for(let U=0;U<w.length;U+=1)w[U]&&w[U].m(V,null);f(e,se),z&&z.m(e,null),f(e,$),f(e,W),F=!0,ne||(_e=[R(k,"input",l[10]),R(i,"change",l[11]),R(e,"submit",Ge(l[8]))],ne=!0)},p(o,[v]){var J,te,ie,Y,K;const U={};if(v&1048592&&(U.$$scope={dirty:v,ctx:o}),!s&&v&16&&(s=!0,U.checked=o[4],Qe(()=>s=!1)),t.$set(U),(J=o[0])!=null&&J.uuid?D?D.p(o,v):(D=ye(o),D.c(),D.m(e,r)):D&&(D.d(1),D=null),(!F||v&1&&g!==(g=!!((te=o[0])!=null&&te.email)))&&(k.disabled=g),v&8&&k.value!==o[3]&&oe(k,o[3]),(!F||v&1&&d!==(d="label "+(((ie=o[0])==null?void 0:ie.email)??"required")))&&_(n,"class",d),(!F||v&1&&A!==(A=!o[0]||!o[0].connection))&&(u.selected=A),v&5){ee=be(o[2]);let P;for(P=0;P<ee.length;P+=1){const re=Ue(o,ee,P);B[P]?B[P].p(re,v):(B[P]=Ne(re),B[P].c(),B[P].m(i,null))}for(;P<B.length;P+=1)B[P].d(1);B.length=ee.length}if((!F||v&1&&j!==(j=!!((Y=o[0])!=null&&Y.connection)))&&(i.disabled=j),v&132&&Se(i,o[7]),(!F||v&1&&H!==(H="label "+(((K=o[0])==null?void 0:K.email)??"required")))&&_(b,"class",H),v&34){le=be(o[1]);let P;for(P=0;P<le.length;P+=1){const re=Ae(o,le,P);w[P]?w[P].p(re,v):(w[P]=De(re),w[P].c(),w[P].m(V,null))}for(;P<w.length;P+=1)w[P].d(1);w.length=le.length}o[6]?z?z.p(o,v):(z=Be(o),z.c(),z.m(e,$)):z&&(z.d(1),z=null)},i(o){F||(ce(t.$$.fragment,o),F=!0)},o(o){me(t.$$.fragment,o),F=!1},d(o){o&&I(e),ll(t),D&&D.d(),Ie(B,o),Ie(w,o),z&&z.d(),ne=!1,qe(_e)}}}function pl(l,e,t){const s=al();let{user:a=void 0}=e,{roleList:r}=e,{connections:n}=e,c=a&&a.email?a.email:"",p=a&&a.connection?a.connection:"",L=a?a.active:!0,k=r.map(([i,u])=>({uuid:u,checked:a?a.roles.includes(u):!1})),g="";async function d(){const i=k.filter(A=>A.checked);if(i.length===0){t(6,g="At least one role must be selected.");return}else t(6,g="");const u=JSON.parse((a==null?void 0:a.generalMetadata)||'{"email":""}');u.email=c;let S={email:c,connection:await ol(p),generalMetadata:JSON.stringify(u),active:L,roles:await Promise.all(i.map(A=>cl(A.uuid).then(j=>({...j,privileges:j.privileges.map(H=>ul(H))}))))};try{if(a)await nl({...S,uuid:a.uuid});else{if(await il(c,p)){s.trigger({message:"Cannot add a user and connection pair that already exists.",background:"variant-filled-error"});return}await rl(S)}s.trigger({message:`Successfully saved ${a?"":"new "}user '${c}'`,background:"variant-filled-success"}),tl("/admin/users")}catch(A){console.error(A),s.trigger({message:`An error occured while saving ${a?"":"new "}user '${c}'`,background:"variant-filled-error"})}}function m(i){L=i,t(4,L)}function b(){c=this.value,t(3,c)}function T(){p=We(this),t(7,p),t(2,n)}function N(i){k[i].checked=this.checked,t(5,k)}const O=()=>t(6,g="");return l.$$set=i=>{"user"in i&&t(0,a=i.user),"roleList"in i&&t(1,r=i.roleList),"connections"in i&&t(2,n=i.connections)},[a,r,n,c,L,k,g,p,d,m,b,T,N,O]}class Dl extends Me{constructor(e){super(),Oe(this,e,pl,kl,we,{user:0,roleList:1,connections:2})}}export{Dl as U};
