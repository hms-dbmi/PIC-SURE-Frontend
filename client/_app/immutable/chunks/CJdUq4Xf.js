const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B1KVb2Wt.js","./Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import{_ as J}from"./C1FmrZbK.js";import"./Bzak7iHL.js";import{o as B}from"./xU7jw7XU.js";import{p as A,k as n,h as v,f as O,l as x,t as K,b as g,c as V,i as X,s as Y,a as z,d as Z,r as D,e as P}from"./DhSNEPDw.js";import{i as k}from"./BG76zvuN.js";import{e as $,i as tt}from"./ByI6iVq5.js";import{s as et,a as ot}from"./DpjY2ypC.js";import{c as at,k as rt,t as st,r as it}from"./BNC-bmXQ.js";import{s as N}from"./CJ66PCUx.js";import{b as lt}from"./C0kNAPzX.js";import{s as nt}from"./BZHGrlEE.js";import{g as ct}from"./CkgF4xEV.js";import{p as ut}from"./CftmxiRQ.js";import{L as mt}from"./bwStxD3u.js";const C=60,I=6,T=nt.distributionExplorer.graphColors,ft={editable:!0,toImageButtonOptions:{format:"png"},displayModeBar:!0,modeBarButtonsToRemove:["pan2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","sendDataToCloud"]};function dt(t){const e=[];for(let o=0;o<t;o++)e.push(T[o%T.length]);return e}function L(t){return t.length>C?t.substring(0,C-3)+"...":t}function E(t,e){const o=Array(t.length).fill(I),r=[];return t.forEach((s,a)=>{s<10&&e?(o[a]=9,r[a]="< 10",t[a]=0):e?r[a]=s+" Â± 3":(o[a]=0,r[a]=s+"")}),{topBar:o,bottomBar:r}}function M(t,e){return t.map(o=>e&&o>0?o-I/2:o)}function pt(t){const e=Object.values(t.categoricalMap),{topBar:o,bottomBar:r}=E(e,t.obfuscated),s=dt(e.length),a=L(t.title),u=[{x:Object.keys(t.categoricalMap),y:M(e,t.obfuscated),name:a,type:"bar",showlegend:!1,marker:{color:s}},{x:Object.keys(t.categoricalMap),y:o,name:"Obfuscated Data",showlegend:!1,type:"bar",marker:{color:s,pattern:{shape:"/",size:20,solidity:.5}},text:r,textposition:"outside"}],f={title:{text:a},width:t.chartWidth||500,height:t.chartHeight||600,hovermode:!1,font:{family:"Nunito Sans, sans-serif"},xaxis:{title:{text:t.xaxisName},automargin:!0},yaxis:{title:{text:t.yaxisName},automargin:!0},barmode:"stack"};return{data:u,layout:f,meta:{isCategorical:!0,unformatedTitle:t.title}}}function ht(t){const e=t.obfuscated,o=[],r=[];Object.keys(t.continuousMap).sort((c,y)=>{let d=parseFloat(c.split(" -")[0]),h=parseFloat(y.split(" -")[0]);return isNaN(d)&&(d=parseFloat(c.split(" +")[0])),isNaN(h)&&(h=parseFloat(c.split(" +")[0])),d-h}).forEach(c=>{o.push(c),r.push(t.continuousMap[c])});const{topBar:s,bottomBar:a}=E(r,e),u=L(t.title),f=[{x:o,y:M(r,t.obfuscated),name:u,type:"bar",showlegend:!1,marker:{color:"#c31f3f",line:{color:"#616265",width:1}}},{x:o,y:s,name:"Obfuscated Data",showlegend:!1,type:"bar",marker:{color:"#c31f3f",pattern:{shape:"/",size:20,solidity:.5},line:{color:"#616265",width:1}},text:a,textposition:"outside"}],_={title:{text:u},width:t.chartWidth||500,height:t.chartHeight||600,autosize:!1,hovermode:!1,bargap:.01,font:{family:"Nunito Sans, sans-serif"},xaxis:{title:{text:t.xaxisName},automargin:!0},yaxis:{title:{text:t.yaxisName},automargin:!0},barmode:"stack"};return{data:f,layout:_,meta:{isCategorical:!1,unformatedTitle:t.title}}}var gt=O("<div></div>");function yt(t,e){A(e,!0);const o=e.meta.isCategorical?"Column chart showing the visualization of ":"Histogram showing the visualization of ";let r=v("");B(async()=>{e.newPlot(n(r),e.data,e.layout,{...ft,toImageButtonOptions:{filename:e.meta.unformatedTitle}})});var s=gt();lt(s,a=>x(r,a),()=>n(r)),K(()=>{N(s,"id",`plot-${e.index??""}`),N(s,"aria-label",o+e.meta.unformatedTitle),N(s,"title","Visualization of "+e.meta.unformatedTitle)}),g(t,s),V()}var bt=O("<div>No Visualizations Available</div>"),vt=O('<p class="mb-8 text-center">All visualizations display the distributions of each variable filter for the specified cohort.</p> <div id="visualizations" class="flex flex-row flex-wrap gap-6 items-center justify-center"><!></div>',1);function Lt(t,e){A(e,!0);const o=()=>ot(it,"$resources",r),[r,s]=et();let a=v(X([])),u=v(void 0),f=v(!0);const _=ut.url.pathname.includes("/discover");async function c(){const i=ct(!_,o().visualization),m=localStorage.getItem("token");await at(rt.QueryV2Sync,{query:i.query,resourceUUID:o().visualization,resourceCredentials:m?{Authorization:"Bearer "+m}:{}}).then(l=>{x(a,[...((l==null?void 0:l.categoricalData)||[]).map(pt),...((l==null?void 0:l.continuousData)||[]).map(ht)],!0)}).catch(l=>{console.error("Viusalzation failed with query: "+JSON.stringify(i),l),st.error({description:"An error occured while parsing your token. Please try again later. If this problem persists, please contact an administrator."})}).finally(()=>{x(f,!1)})}B(async()=>{const i=await J(()=>import("./B1KVb2Wt.js").then(m=>m.p),__vite__mapDeps([0,1]),import.meta.url);x(u,i.newPlot,!0),await c()});var y=vt(),d=Y(z(y),2),h=Z(d);{var S=i=>{mt(i,{ring:!0,size:"medium"})},F=i=>{var m=P(),l=z(m);{var j=p=>{var b=P(),R=z(b);$(R,17,()=>n(a),tt,(H,w,U)=>{let G=()=>n(w).data,Q=()=>n(w).layout,W=()=>n(w).meta;yt(H,{index:U,get data(){return G()},get layout(){return Q()},get meta(){return W()},get newPlot(){return n(u)}})}),g(p,b)},q=p=>{var b=bt();g(p,b)};k(l,p=>{n(a).length?p(j):p(q,!1)},!0)}g(i,m)};k(h,i=>{n(f)?i(S):i(F,!1)})}D(d),g(t,y),V(),s()}export{Lt as V};
