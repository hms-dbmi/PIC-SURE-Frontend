import{f as q,a as v,t as V}from"./CtfeAAbw.js";import{p as W,b as A,d as R,c as o,s as i,r as n,g as l,n as L,t as f,e as c,a as X}from"./B4GrenNm.js";import{s as S}from"./DxSOTiY2.js";import{i as U}from"./CSsnQ7i2.js";import{e as Y,i as Z}from"./BdG0KSB2.js";import{r as b,d as ee}from"./BPiAbArq.js";import{e as ae}from"./D7VV4X-8.js";import{b as C,a as te}from"./CJCVGGPV.js";import{p as re,a as se,s as ie}from"./DvPjbdiY.js";import{g as le}from"./BNhMDwfB.js";import{u as oe,a as ne}from"./DrQstrIY.js";import{a as de,t as F}from"./BRrMSDP5.js";import{E as pe}from"./BVg5wqNm.js";var ce=q('<label class="label"><span>UUID:</span> <input type="text" class="input"/></label>'),me=q('<label class="flex items-center space-x-2"><input class="checkbox" type="checkbox"/> <div> </div></label>'),ue=q('<form><fieldset data-testid="role-form" class="grid gap-4 my-3"><!> <label class="label required"><span>Name:</span> <input type="text" class="input" required minlength="1" maxlength="255"/></label> <label class="label required"><span>Description:</span> <input type="text" class="input" required minlength="1" maxlength="255"/></label> <fieldset data-testid="privilege-checkboxes"><legend class="required">Privileges:</legend> <!></fieldset> <!> <div class="mt-2"><button type="submit" data-testid="role-save-btn" class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500">Save</button> <a href="/admin/configuration" data-testid="role-cancel-btn" class="btn preset-tonal-secondary border border-secondary-500 hover:preset-filled-secondary-500">Cancel</a></div></fieldset></form>');function qe(I,m){W(m,!0);const[N,O]=ie(),j=()=>se(de,"$isTopAdmin",N);let s=re(m,"role",3,void 0),d=A(R(s()?s().name:"")),g=A(R(s()?s().description:"")),_=R(m.privilegeList.map(([e,a])=>({uuid:a,checked:s()?s().privileges.includes(a):!1}))),p=A("");async function z(e){e.preventDefault();const a=_.filter(r=>r.checked).map(r=>r.uuid);if(a.length===0){c(p,"At least one privilege must be selected.");return}else c(p,"");let t={name:l(d),description:l(g),privileges:a};try{s()?(t={...t,uuid:s().uuid},await oe(t)):await ne(t),F.success({title:`Successfully saved ${t&&"new "}role '${l(d)}'`}),le("/admin/configuration")}catch(r){console.error(r),F.error({title:`An error occured while saving ${t&&"new "}role '${l(d)}'`})}}var u=ue(),h=o(u),D=o(h);{var B=e=>{var a=ce(),t=i(o(a),2);b(t),t.readOnly=!0,n(a),f(()=>{var r;return ee(t,(r=s())==null?void 0:r.uuid)}),v(e,a)};U(D,e=>{var a;(a=s())!=null&&a.uuid&&e(B)})}var y=i(D,2),E=i(o(y),2);b(E),n(y);var x=i(y,2),P=i(o(x),2);b(P),n(x);var $=i(x,2),G=i(o($),2);Y(G,17,()=>m.privilegeList,Z,(e,a,t,r)=>{let K=()=>l(a)[0];var k=me(),w=o(k);b(w);var T=i(w,2),M=o(T,!0);n(T),n(k),f(()=>S(M,K())),te(w,()=>_[t].checked,Q=>_[t].checked=Q),v(e,k)}),n($);var H=i($,2);{var J=e=>{pe(e,{"data-testid":"validation-error",onclose:()=>c(p,""),children:(a,t)=>{L();var r=V();f(()=>S(r,l(p))),v(a,r)},$$slots:{default:!0}})};U(H,e=>{l(p)&&e(J)})}L(2),n(h),n(u),f(()=>h.disabled=!j()),ae("submit",u,z),C(E,()=>l(d),e=>c(d,e)),C(P,()=>l(g),e=>c(g,e)),v(I,u),X(),O()}export{qe as R};
