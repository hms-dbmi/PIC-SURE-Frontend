import{a as K,o as Z}from"./DpyMT7OB.js";import{d as H,e as T,g as y,aC as U,ak as Q,h as P,b as X,u as Y}from"./KPVYLOSR.js";import{L as tt,C as $,N as et,O as rt,P as V,Q as nt,R as st,D as J,S as A,T as ot,G as ut}from"./DCY6c1ra.js";function ct(t){return new Proxy({},{get(s,n){return n==="style"?i=>t({style:i}).style:t}})}var bt=()=>t=>Array.from(new Set(t));const W={className:"class",defaultChecked:"checked",defaultValue:"value",htmlFor:"for",onBlur:"onfocusout",onChange:"oninput",onFocus:"onfocusin",onDoubleClick:"ondblclick"};function at(t){let s="";for(let n in t){const i=t[n];i!=null&&(n.startsWith("--")||(n=n.replace(/[A-Z]/g,b=>`-${b.toLowerCase()}`)),s+=`${n}:${i};`)}return s}const it="viewBox,className,preserveAspectRatio,fillRule,clipPath,clipRule,strokeWidth,strokeLinecap,strokeLinejoin,strokeDasharray,strokeDashoffset,strokeMiterlimit".split(",");function ft(t){return t in W?W[t]:it.includes(t)?t:t.toLowerCase()}function lt(t,s){if(t==="style"&&typeof s=="object")return at(s);if(s!==!1)return s}const Ct=ct(t=>{const s={};for(const n in t)s[ft(n)]=lt(n,t[n]);return s});function _(t){const s=t().defaultValue??t().value,n=t().isEqual??Object.is;let i=H(T(s));const b=P(()=>t().value!==void 0);let c={current:y(i)},f={current:void 0};U(()=>{const l=y(b)?t().value:y(i);c={current:l},f={current:l}});const w=l=>{var C,j;const p=$(l)?l(c.current):l,g=f.current;t().debug&&console.log(`[bindable > ${t().debug}] setValue`,{next:p,prev:g}),y(b)||X(i,p,!0),n(p,g)||(j=(C=t()).onChange)==null||j.call(C,p,g)};function N(){return y(b)?t().value:y(i)}return{initial:s,ref:c,get:N,set(l){(t().sync?Q:tt)(()=>w(l))},invoke(l,p){var g,C;(C=(g=t()).onChange)==null||C.call(g,l,p)},hash(l){var p,g;return((g=(p=t()).hash)==null?void 0:g.call(p,l))??String(l)}}}_.cleanup=t=>{K(()=>t())};_.ref=t=>{let s=t;return{get:()=>s,set:n=>{s=n}}};function gt(t){const s=T({current:t});return{get(n){return s.current[n]},set(n,i){s.current[n]=i}}}const F=t=>typeof t=="function"?t():t,dt=(t,s)=>{let n=[],i=!0;Y(()=>{if(i){n=t.map(c=>F(c)),i=!1;return}let b=!1;for(let c=0;c<t.length;c++)if(!et(n[c],F(t[c]))){b=!0;break}b&&(n=t.map(c=>F(c)),s())})};function L(t){return $(t)?t():t}function Nt(t,s){var h,B,I;const n=P(()=>{const{id:e,ids:r,getRootNode:u}=L(s);return ot({id:e,ids:r,getRootNode:u})}),i=(...e)=>{t.debug&&console.log(...e)},b=P(()=>{var e;return((e=t.props)==null?void 0:e.call(t,{props:ut(L(s)),scope:y(n)}))??L(s)}),c=pt(()=>y(b)),f=(h=t.context)==null?void 0:h.call(t,{prop:c,bindable:_,get scope(){return y(n)},flush:G,getContext(){return w},getComputed(){return E},getRefs(){return D}}),w={get(e){return f==null?void 0:f[e].get()},set(e,r){f==null||f[e].set(r)},initial(e){return f==null?void 0:f[e].initial},hash(e){const r=f==null?void 0:f[e].get();return f==null?void 0:f[e].hash(r)}};let N=new Map,l={current:null},p={current:null},g=T({current:{type:""}});const C=()=>({...g.current,current(){return g.current},previous(){return p.current}}),j=()=>({...k,hasTag(e){var u,o;const r=k.get();return!!((o=(u=t.states[r])==null?void 0:u.tags)!=null&&o.includes(e))},matches(...e){const r=k.get();return e.includes(r)}}),D=gt(((B=t.refs)==null?void 0:B.call(t,{prop:c,context:w}))??{}),R=()=>({state:j(),context:w,event:C(),prop:c,send:m,action:M,guard:q,track:dt,refs:D,computed:E,flush:G,scope:y(n),choose:O}),M=e=>{const r=$(e)?e(R()):e;if(!r)return;const u=r.map(o=>{var d,v;const a=(v=(d=t.implementations)==null?void 0:d.actions)==null?void 0:v[o];return a||J(`[zag-js] No implementation found for action "${JSON.stringify(o)}"`),a});for(const o of u)o==null||o(R())},q=e=>{var r,u;return $(e)?e(R()):(u=(r=t.implementations)==null?void 0:r.guards)==null?void 0:u[e](R())},x=e=>{const r=$(e)?e(R()):e;if(!r)return;const u=r.map(a=>{var v,S;const d=(S=(v=t.implementations)==null?void 0:v.effects)==null?void 0:S[a];return d||J(`[zag-js] No implementation found for effect "${JSON.stringify(a)}"`),d}),o=[];for(const a of u){const d=a==null?void 0:a(R());d&&o.push(d)}return()=>o.forEach(a=>a==null?void 0:a())},O=e=>nt(e).find(r=>{let u=!r.guard;return st(r.guard)?u=!!q(r.guard):$(r.guard)&&(u=r.guard(R())),u}),E=e=>{rt(t.computed,()=>"[zag-js] No computed object found on machine");const r=t.computed[e];return r({context:w,event:C(),prop:c,refs:D,scope:y(n),computed:E})},k=_(()=>({defaultValue:t.initialState({prop:c}),onChange(e,r){var o,a,d,v;if(r){const S=N.get(r);S==null||S(),N.delete(r)}r&&M((o=t.states[r])==null?void 0:o.exit),M((a=l.current)==null?void 0:a.actions);const u=x((d=t.states[e])==null?void 0:d.effects);if(u&&N.set(e,u),r===A){M(t.entry);const S=x(t.effects);S&&N.set(A,S)}M((v=t.states[e])==null?void 0:v.entry)}}));let z=V.NotStarted;Z(()=>{const e=z===V.Started;z=V.Started,i(e?"rehydrating...":"initializing..."),k.invoke(k.initial,A)}),K(()=>{i("unmounting..."),z=V.Stopped,N.forEach(e=>e==null?void 0:e()),N=new Map,l.current=null,M(t.exit)});const m=e=>{var v,S;if(z!==V.Started)return;p.current=g.current,g.current=e;let r=k.get();const u=((v=t.states[r].on)==null?void 0:v[e.type])??((S=t.on)==null?void 0:S[e.type]),o=O(u);if(!o)return;l.current=o;const a=o.target??r,d=a!==r;d?k.set(a):o.reenter&&!d?k.invoke(r,r):M(o.actions)};return(I=t.watch)==null||I.call(t,R()),{get state(){return j()},send:m,context:w,prop:c,scope:y(n),refs:D,computed:E,get event(){return C()},getStatus:()=>z}}function pt(t){return function(n){return t()[n]}}function G(t){queueMicrotask(()=>{Q(()=>t())})}export{bt as c,Ct as n,at as t,Nt as u};
