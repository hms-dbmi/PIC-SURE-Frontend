var T=Object.defineProperty;var I=(e,t,s)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var r=(e,t,s)=>I(e,typeof t!="symbol"?t+"":t,s);import{f as n,a as q}from"./configuration.CIpdfyUx.js";import{r as o}from"./scheduler.bui7uCNy.js";import{u as C}from"./User.D1BG6p9P.js";import{f as R,h as x}from"./Filter.BoavJqGc.js";class c{constructor(t){r(this,"categoryFilters");r(this,"numericFilters");r(this,"requiredFields");r(this,"anyRecordOf");r(this,"fields");r(this,"crossCountFields");r(this,"variantInfoFilters");r(this,"expectedResultType");var a;this.categoryFilters=(t==null?void 0:t.categoryFilters)||{},this.numericFilters=(t==null?void 0:t.numericFilters)||{},this.requiredFields=(t==null?void 0:t.requiredFields)||[],this.anyRecordOf=(t==null?void 0:t.anyRecordOf)||[],this.crossCountFields=(t==null?void 0:t.crossCountFields)||void 0,this.fields=(t==null?void 0:t.fields)||[];const s=((a=t==null?void 0:t.variantInfoFilters)==null?void 0:a[0])||{categoryVariantInfoFilters:{},numericVariantInfoFilters:{}};this.variantInfoFilters=[s],this.expectedResultType=(t==null?void 0:t.expectedResultType)||"COUNT"}addCategoryFilter(t,s){this.categoryFilters[t]=s}removeCategoryFilter(t){delete this.categoryFilters[t]}addNumericFilter(t,s,a){this.numericFilters[t]={min:s.toString(),max:a.toString()}}addCategoryVariantInfoFilters(t){this.variantInfoFilters[0].categoryVariantInfoFilters={Gene_with_variant:t.Gene_with_variant,Variant_consequence_calculated:t.Variant_consequence_calculated,Variant_frequency_as_text:t.Variant_frequency_as_text}}setCrossCountFields(t){this.crossCountFields=t}addSnpFilter(t){t.forEach(s=>{this.categoryFilters[s.search]=s.constraint.split(",")})}addRequiredField(t){this.requiredFields.push(t)}addAnyRecordOf(t){this.anyRecordOf.push(t)}hasFilter(){var i,l,d,h,F,_,u,f,m;const t=((d=(l=(i=this.variantInfoFilters[0])==null?void 0:i.categoryVariantInfoFilters)==null?void 0:l.Gene_with_variant)==null?void 0:d.length)||0,s=((_=(F=(h=this.variantInfoFilters[0])==null?void 0:h.categoryVariantInfoFilters)==null?void 0:F.Variant_consequence_calculated)==null?void 0:_.length)||0,a=((m=(f=(u=this.variantInfoFilters[0])==null?void 0:u.categoryVariantInfoFilters)==null?void 0:f.Variant_frequency_as_text)==null?void 0:m.length)||0;return Object.keys(this.categoryFilters).length+Object.keys(this.numericFilters).length+t+s+a+this.requiredFields.length+this.anyRecordOf.length}}const V="\\DCC Harmonized data set",y="\\_harmonized_consent\\",O="\\_topmed_consents\\";function S(e=!0,t=q.hpds,s="COUNT"){let a=new c;if(n.useQueryTemplate&&e){const i=o(C).queryTemplate;i&&(a=new c(structuredClone(i)))}return o(R).forEach(i=>{i.filterType==="Categorical"?i.displayType==="restrict"?a.addCategoryFilter(i.id,i.categoryValues):a.addRequiredField(i.id):i.filterType==="numeric"?a.addNumericFilter(i.id,i.min||"",i.max||""):i.filterType==="genomic"?a.addCategoryVariantInfoFilters({Gene_with_variant:i.Gene_with_variant,Variant_consequence_calculated:i.Variant_consequence_calculated,Variant_frequency_as_text:i.Variant_frequency_as_text}):i.filterType==="snp"&&a.addSnpFilter(i.snpValues)}),n.requireConsents&&e&&(a=v(a)),a.expectedResultType=s,{query:a,resourceUUID:t}}function b(e=!0,t=q.hpds,s="COUNT"){let a=new c;if(n.useQueryTemplate&&e){const i=o(C).queryTemplate;i&&(a=new c(structuredClone(i)))}return n.requireConsents&&e&&(a=v(a)),a.expectedResultType=s,{query:a,resourceUUID:t}}const v=e=>(!p(e.categoryFilters)&&!p(e.numericFilters)&&!g(e.fields)&&!g(e.requiredFields)&&e.removeCategoryFilter(y),o(x)||e.removeCategoryFilter(O),e),p=e=>Object.keys(e).some(t=>t.includes(V)),g=e=>e.some(t=>t.includes(V));export{b as a,S as g,v as u};
