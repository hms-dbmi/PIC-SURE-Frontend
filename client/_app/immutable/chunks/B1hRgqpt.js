import{s as ge,e as y,a as N,c as k,b as E,g as P,f as g,m,i as A,h,k as ee,o as be,t as C,d as F,j as G,z as ve,u as Z,n as x,r as J,w as ye,_ as W,$ as X}from"./DfqJWsAP.js";import{S as ke,i as Oe,g as ne,a as j,b as oe,t as B,d as ae,e as ue,m as ce,f as fe,j as Y}from"./B9sU1H0B.js";import{c as Ee,a as Se,b as we,O as Ve}from"./jmaSSIlA.js";import{a as Le}from"./BxMVHhPd.js";import{a as te}from"./ClRdNtGr.js";import{g as Ce}from"./BWY6sm7c.js";import{g as Fe}from"./D4yaORjf.js";import"./8fc_wYz-.js";import{P as Ae}from"./hZi8C6Ly.js";import{g as De}from"./CWplMVgD.js";function le(o){let e,t,r,l=o[8]&&ie(o),s=o[9]&&se(o),f=o[10]&&re(o);return{c(){e=y("div"),l&&l.c(),t=N(),s&&s.c(),r=N(),f&&f.c(),this.h()},l(a){e=k(a,"DIV",{class:!0});var i=E(e);l&&l.l(i),t=P(i),s&&s.l(i),r=P(i),f&&f.l(i),i.forEach(g),this.h()},h(){m(e,"class","variable-info")},m(a,i){A(a,e,i),l&&l.m(e,null),h(e,t),s&&s.m(e,null),h(e,r),f&&f.m(e,null)},p(a,i){a[8]?l?l.p(a,i):(l=ie(a),l.c(),l.m(e,t)):l&&(l.d(1),l=null),a[9]?s?s.p(a,i):(s=se(a),s.c(),s.m(e,r)):s&&(s.d(1),s=null),a[10]?f?f.p(a,i):(f=re(a),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(a){a&&g(e),l&&l.d(),s&&s.d(),f&&f.d()}}}function ie(o){let e,t,r;return{c(){e=y("div"),t=C("Variable Name: "),r=C(o[8]),this.h()},l(l){e=k(l,"DIV",{class:!0});var s=E(e);t=F(s,"Variable Name: "),r=F(s,o[8]),s.forEach(g),this.h()},h(){m(e,"class","variable-name")},m(l,s){A(l,e,s),h(e,t),h(e,r)},p(l,s){s&256&&G(r,l[8])},d(l){l&&g(e)}}}function se(o){let e,t,r;return{c(){e=y("div"),t=C("Variable Description: "),r=C(o[9]),this.h()},l(l){e=k(l,"DIV",{class:!0});var s=E(e);t=F(s,"Variable Description: "),r=F(s,o[9]),s.forEach(g),this.h()},h(){m(e,"class","variable-desc")},m(l,s){A(l,e,s),h(e,t),h(e,r)},p(l,s){s&512&&G(r,l[9])},d(l){l&&g(e)}}}function re(o){let e,t,r;return{c(){e=y("div"),t=C("Study: "),r=C(o[10]),this.h()},l(l){e=k(l,"DIV",{class:!0});var s=E(e);t=F(s,"Study: "),r=F(s,o[10]),s.forEach(g),this.h()},h(){m(e,"class","variable-study")},m(l,s){A(l,e,s),h(e,t),h(e,r)},p(l,s){s&1024&&G(r,l[10])},d(l){l&&g(e)}}}function Ie(o){let e,t,r,l,s,f,a,i,v;const b=[Te,Pe],c=[];function u(n,p){var _,V;return((_=n[0])==null?void 0:_.type)==="Categorical"?0:((V=n[0])==null?void 0:V.type)==="Continuous"?1:-1}return~(e=u(o))&&(t=c[e]=b[e](o)),{c(){t&&t.c(),r=N(),l=y("button"),s=y("i"),this.h()},l(n){t&&t.l(n),r=P(n),l=k(n,"BUTTON",{class:!0,"data-testid":!0,"aria-label":!0});var p=E(l);s=k(p,"I",{class:!0}),E(s).forEach(g),p.forEach(g),this.h()},h(){m(s,"class","fas fa-plus"),m(l,"class","btn btn-icon variant-filled-primary m-1 svelte-1l20iax"),m(l,"data-testid","add-filter"),m(l,"aria-label","Add Filter"),l.disabled=f=o[0].type==="Categorical"&&o[11].length===0},m(n,p){~e&&c[e].m(n,p),A(n,r,p),A(n,l,p),h(l,s),a=!0,i||(v=Z(l,"click",o[13]),i=!0)},p(n,p){let _=e;e=u(n),e===_?~e&&c[e].p(n,p):(t&&(ne(),j(c[_],1,1,()=>{c[_]=null}),oe()),~e?(t=c[e],t?t.p(n,p):(t=c[e]=b[e](n),t.c()),B(t,1),t.m(r.parentNode,r)):t=null),(!a||p&2049&&f!==(f=n[0].type==="Categorical"&&n[11].length===0))&&(l.disabled=f)},i(n){a||(B(t),a=!0)},o(n){j(t),a=!1},d(n){n&&(g(r),g(l)),~e&&c[e].d(n),i=!1,v()}}}function Ne(o){let e,t;return e=new Ae({props:{width:"w-10",value:void 0}}),{c(){ae(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,l){ce(e,r,l),t=!0},p:x,i(r){t||(B(e.$$.fragment,r),t=!0)},o(r){j(e.$$.fragment,r),t=!1},d(r){fe(e,r)}}}function Pe(o){let e,t,r,l,s,f,a,i,v,b,c,u,n,p,_,V,L;return{c(){e=y("div"),t=y("section"),r=y("label"),l=y("span"),s=C("Min: "),f=C(o[3]),a=N(),i=y("input"),v=N(),b=y("label"),c=y("span"),u=C("Max: "),n=C(o[2]),p=N(),_=y("input"),this.h()},l(O){e=k(O,"DIV",{class:!0});var S=E(e);t=k(S,"SECTION",{class:!0,"data-testid":!0});var D=E(t);r=k(D,"LABEL",{class:!0});var T=E(r);l=k(T,"SPAN",{});var U=E(l);s=F(U,"Min: "),f=F(U,o[3]),U.forEach(g),a=P(T),i=k(T,"INPUT",{id:!0,"data-testid":!0,type:!0,placeholder:!0,class:!0}),T.forEach(g),v=P(D),b=k(D,"LABEL",{class:!0});var I=E(b);c=k(I,"SPAN",{});var q=E(c);u=F(q,"Max: "),n=F(q,o[2]),q.forEach(g),p=P(I),_=k(I,"INPUT",{id:!0,"data-testid":!0,type:!0,placeholder:!0,class:!0}),I.forEach(g),D.forEach(g),S.forEach(g),this.h()},h(){m(i,"id","min"),m(i,"data-testid","min-input"),m(i,"type","text"),m(i,"placeholder","Enter value or leave blank for variable min"),m(i,"class","input"),m(r,"class","flex-auto flex-col"),m(_,"id","max"),m(_,"data-testid","max-input"),m(_,"type","text"),m(_,"placeholder","Enter value or leave blank for variable max"),m(_,"class","input"),m(b,"class","flex-auto flex-col"),m(t,"class","card-body flex flex-grow gap-4"),m(t,"data-testid","numerical-filter"),m(e,"class","card p-3 m-1 w-full")},m(O,S){A(O,e,S),h(e,t),h(t,r),h(r,l),h(l,s),h(l,f),h(r,a),h(r,i),J(i,o[4]),h(t,v),h(t,b),h(b,c),h(c,u),h(c,n),h(b,p),h(b,_),J(_,o[5]),V||(L=[Z(i,"input",o[19]),Z(_,"input",o[20])],V=!0)},p(O,S){S&8&&G(f,O[3]),S&16&&i.value!==O[4]&&J(i,O[4]),S&4&&G(n,O[2]),S&32&&_.value!==O[5]&&J(_,O[5])},i:x,o:x,d(O){O&&g(e),V=!1,ye(L)}}}function Te(o){var c;let e,t,r,l,s,f;function a(u){o[15](u)}function i(u){o[16](u)}function v(u){o[17](u)}let b={allOptions:(c=o[0])==null?void 0:c.values};return o[6]!==void 0&&(b.unselectedOptions=o[6]),o[1]!==void 0&&(b.selectedOptions=o[1]),o[7]!==void 0&&(b.currentlyLoading=o[7]),t=new Ve({props:b}),W.push(()=>Y(t,"unselectedOptions",a)),W.push(()=>Y(t,"selectedOptions",i)),W.push(()=>Y(t,"currentlyLoading",v)),t.$on("scroll",o[18]),{c(){e=y("div"),ae(t.$$.fragment),this.h()},l(u){e=k(u,"DIV",{"data-testid":!0,class:!0});var n=E(e);ue(t.$$.fragment,n),n.forEach(g),this.h()},h(){m(e,"data-testid","categoical-filter"),m(e,"class","w-full")},m(u,n){A(u,e,n),ce(t,e,null),f=!0},p(u,n){var _;const p={};n&1&&(p.allOptions=(_=u[0])==null?void 0:_.values),!r&&n&64&&(r=!0,p.unselectedOptions=u[6],X(()=>r=!1)),!l&&n&2&&(l=!0,p.selectedOptions=u[1],X(()=>l=!1)),!s&&n&128&&(s=!0,p.currentlyLoading=u[7],X(()=>s=!1)),t.$set(p)},i(u){f||(B(t.$$.fragment,u),f=!0)},o(u){j(t.$$.fragment,u),f=!1},d(u){u&&g(e),fe(t)}}}function Me(o){let e,t,r,l,s,f,a=!!o[0]&&le(o);const i=[Ne,Ie],v=[];function b(c,u){return c[0]?1:0}return l=b(o),s=v[l]=i[l](o),{c(){e=y("div"),a&&a.c(),t=N(),r=y("div"),s.c(),this.h()},l(c){e=k(c,"DIV",{});var u=E(e);a&&a.l(u),t=P(u),r=k(u,"DIV",{class:!0,"data-testid":!0});var n=E(r);s.l(n),n.forEach(g),u.forEach(g),this.h()},h(){m(r,"class","flex justify-between"),m(r,"data-testid","filter-component")},m(c,u){A(c,e,u),a&&a.m(e,null),h(e,t),h(e,r),v[l].m(r,null),f=!0},p(c,[u]){c[0]?a?a.p(c,u):(a=le(c),a.c(),a.m(e,t)):a&&(a.d(1),a=null);let n=l;l=b(c),l===n?v[l].p(c,u):(ne(),j(v[n],1,1,()=>{v[n]=null}),oe(),s=v[l],s?s.p(c,u):(s=v[l]=i[l](c),s.c()),B(s,1),s.m(r,null))},i(c){f||(B(s),f=!0)},o(c){j(s),f=!1},d(c){c&&g(e),a&&a.d(),v[l].d()}}}let K=20;function Re(o,e,t){let r,l,s;ee(o,te,d=>t(24,s=d));const f=Ce();ee(o,f,d=>t(23,l=d));const a=Fe();let{data:i}=e,v,b,c,u,n=[],p=[],_=K,V="",L=!1,O,S,D;be(async()=>{var d,M,z,R;if((d=l[0])!=null&&d.meta.existingFilter){const w=(M=l[0])==null?void 0:M.meta.existingFilter;t(0,i=(z=l[0])==null?void 0:z.meta.existingFilter.searchResult),t(8,O=(i==null?void 0:i.display)||""),t(9,S=(i==null?void 0:i.description)||""),t(10,D=i.studyAcronym&&i.dataset?`${i.studyAcronym} (${i.dataset})`:i.studyAcronym||i.dataset||""),w.filterType==="Categorical"?(w.categoryValues.length===0?t(1,p=(i==null?void 0:i.values)||[]):t(1,p=w.categoryValues),t(6,n=((R=i==null?void 0:i.values)==null?void 0:R.filter(H=>!p.find(Q=>Q===H)))||[]),n.length>=50&&t(6,n=n.slice(0,K))):w.filterType==="numeric"&&(t(4,c=w.min||""),t(5,u=w.max||""))}else if((i==null?void 0:i.type)==="Categorical")try{t(7,L=!0),t(0,i=await De(i.conceptPath,i.dataset)),t(7,L=!1),t(6,n=(i==null?void 0:i.values)||[]),n.length>=50&&t(6,n=n.slice(0,K))}catch(w){console.error(w),a.trigger({message:"An error occured while loading the filter. Please try again later.",background:"variant-filled-error"})}t(3,b=i.min?i.min.toString():""),t(2,v=i.max?i.max.toString():"")});function T(){var M;let d;if(i.type==="Categorical"){if(!r||r.length===0)return;r.length===((M=i==null?void 0:i.values)==null?void 0:M.length)?d=Ee(i):d=Se(i,r)}else d=we(i,c||void 0,u||void 0);d&&(Le(d),U())}function U(){ve(te,s="",s),l[0]&&f.close()}function I(d=""){var z;if((((z=i==null?void 0:i.values)==null?void 0:z.length)||0)!==0){t(7,L=!0);try{let R=(i==null?void 0:i.values)||[];(d!==V||!V.includes(d))&&(_=0,t(6,n=[]),V=d);let w=R.filter($=>!p.includes($)&&(!d||$.toLowerCase().includes(d.toLowerCase())));const H=Math.min(_+K,w.length),Q=w.slice(_,H);t(6,n=[...n,...Q]),_=H}catch(R){console.error(R),a.trigger({message:"An error occurred while loading more options. Please try again later.",background:"variant-filled-error"})}t(7,L=!1)}}function q(d){n=d,t(6,n)}function de(d){p=d,t(1,p)}function pe(d){L=d,t(7,L)}const _e=d=>I(d.detail.search);function me(){c=this.value,t(4,c)}function he(){u=this.value,t(5,u)}return o.$$set=d=>{"data"in d&&t(0,i=d.data)},o.$$.update=()=>{o.$$.dirty&2&&t(11,r=p.map(d=>d))},[i,p,v,b,c,u,n,L,O,S,D,r,f,T,I,q,de,pe,_e,me,he]}class We extends ke{constructor(e){super(),Oe(this,e,Re,Me,ge,{data:0})}}export{We as A};
