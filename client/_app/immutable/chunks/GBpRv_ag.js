import"./Bzak7iHL.js";import{p as Q,h as O,i as U,f as I,d as p,s,r as v,k as e,t as K,l as m,b as q,c as V,a as M,u as G,e as se,n as ee,j as re}from"./pV5yBOfK.js";import{d as te,e as oe}from"./D3FUfhzK.js";import{i as B}from"./BAa5cEXk.js";import{r as z,s as de,a as ae,d as ce}from"./B3YVaWvx.js";import{b as H}from"./CMMNa4Y8.js";import{p as J,s as le,a as ie}from"./C2caA9Pm.js";import{g as ue}from"./BLfKYx2_.js";import{u as be,a as fe}from"./BJn3HusL.js";import{a as ne,t as X}from"./tvkVmxlD.js";import{e as pe}from"./CFqqwPkz.js";import{p as ve}from"./wLQzkxGg.js";import{E as me}from"./C6RsMIt9.js";const _e=(x,a,i,g,E,b)=>{const o={label:e(a),id:e(i)};g()(E(),o),m(b,!1)},ge=(x,a,i,g)=>{m(a,i().label,!0),m(g,i().id,!0)},ye=(x,a,i,g)=>a()({label:e(i),id:e(g)}),Y=(x,a)=>m(a,!e(a));var he=I('<button type="button" title="Reset and cancel" class="btn-icon-color" data-testid="required-field-reset-btn"><i class="fa-solid fa-arrow-rotate-right fa-xl"></i> <span class="sr-only">Reset and cancel</span></button>'),xe=I('<button type="button" title="Cancel" class="btn-icon-color" data-testid="required-field-cancel-btn"><i class="fa-solid fa-ban fa-xl"></i> <span class="sr-only">Cancel</span></button>'),we=I('<button type="button" title="Save" data-testid="required-field-save-btn" class="btn-icon-color"><i class="fa-solid fa-floppy-disk fa-xl"></i> <span class="sr-only">Save</span></button> <!>',1),Fe=I('<button type="button" title="Edit" class="btn-icon-color" data-testid="required-field-edit-btn"><i class="fa-solid fa-pen fa-xl"></i> <span class="sr-only">Edit</span></button>'),qe=I('<div class="flex gap-4 p-3 odd:bg-surface-100-900 even:bg-surface-50-950"><label class="label flex-1"><span>Label:</span> <input type="text" class="input" minlength="1" maxlength="255"/></label> <label class="label flex-1"><span>ID:</span> <input type="text" minlength="1" maxlength="255"/></label> <div class="flex-none content-end py-2"><!> <button type="button" title="Delete" class="btn-icon-color" data-testid="required-field-delete-btn"><i class="fa-solid fa-trash fa-xl"></i> <span class="sr-only">Delete</span></button></div></div>');function Z(x,a){Q(a,!0);let i=J(a,"field",19,()=>({label:"",id:""})),g=J(a,"duplicate",3,!1),E=J(a,"onsave",3,()=>{}),b=J(a,"ondelete",3,()=>{}),o=O(U(i().label)),r=O(U(i().id)),f=G(()=>i().id!==e(r)||i().label!==e(o));const k=i().label===""||i().id==="";let w=O(U(k));var $=qe(),C=p($),A=s(p(C),2);z(A),v(C);var y=s(C,2),h=s(p(y),2);z(h),v(y);var D=s(y,2),S=p(D);{var P=d=>{var F=we(),t=M(F);t.__click=[_e,o,r,E,i,w];var l=s(t,2);{var c=_=>{var n=he();n.__click=[ge,o,i,r],q(_,n)},R=_=>{var n=se(),u=M(n);{var N=j=>{var W=xe();W.__click=[Y,w],q(j,W)};B(u,j=>{!k&&!e(f)&&j(N)},!0)}q(_,n)};B(l,_=>{e(f)?_(c):_(R,!1)})}K(()=>t.disabled=!e(o)||!e(r)||!e(f)),q(d,F)},T=d=>{var F=Fe();F.__click=[Y,w],q(d,F)};B(S,d=>{e(w)?d(P):d(T,!1)})}var L=s(S,2);L.__click=[ye,b,o,r],v(D),v($),K(()=>{de($,"data-testid",`required-field-row-${i().id?i().id:"new"}`),A.disabled=!e(w),h.disabled=!e(w),ae(h,1,`input ${(g()&&"preset-tonal-warning border border-warning-500 border-warning-600-400 focus:border-warning-800-200")??""}`)}),H(A,()=>e(o),d=>m(o,d)),H(h,()=>e(r),d=>m(r,d)),q(x,$),V()}te(["click"]);var ke=(x,a)=>m(a,!e(a)),$e=I('<fieldset class="border border-surface-300-700"><legend class="px-2 ml-2">Required Fields: <button type="button" class="text-primary-700-300 hover:text-secondary-700-300" aria-label="Add New Field" title="Add New Field" data-testid="required-field-new-btn"><i></i></button></legend> <!> <!> <!></fieldset>');function Ce(x,a){Q(a,!0);const i=()=>ie(ne,"$isTopAdmin",g),[g,E]=le();let b=J(a,"fields",3,"[]"),o=J(a,"onupdate",3,()=>{}),r=G(()=>ve(b())),f=G(()=>e(r).length===0||!i()),k=G(()=>e(r).filter(t=>e(r).filter(l=>l!==t).filter(l=>l.id===t.id).length>0));function w(t){return!!e(k).find(l=>l===t)}function $(t){o()(JSON.stringify(t))}function C(t,l){const c=[...e(r)];if(t.label===""||t.id==="")c.push(l),m(f,!1);else{const R=c.findIndex(_=>_.label===t.label&&_.id===t.id);R>-1&&(c[R]=l)}$(c)}function A(t){const l=e(r).filter(c=>c.label!==t.label||c.id!==t.id);$(l)}var y=$e(),h=p(y),D=s(p(h));D.__click=[ke,f];var S=p(D);v(D),v(h);var P=s(h,2);{var T=t=>{Z(t,{onsave:C,ondelete:()=>m(f,!1)})};B(P,t=>{e(f)&&t(T)})}var L=s(P,2);pe(L,19,()=>e(r),(t,l)=>`${l}-${t.label}-${t.id}`,(t,l)=>{{let c=G(()=>w(e(l)));Z(t,{get duplicate(){return e(c)},get field(){return e(l)},onsave:C,ondelete:A})}});var d=s(L,2);{var F=t=>{me(t,{"data-testid":"validation-warn",color:"warning",children:(l,c)=>{ee();var R=re("Fields with the same ID may not function properly.");q(l,R)},$$slots:{default:!0}})};B(d,t=>{e(k).length>0&&t(F)})}v(y),K(()=>{D.disabled=e(f),ae(S,1,`fa-solid fa-square-plus fa-xl ${e(f)?"opacity-50":""}`)}),q(x,y),V(),E()}te(["click"]);var Ae=I('<label class="label"><span>UUID:</span> <input type="text" class="input"/></label>'),De=I('<p class="mb-3 text-center">For details on how to set up a Connection, please refer to the <a href="https://pic-sure.gitbook.io/pic-sure-developer-guide/configuring-pic-sure/all-in-one-authentication-configuration#additional-authentication-configuration-option-s" target="_blank" class="anchor">PIC-SURE developer guide</a>.</p> <form><fieldset data-testid="connection-form" class="grid gap-4 my-3"><!> <label class="label required"><span>Label:</span> <input type="text" class="input" required minlength="1" maxlength="255"/></label> <label class="label required"><span>ID:</span> <input type="text" class="input" required minlength="1" maxlength="255"/></label> <label class="label required"><span>Sub Prefix:</span> <input type="text" class="input" required minlength="1" maxlength="255"/></label> <!> <div class="mt-2"><button type="submit" data-testid="connection-save-btn" class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500">Save</button> <a href="/admin/configuration" data-testid="connection-cancel-btn" class="btn preset-tonal-secondary border border-secondary-500 hover:preset-filled-secondary-500">Cancel</a></div></fieldset></form>',1);function Be(x,a){var l,c,R,_;Q(a,!0);const i=()=>ie(ne,"$isTopAdmin",g),[g,E]=le();let b=J(a,"connection",3,void 0),o=O(U(((l=b())==null?void 0:l.label)||"")),r=O(U(((c=b())==null?void 0:c.id)||"")),f=O(U(((R=b())==null?void 0:R.subPrefix)||"")),k=O(U(((_=b())==null?void 0:_.requiredFields)||"[]"));function w(n){m(k,n,!0)}async function $(n){n.preventDefault();let u={id:e(r),label:e(o),requiredFields:e(k),subPrefix:e(f)};try{b()?(u={...u,uuid:b().uuid},await be(u)):await fe(u),X.success({title:`Successfully saved ${u&&"new "}connection '${e(o)}'`}),ue("/admin/configuration")}catch(N){console.error(N),X.error({title:`An error occured while saving ${u&&"new "}connection '${e(o)}'`})}}var C=De(),A=s(M(C),2),y=p(A),h=p(y);{var D=n=>{var u=Ae(),N=s(p(u),2);z(N),N.readOnly=!0,v(u),K(()=>{var j;return ce(N,(j=b())==null?void 0:j.uuid)}),q(n,u)};B(h,n=>{var u;(u=b())!=null&&u.uuid&&n(D)})}var S=s(h,2),P=s(p(S),2);z(P),v(S);var T=s(S,2),L=s(p(T),2);z(L),v(T);var d=s(T,2),F=s(p(d),2);z(F),v(d);var t=s(d,2);Ce(t,{get fields(){return e(k)},onupdate:w}),ee(2),v(y),v(A),K(()=>y.disabled=!i()),oe("submit",A,$),H(P,()=>e(o),n=>m(o,n)),H(L,()=>e(r),n=>m(r,n)),H(F,()=>e(f),n=>m(f,n)),q(x,C),V(),E()}export{Be as C};
