import{s as ge,e as y,a as A,c as k,b as E,g as T,f as g,m,i as F,h,k as ee,o as be,t as C,d as D,j as Q,Q as ve,O as X,n as x,U as Z,w as ye,Y as J,Z as K}from"./scheduler.bui7uCNy.js";import{S as ke,i as Oe,g as re,a as U,b as oe,t as j,d as ae,e as ue,m as ce,f as fe,j as W}from"./index.Divvo4fc.js";import{c as Ee,a as Se,b as we,O as Ve}from"./OptionsSelectionList.qVZJIXX4.js";import{a as Le}from"./Filter.BoavJqGc.js";import{a as te}from"./Row.B9Nl9j0R.js";import{g as Ce}from"./stores.CsbPyROH.js";import{g as De}from"./stores.ClIv_1MU.js";import"./ProgressBar.svelte_svelte_type_style_lang.B7SkmbeT.js";import{P as Fe}from"./ProgressRadial.CtNAsR5Q.js";import{b as Ie}from"./dictionary.81xI9LLS.js";function Je(o,t){const{transition:e,params:n,enabled:l}=t;return l?e(o,n):"duration"in n?e(o,{duration:0}):{duration:0}}function le(o){let t,e,n,l=o[8]&&ie(o),s=o[9]&&se(o),f=o[10]&&ne(o);return{c(){t=y("div"),l&&l.c(),e=A(),s&&s.c(),n=A(),f&&f.c(),this.h()},l(a){t=k(a,"DIV",{class:!0});var i=E(t);l&&l.l(i),e=T(i),s&&s.l(i),n=T(i),f&&f.l(i),i.forEach(g),this.h()},h(){m(t,"class","variable-info")},m(a,i){F(a,t,i),l&&l.m(t,null),h(t,e),s&&s.m(t,null),h(t,n),f&&f.m(t,null)},p(a,i){a[8]?l?l.p(a,i):(l=ie(a),l.c(),l.m(t,e)):l&&(l.d(1),l=null),a[9]?s?s.p(a,i):(s=se(a),s.c(),s.m(t,n)):s&&(s.d(1),s=null),a[10]?f?f.p(a,i):(f=ne(a),f.c(),f.m(t,null)):f&&(f.d(1),f=null)},d(a){a&&g(t),l&&l.d(),s&&s.d(),f&&f.d()}}}function ie(o){let t,e,n;return{c(){t=y("div"),e=C("Variable Name: "),n=C(o[8]),this.h()},l(l){t=k(l,"DIV",{class:!0});var s=E(t);e=D(s,"Variable Name: "),n=D(s,o[8]),s.forEach(g),this.h()},h(){m(t,"class","variable-name")},m(l,s){F(l,t,s),h(t,e),h(t,n)},p(l,s){s&256&&Q(n,l[8])},d(l){l&&g(t)}}}function se(o){let t,e,n;return{c(){t=y("div"),e=C("Variable Description: "),n=C(o[9]),this.h()},l(l){t=k(l,"DIV",{class:!0});var s=E(t);e=D(s,"Variable Description: "),n=D(s,o[9]),s.forEach(g),this.h()},h(){m(t,"class","variable-desc")},m(l,s){F(l,t,s),h(t,e),h(t,n)},p(l,s){s&512&&Q(n,l[9])},d(l){l&&g(t)}}}function ne(o){let t,e,n;return{c(){t=y("div"),e=C("Study: "),n=C(o[10]),this.h()},l(l){t=k(l,"DIV",{class:!0});var s=E(t);e=D(s,"Study: "),n=D(s,o[10]),s.forEach(g),this.h()},h(){m(t,"class","variable-study")},m(l,s){F(l,t,s),h(t,e),h(t,n)},p(l,s){s&1024&&Q(n,l[10])},d(l){l&&g(t)}}}function Ne(o){let t,e,n,l,s,f,a,i,v;const b=[Pe,Te],c=[];function u(r,p){var _,V;return((_=r[0])==null?void 0:_.type)==="Categorical"?0:((V=r[0])==null?void 0:V.type)==="Continuous"?1:-1}return~(t=u(o))&&(e=c[t]=b[t](o)),{c(){e&&e.c(),n=A(),l=y("button"),s=y("i"),this.h()},l(r){e&&e.l(r),n=T(r),l=k(r,"BUTTON",{class:!0,"data-testid":!0});var p=E(l);s=k(p,"I",{class:!0}),E(s).forEach(g),p.forEach(g),this.h()},h(){m(s,"class","fas fa-plus"),m(l,"class","btn btn-icon variant-filled-primary m-1 svelte-1l20iax"),m(l,"data-testid","add-filter"),l.disabled=f=o[0].type==="Categorical"&&o[11].length===0},m(r,p){~t&&c[t].m(r,p),F(r,n,p),F(r,l,p),h(l,s),a=!0,i||(v=X(l,"click",o[13]),i=!0)},p(r,p){let _=t;t=u(r),t===_?~t&&c[t].p(r,p):(e&&(re(),U(c[_],1,1,()=>{c[_]=null}),oe()),~t?(e=c[t],e?e.p(r,p):(e=c[t]=b[t](r),e.c()),j(e,1),e.m(n.parentNode,n)):e=null),(!a||p&2049&&f!==(f=r[0].type==="Categorical"&&r[11].length===0))&&(l.disabled=f)},i(r){a||(j(e),a=!0)},o(r){U(e),a=!1},d(r){r&&(g(n),g(l)),~t&&c[t].d(r),i=!1,v()}}}function Ae(o){let t,e;return t=new Fe({props:{width:"w-10",value:void 0}}),{c(){ae(t.$$.fragment)},l(n){ue(t.$$.fragment,n)},m(n,l){ce(t,n,l),e=!0},p:x,i(n){e||(j(t.$$.fragment,n),e=!0)},o(n){U(t.$$.fragment,n),e=!1},d(n){fe(t,n)}}}function Te(o){let t,e,n,l,s,f,a,i,v,b,c,u,r,p,_,V,L;return{c(){t=y("div"),e=y("section"),n=y("label"),l=y("span"),s=C("Min: "),f=C(o[3]),a=A(),i=y("input"),v=A(),b=y("label"),c=y("span"),u=C("Max: "),r=C(o[2]),p=A(),_=y("input"),this.h()},l(O){t=k(O,"DIV",{class:!0});var S=E(t);e=k(S,"SECTION",{class:!0,"data-testid":!0});var I=E(e);n=k(I,"LABEL",{class:!0});var P=E(n);l=k(P,"SPAN",{});var B=E(l);s=D(B,"Min: "),f=D(B,o[3]),B.forEach(g),a=T(P),i=k(P,"INPUT",{id:!0,"data-testid":!0,type:!0,placeholder:!0,class:!0}),P.forEach(g),v=T(I),b=k(I,"LABEL",{class:!0});var N=E(b);c=k(N,"SPAN",{});var q=E(c);u=D(q,"Max: "),r=D(q,o[2]),q.forEach(g),p=T(N),_=k(N,"INPUT",{id:!0,"data-testid":!0,type:!0,placeholder:!0,class:!0}),N.forEach(g),I.forEach(g),S.forEach(g),this.h()},h(){m(i,"id","min"),m(i,"data-testid","min-input"),m(i,"type","text"),m(i,"placeholder","Enter value or leave blank for variable min"),m(i,"class","input"),m(n,"class","flex-auto flex-col"),m(_,"id","max"),m(_,"data-testid","max-input"),m(_,"type","text"),m(_,"placeholder","Enter value or leave blank for variable max"),m(_,"class","input"),m(b,"class","flex-auto flex-col"),m(e,"class","card-body flex flex-grow gap-4"),m(e,"data-testid","numerical-filter"),m(t,"class","card p-3 m-1 w-full")},m(O,S){F(O,t,S),h(t,e),h(e,n),h(n,l),h(l,s),h(l,f),h(n,a),h(n,i),Z(i,o[4]),h(e,v),h(e,b),h(b,c),h(c,u),h(c,r),h(b,p),h(b,_),Z(_,o[5]),V||(L=[X(i,"input",o[19]),X(_,"input",o[20])],V=!0)},p(O,S){S&8&&Q(f,O[3]),S&16&&i.value!==O[4]&&Z(i,O[4]),S&4&&Q(r,O[2]),S&32&&_.value!==O[5]&&Z(_,O[5])},i:x,o:x,d(O){O&&g(t),V=!1,ye(L)}}}function Pe(o){var c;let t,e,n,l,s,f;function a(u){o[15](u)}function i(u){o[16](u)}function v(u){o[17](u)}let b={allOptions:(c=o[0])==null?void 0:c.values};return o[6]!==void 0&&(b.unselectedOptions=o[6]),o[1]!==void 0&&(b.selectedOptions=o[1]),o[7]!==void 0&&(b.currentlyLoading=o[7]),e=new Ve({props:b}),J.push(()=>W(e,"unselectedOptions",a)),J.push(()=>W(e,"selectedOptions",i)),J.push(()=>W(e,"currentlyLoading",v)),e.$on("scroll",o[18]),{c(){t=y("div"),ae(e.$$.fragment),this.h()},l(u){t=k(u,"DIV",{"data-testid":!0,class:!0});var r=E(t);ue(e.$$.fragment,r),r.forEach(g),this.h()},h(){m(t,"data-testid","categoical-filter"),m(t,"class","w-full")},m(u,r){F(u,t,r),ce(e,t,null),f=!0},p(u,r){var _;const p={};r&1&&(p.allOptions=(_=u[0])==null?void 0:_.values),!n&&r&64&&(n=!0,p.unselectedOptions=u[6],K(()=>n=!1)),!l&&r&2&&(l=!0,p.selectedOptions=u[1],K(()=>l=!1)),!s&&r&128&&(s=!0,p.currentlyLoading=u[7],K(()=>s=!1)),e.$set(p)},i(u){f||(j(e.$$.fragment,u),f=!0)},o(u){U(e.$$.fragment,u),f=!1},d(u){u&&g(t),fe(e)}}}function Me(o){let t,e,n,l,s,f,a=!!o[0]&&le(o);const i=[Ae,Ne],v=[];function b(c,u){return c[0]?1:0}return l=b(o),s=v[l]=i[l](o),{c(){t=y("div"),a&&a.c(),e=A(),n=y("div"),s.c(),this.h()},l(c){t=k(c,"DIV",{});var u=E(t);a&&a.l(u),e=T(u),n=k(u,"DIV",{class:!0,"data-testid":!0});var r=E(n);s.l(r),r.forEach(g),u.forEach(g),this.h()},h(){m(n,"class","flex justify-between"),m(n,"data-testid","filter-component")},m(c,u){F(c,t,u),a&&a.m(t,null),h(t,e),h(t,n),v[l].m(n,null),f=!0},p(c,[u]){c[0]?a?a.p(c,u):(a=le(c),a.c(),a.m(t,e)):a&&(a.d(1),a=null);let r=l;l=b(c),l===r?v[l].p(c,u):(re(),U(v[r],1,1,()=>{v[r]=null}),oe(),s=v[l],s?s.p(c,u):(s=v[l]=i[l](c),s.c()),j(s,1),s.m(n,null))},i(c){f||(j(s),f=!0)},o(c){U(s),f=!1},d(c){c&&g(t),a&&a.d(),v[l].d()}}}let G=20;function Re(o,t,e){let n,l,s;ee(o,te,d=>e(24,s=d));const f=Ce();ee(o,f,d=>e(23,l=d));const a=De();let{data:i}=t,v,b,c,u,r=[],p=[],_=G,V="",L=!1,O,S,I;be(async()=>{var d,M,z,R;if((d=l[0])!=null&&d.meta.existingFilter){const w=(M=l[0])==null?void 0:M.meta.existingFilter;e(0,i=(z=l[0])==null?void 0:z.meta.existingFilter.searchResult),e(8,O=(i==null?void 0:i.display)||""),e(9,S=(i==null?void 0:i.description)||""),e(10,I=i.studyAcronym&&i.dataset?`${i.studyAcronym} (${i.dataset})`:i.studyAcronym||i.dataset||""),w.filterType==="Categorical"?(w.categoryValues.length===0?e(1,p=(i==null?void 0:i.values)||[]):e(1,p=w.categoryValues),e(6,r=((R=i==null?void 0:i.values)==null?void 0:R.filter(Y=>!p.find(H=>H===Y)))||[]),r.length>=50&&e(6,r=r.slice(0,G))):w.filterType==="numeric"&&(e(4,c=w.min||""),e(5,u=w.max||""))}else if((i==null?void 0:i.type)==="Categorical")try{e(7,L=!0),e(0,i=await Ie(i.conceptPath,i.dataset)),e(7,L=!1),e(6,r=(i==null?void 0:i.values)||[]),r.length>=50&&e(6,r=r.slice(0,G))}catch(w){console.error(w),a.trigger({message:"An error occured while loading the filter. Please try again later.",background:"variant-filled-error"})}e(3,b=i.min?i.min.toString():""),e(2,v=i.max?i.max.toString():"")});function P(){var M;let d;if(i.type==="Categorical"){if(!n||n.length===0)return;n.length===((M=i==null?void 0:i.values)==null?void 0:M.length)?d=Ee(i):d=Se(i,n)}else d=we(i,c||void 0,u||void 0);d&&(Le(d),B())}function B(){ve(te,s="",s),l[0]&&f.close()}function N(d=""){var z;if((((z=i==null?void 0:i.values)==null?void 0:z.length)||0)!==0){e(7,L=!0);try{let R=(i==null?void 0:i.values)||[];(d!==V||!V.includes(d))&&(_=0,e(6,r=[]),V=d);let w=R.filter($=>!p.includes($)&&(!d||$.toLowerCase().includes(d.toLowerCase())));const Y=Math.min(_+G,w.length),H=w.slice(_,Y);e(6,r=[...r,...H]),_=Y}catch(R){console.error(R),a.trigger({message:"An error occurred while loading more options. Please try again later.",background:"variant-filled-error"})}e(7,L=!1)}}function q(d){r=d,e(6,r)}function de(d){p=d,e(1,p)}function pe(d){L=d,e(7,L)}const _e=d=>N(d.detail.search);function me(){c=this.value,e(4,c)}function he(){u=this.value,e(5,u)}return o.$$set=d=>{"data"in d&&e(0,i=d.data)},o.$$.update=()=>{o.$$.dirty&2&&e(11,n=p.map(d=>d))},[i,p,v,b,c,u,r,L,O,S,I,n,f,P,N,q,de,pe,_e,me,he]}class Ke extends ke{constructor(t){super(),Oe(this,t,Re,Me,ge,{data:0})}}export{Ke as A,Je as d};
