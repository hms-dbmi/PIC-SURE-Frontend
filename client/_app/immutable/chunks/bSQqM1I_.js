var Xe=Object.defineProperty;var Ce=a=>{throw TypeError(a)};var Ge=(a,e,l)=>e in a?Xe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[e]=l;var xe=(a,e,l)=>Ge(a,typeof e!="symbol"?e+"":e,l),Ke=(a,e,l)=>e.has(a)||Ce("Cannot "+l);var $=(a,e,l)=>(Ke(a,e,"read from private field"),l?l.call(a):e.get(a)),oe=(a,e,l)=>e.has(a)?Ce("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,l);import{a5 as Qe,b8 as Ye,bb as Ze,p as ne,f as g,d,a as ee,s as c,k as t,r as o,b as u,t as P,c as se,e as Ae,u as ce,i as fe,h as J,l as f,n as Re}from"./DhSNEPDw.js";import"./Bzak7iHL.js";import{w as pe,g as re,o as De}from"./xU7jw7XU.js";import{s as B,d as Fe}from"./DVtHS8ol.js";import{i as C}from"./BG76zvuN.js";import{s as Z,r as we,a as Me,d as $e,h as et,b as tt,c as at}from"./CJ66PCUx.js";import{b as Te}from"./DPXw0ygh.js";import{p as K,s as Ve,c as ve}from"./DpjY2ypC.js";import{t as ue}from"./BNC-bmXQ.js";import{i as rt,j as je,A as it,k as nt,l as st,m as ot}from"./DA3-ipRP.js";import{c as ze,d as lt,e as dt}from"./CD4Ar3Xi.js";import{p as Ie}from"./B1n7kAsq.js";import{L as me}from"./bwStxD3u.js";import{O as ct}from"./fGsiDjuU.js";import{a as He}from"./Jhkhy7E3.js";import{e as qe,i as We}from"./ByI6iVq5.js";import{M as ft}from"./B9gq-btx.js";import{p as vt}from"./CftmxiRQ.js";import{E as Ne}from"./nxdkf_Tf.js";const ut=[];function ya(a,e=!1,l=!1){return de(a,new Map,"",ut,null,l)}function de(a,e,l,A,r=null,x=!1){if(typeof a=="object"&&a!==null){var L=e.get(a);if(L!==void 0)return L;if(a instanceof Map)return new Map(a);if(a instanceof Set)return new Set(a);if(Qe(a)){var v=Array(a.length);e.set(a,v),r!==null&&e.set(r,v);for(var i=0;i<a.length;i+=1){var O=a[i];i in a&&(v[i]=de(O,e,l,A,null,x))}return v}if(Ye(a)===Ze){v={},e.set(a,v),r!==null&&e.set(r,v);for(var E in a)v[E]=de(a[E],e,l,A,null,x);return v}if(a instanceof Date)return structuredClone(a);if(typeof a.toJSON=="function"&&!x)return de(a.toJSON(),e,l,A,a)}if(a instanceof EventTarget)return a;try{return structuredClone(a)}catch{return a}}var mt=g('<div><span class="font-bold">Name:</span> </div>'),_t=g('<div><span class="font-bold mb-1">Accession:</span> </div>'),pt=g('<div><span class="font-bold mb-1">Type:</span> </div>'),yt=g('<div><span class="font-bold">Description:</span> </div>'),gt=g('<div><span class="font-bold mb-1">Name:</span> </div>'),bt=g('<div><span class="font-bold">Accession:</span> </div>'),ht=g('<div><span class="font-bold">Description:</span> </div>'),xt=g('<section data-testid="dataset-info" class="flex flex-col w-3/4 p-4"><h3 class="text-primary-500">Dataset Information</h3> <div class="w-full flex flex-row justify-between"><!> <!></div> <!></section>'),wt=g('<div><span class="font-bold mb-1">Study Name:</span> </div>'),At=g('<div><span class="font-bold">Study Accession:</span> </div>'),Ft=g('<section data-testid="study-info" class="flex flex-col w-3/4 p-4"><h3 class="text-primary-500">Study Information</h3> <div class="w-full flex flex-col"><!> <!></div></section>'),Ot=g('<section data-testid="variable-info" class="flex flex-col w-3/4 p-4"><h3 class="text-primary-500">Variable Information</h3> <div class="w-full flex flex-row justify-between"><!> <!> <!></div> <!></section> <!> <!>',1),kt=g('<div class="card bg-surface-100 min-h-60 p-4"><div class="card-body"><!></div></div>');function St(a,e){ne(e,!0);let l=K(e,"data",19,()=>({})),A=ze(l().conceptPath,l().dataset);var r=kt(),x=d(r),L=d(x);He(L,()=>A,v=>{me(v,{ring:!0,size:"medium"})},(v,i)=>{var O=Ot(),E=ee(O),y=c(d(E),2),T=d(y);{var I=w=>{var n=mt(),m=c(d(n));o(n),P(()=>B(m,` ${t(i).display??""}`)),u(w,n)};C(T,w=>{t(i).display&&w(I)})}var p=c(T,2);{var F=w=>{var n=_t(),m=c(d(n));o(n),P(()=>B(m,` ${t(i).name??""}`)),u(w,n)};C(p,w=>{t(i).name&&w(F)})}var M=c(p,2);{var q=w=>{var n=pt(),m=c(d(n));o(n),P(()=>B(m,` ${t(i).type??""}`)),u(w,n)};C(M,w=>{t(i).type&&w(q)})}o(y);var G=c(y,2);{var R=w=>{var n=yt(),m=c(d(n));o(n),P(()=>B(m,` ${t(i).description??""}`)),u(w,n)};C(G,w=>{t(i).description&&w(R)})}o(E);var te=c(E,2);{var Q=w=>{var n=xt(),m=c(d(n),2),b=d(m);{var W=k=>{var S=gt(),H=c(d(S));o(S),P(()=>B(H,` ${t(i).table.display??""}`)),u(k,S)};C(b,k=>{t(i).table.display&&k(W)})}var U=c(b,2);{var s=k=>{var S=bt(),H=c(d(S));o(S),P(()=>B(H,` ${t(i).table.name??""}`)),u(k,S)};C(U,k=>{t(i).table.name&&k(s)})}o(m);var _=c(m,2);{var h=k=>{var S=ht(),H=c(d(S));o(S),P(()=>B(H,` ${t(i).table.description??""}`)),u(k,S)};C(_,k=>{t(i).table.description&&k(h)})}o(n),u(w,n)};C(te,w=>{t(i).table&&w(Q)})}var Y=c(te,2);{var D=w=>{var n=Ft(),m=c(d(n),2),b=d(m);{var W=_=>{var h=wt(),k=c(d(h));o(h),P(()=>{var S;return B(k,` ${(t(i).study.fullName||t(i).study.display||t(i).study.studyAcronym||((S=t(i))==null?void 0:S.studyAcronym))??""}`)}),u(_,h)};C(b,_=>{var h;(t(i).study.fullName||t(i).study.display||t(i).study.studyAcronym||(h=t(i))!=null&&h.studyAcronym)&&_(W)})}var U=c(b,2);{var s=_=>{var h=At(),k=c(d(h));o(h),P(()=>B(k,` ${t(i).study.ref??""}`)),u(_,h)};C(U,_=>{t(i).study.ref&&_(s)})}o(m),o(n),u(w,n)};C(Y,w=>{t(i).study&&w(D)})}u(v,O)}),o(x),o(r),u(a,r),se()}var Et=g('<i class="fa-solid fa-angle-left fa-xl -rotate-45 self-center"></i>'),Ct=(a,e)=>e.node.select(),Tt=g('<details class="tree-item" open><summary class="tree-item-summary list-none [&amp;::-webkit-details-marker]:hidden flex items-center cursor-pointer rounded-container p-0 hover:preset-tonal-primary space-x-1 w-full mr-2" role="treeitem"><!> <input type="radio" name="tree-radio"/> <label class="w-full"> </label></summary> <div class="tree-item-children ml-4" role="group"><!></div></details>');function Je(a,e){ne(e,!0);const l=K(e,"isRoot",3,!1),A=K(e,"disabled",3,!1);var r=Tt(),x=d(r);Z(x,"aria-expanded",!0);var L=d(x);{var v=p=>{var F=Et();P(()=>tt(F,`margin-left: ${(e.index+1)*9}px;`)),u(p,F)};C(L,p=>{l()||p(v)})}var i=c(L,2);we(i),i.__click=[Ct,e];var O=c(i,2),E=d(O,!0);o(O),o(x);var y=c(x,2),T=d(y);{var I=p=>{var F=Ae(),M=ee(F);qe(M,17,()=>e.node.children,We,(q,G)=>{{let R=ce(()=>e.index+1);Je(q,{get node(){return t(G)},get index(){return t(R)},get disabled(){return A()}})}}),u(p,F)};C(T,p=>{e.node.isLeaf||p(I)})}o(y),o(r),P(()=>{Z(r,"data-testid",`tree-item:${e.node.name??""}-${e.node.value??""}`),Z(r,"aria-disabled",e.node.disabled||A()),Z(x,"aria-selected",e.node.selected),Z(i,"id",`radio:${e.node.name??""}`),Z(i,"data-testid",`radio:${e.node.name??""}`),Me(i,1,`radio tree-item-radio self-center ${l()?"ml-[28px]":""}`),$e(i,e.node.value),i.disabled=e.node.disabled||A(),et(i,e.node.selected),Z(O,"for",`${e.node.isLeaf?"radio:":"tree-item-btn:"}${e.node.name??""}`),B(E,e.node.name),Z(y,"data-testid",`tree-item-children:${e.node.name??""}`)}),u(a,r),se()}Fe(["click"]);var Nt=g("<div></div>");function Pt(a,e){var E,y,T;ne(e,!0);let l=K(e,"nodes",19,()=>[]),A=K(e,"fullWidth",3,!1),r=K(e,"onselect",3,()=>{}),x=K(e,"disableTree",3,!1);class L{constructor(p,F,M=[],q=!1,G=!1){xe(this,"name","");xe(this,"value","");oe(this,E,J(!1));oe(this,y,J(x()));oe(this,T,J(fe([])));this.name=p,this.value=F,this.children=M,this.selected=q||this.isLeaf,this.disabled=G}get selected(){return t($(this,E))}set selected(p){f($(this,E),p,!0)}get disabled(){return t($(this,y))}set disabled(p){f($(this,y),p,!0)}get children(){return t($(this,T))}set children(p){f($(this,T),p,!0)}get isLeaf(){return this.children.length===0}select(){this.disabled||(i.forEach(p=>{const F=M=>{M!==this&&(M.selected=!1,M.children.forEach(F))};F(p)}),this.selected=!0,r()(this.value))}}E=new WeakMap,y=new WeakMap,T=new WeakMap;function v(I){const{name:p,value:F,selected:M}=I;let q=[];return I.children.length>0&&(q=I.children.map(v)),new L(p,F,q,M)}let i=fe(l().map(v));var O=Nt();qe(O,21,()=>i,We,(I,p,F)=>{Je(I,{get node(){return t(p)},index:F,get disabled(){return x()},isRoot:F===0})}),o(O),P(()=>Me(O,1,at(A()?"w-full":""))),u(a,O),se()}async function Lt(a,e,l,A,r,x,L){if(!t(e)){if(!t(l)){ue.error({description:"No selection made"});return}f(e,!0);try{const v=await dt(A().dataset,r,t(l));let i;const O={conceptPath:t(l),display:t(l).split("\\").filter(Boolean).pop()||t(l),name:t(l),allowFiltering:!0,dataset:A().dataset,studyAcronym:A().studyAcronym,description:`Any Record of ${t(l)}`,meta:A().meta,study:A().study,table:A().table,type:"AnyRecordOf"};i=rt(O,v),je(i),x()}catch(v){v instanceof it?f(L,!0):(console.error("Error adding selection: ",v instanceof Error?v.message:v),ue.error({description:"Something went wrong when adding the filter. If the problem persists, please contact your administrator."}))}finally{f(e,!1)}}}var Mt=(a,e)=>f(e,!1),Vt=g(`<div data-testid="hierarchy-component-error-modal-content"><p class="m-0">The level of the data tree you selected exceeds 9,500 variables. This was not added as a
      filter to your query. Please make a selection lower in the data tree and try again.</p> <div class="flex justify-center mt-4"><button class="btn preset-filled-primary-500">Okay</button></div></div>`),jt=g('<p class="m-0">Filtering is not available for this variable</p>'),zt=g('<p class="m-0">Error loading hierarchy</p> <span class="text-sm text-gray-500 hidden"> </span>',1),It=g('<i class="fas fa-warning"></i> <span class="sr-only">Filtering is not available for this variable</span>',1),Ht=g('<i class="fas fa-plus"></i>'),qt=g('<!> <div data-testid="hierarchy-component" class="flex flex-row justify-between bg-surface-100 p-4 rounded-container"><div class="flex flex-col gap-2"><!> <!></div> <button class="btn btn-icon preset-filled-primary-500 m-1" data-testid="add-filter"><!></button></div>',1);function Wt(a,e){ne(e,!0);const[l,A]=Ve(),r=100;let x=K(e,"data",19,()=>({})),L=K(e,"onclose",3,()=>{}),v=J(!1),i=J(void 0),O=J(!1),E=ce(()=>{var n;return!((n=x())!=null&&n.allowFiltering)&&vt.url.pathname.includes("/discover")});async function y(){var n,m;if(!((n=x())!=null&&n.dataset)||!((m=x())!=null&&m.conceptPath))throw new Error("Dataset and concept path are required");try{const b=await lt(x().dataset,x().conceptPath);if(!(b!=null&&b.length))throw new Error("No hierarchy concepts found");const W=b.reduce((U,s)=>{const _=T(s);return U&&(_.children=[U]),_},null);return f(i,b[0].conceptPath,!0),W?[W]:[]}catch(b){throw console.error("Error getting hierarchy concepts: ",b instanceof Error?b.message:b),b}}function T(n){return{name:`${n.display} (${n.name})`,value:n.conceptPath,children:[],open:!0,selected:!1}}function I(){ve(ie,""),ve(Ie,!0),L()()}var p=qt(),F=ee(p);ft(F,{"data-testid":"hierarchy-component-error-modal",title:"Data tree selection too large",closeable:!0,width:"w-1/2",get open(){return t(v)},set open(n){f(v,n,!0)},children:(n,m)=>{var b=Vt(),W=c(d(b),2),U=d(W);U.__click=[Mt,v],o(W),o(b),u(n,b)},$$slots:{default:!0}});var M=c(F,2),q=d(M),G=d(q);{var R=n=>{Ne(n,{color:"warning",children:(m,b)=>{var W=jt();u(m,W)},$$slots:{default:!0}})};C(G,n=>{t(E)&&n(R)})}var te=c(G,2);He(te,y,n=>{me(n,{ring:!0,size:"small"})},(n,m)=>{Pt(n,{fullWidth:!0,get nodes(){return t(m)},get disableTree(){return t(E)},onselect:b=>f(i,b,!0)})},(n,m)=>{Ne(n,{color:"error",children:(b,W)=>{var U=zt(),s=c(ee(U),2),_=d(s,!0);o(s),P(h=>B(_,h),[()=>t(m)instanceof Error?t(m).message:String(t(m))]),u(b,U)},$$slots:{default:!0}})}),o(q);var Q=c(q,2);Q.__click=[Lt,O,i,x,r,I,v];var Y=d(Q);{var D=n=>{me(n,{size:"micro",color:"white"})},w=n=>{var m=Ae(),b=ee(m);{var W=s=>{var _=It();Re(2),u(s,_)},U=s=>{var _=Ht();u(s,_)};C(b,s=>{t(E)?s(W):s(U,!1)},!0)}u(n,m)};C(Y,n=>{t(O)?n(D):n(w,!1)})}o(Q),o(M),P(()=>{Z(Q,"aria-label",t(O)?"Adding Filter...":"Add Filter"),Q.disabled=t(O)||t(E)}),u(a,p),se(),A()}Fe(["click"]);const _e={filter:()=>Zt,info:()=>St,hierarchy:()=>Wt},Pe=pe(""),ie=pe(""),Le=pe(_e.info()),le=pe(_e.info());function ga(a){const{row:e,table:l,component:A}=a,r=re(ie)===e,x=!A||re(le)===_e[A](),L=!l||re(Pe)===l;r&&x&&L?(ie.set(""),le.set(re(Le))):(ie.set(e),l&&Pe.set(l),A?le.set(_e[A]()):le.set(re(Le)))}var Jt=g('<div class="variable-name"> </div>'),Bt=g('<div class="variable-desc"> </div>'),Ut=g('<div class="variable-study"> </div>'),Xt=g('<div class="variable-info"><!> <!> <!></div>'),Gt=g('<div data-testid="categoical-filter" class="w-full"><!></div>'),Kt=g('<div class="card bg-surface-100 p-3 m-1 w-full"><section class="card-body flex grow gap-4" data-testid="numerical-filter"><label class="flex-auto flex-col"><span> </span> <input id="min" data-testid="min-input" type="text" placeholder="Enter value or leave blank for variable min" class="input"/></label> <label class="flex-auto flex-col"><span> </span> <input id="max" data-testid="max-input" type="text" placeholder="Enter value or leave blank for variable max" class="input"/></label></section></div>'),Qt=g('<!> <button class="btn btn-icon preset-filled-primary-500 m-1 svelte-ioyacr" data-testid="add-filter" aria-label="Add Filter"><i class="fas fa-plus"></i></button>',1),Yt=g('<div><!> <div class="flex justify-between" data-testid="filter-component"><!></div></div>');function Zt(a,e){ne(e,!0);const[l,A]=Ve();let r=K(e,"data",23,()=>({})),x=K(e,"onclose",3,()=>{}),L=J(""),v=J(""),i=J(""),O=J(""),E=20,y=J(fe([])),T=J(fe([])),I=E,p="",F=J(!1),M=J(""),q=J(""),G=J("");De(async()=>{var s,_,h,k,S,H,X;if(e.existingFilter)f(M,((s=r())==null?void 0:s.display)||"",!0),f(q,((_=r())==null?void 0:_.description)||"",!0),f(G,r().studyAcronym&&r().dataset?`${r().studyAcronym} (${r().dataset})`:r().studyAcronym||r().dataset||"",!0),e.existingFilter.filterType==="Categorical"?(e.existingFilter.categoryValues.length===0?f(T,((h=r())==null?void 0:h.values)||[],!0):f(T,e.existingFilter.categoryValues,!0),f(y,((S=(k=r())==null?void 0:k.values)==null?void 0:S.filter(V=>!t(T).find(N=>N===V)))||[],!0),t(y).length>=50&&f(y,t(y).slice(0,E),!0)):e.existingFilter.filterType==="numeric"&&(f(i,e.existingFilter.min!==void 0&&e.existingFilter.min!==null?e.existingFilter.min.toString():"",!0),f(O,e.existingFilter.max!==void 0&&e.existingFilter.max!==null?e.existingFilter.max.toString():"",!0));else if(((H=r())==null?void 0:H.type)==="Categorical")try{f(F,!0),r(await ze(r().conceptPath,r().dataset)),f(F,!1),f(y,((X=r())==null?void 0:X.values)||[],!0),t(y).length>=50&&f(y,t(y).slice(0,E),!0)}catch(V){console.error(V),ue.error({title:"An error occured while loading the filter. Please try again later."})}f(v,r().min!==void 0&&r().min!==null?r().min.toString():"",!0),f(L,r().max!==void 0&&r().max!==null?r().max.toString():"",!0)});function R(){var _,h;let s;if(r().type==="Categorical"){if(!t(Y)||t(Y).length===0)return;t(Y).length===((h=(_=r())==null?void 0:_.values)==null?void 0:h.length)?s=nt(r()):s=st(r(),t(Y))}else s=ot(r(),t(i)||void 0,t(O)||void 0);s&&(je(s),te())}function te(){ve(ie,""),ve(Ie,!0),x()()}function Q(s=""){var h,k,S;if((((k=(h=r())==null?void 0:h.values)==null?void 0:k.length)||0)!==0){f(F,!0);try{let H=((S=r())==null?void 0:S.values)||[];(s!==p||!p.includes(s))&&(I=0,f(y,[],!0),p=s);let X=H.filter(j=>!t(T).includes(j)&&(!s||j.toLowerCase().includes(s.toLowerCase())));const V=Math.min(I+E,X.length),N=X.slice(I,V);f(y,[...t(y),...N],!0),I=V}catch(H){console.error(H),ue.error({title:"An error occurred while loading more options. Please try again later."})}f(F,!1)}}let Y=ce(()=>t(T).map(s=>s));var D=Yt(),w=d(D);{var n=s=>{var _=Xt(),h=d(_);{var k=N=>{var j=Jt(),z=d(j);o(j),P(()=>B(z,`Variable Name: ${t(M)??""}`)),u(N,j)};C(h,N=>{t(M)&&N(k)})}var S=c(h,2);{var H=N=>{var j=Bt(),z=d(j);o(j),P(()=>B(z,`Variable Description: ${t(q)??""}`)),u(N,j)};C(S,N=>{t(q)&&N(H)})}var X=c(S,2);{var V=N=>{var j=Ut(),z=d(j);o(j),P(()=>B(z,`Study: ${t(G)??""}`)),u(N,j)};C(X,N=>{t(G)&&N(V)})}o(_),u(s,_)};C(w,s=>{r()&&s(n)})}var m=c(w,2),b=d(m);{var W=s=>{me(s,{ring:!0,size:"medium"})},U=s=>{var _=Qt(),h=ee(_);{var k=X=>{var V=Gt(),N=d(V);{let j=ce(()=>{var z;return(z=r())==null?void 0:z.values});ct(N,{get allOptions(){return t(j)},onscroll:Q,get unselectedOptions(){return t(y)},set unselectedOptions(z){f(y,z,!0)},get selectedOptions(){return t(T)},set selectedOptions(z){f(T,z,!0)},get currentlyLoading(){return t(F)},set currentlyLoading(z){f(F,z,!0)}})}o(V),u(X,V)},S=X=>{var V=Ae(),N=ee(V);{var j=z=>{var ae=Kt(),Oe=d(ae),ye=d(Oe),ge=d(ye),Be=d(ge);o(ge);var ke=c(ge,2);we(ke),o(ye);var Se=c(ye,2),be=d(Se),Ue=d(be);o(be);var Ee=c(be,2);we(Ee),o(Se),o(Oe),o(ae),P(()=>{B(Be,`Min: ${t(v)??""}`),B(Ue,`Max: ${t(L)??""}`)}),Te(ke,()=>t(i),he=>f(i,he)),Te(Ee,()=>t(O),he=>f(O,he)),u(z,ae)};C(N,z=>{var ae;((ae=r())==null?void 0:ae.type)==="Continuous"&&z(j)},!0)}u(X,V)};C(h,X=>{var V;((V=r())==null?void 0:V.type)==="Categorical"?X(k):X(S,!1)})}var H=c(h,2);H.__click=R,P(()=>H.disabled=r().type==="Categorical"&&t(Y).length===0),u(s,_)};C(b,s=>{r()?s(U,!1):s(W)})}o(m),o(D),u(a,D),se(),A()}Fe(["click"]);export{Zt as A,ya as a,ie as b,Pe as c,le as d,ga as s};
