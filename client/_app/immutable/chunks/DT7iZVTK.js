import{s as pe,e as d,a as w,t as le,c as _,b as I,g as A,l as J,f as P,d as ne,m as f,r as X,T as ve,i as ae,h as o,W as ce,u as W,v as be,n as ue,y as he,w as ke,j as me,X as Ce}from"./DfqJWsAP.js";import{e as V}from"./CnUKkpeB.js";import{S as Ee,i as Se}from"./B9sU1H0B.js";import{g as Le}from"./DA0IzwqI.js";import{g as ye}from"./D4yaORjf.js";import"./8fc_wYz-.js";import{U as Pe}from"./BG8FnnGv.js";import{C as Ue}from"./CjRA7bPa.js";import{R as Ne}from"./CC3Nk4BD.js";import{P as Te}from"./Cg9HbQ4q.js";function fe(l,e,n){const r=l.slice();return r[18]=e[n][0],r[19]=e,r[20]=n,r}function de(l,e,n){const r=l.slice();return r[6]=e[n],r}function _e(l){let e,n=l[6].label+"",r,b,h;return{c(){e=d("option"),r=le(n),this.h()},l(u){e=_(u,"OPTION",{});var g=I(e);r=ne(g,n),g.forEach(P),this.h()},h(){e.__value=b=l[6].uuid,X(e,e.__value),e.selected=h=l[0]&&l[0].connection===l[6].uuid},m(u,g){ae(u,e,g),o(e,r)},p(u,g){g&4&&n!==(n=u[6].label+"")&&me(r,n),g&4&&b!==(b=u[6].uuid)&&(e.__value=b,X(e,e.__value)),g&5&&h!==(h=u[0]&&u[0].connection===u[6].uuid)&&(e.selected=h)},d(u){u&&P(e)}}}function ge(l){let e,n,r,b,h=l[18]+"",u,g,S,i;function B(){l[11].call(n,l[20])}return{c(){e=d("label"),n=d("input"),r=w(),b=d("p"),u=le(h),g=w(),this.h()},l(C){e=_(C,"LABEL",{class:!0});var s=I(e);n=_(s,"INPUT",{class:!0,type:!0}),r=A(s),b=_(s,"P",{});var U=I(b);u=ne(U,h),U.forEach(P),g=A(s),s.forEach(P),this.h()},h(){f(n,"class","checkbox"),f(n,"type","checkbox"),f(e,"class","flex items-center space-x-2 svelte-1hg36ee")},m(C,s){ae(C,e,s),o(e,n),n.checked=l[5][l[20]].checked,o(e,r),o(e,b),o(b,u),o(e,g),S||(i=W(n,"change",B),S=!0)},p(C,s){l=C,s&32&&(n.checked=l[5][l[20]].checked),s&2&&h!==(h=l[18]+"")&&me(u,h)},d(C){C&&P(e),S=!1,i()}}}function we(l){let e,n,r,b,h,u="Active",g,S,i,B="Email:",C,s,U,L,N,z="Connection:",j,E,y,G,m,T,k,q,H="Roles:",Y,Z,R,se="Save",$,M,oe="Cancel",ee,re,x=V(l[2]),p=[];for(let a=0;a<x.length;a+=1)p[a]=_e(de(l,x,a));let D=V(l[1]),v=[];for(let a=0;a<D.length;a+=1)v[a]=ge(fe(l,D,a));return{c(){e=d("form"),n=d("label"),r=d("input"),b=w(),h=d("p"),h.textContent=u,g=w(),S=d("label"),i=d("span"),i.textContent=B,C=w(),s=d("input"),U=w(),L=d("label"),N=d("span"),N.textContent=z,j=w(),E=d("select"),y=d("option"),G=le("none");for(let a=0;a<p.length;a+=1)p[a].c();T=w(),k=d("fieldset"),q=d("legend"),q.textContent=H,Y=w();for(let a=0;a<v.length;a+=1)v[a].c();Z=w(),R=d("button"),R.textContent=se,$=w(),M=d("a"),M.textContent=oe,this.h()},l(a){e=_(a,"FORM",{});var c=I(e);n=_(c,"LABEL",{class:!0});var t=I(n);r=_(t,"INPUT",{class:!0,type:!0}),b=A(t),h=_(t,"P",{"data-svelte-h":!0}),J(h)!=="svelte-9a8exy"&&(h.textContent=u),t.forEach(P),g=A(c),S=_(c,"LABEL",{class:!0});var O=I(S);i=_(O,"SPAN",{"data-svelte-h":!0}),J(i)!=="svelte-1s4kc5o"&&(i.textContent=B),C=A(O),s=_(O,"INPUT",{type:!0,class:!0,minlength:!0,maxlength:!0}),O.forEach(P),U=A(c),L=_(c,"LABEL",{class:!0});var K=I(L);N=_(K,"SPAN",{"data-svelte-h":!0}),J(N)!=="svelte-ir2yyg"&&(N.textContent=z),j=A(K),E=_(K,"SELECT",{class:!0});var te=I(E);y=_(te,"OPTION",{});var ie=I(y);G=ne(ie,"none"),ie.forEach(P);for(let F=0;F<p.length;F+=1)p[F].l(te);te.forEach(P),K.forEach(P),T=A(c),k=_(c,"FIELDSET",{"data-testid":!0,class:!0});var Q=I(k);q=_(Q,"LEGEND",{"data-svelte-h":!0}),J(q)!=="svelte-1uxa1d9"&&(q.textContent=H),Y=A(Q);for(let F=0;F<v.length;F+=1)v[F].l(Q);Q.forEach(P),Z=A(c),R=_(c,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),J(R)!=="svelte-uo67us"&&(R.textContent=se),$=A(c),M=_(c,"A",{href:!0,class:!0,"data-svelte-h":!0}),J(M)!=="svelte-13l4n87"&&(M.textContent=oe),c.forEach(P),this.h()},h(){f(r,"class","checkbox"),f(r,"type","checkbox"),f(n,"class","flex items-center space-x-2 svelte-1hg36ee"),f(s,"type","email"),f(s,"class","input"),s.required=!0,f(s,"minlength","1"),f(s,"maxlength","255"),f(S,"class","label required svelte-1hg36ee"),y.selected=m=!l[0]||!l[0].connection,y.disabled=!0,y.__value="",X(y,y.__value),f(E,"class","select"),E.required=!0,l[6]===void 0&&ve(()=>l[10].call(E)),f(L,"class","label required svelte-1hg36ee"),f(k,"data-testid","privilege-checkboxes"),f(k,"class","svelte-1hg36ee"),f(R,"type","submit"),f(R,"class","btn variant-ghost-primary hover:variant-filled-primary"),f(M,"href","/admin/users"),f(M,"class","btn variant-ghost-secondary hover:variant-filled-secondary")},m(a,c){ae(a,e,c),o(e,n),o(n,r),r.checked=l[4],o(n,b),o(n,h),o(e,g),o(e,S),o(S,i),o(S,C),o(S,s),X(s,l[3]),o(e,U),o(e,L),o(L,N),o(L,j),o(L,E),o(E,y),o(y,G);for(let t=0;t<p.length;t+=1)p[t]&&p[t].m(E,null);ce(E,l[6],!0),o(e,T),o(e,k),o(k,q),o(k,Y);for(let t=0;t<v.length;t+=1)v[t]&&v[t].m(k,null);o(e,Z),o(e,R),o(e,$),o(e,M),ee||(re=[W(r,"change",l[8]),W(s,"input",l[9]),W(E,"change",l[10]),W(e,"submit",be(l[7]))],ee=!0)},p(a,[c]){if(c&16&&(r.checked=a[4]),c&8&&s.value!==a[3]&&X(s,a[3]),c&1&&m!==(m=!a[0]||!a[0].connection)&&(y.selected=m),c&5){x=V(a[2]);let t;for(t=0;t<x.length;t+=1){const O=de(a,x,t);p[t]?p[t].p(O,c):(p[t]=_e(O),p[t].c(),p[t].m(E,null))}for(;t<p.length;t+=1)p[t].d(1);p.length=x.length}if(c&68&&ce(E,a[6]),c&34){D=V(a[1]);let t;for(t=0;t<D.length;t+=1){const O=fe(a,D,t);v[t]?v[t].p(O,c):(v[t]=ge(O),v[t].c(),v[t].m(k,null))}for(;t<v.length;t+=1)v[t].d(1);v.length=D.length}},i:ue,o:ue,d(a){a&&P(e),he(p,a),he(v,a),ee=!1,ke(re)}}}function Ae(l,e,n){const r=ye(),{addUser:b,updateUser:h}=Pe,{getConnection:u}=Ue,{getRole:g}=Ne,{getPrivilege:S}=Te;let{user:i=void 0}=e,{roleList:B}=e,{connections:C}=e,s=i?i.email:"",U=i?i.connection:"",L=i?i.active:!0,N=B.map(([m,T])=>({uuid:T,checked:i?i.roles.includes(T):!1}));async function z(){const m=JSON.parse((i==null?void 0:i.generalMetadata)||'{"email":""}');m.email=s;let T={email:s,connection:await u(U),generalMetadata:JSON.stringify(m),active:L,roles:await Promise.all(N.filter(k=>k.checked).map(k=>g(k.uuid).then(q=>({...q,privileges:q.privileges.map(H=>S(H))}))))};try{i?await h({...T,uuid:i.uuid}):await b(T),r.trigger({message:`Successfully saved ${T?"new user":"user"} '${s}'`,background:"variant-filled-success"}),Le("/admin/users")}catch(k){console.error(k),r.trigger({message:`An error occured while saving ${T?"new user":"user"} '${s}'`,background:"variant-filled-error"})}}function j(){L=this.checked,n(4,L)}function E(){s=this.value,n(3,s)}function y(){U=Ce(this),n(6,U),n(2,C)}function G(m){N[m].checked=this.checked,n(5,N)}return l.$$set=m=>{"user"in m&&n(0,i=m.user),"roleList"in m&&n(1,B=m.roleList),"connections"in m&&n(2,C=m.connections)},[i,B,C,s,L,N,U,z,j,E,y,G]}class je extends Ee{constructor(e){super(),Se(this,e,Ae,we,pe,{user:0,roleList:1,connections:2})}}export{je as U};
