const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./plotly.min.mpEJP4zK.js","./_commonjsHelpers.Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import{_ as W}from"./preload-helper.C1FmrZbK.js";import{s as O,e as b,c as w,b as B,f as h,m as d,i as p,n as _,o as I,Y,a as J,l as S,g as K,k as Q,q as x,R as X}from"./scheduler.bui7uCNy.js";import{S as V,i as q,g as A,a as y,b as E,t as g,d as L,e as M,m as R,f as F}from"./index.CNwEczq-.js";import{e as v}from"./each.VHlBgARd.js";import{g as Z}from"./stores.De0gTmA3.js";import"./ProgressBar.svelte_svelte_type_style_lang.CGDEO2C7.js";import{P as D}from"./ProgressRadial.CbTPnjvT.js";import{s as $,a as C}from"./configuration.CsqyQUvi.js";import{p as tt}from"./User.C8JF3DW-.js";import{g as et}from"./QueryBuilder.DvtNy6Ht.js";import{p as ot}from"./stores.C84jDIWK.js";const P=60,j=6,z=$.distributionExplorer.graphColors,at={editable:!0,toImageButtonOptions:{format:"png"},displayModeBar:!0,modeBarButtonsToRemove:["pan2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","sendDataToCloud"]};function lt(a){const t=[];for(let l=0;l<a;l++)t.push(z[l%z.length]);return t}function H(a){return a.length>P?a.substring(0,P-3)+"...":a}function U(a,t){const l=Array(a.length).fill(j),e=[];return a.forEach((o,n)=>{o<10&&t?(l[n]=9,e[n]="< 10",a[n]=0):t?e[n]=o+" Â± 3":(l[n]=0,e[n]=o+"")}),{topBar:l,bottomBar:e}}function G(a,t){return a.map(l=>t&&l>0?l-j/2:l)}function rt(a){const t=Object.values(a.categoricalMap),{topBar:l,bottomBar:e}=U(t,a.obfuscated),o=lt(t.length),n=H(a.title),r=[{x:Object.keys(a.categoricalMap),y:G(t,a.obfuscated),name:n,type:"bar",showlegend:!1,marker:{color:o}},{x:Object.keys(a.categoricalMap),y:l,name:"Obfuscated Data",showlegend:!1,type:"bar",marker:{color:o,pattern:{shape:"/",size:20,solidity:.5}},text:e,textposition:"outside"}],s={title:n,width:a.chartWidth||500,height:a.chartHeight||600,hovermode:!1,font:{family:"Nunito Sans, sans-serif"},xaxis:{title:a.xaxisName,automargin:!0},yaxis:{title:a.yaxisName,automargin:!0},barmode:"stack"};return{data:r,layout:s,meta:{isCategorical:!0,unformatedTitle:a.title}}}function nt(a){const t=a.obfuscated,l=[],e=[];Object.keys(a.continuousMap).sort((u,m)=>{let i=parseFloat(u.split(" -")[0]),f=parseFloat(m.split(" -")[0]);return isNaN(i)&&(i=parseFloat(u.split(" +")[0])),isNaN(f)&&(f=parseFloat(u.split(" +")[0])),i-f}).forEach(u=>{l.push(u),e.push(a.continuousMap[u])});const{topBar:o,bottomBar:n}=U(e,t),r=H(a.title),s=[{x:l,y:G(e,a.obfuscated),name:r,type:"bar",showlegend:!1,marker:{color:"#c31f3f",line:{color:"#616265",width:1}}},{x:l,y:o,name:"Obfuscated Data",showlegend:!1,type:"bar",marker:{color:"#c31f3f",pattern:{shape:"/",size:20,solidity:.5},line:{color:"#616265",width:1}},text:n,textposition:"outside"}],c={title:r,width:a.chartWidth||500,height:a.chartHeight||600,autosize:!1,hovermode:!1,bargap:.01,font:{family:"Nunito Sans, sans-serif"},xaxis:{title:a.xaxisName,automargin:!0},yaxis:{title:a.yaxisName,automargin:!0},barmode:"stack"};return{data:s,layout:c,meta:{isCategorical:!1,unformatedTitle:a.title}}}function it(a){let t,l,e,o;return{c(){t=b("div"),this.h()},l(n){t=w(n,"DIV",{id:!0,"aria-label":!0,title:!0}),B(t).forEach(h),this.h()},h(){d(t,"id",l="plot-"+a[0]),d(t,"aria-label",e=a[3]+a[1].unformatedTitle),d(t,"title",o="Visualization of "+a[1].unformatedTitle)},m(n,r){p(n,t,r),a[7](t)},p(n,[r]){r&1&&l!==(l="plot-"+n[0])&&d(t,"id",l),r&2&&e!==(e=n[3]+n[1].unformatedTitle)&&d(t,"aria-label",e),r&2&&o!==(o="Visualization of "+n[1].unformatedTitle)&&d(t,"title",o)},i:_,o:_,d(n){n&&h(t),a[7](null)}}}function st(a,t,l){let{index:e}=t,{data:o}=t,{meta:n}=t,{layout:r}=t,{newPlot:s}=t;const c=n.isCategorical?"Column chart showing the visualization of ":"Histogram showing the visualization of ";let u;I(async()=>{s(u,o,r,{...at,toImageButtonOptions:{filename:n.unformatedTitle}})});function m(i){Y[i?"unshift":"push"](()=>{u=i,l(2,u)})}return a.$$set=i=>{"index"in i&&l(0,e=i.index),"data"in i&&l(4,o=i.data),"meta"in i&&l(1,n=i.meta),"layout"in i&&l(5,r=i.layout),"newPlot"in i&&l(6,s=i.newPlot)},[e,n,u,c,o,r,s,m]}class ct extends V{constructor(t){super(),q(this,t,st,it,O,{index:0,data:4,meta:1,layout:5,newPlot:6})}}function N(a,t,l){const e=a.slice();return e[7]=t[l].data,e[8]=t[l].layout,e[9]=t[l].meta,e[11]=l,e}function ut(a){let t,l="No Visualizations Available";return{c(){t=b("div"),t.textContent=l},l(e){t=w(e,"DIV",{"data-svelte-h":!0}),S(t)!=="svelte-1qaygid"&&(t.textContent=l)},m(e,o){p(e,t,o)},p:_,i:_,o:_,d(e){e&&h(t)}}}function ft(a){let t,l,e=v(a[0]),o=[];for(let r=0;r<e.length;r+=1)o[r]=T(N(a,e,r));const n=r=>y(o[r],1,1,()=>{o[r]=null});return{c(){for(let r=0;r<o.length;r+=1)o[r].c();t=x()},l(r){for(let s=0;s<o.length;s+=1)o[s].l(r);t=x()},m(r,s){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(r,s);p(r,t,s),l=!0},p(r,s){if(s&3){e=v(r[0]);let c;for(c=0;c<e.length;c+=1){const u=N(r,e,c);o[c]?(o[c].p(u,s),g(o[c],1)):(o[c]=T(u),o[c].c(),g(o[c],1),o[c].m(t.parentNode,t))}for(A(),c=e.length;c<o.length;c+=1)n(c);E()}},i(r){if(!l){for(let s=0;s<e.length;s+=1)g(o[s]);l=!0}},o(r){o=o.filter(Boolean);for(let s=0;s<o.length;s+=1)y(o[s]);l=!1},d(r){r&&h(t),X(o,r)}}}function mt(a){let t,l;return t=new D({}),{c(){L(t.$$.fragment)},l(e){M(t.$$.fragment,e)},m(e,o){R(t,e,o),l=!0},p:_,i(e){l||(g(t.$$.fragment,e),l=!0)},o(e){y(t.$$.fragment,e),l=!1},d(e){F(t,e)}}}function T(a){let t,l;return t=new ct({props:{index:a[11],data:a[7],layout:a[8],meta:a[9],newPlot:a[1]}}),{c(){L(t.$$.fragment)},l(e){M(t.$$.fragment,e)},m(e,o){R(t,e,o),l=!0},p(e,o){const n={};o&1&&(n.data=e[7]),o&1&&(n.layout=e[8]),o&1&&(n.meta=e[9]),o&2&&(n.newPlot=e[1]),t.$set(n)},i(e){l||(g(t.$$.fragment,e),l=!0)},o(e){y(t.$$.fragment,e),l=!1},d(e){F(t,e)}}}function dt(a){let t,l="All visualizations display the distributions of each variable filter for the specified cohort.",e,o,n,r,s;const c=[mt,ft,ut],u=[];function m(i,f){return i[2]?0:i[0].length?1:2}return n=m(a),r=u[n]=c[n](a),{c(){t=b("p"),t.textContent=l,e=J(),o=b("div"),r.c(),this.h()},l(i){t=w(i,"P",{class:!0,"data-svelte-h":!0}),S(t)!=="svelte-1qfu76z"&&(t.textContent=l),e=K(i),o=w(i,"DIV",{id:!0,class:!0});var f=B(o);r.l(f),f.forEach(h),this.h()},h(){d(t,"class","mb-8 text-center"),d(o,"id","visualizations"),d(o,"class","flex flex-row flex-wrap gap-6 items-center justify-center")},m(i,f){p(i,t,f),p(i,e,f),p(i,o,f),u[n].m(o,null),s=!0},p(i,[f]){let k=n;n=m(i),n===k?u[n].p(i,f):(A(),y(u[k],1,1,()=>{u[k]=null}),E(),r=u[n],r?r.p(i,f):(r=u[n]=c[n](i),r.c()),g(r,1),r.m(o,null))},i(i){s||(g(r),s=!0)},o(i){y(r),s=!1},d(i){i&&(h(t),h(e),h(o)),u[n].d()}}}const ht="/picsure/query/sync";function gt(a,t,l){let e,o;Q(a,ot,m=>l(3,o=m));const n=Z();let r=[],s;const c=o.url.pathname.includes("/discover");async function u(){const m=et(!c,C.visualization),i=localStorage.getItem("token");await tt(ht,{query:m.query,resourceUUID:C.visualization,resourceCredentials:i?{Authorization:"Bearer "+i}:{}}).then(f=>{l(0,r=[...((f==null?void 0:f.categoricalData)||[]).map(rt),...((f==null?void 0:f.continuousData)||[]).map(nt)])}).catch(f=>{console.error("Viusalzation failed with query: "+JSON.stringify(m),f),n.trigger({message:"An error occured while parsing your token. Please try again later. If this problem persists, please contact an administrator.",background:"variant-filled-error"})}).finally(()=>{l(2,e=!1)})}return I(async()=>{const m=await W(()=>import("./plotly.min.mpEJP4zK.js").then(i=>i.p),__vite__mapDeps([0,1]),import.meta.url);l(1,s=m.newPlot),await u()}),l(2,e=!0),[r,s,e]}class Nt extends V{constructor(t){super(),q(this,t,gt,dt,O,{})}}export{Nt as V};
