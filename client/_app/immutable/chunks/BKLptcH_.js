import{s as qe,T as ke,e as E,a as w,c as C,b as y,g as z,f as A,a0 as Ce,r as _,Q as ge,i as K,h as f,z as R,C as we,a1 as Te,R as Oe,V as Ve,U as Le,m as Re,u as je,o as Fe,p as He,a2 as X,E as Je,t as ue,q as Z,d as de,y as oe,W as Ge,_ as Se,A as Ke,F as Qe,B as Ae,j as ve,$ as We}from"./CDvIr29H.js";import{S as ze,i as Me,t as ce,g as Xe,a as me,b as Ye,h as Ze,d as xe,e as $e,m as el,f as ll}from"./ByE-_V18.js";import{e as be}from"./mmDljT_r.js";import{g as tl}from"./BMKj-mzl.js";import{g as al}from"./VQmOc05J.js";import"./C1zJQccS.js";import{g as sl}from"./CgU5AtxT.js";import{u as nl,g as il,a as rl}from"./Cn2szpNP.js";import{g as ol}from"./iFuEiUsZ.js";import{g as cl}from"./DhtKDrdK.js";import{g as ul}from"./ZQo-p3Ky.js";function Ie(l){let e,t;const s=l[22].default,a=Re(s,l,l[21],null);return{c(){e=E("div"),a&&a.c(),this.h()},l(r){e=C(r,"DIV",{class:!0});var n=y(e);a&&a.l(n),n.forEach(A),this.h()},h(){_(e,"class","slide-toggle-text ml-3")},m(r,n){K(r,e,n),a&&a.m(e,null),t=!0},p(r,n){a&&a.p&&(!t||n[0]&2097152)&&je(a,s,r,r[21],t?He(s,r[21],n,null):Fe(r[21]),null)},i(r){t||(ce(a,r),t=!0)},o(r){me(a,r),t=!1},d(r){r&&A(e),a&&a.d(r)}}}function dl(l){let e,t,s,a,r,n,c,k,L,p,g,d,m,b,T,D=[{type:"checkbox"},{class:"slide-toggle-input hidden"},{name:l[1]},l[8](),{disabled:a=l[9].disabled}],M={};for(let u=0;u<D.length;u+=1)M=ke(M,D[u]);let i=l[10].default&&Ie(l);return{c(){e=E("div"),t=E("label"),s=E("input"),r=w(),n=E("div"),c=E("div"),p=w(),i&&i.c(),this.h()},l(u){e=C(u,"DIV",{id:!0,class:!0,"data-testid":!0,role:!0,"aria-label":!0,"aria-checked":!0,tabindex:!0});var S=y(e);t=C(S,"LABEL",{class:!0});var P=y(t);s=C(P,"INPUT",{type:!0,class:!0,name:!0}),r=z(P),n=C(P,"DIV",{class:!0});var j=y(n);c=C(j,"DIV",{class:!0}),y(c).forEach(A),j.forEach(A),p=z(P),i&&i.l(P),P.forEach(A),S.forEach(A),this.h()},h(){Ce(s,M),_(c,"class",k="slide-toggle-thumb "+l[3]),ge(c,"cursor-not-allowed",l[9].disabled),_(n,"class",L="slide-toggle-track "+l[4]),ge(n,"cursor-not-allowed",l[9].disabled),_(t,"class",g="slide-toggle-label "+l[5]),_(e,"id",l[2]),_(e,"class",d="slide-toggle "+l[6]),_(e,"data-testid","slide-toggle"),_(e,"role","switch"),_(e,"aria-label",l[2]),_(e,"aria-checked",l[0]),_(e,"tabindex","0")},m(u,S){K(u,e,S),f(e,t),f(t,s),s.autofocus&&s.focus(),s.checked=l[0],f(t,r),f(t,n),f(n,c),f(t,p),i&&i.m(t,null),m=!0,b||(T=[R(s,"change",l[31]),R(s,"click",l[23]),R(s,"keydown",l[24]),R(s,"keyup",l[25]),R(s,"keypress",l[26]),R(s,"mouseover",l[27]),R(s,"change",l[28]),R(s,"focus",l[29]),R(s,"blur",l[30]),R(e,"keydown",l[7])],b=!0)},p(u,S){Ce(s,M=sl(D,[{type:"checkbox"},{class:"slide-toggle-input hidden"},(!m||S[0]&2)&&{name:u[1]},u[8](),(!m||S[0]&512&&a!==(a=u[9].disabled))&&{disabled:a}])),S[0]&1&&(s.checked=u[0]),(!m||S[0]&8&&k!==(k="slide-toggle-thumb "+u[3]))&&_(c,"class",k),(!m||S[0]&520)&&ge(c,"cursor-not-allowed",u[9].disabled),(!m||S[0]&16&&L!==(L="slide-toggle-track "+u[4]))&&_(n,"class",L),(!m||S[0]&528)&&ge(n,"cursor-not-allowed",u[9].disabled),u[10].default?i?(i.p(u,S),S[0]&1024&&ce(i,1)):(i=Ie(u),i.c(),ce(i,1),i.m(t,null)):i&&(Xe(),me(i,1,1,()=>{i=null}),Ye()),(!m||S[0]&32&&g!==(g="slide-toggle-label "+u[5]))&&_(t,"class",g),(!m||S[0]&4)&&_(e,"id",u[2]),(!m||S[0]&64&&d!==(d="slide-toggle "+u[6]))&&_(e,"class",d),(!m||S[0]&4)&&_(e,"aria-label",u[2]),(!m||S[0]&1)&&_(e,"aria-checked",u[0])},i(u){m||(ce(i),m=!0)},o(u){me(i),m=!1},d(u){u&&A(e),i&&i.d(),b=!1,we(T)}}}const fl="inline-block",hl="unstyled flex items-center",_l="flex transition-all duration-[200ms] cursor-pointer",gl="w-[50%] h-full scale-[0.8] transition-all duration-[200ms] shadow";function bl(l,e,t){let s,a,r,n,c,k,L,p;const g=["name","checked","size","background","active","border","rounded","label"];let d=Te(e,g),{$$slots:m={},$$scope:b}=e;const T=Oe(m),D=Ve();let{name:M}=e,{checked:i=!1}=e,{size:u="md"}=e,{background:S="bg-surface-400 dark:bg-surface-700"}=e,{active:P="bg-surface-900 dark:bg-surface-300"}=e,{border:j=""}=e,{rounded:F="rounded-full"}=e,{label:x=""}=e,V;switch(u){case"sm":V="w-12 h-6";break;case"lg":V="w-20 h-10";break;default:V="w-16 h-8"}function Q(h){["Enter","Space"].includes(h.code)&&(h.preventDefault(),D("keyup",h),h.currentTarget.firstChild.click())}function fe(){return delete d.class,d}function ae(h){X.call(this,l,h)}function se(h){X.call(this,l,h)}function $(h){X.call(this,l,h)}function W(h){X.call(this,l,h)}function he(h){X.call(this,l,h)}function H(h){X.call(this,l,h)}function ne(h){X.call(this,l,h)}function _e(h){X.call(this,l,h)}function pe(){i=this.checked,t(0,i)}return l.$$set=h=>{t(9,e=ke(ke({},e),Le(h))),t(33,d=Te(e,g)),"name"in h&&t(1,M=h.name),"checked"in h&&t(0,i=h.checked),"size"in h&&t(11,u=h.size),"background"in h&&t(12,S=h.background),"active"in h&&t(13,P=h.active),"border"in h&&t(14,j=h.border),"rounded"in h&&t(15,F=h.rounded),"label"in h&&t(2,x=h.label),"$$scope"in h&&t(21,b=h.$$scope)},l.$$.update=()=>{l.$$.dirty[0]&12289&&t(19,s=i?P:`${S} cursor-pointer`),l.$$.dirty[0]&1&&t(18,a=i?"bg-white/75":"bg-white"),l.$$.dirty[0]&1&&t(17,r=i?"translate-x-full":""),t(20,n=e.disabled===!0?"opacity-50":"hover:brightness-[105%] dark:hover:brightness-110 cursor-pointer"),t(6,c=`${fl} ${F} ${n} ${e.class??""}`),l.$$.dirty[0]&638976&&t(4,L=`${_l} ${j} ${F} ${V} ${s}`),l.$$.dirty[0]&425984&&t(3,p=`${gl} ${F} ${a} ${r}`)},t(5,k=`${hl}`),e=Le(e),[i,M,x,p,L,k,c,Q,fe,e,T,u,S,P,j,F,V,r,a,s,n,b,m,ae,se,$,W,he,H,ne,_e,pe]}class ml extends ze{constructor(e){super(),Me(this,e,bl,dl,qe,{name:1,checked:0,size:11,background:12,active:13,border:14,rounded:15,label:2},null,[-1,-1])}}function Pe(l,e,t){const s=l.slice();return s[15]=e[t][0],s[16]=e,s[17]=t,s}function Ue(l,e,t){const s=l.slice();return s[7]=e[t],s}function vl(l){let e=l[4]?"Active":"Inactive",t;return{c(){t=ue(e)},l(s){t=de(s,e)},m(s,a){K(s,t,a)},p(s,a){a&16&&e!==(e=s[4]?"Active":"Inactive")&&ve(t,e)},d(s){s&&A(t)}}}function ye(l){let e,t,s="UUID:",a,r,n,c,k,L,p="Subject:",g,d,m;return{c(){e=E("label"),t=E("span"),t.textContent=s,a=w(),r=E("input"),c=w(),k=E("label"),L=E("span"),L.textContent=p,g=w(),d=E("input"),this.h()},l(b){e=C(b,"LABEL",{class:!0});var T=y(e);t=C(T,"SPAN",{"data-svelte-h":!0}),Z(t)!=="svelte-xruxbf"&&(t.textContent=s),a=z(T),r=C(T,"INPUT",{type:!0,class:!0}),T.forEach(A),c=z(b),k=C(b,"LABEL",{class:!0});var D=y(k);L=C(D,"SPAN",{"data-svelte-h":!0}),Z(L)!=="svelte-1bo23h8"&&(L.textContent=p),g=z(D),d=C(D,"INPUT",{type:!0,class:!0}),D.forEach(A),this.h()},h(){var b,T;_(r,"type","text"),_(r,"class","input"),r.value=n=(b=l[0])==null?void 0:b.uuid,r.disabled=!0,_(e,"class","label"),_(d,"type","text"),_(d,"class","input"),d.value=m=(T=l[0])==null?void 0:T.subject,d.disabled=!0,_(k,"class","label")},m(b,T){K(b,e,T),f(e,t),f(e,a),f(e,r),K(b,c,T),K(b,k,T),f(k,L),f(k,g),f(k,d)},p(b,T){var D,M;T&1&&n!==(n=(D=b[0])==null?void 0:D.uuid)&&r.value!==n&&(r.value=n),T&1&&m!==(m=(M=b[0])==null?void 0:M.subject)&&d.value!==m&&(d.value=m)},d(b){b&&(A(e),A(c),A(k))}}}function De(l){let e,t=l[7].label+"",s,a,r;return{c(){e=E("option"),s=ue(t),this.h()},l(n){e=C(n,"OPTION",{});var c=y(e);s=de(c,t),c.forEach(A),this.h()},h(){e.__value=a=l[7].uuid,oe(e,e.__value),e.selected=r=l[0]&&l[0].connection===l[7].uuid},m(n,c){K(n,e,c),f(e,s)},p(n,c){c&4&&t!==(t=n[7].label+"")&&ve(s,t),c&4&&a!==(a=n[7].uuid)&&(e.__value=a,oe(e,e.__value)),c&5&&r!==(r=n[0]&&n[0].connection===n[7].uuid)&&(e.selected=r)},d(n){n&&A(e)}}}function Ne(l){let e,t,s,a,r=l[15]+"",n,c,k,L;function p(){l[12].call(t,l[17])}return{c(){e=E("label"),t=E("input"),s=w(),a=E("p"),n=ue(r),c=w(),this.h()},l(g){e=C(g,"LABEL",{class:!0});var d=y(e);t=C(d,"INPUT",{class:!0,type:!0}),s=z(d),a=C(d,"P",{});var m=y(a);n=de(m,r),m.forEach(A),c=z(d),d.forEach(A),this.h()},h(){_(t,"class","checkbox"),_(t,"type","checkbox"),_(e,"class","flex items-center space-x-2")},m(g,d){K(g,e,d),f(e,t),t.checked=l[5][l[17]].checked,f(e,s),f(e,a),f(a,n),f(e,c),k||(L=R(t,"change",p),k=!0)},p(g,d){l=g,d&32&&(t.checked=l[5][l[17]].checked),d&2&&r!==(r=l[15]+"")&&ve(n,r)},d(g){g&&A(e),k=!1,L()}}}function Be(l){let e,t,s,a,r,n,c,k='<i class="fa-solid fa-xmark"></i> <span class="sr-only">Close</span>',L,p;return{c(){e=E("aside"),t=E("div"),s=E("p"),a=ue(l[6]),r=w(),n=E("div"),c=E("button"),c.innerHTML=k,this.h()},l(g){e=C(g,"ASIDE",{"data-testid":!0,class:!0});var d=y(e);t=C(d,"DIV",{class:!0});var m=y(t);s=C(m,"P",{});var b=y(s);a=de(b,l[6]),b.forEach(A),m.forEach(A),r=z(d),n=C(d,"DIV",{class:!0});var T=y(n);c=C(T,"BUTTON",{"data-svelte-h":!0}),Z(c)!=="svelte-14sn3fl"&&(c.innerHTML=k),T.forEach(A),d.forEach(A),this.h()},h(){_(t,"class","alert-message"),_(n,"class","alert-actions"),_(e,"data-testid","validation-error"),_(e,"class","alert variant-ghost-error")},m(g,d){K(g,e,d),f(e,t),f(t,s),f(s,a),f(e,r),f(e,n),f(n,c),L||(p=R(c,"click",l[13]),L=!0)},p(g,d){d&64&&ve(a,g[6])},d(g){g&&A(e),L=!1,p()}}}function pl(l){var Ee;let e,t,s,a,r,n,c,k="Email:",L,p,g,d,m,b,T,D="Connection:",M,i,u,S,P,j,F,x,V,Q,fe="Roles:",ae,se,$,W,he='<button type="submit" class="btn variant-ghost-primary hover:variant-filled-primary">Save</button> <a href="/admin/users" class="btn variant-ghost-secondary hover:variant-filled-secondary">Cancel</a>',H,ne,_e;function pe(o){l[9](o)}let h={name:"Active",size:"sm",active:"bg-success-500",label:"Status",$$slots:{default:[vl]},$$scope:{ctx:l}};l[4]!==void 0&&(h.checked=l[4]),t=new ml({props:h}),Je.push(()=>Ze(t,"checked",pe));let N=((Ee=l[0])==null?void 0:Ee.uuid)&&ye(l),ee=be(l[2]),B=[];for(let o=0;o<ee.length;o+=1)B[o]=De(Ue(l,ee,o));let le=be(l[1]),q=[];for(let o=0;o<le.length;o+=1)q[o]=Ne(Pe(l,le,o));let O=l[6]&&Be(l);return{c(){e=E("form"),xe(t.$$.fragment),a=w(),N&&N.c(),r=w(),n=E("label"),c=E("span"),c.textContent=k,L=w(),p=E("input"),m=w(),b=E("label"),T=E("span"),T.textContent=D,M=w(),i=E("select"),u=E("option"),S=ue("none");for(let o=0;o<B.length;o+=1)B[o].c();x=w(),V=E("fieldset"),Q=E("legend"),Q.textContent=fe,ae=w();for(let o=0;o<q.length;o+=1)q[o].c();se=w(),O&&O.c(),$=w(),W=E("div"),W.innerHTML=he,this.h()},l(o){e=C(o,"FORM",{class:!0});var v=y(e);$e(t.$$.fragment,v),a=z(v),N&&N.l(v),r=z(v),n=C(v,"LABEL",{class:!0});var U=y(n);c=C(U,"SPAN",{"data-svelte-h":!0}),Z(c)!=="svelte-1s4kc5o"&&(c.textContent=k),L=z(U),p=C(U,"INPUT",{type:!0,class:!0,minlength:!0,maxlength:!0}),U.forEach(A),m=z(v),b=C(v,"LABEL",{class:!0});var J=y(b);T=C(J,"SPAN",{"data-svelte-h":!0}),Z(T)!=="svelte-ir2yyg"&&(T.textContent=D),M=z(J),i=C(J,"SELECT",{class:!0});var te=y(i);u=C(te,"OPTION",{});var ie=y(u);S=de(ie,"none"),ie.forEach(A);for(let G=0;G<B.length;G+=1)B[G].l(te);te.forEach(A),J.forEach(A),x=z(v),V=C(v,"FIELDSET",{"data-testid":!0});var Y=y(V);Q=C(Y,"LEGEND",{class:!0,"data-svelte-h":!0}),Z(Q)!=="svelte-12sbs1l"&&(Q.textContent=fe),ae=z(Y);for(let G=0;G<q.length;G+=1)q[G].l(Y);Y.forEach(A),se=z(v),O&&O.l(v),$=z(v),W=C(v,"DIV",{"data-svelte-h":!0}),Z(W)!=="svelte-g6nnqz"&&(W.innerHTML=he),v.forEach(A),this.h()},h(){var o,v,U,J;_(p,"type","email"),_(p,"class","input"),p.required=!0,p.disabled=g=!!((o=l[0])!=null&&o.email),_(p,"minlength","1"),_(p,"maxlength","255"),_(n,"class",d="label "+(((v=l[0])==null?void 0:v.email)??"required")),u.selected=P=!l[0]||!l[0].connection,u.disabled=!0,u.__value="",oe(u,u.__value),_(i,"class","select"),i.required=!0,i.disabled=j=!!((U=l[0])!=null&&U.connection),l[7]===void 0&&Ge(()=>l[11].call(i)),_(b,"class",F="label "+(((J=l[0])==null?void 0:J.email)??"required")),_(Q,"class","required"),_(V,"data-testid","privilege-checkboxes"),_(e,"class","grid gap-4 my-3")},m(o,v){K(o,e,v),el(t,e,null),f(e,a),N&&N.m(e,null),f(e,r),f(e,n),f(n,c),f(n,L),f(n,p),oe(p,l[3]),f(e,m),f(e,b),f(b,T),f(b,M),f(b,i),f(i,u),f(u,S);for(let U=0;U<B.length;U+=1)B[U]&&B[U].m(i,null);Se(i,l[7],!0),f(e,x),f(e,V),f(V,Q),f(V,ae);for(let U=0;U<q.length;U+=1)q[U]&&q[U].m(V,null);f(e,se),O&&O.m(e,null),f(e,$),f(e,W),H=!0,ne||(_e=[R(p,"input",l[10]),R(i,"change",l[11]),R(e,"submit",Ke(l[8]))],ne=!0)},p(o,[v]){var J,te,ie,Y,G;const U={};if(v&1048592&&(U.$$scope={dirty:v,ctx:o}),!s&&v&16&&(s=!0,U.checked=o[4],Qe(()=>s=!1)),t.$set(U),(J=o[0])!=null&&J.uuid?N?N.p(o,v):(N=ye(o),N.c(),N.m(e,r)):N&&(N.d(1),N=null),(!H||v&1&&g!==(g=!!((te=o[0])!=null&&te.email)))&&(p.disabled=g),v&8&&p.value!==o[3]&&oe(p,o[3]),(!H||v&1&&d!==(d="label "+(((ie=o[0])==null?void 0:ie.email)??"required")))&&_(n,"class",d),(!H||v&1&&P!==(P=!o[0]||!o[0].connection))&&(u.selected=P),v&5){ee=be(o[2]);let I;for(I=0;I<ee.length;I+=1){const re=Ue(o,ee,I);B[I]?B[I].p(re,v):(B[I]=De(re),B[I].c(),B[I].m(i,null))}for(;I<B.length;I+=1)B[I].d(1);B.length=ee.length}if((!H||v&1&&j!==(j=!!((Y=o[0])!=null&&Y.connection)))&&(i.disabled=j),v&132&&Se(i,o[7]),(!H||v&1&&F!==(F="label "+(((G=o[0])==null?void 0:G.email)??"required")))&&_(b,"class",F),v&34){le=be(o[1]);let I;for(I=0;I<le.length;I+=1){const re=Pe(o,le,I);q[I]?q[I].p(re,v):(q[I]=Ne(re),q[I].c(),q[I].m(V,null))}for(;I<q.length;I+=1)q[I].d(1);q.length=le.length}o[6]?O?O.p(o,v):(O=Be(o),O.c(),O.m(e,$)):O&&(O.d(1),O=null)},i(o){H||(ce(t.$$.fragment,o),H=!0)},o(o){me(t.$$.fragment,o),H=!1},d(o){o&&A(e),ll(t),N&&N.d(),Ae(B,o),Ae(q,o),O&&O.d(),ne=!1,we(_e)}}}function kl(l,e,t){const s=al();let{user:a=void 0}=e,{roleList:r}=e,{connections:n}=e,c=a&&a.email?a.email:"",k=a&&a.connection?a.connection:"",L=a?a.active:!0,p=r.map(([i,u])=>({uuid:u,checked:a?a.roles.includes(u):!1})),g="";async function d(){const i=p.filter(P=>P.checked);if(i.length===0){t(6,g="At least one role must be selected.");return}else t(6,g="");const u=JSON.parse((a==null?void 0:a.generalMetadata)||'{"email":""}');u.email=c;let S={email:c,connection:await ol(k),generalMetadata:JSON.stringify(u),active:L,roles:await Promise.all(i.map(P=>cl(P.uuid).then(j=>({...j,privileges:j.privileges.map(F=>ul(F))}))))};try{if(a)await nl({...S,uuid:a.uuid});else{if(await il(c,k)){s.trigger({message:"Cannot add a user and connection pair that already exists.",background:"variant-filled-error"});return}await rl(S)}s.trigger({message:`Successfully saved ${a?"":"new "}user '${c}'`,background:"variant-filled-success"}),tl("/admin/users")}catch(P){console.error(P),s.trigger({message:`An error occured while saving ${a?"":"new "}user '${c}'`,background:"variant-filled-error"})}}function m(i){L=i,t(4,L)}function b(){c=this.value,t(3,c)}function T(){k=We(this),t(7,k),t(2,n)}function D(i){p[i].checked=this.checked,t(5,p)}const M=()=>t(6,g="");return l.$$set=i=>{"user"in i&&t(0,a=i.user),"roleList"in i&&t(1,r=i.roleList),"connections"in i&&t(2,n=i.connections)},[a,r,n,c,L,p,g,k,d,m,b,T,D,M]}class Nl extends ze{constructor(e){super(),Me(this,e,kl,pl,qe,{user:0,roleList:1,connections:2})}}export{Nl as U};
