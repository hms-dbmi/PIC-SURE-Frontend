import{d as m,w as d,g as i}from"./DpyMT7OB.js";import{g as p,d as g,p as R,c as f}from"./BpV1Tt4c.js";function c(s){return{...s,privileges:s.privileges?s.privileges.map(e=>e.uuid):[]}}const r="psama/role",w="psama/studyAccess",l=d(!1),o=d([]),v=m(o,s=>s.map(e=>[e.name,e.uuid||""]),[]);async function y(){if(i(l))return;const s=await p(r);o.set(s.map(c)),l.set(!0)}async function b(s){const t=i(o).find(a=>a.uuid===s);if(t)return t;const n=await p(`${r}/${s}`);return c(n)}async function $(s){const e=await f(r,[{...s,privileges:s.privileges.map(a=>({uuid:a}))}]),t=c(e.content[0]),n=i(o);n.push(t),o.set(n)}async function I(s){const e=await R(r,[{...s,privileges:s.privileges.map(u=>({uuid:u}))}]),t=c(e.content[0]),n=i(o),a=n.findIndex(u=>u.uuid===t.uuid);a===-1?n.push(t):n[a]=t,o.set(n)}async function L(s){await g(`${r}/${s}`);const e=i(o),t=e.findIndex(n=>n.uuid===s);t>-1&&(e.splice(t,1),o.set(e))}async function h(s){const e=await f(w,s);if(e.status!==200)throw new Error("Failed to add manual role");return e}const E={subscribe:o.subscribe,roles:o,roleList:v,loadRoles:y,getRole:b};export{E as R,$ as a,h as b,L as d,b as g,y as l,o as r,I as u};
