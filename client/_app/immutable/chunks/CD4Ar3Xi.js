var ue=Object.defineProperty;var Y=s=>{throw TypeError(s)};var de=(s,e,t)=>e in s?ue(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var n=(s,e,t)=>de(s,typeof e!="symbol"?e+"":e,t),fe=(s,e,t)=>e.has(s)||Y("Cannot "+t);var i=(s,e,t)=>(fe(s,e,"read from private field"),t?t.call(s):e.get(s)),l=(s,e,t)=>e.has(s)?Y("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);import{w as f,g as d}from"./xU7jw7XU.js";import{p as ne}from"./CftmxiRQ.js";import{g as le,k as b,u as ge,c as J}from"./BNC-bmXQ.js";import{h as u,k as c,l as h,i as P,u as p}from"./DhSNEPDw.js";import"./Bzak7iHL.js";import{d as m}from"./DVtHS8ol.js";m(["click"]);m(["click"]);m(["input"]);m(["click"]);m(["input"]);m(["change"]);class pe{constructor(){n(this,"listeners",{change:[],clearFilters:[],clearSearch:[]});n(this,"queue",new Set)}add(e,t){this.listeners[e].push(t)}async dispatch(e){this.queue.add(e),await new Promise(t=>setTimeout(t,40)),this.queue.size>0&&this.run(),this.queue.clear()}run(){for(const e of this.queue)for(const t of this.listeners[e])t()}}var y,C,R,T,E,F,A,$,x,I,q,D,B,N,z,W,_;class we{constructor(e,t){n(this,"selectBy");n(this,"event",new pe);l(this,y,u(""));l(this,C,u(P({})));l(this,R,u(void 0));l(this,T,u(!1));l(this,E,u(10));l(this,F,u(1));l(this,A,u(P([])));l(this,$,p(()=>this.filters.length));l(this,x,u(P([])));l(this,I,p(()=>this.createRowCount()));l(this,q,p(()=>this.createPages()));l(this,D,p(()=>this.createPageCount()));l(this,B,p(()=>this.createPagesWithEllipsis()));l(this,N,u(P([])));l(this,z,p(()=>this.createIsAllSelected()));l(this,W,u(void 0));l(this,_,u(1e3));this.rows=e,this.selectBy=t.selectBy??void 0,this.totalRows=t.totalRows,this.rowsPerPage=t.rowsPerPage??10}get search(){return c(i(this,y))}set search(e){h(i(this,y),e,!0)}get sort(){return c(i(this,C))}set sort(e){h(i(this,C),e,!0)}get totalRows(){return c(i(this,R))}set totalRows(e){h(i(this,R),e,!0)}get isLoading(){return c(i(this,T))}set isLoading(e){h(i(this,T),e,!0)}get rowsPerPage(){return c(i(this,E))}set rowsPerPage(e){h(i(this,E),e,!0)}get currentPage(){return c(i(this,F))}set currentPage(e){h(i(this,F),e,!0)}get filters(){return c(i(this,A))}set filters(e){h(i(this,A),e,!0)}get filterCount(){return c(i(this,$))}set filterCount(e){h(i(this,$),e)}get rows(){return c(i(this,x))}set rows(e){h(i(this,x),e,!0)}get rowCount(){return c(i(this,I))}set rowCount(e){h(i(this,I),e)}get pages(){return c(i(this,q))}set pages(e){h(i(this,q),e)}get pageCount(){return c(i(this,D))}set pageCount(e){h(i(this,D),e)}get pagesWithEllipsis(){return c(i(this,B))}set pagesWithEllipsis(e){h(i(this,B),e)}get selected(){return c(i(this,N))}set selected(e){h(i(this,N),e,!0)}get isAllSelected(){return c(i(this,z))}set isAllSelected(e){h(i(this,z),e)}get element(){return c(i(this,W))}set element(e){h(i(this,W),e,!0)}get clientWidth(){return c(i(this,_))}set clientWidth(e){h(i(this,_),e,!0)}getState(){return{currentPage:this.currentPage,rowsPerPage:this.rowsPerPage,offset:this.rowsPerPage*(this.currentPage-1),search:this.search,sort:this.sort.field?this.sort:void 0,filters:this.filters.length>0?this.filters:void 0,setTotalRows:e=>this.totalRows=e}}createPages(){return!this.rowsPerPage||!this.totalRows?void 0:Array.from(Array(Math.ceil(this.totalRows/this.rowsPerPage))).map((t,r)=>r+1)}createPageCount(){if(this.pages)return this.pages.length}createPagesWithEllipsis(){if(!this.pages)return;if(this.pageCount<=7)return this.pages;const e=null,t=1,r=this.pageCount;return this.currentPage<=4?[...this.pages.slice(0,5),e,r]:this.currentPage<this.pageCount-3?[t,e,...this.pages.slice(this.currentPage-2,this.currentPage+1),e,r]:[t,e,...this.pages.slice(this.pageCount-5,this.pageCount)]}createRowCount(){return!this.rowsPerPage||!this.totalRows?{total:void 0,start:void 0,end:void 0,selected:this.selected.length}:{total:this.totalRows,start:this.currentPage*this.rowsPerPage-this.rowsPerPage+1,end:Math.min(this.currentPage*this.rowsPerPage,this.totalRows),selected:this.selected.length}}createIsAllSelected(){return this.rows.length===0?!1:this.rows.map(t=>t[this.selectBy]).every(t=>this.selected.includes(t))}}y=new WeakMap,C=new WeakMap,R=new WeakMap,T=new WeakMap,E=new WeakMap,F=new WeakMap,A=new WeakMap,$=new WeakMap,x=new WeakMap,I=new WeakMap,q=new WeakMap,D=new WeakMap,B=new WeakMap,N=new WeakMap,z=new WeakMap,W=new WeakMap,_=new WeakMap;class be{constructor(e){n(this,"table");n(this,"reload");this.table=e}set(e){this.reload=e}async invalidate(){if(!this.reload)return;this.table.isLoading=!0;const e=this.table.getState(),t=await this.reload(e);this.table.isLoading=!1,t&&(this.table.rows=t)}}class me{constructor(e){n(this,"table");this.table=e}set(e){const t=this.table.sort;!t||t.field!==e?this.asc(e):t.direction==="asc"?this.desc(e):t.direction==="desc"&&this.asc(e)}asc(e){this.table.sort={field:e,direction:"asc"},this.table.setPage(1)}desc(e){this.table.sort={field:e,direction:"desc"},this.table.setPage(1)}}class Pe{constructor(e){n(this,"table");this.table=e}set(e){this.table.selected.includes(e)?this.table.selected=this.table.selected.filter(t=>t!==e):this.table.selected=[e,...this.table.selected]}all(){const e=this.table.rows.map(t=>t[this.table.selectBy]);this.table.isAllSelected?this.table.selected=this.table.selected.filter(t=>e.includes(t)===!1):this.table.selected=[...new Set([...e,...this.table.selected])]}clear(){this.table.selected=[]}}class ve{constructor(e){n(this,"table");this.table=e}goto(e){this.table.rowsPerPage&&this.table.totalRows?e>=1&&e<=this.table.pageCount&&(this.table.currentPage=e,this.table.event.dispatch("change"),this.table.invalidate()):e>=1&&(this.table.currentPage=e,this.table.event.dispatch("change"),this.table.invalidate())}previous(){this.goto(this.table.currentPage-1)}next(){this.goto(this.table.currentPage+1)}}class Se{constructor(e){n(this,"table");this.table=e}clear(){this.table.event.dispatch("clearSearch")}}class He{constructor(e){n(this,"table");this.table=e}set(e,t){this.table.filters=this.table.filters.filter(r=>r.field!==t&&r.value),e&&this.table.filters.push({value:e,field:t})}unset(e){this.table.filters=this.table.filters.filter(t=>t.field!==e)}clear(){this.table.filters=[],this.table.event.dispatch("clearFilters")}}var L;class ye{constructor(e,t){l(this,L,u(P([])));n(this,"table");n(this,"interval");n(this,"mutation");this.table=e,this.columns=[],this.interval=setInterval(()=>this.createColumns(t),200)}get columns(){return c(i(this,L))}set columns(e){h(i(this,L),e,!0)}toggle(e){if(!this.table.element)return;const t=this.columns.find(r=>r.name===e);t&&t.toggle()}createColumns(e){var t;(t=this.table)!=null&&t.element&&(clearInterval(this.interval),this.columns=e.map(({name:r,index:a,isVisible:o,isFrozen:g})=>({name:r,index:a,isVisible:o!==!1,isFrozen:g===!0,element:this.table.element,toggle(){this.isVisible=!this.isVisible,this.element.querySelectorAll(`tr > *:nth-child(${this.index+1})`).forEach(he=>{he.classList.toggle("hidden")})}})),this.preset(),this.mutation=new MutationObserver(()=>{setTimeout(()=>{this.preset()},2)}),this.mutation.observe(this.table.element,{childList:!0,subtree:!0}))}preset(){let e=0;for(const{isVisible:t,isFrozen:r,index:a}of this.columns)r===!0&&(e+=this.freeze(a,e)),t===!1&&this.table.element.querySelectorAll(`tr > *:nth-child(${a+1})`).forEach(o=>{o.classList.add("hidden")})}freeze(e,t=0){const r=this.table.element.querySelector(`thead th:nth-child(${e+1})`),{width:a}=r.getBoundingClientRect();return this.table.element.querySelectorAll(`tr > *:nth-child(${e+1})`).forEach(o=>{o.style.position="sticky",o.style.left=t+"px",o.style.width=a+"px"}),a}setPosition(e,t){this.table.element.querySelectorAll("tr").forEach(r=>{const a=[].slice.call(r.querySelectorAll("th, td"));e>t?a[t].parentNode.insertBefore(a[e],a[t]):a[t].parentNode.insertBefore(a[e],a[t].nextSibling)})}}L=new WeakMap;var M;class Ce{constructor(e){l(this,M,u(""));n(this,"timeout");n(this,"table");this.table=e,this.cleanup()}get value(){return c(i(this,M))}set value(e){h(i(this,M),e,!0)}set(){this.table.search=this.value,clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.table.setPage(1)},400)}init(e){return e?(this.value=e,this.table.search=e,this):this}clear(){this.value="",this.table.search="",this.table.invalidate()}cleanup(){this.table.on("clearSearch",()=>this.clear())}}M=new WeakMap;var V,k;class Re{constructor(e,t){n(this,"sortHandler");n(this,"field");l(this,V,p(()=>this.createIsActive()));l(this,k,p(()=>this.createDirection()));this.sortHandler=e,this.field=t}get isActive(){return c(i(this,V))}set isActive(e){h(i(this,V),e)}get direction(){return c(i(this,k))}set direction(e){h(i(this,k),e)}set(){this.sortHandler.set(this.field)}init(e){return e?(this[e](),this):this}asc(){this.sortHandler.asc(this.field)}desc(){this.sortHandler.desc(this.field)}createIsActive(){var e;return this.field===((e=this.sortHandler.table.sort)==null?void 0:e.field)}createDirection(){var e;return this.isActive===!1?null:(e=this.sortHandler.table.sort)==null?void 0:e.direction}}V=new WeakMap,k=new WeakMap;var O;class Te{constructor(e,t){l(this,O,u(""));n(this,"timeout");n(this,"filterHandler");n(this,"field");this.filterHandler=e,this.field=t,this.cleanup()}get value(){return c(i(this,O))}set value(e){h(i(this,O),e,!0)}set(){this.filterHandler.set(this.value,this.field),clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.filterHandler.table.invalidate()},400)}init(e){return e?(this.value=e,this.filterHandler.set(this.value,this.field),this):this}clear(){this.value="",this.filterHandler.unset(this.field)}cleanup(){this.filterHandler.table.on("clearFilters",()=>this.clear())}}O=new WeakMap;class Ee extends we{constructor(t=[],r={rowsPerPage:5}){super(t,r);n(this,"fetchHandler");n(this,"sortHandler");n(this,"selectHandler");n(this,"pageHandler");n(this,"searchHandler");n(this,"filterHandler");n(this,"view");n(this,"i18n");this.i18n=this.translate(r.i18n),this.fetchHandler=new be(this),this.sortHandler=new me(this),this.selectHandler=new Pe(this),this.pageHandler=new ve(this),this.searchHandler=new Se(this),this.filterHandler=new He(this)}load(t){this.fetchHandler.set(t)}invalidate(){this.fetchHandler.invalidate()}setRowsPerPage(t){this.rowsPerPage=t,this.setPage(1)}setPage(t){switch(t){case"previous":return this.pageHandler.previous();case"next":return this.pageHandler.next();case"last":return this.pageHandler.goto(this.pageCount);default:return this.pageHandler.goto(t)}}clearSearch(){this.searchHandler.clear()}createSearch(){return new Ce(this)}createSort(t){if(typeof t=="function")throw new Error(`Invalid field argument: ${String(t)}. Function type arguments are not allowed in server-side mode`);return new Re(this.sortHandler,t)}clearFilters(){this.filterHandler.clear(),this.invalidate()}createFilter(t){if(typeof t=="function")throw new Error(`Invalid field argument: ${String(t)}. Function type arguments are not allowed in server-side mode`);return new Te(this.filterHandler,t)}select(t){this.selectHandler.set(t)}selectAll(){this.selectHandler.all()}clearSelection(){this.selectHandler.clear()}on(t,r){this.event.add(t,r)}createView(t){return this.view=new ye(this,t),this.view}getView(){return this.view}translate(t){return{search:"Search...",show:"Show",entries:"entries",filter:"Filter",rowCount:"Showing {start} to {end} of {total} entries",noRows:"No entries found",previous:"Previous",next:"Next",selectedCount:"{count} of {total} row(s).",...t}}}const j="datatableSettings",U=10,S=f(Fe());S.subscribe(s=>{localStorage.setItem(j,JSON.stringify(s))});function Fe(){if(localStorage.getItem(j))try{return JSON.parse(localStorage.getItem(j)||"{}")}catch{console.error("restoring user datatable settings failed"),localStorage.setItem(j,"{}")}return{}}function oe(s){if(!s)return U;const e=d(S);return e?e[s]?e[s]:(e[s]=U,S.set(e),U):U}function je(s,e){const t=d(S);t[s]=e,S.set(t)}const ee=f(!1),Ae=f(Promise.resolve(void 0)),H=f(""),w=f([]),Z=new Ee([],{rowsPerPage:oe("ExplorerTable")}),K=f(!0),Q=f(""),te=f(1),se=f(""),re=f(oe("ExplorerTable")),ie=()=>{},X={searchTerm:ie,selectedFacets:ie};let G=!1;function Ze(){Object.values(X).forEach(s=>s()),X.selectedFacets=w.subscribe(()=>{G||Z.setPage(1)}),X.searchTerm=H.subscribe(()=>{G||Z.setPage(1)}),Z.load(async s=>{const e=d(H),t=d(w);ee.set(!0),d(K)&&(e||t.length>0)&&K.set(!1);try{const r=d(te)!==s.currentPage,a=d(re)!==s.rowsPerPage,o=d(se)!==e,g=(r||a)&&!o;return se.set(e),g?(te.set(s.currentPage),re.set(s.rowsPerPage)):qe.set(We()),await $e(s)}catch{return[]}finally{ee.set(!1)}})}async function $e(s){const e="An error occurred while searching. If the problem persists, please contact an administrator.",t=d(w),r=d(H);if(!r&&!t.length)return s.setTotalRows(0),[];const a=Ne(r.trim(),t,{pageNumber:s.currentPage-1,pageSize:s.rowsPerPage});Ae.set(a);const o=await a.catch(g=>{throw console.error(g),s.setTotalRows(0),Q.set(e),g});return o||Q.set(e),s.setTotalRows((o==null?void 0:o.totalElements)??0),(o==null?void 0:o.content)??[]}async function xe(s){const e=d(w);s.forEach(t=>{const r=e.findIndex(a=>a.name===t.name);r!==-1?e.splice(r,1):e.push(t)}),w.set(e.sort((t,r)=>r.count-t.count))}function Ge(){G=!0,H.set(""),w.set([]),Q.set(""),K.set(!0),G=!1,Z.setPage(1)}const Xe={selectedFacets:w,updateFacets:xe},Ie=f({}),qe=f(Promise.resolve([])),De=f([]),v=new Map,ae=100;function Be(s,e){!s||!e||(v.size>100&&v.clear(),v.set(s,e))}function Ne(s="",e,t){let r={facets:e,search:s};return ne.url.pathname.includes("/discover")||(r=ce(r)),J(`${b.Concepts}?page_number=${t.pageNumber}&page_size=${t.pageSize}`,r)}function ze(s){const e=s.map(t=>({name:t.name,values:t.facets.filter(r=>r.count===0).map(r=>r.name)})).reduce((t,r)=>(t[r.name]=r.values,t),{});console.debug("Found the following facets that should be hidden:",JSON.stringify(e)),Ie.set(e)}async function We(){const s=d(H);let t={facets:d(w),search:s};ne.url.pathname.includes("/discover")||(t=ce(t));try{const r=await J(b.Facets,t);ze(r),_e(r);const a=r.map(o=>o.facets.some(g=>g.count>0)?o.name:"").filter(o=>o);return De.set(a),r}catch(r){throw console.error("Failed to update facets from search:",r),r}}function _e(s){s.forEach(e=>{e.facets.forEach(t=>{var r;t.categoryRef={name:e.name,display:e.display,description:e.description},(r=t.children)!=null&&r.length&&t.children.forEach(a=>{a.categoryRef={name:e.name,display:e.display,description:e.description},a.parentRef={name:t.name,display:t.display,description:t.description}})})})}async function Ke(s,e){const t=`${b.Concept.Detail}/${e}`,r=String.raw`${s.replace(/\\\\/g,"\\")}`;if(v.has(r))return v.get(r);const a=await J(t,r);if(!a)throw new Error("No response");return Be(r,a),a}async function Qe(s,e){const t=await J(`${b.Concept.Hierarchy}/${s}`,e);if(!t)throw new Error("No response");return t}function ce(s){var t;const e=(t=d(ge))==null?void 0:t.queryTemplate;if(e){const a=(e.categoryFilters||{})["\\_consents\\"]||[];s.consents=a}return s}async function Ye(s){return le(`${b.DashboardDrawer}/${s}`)}async function et(s,e,t){const r=`${b.Concept.Tree}/${s}?depth=${e}`;return J(r,t)}async function tt(s=1){return s>ae&&(s=ae),le(`${b.Concept.Tree}?depth=${s}`)}export{pe as E,Xe as S,Ee as T,ye as V,w as a,ce as b,Ke as c,Qe as d,et as e,qe as f,oe as g,Ie as h,Ae as i,Q as j,Ze as k,K as l,ee as m,Ne as n,De as o,tt as p,je as q,Ge as r,H as s,Z as t,xe as u,Ye as v};
