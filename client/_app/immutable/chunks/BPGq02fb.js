var ne=Object.defineProperty;var Y=s=>{throw TypeError(s)};var le=(s,e,t)=>e in s?ne(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var n=(s,e,t)=>le(s,typeof e!="symbol"?e+"":e,t),oe=(s,e,t)=>e.has(s)||Y("Cannot "+t);var i=(s,e,t)=>(oe(s,e,"read from private field"),t?t.call(s):e.get(s)),l=(s,e,t)=>e.has(s)?Y("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);import{w as f,g as u}from"./DpyMT7OB.js";import{p as re}from"./DjiALQWk.js";import{c as b,u as ce,g as he}from"./BpV1Tt4c.js";import{d,g as o,b as c,e as P,h as p}from"./KPVYLOSR.js";import"./DKNWTM-D.js";import{d as m}from"./NtGCh5xy.js";m(["click"]);m(["click"]);m(["input"]);m(["click"]);m(["input"]);m(["change"]);class ue{constructor(){n(this,"listeners",{change:[],clearFilters:[],clearSearch:[]});n(this,"queue",new Set)}add(e,t){this.listeners[e].push(t)}async dispatch(e){this.queue.add(e),await new Promise(t=>setTimeout(t,40)),this.queue.size>0&&this.run(),this.queue.clear()}run(){for(const e of this.queue)for(const t of this.listeners[e])t()}}var y,H,C,R,E,T,F,A,$,I,x,q,_,L,D,B,N;class de{constructor(e,t){n(this,"selectBy");n(this,"event",new ue);l(this,y,d(""));l(this,H,d(P({})));l(this,C,d(void 0));l(this,R,d(!1));l(this,E,d(10));l(this,T,d(1));l(this,F,d(P([])));l(this,A,p(()=>this.filters.length));l(this,$,d(P([])));l(this,I,p(()=>this.createRowCount()));l(this,x,p(()=>this.createPages()));l(this,q,p(()=>this.createPageCount()));l(this,_,p(()=>this.createPagesWithEllipsis()));l(this,L,d(P([])));l(this,D,p(()=>this.createIsAllSelected()));l(this,B,d(void 0));l(this,N,d(1e3));this.rows=e,this.selectBy=t.selectBy??void 0,this.totalRows=t.totalRows,this.rowsPerPage=t.rowsPerPage??10}get search(){return o(i(this,y))}set search(e){c(i(this,y),e,!0)}get sort(){return o(i(this,H))}set sort(e){c(i(this,H),e,!0)}get totalRows(){return o(i(this,C))}set totalRows(e){c(i(this,C),e,!0)}get isLoading(){return o(i(this,R))}set isLoading(e){c(i(this,R),e,!0)}get rowsPerPage(){return o(i(this,E))}set rowsPerPage(e){c(i(this,E),e,!0)}get currentPage(){return o(i(this,T))}set currentPage(e){c(i(this,T),e,!0)}get filters(){return o(i(this,F))}set filters(e){c(i(this,F),e,!0)}get filterCount(){return o(i(this,A))}set filterCount(e){c(i(this,A),e)}get rows(){return o(i(this,$))}set rows(e){c(i(this,$),e,!0)}get rowCount(){return o(i(this,I))}set rowCount(e){c(i(this,I),e)}get pages(){return o(i(this,x))}set pages(e){c(i(this,x),e)}get pageCount(){return o(i(this,q))}set pageCount(e){c(i(this,q),e)}get pagesWithEllipsis(){return o(i(this,_))}set pagesWithEllipsis(e){c(i(this,_),e)}get selected(){return o(i(this,L))}set selected(e){c(i(this,L),e,!0)}get isAllSelected(){return o(i(this,D))}set isAllSelected(e){c(i(this,D),e)}get element(){return o(i(this,B))}set element(e){c(i(this,B),e,!0)}get clientWidth(){return o(i(this,N))}set clientWidth(e){c(i(this,N),e,!0)}getState(){return{currentPage:this.currentPage,rowsPerPage:this.rowsPerPage,offset:this.rowsPerPage*(this.currentPage-1),search:this.search,sort:this.sort.field?this.sort:void 0,filters:this.filters.length>0?this.filters:void 0,setTotalRows:e=>this.totalRows=e}}createPages(){return!this.rowsPerPage||!this.totalRows?void 0:Array.from(Array(Math.ceil(this.totalRows/this.rowsPerPage))).map((t,r)=>r+1)}createPageCount(){if(this.pages)return this.pages.length}createPagesWithEllipsis(){if(!this.pages)return;if(this.pageCount<=7)return this.pages;const e=null,t=1,r=this.pageCount;return this.currentPage<=4?[...this.pages.slice(0,5),e,r]:this.currentPage<this.pageCount-3?[t,e,...this.pages.slice(this.currentPage-2,this.currentPage+1),e,r]:[t,e,...this.pages.slice(this.pageCount-5,this.pageCount)]}createRowCount(){return!this.rowsPerPage||!this.totalRows?{total:void 0,start:void 0,end:void 0,selected:this.selected.length}:{total:this.totalRows,start:this.currentPage*this.rowsPerPage-this.rowsPerPage+1,end:Math.min(this.currentPage*this.rowsPerPage,this.totalRows),selected:this.selected.length}}createIsAllSelected(){return this.rows.length===0?!1:this.rows.map(t=>t[this.selectBy]).every(t=>this.selected.includes(t))}}y=new WeakMap,H=new WeakMap,C=new WeakMap,R=new WeakMap,E=new WeakMap,T=new WeakMap,F=new WeakMap,A=new WeakMap,$=new WeakMap,I=new WeakMap,x=new WeakMap,q=new WeakMap,_=new WeakMap,L=new WeakMap,D=new WeakMap,B=new WeakMap,N=new WeakMap;class fe{constructor(e){n(this,"table");n(this,"reload");this.table=e}set(e){this.reload=e}async invalidate(){if(!this.reload)return;this.table.isLoading=!0;const e=this.table.getState(),t=await this.reload(e);this.table.isLoading=!1,t&&(this.table.rows=t)}}class ge{constructor(e){n(this,"table");this.table=e}set(e){const t=this.table.sort;!t||t.field!==e?this.asc(e):t.direction==="asc"?this.desc(e):t.direction==="desc"&&this.asc(e)}asc(e){this.table.sort={field:e,direction:"asc"},this.table.setPage(1)}desc(e){this.table.sort={field:e,direction:"desc"},this.table.setPage(1)}}class pe{constructor(e){n(this,"table");this.table=e}set(e){this.table.selected.includes(e)?this.table.selected=this.table.selected.filter(t=>t!==e):this.table.selected=[e,...this.table.selected]}all(){const e=this.table.rows.map(t=>t[this.table.selectBy]);this.table.isAllSelected?this.table.selected=this.table.selected.filter(t=>e.includes(t)===!1):this.table.selected=[...new Set([...e,...this.table.selected])]}clear(){this.table.selected=[]}}class we{constructor(e){n(this,"table");this.table=e}goto(e){this.table.rowsPerPage&&this.table.totalRows?e>=1&&e<=this.table.pageCount&&(this.table.currentPage=e,this.table.event.dispatch("change"),this.table.invalidate()):e>=1&&(this.table.currentPage=e,this.table.event.dispatch("change"),this.table.invalidate())}previous(){this.goto(this.table.currentPage-1)}next(){this.goto(this.table.currentPage+1)}}class be{constructor(e){n(this,"table");this.table=e}clear(){this.table.event.dispatch("clearSearch")}}class me{constructor(e){n(this,"table");this.table=e}set(e,t){this.table.filters=this.table.filters.filter(r=>r.field!==t&&r.value),e&&this.table.filters.push({value:e,field:t})}unset(e){this.table.filters=this.table.filters.filter(t=>t.field!==e)}clear(){this.table.filters=[],this.table.event.dispatch("clearFilters")}}var z;class Pe{constructor(e,t){l(this,z,d(P([])));n(this,"table");n(this,"interval");n(this,"mutation");this.table=e,this.columns=[],this.interval=setInterval(()=>this.createColumns(t),200)}get columns(){return o(i(this,z))}set columns(e){c(i(this,z),e,!0)}toggle(e){if(!this.table.element)return;const t=this.columns.find(r=>r.name===e);t&&t.toggle()}createColumns(e){var t;(t=this.table)!=null&&t.element&&(clearInterval(this.interval),this.columns=e.map(({name:r,index:a,isVisible:h,isFrozen:g})=>({name:r,index:a,isVisible:h!==!1,isFrozen:g===!0,element:this.table.element,toggle(){this.isVisible=!this.isVisible,this.element.querySelectorAll(`tr > *:nth-child(${this.index+1})`).forEach(ae=>{ae.classList.toggle("hidden")})}})),this.preset(),this.mutation=new MutationObserver(()=>{setTimeout(()=>{this.preset()},2)}),this.mutation.observe(this.table.element,{childList:!0,subtree:!0}))}preset(){let e=0;for(const{isVisible:t,isFrozen:r,index:a}of this.columns)r===!0&&(e=this.freeze(a,e)),t===!1&&this.table.element.querySelectorAll(`tr > *:nth-child(${a+1})`).forEach(h=>{h.classList.add("hidden")})}freeze(e,t=0){const r=this.table.element.querySelector(`thead th:nth-child(${e+1})`),{width:a}=r.getBoundingClientRect();return this.table.element.querySelectorAll(`tr > *:nth-child(${e+1})`).forEach(h=>{h.style.position="sticky",h.style.left=e*t+"px",h.style.width=a+"px"}),a}setPosition(e,t){this.table.element.querySelectorAll("tr").forEach(r=>{const a=[].slice.call(r.querySelectorAll("th, td"));e>t?a[t].parentNode.insertBefore(a[e],a[t]):a[t].parentNode.insertBefore(a[e],a[t].nextSibling)})}}z=new WeakMap;var W;class ve{constructor(e){l(this,W,d(""));n(this,"timeout");n(this,"table");this.table=e,this.cleanup()}get value(){return o(i(this,W))}set value(e){c(i(this,W),e,!0)}set(){this.table.search=this.value,clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.table.invalidate()},400)}clear(){this.value="",this.table.search="",this.table.invalidate()}cleanup(){this.table.on("clearSearch",()=>this.clear())}}W=new WeakMap;var U,V;class Se{constructor(e,t){n(this,"sortHandler");n(this,"field");l(this,U,p(()=>this.createIsActive()));l(this,V,p(()=>this.createDirection()));this.sortHandler=e,this.field=t}get isActive(){return o(i(this,U))}set isActive(e){c(i(this,U),e)}get direction(){return o(i(this,V))}set direction(e){c(i(this,V),e)}set(){this.sortHandler.set(this.field)}asc(){this.sortHandler.asc(this.field)}desc(){this.sortHandler.desc(this.field)}createIsActive(){var e;return this.field===((e=this.sortHandler.table.sort)==null?void 0:e.field)}createDirection(){var e;return this.isActive===!1?null:(e=this.sortHandler.table.sort)==null?void 0:e.direction}}U=new WeakMap,V=new WeakMap;var M;class ye{constructor(e,t){l(this,M,d(""));n(this,"timeout");n(this,"filterHandler");n(this,"field");this.filterHandler=e,this.field=t,this.cleanup()}get value(){return o(i(this,M))}set value(e){c(i(this,M),e,!0)}set(){this.filterHandler.set(this.value,this.field),clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.filterHandler.table.invalidate()},400)}clear(){this.value="",this.filterHandler.unset(this.field)}cleanup(){this.filterHandler.table.on("clearFilters",()=>this.clear())}}M=new WeakMap;class He extends de{constructor(t=[],r={rowsPerPage:5}){super(t,r);n(this,"fetchHandler");n(this,"sortHandler");n(this,"selectHandler");n(this,"pageHandler");n(this,"searchHandler");n(this,"filterHandler");n(this,"view");n(this,"i18n");this.i18n=this.translate(r.i18n),this.fetchHandler=new fe(this),this.sortHandler=new ge(this),this.selectHandler=new pe(this),this.pageHandler=new we(this),this.searchHandler=new be(this),this.filterHandler=new me(this)}load(t){this.fetchHandler.set(t)}invalidate(){this.fetchHandler.invalidate()}setRowsPerPage(t){this.rowsPerPage=t,this.setPage(1)}setPage(t){switch(t){case"previous":return this.pageHandler.previous();case"next":return this.pageHandler.next();case"last":return this.pageHandler.goto(this.pageCount);default:return this.pageHandler.goto(t)}}clearSearch(){this.searchHandler.clear()}createSearch(){return new ve(this)}createSort(t){if(typeof t=="function")throw new Error(`Invalid field argument: ${String(t)}. Function type arguments are not allowed in server-side mode`);return new Se(this.sortHandler,t)}clearFilters(){this.filterHandler.clear(),this.invalidate()}createFilter(t){if(typeof t=="function")throw new Error(`Invalid field argument: ${String(t)}. Function type arguments are not allowed in server-side mode`);return new ye(this.filterHandler,t)}select(t){this.selectHandler.set(t)}selectAll(){this.selectHandler.all()}clearSelection(){this.selectHandler.clear()}on(t,r){this.event.add(t,r)}createView(t){return this.view=new Pe(this,t),this.view}getView(){return this.view}translate(t){return{search:"Search...",show:"Show",entries:"entries",filter:"Filter",rowCount:"Showing {start} to {end} of {total} entries",noRows:"No entries found",previous:"Previous",next:"Next",selectedCount:"{count} of {total} row(s).",...t}}}const J="datatableSettings",k=10,S=f(Ce());S.subscribe(s=>{localStorage.setItem(J,JSON.stringify(s))});function Ce(){if(localStorage.getItem(J))try{return JSON.parse(localStorage.getItem(J)||"{}")}catch{console.error("restoring user datatable settings failed"),localStorage.setItem(J,"{}")}return{}}function ie(s){if(!s)return k;const e=u(S);return e?e[s]?e[s]:(e[s]=k,S.set(e),k):k}function ke(s,e){const t=u(S);t[s]=e,S.set(t)}const ee=f(!1),Re=f(Promise.resolve(void 0)),O=f(""),w=f([]),Q=new He([],{rowsPerPage:ie("ExplorerTable")}),G=f(!0),K=f(""),te=f(1),se=f(ie("ExplorerTable"));w.subscribe(()=>{Q.setPage(1)});O.subscribe(()=>{Q.setPage(1)});Q.load(async s=>{const e=u(O),t=u(w);ee.set(!0),u(G)&&(e||t.length>0)&&G.set(!1);try{return u(te)!==s.currentPage||u(se)!==s.rowsPerPage?(te.set(s.currentPage),se.set(s.rowsPerPage)):Ie.set(De()),await Ee(s)}catch{return[]}finally{ee.set(!1)}});async function Ee(s){const e="An error occurred while searching. If the problem persists, please contact an administrator.",t=u(w),r=u(O);if(!r&&!t.length)return s.setTotalRows(0),[];const a=_e(r.trim(),t,{pageNumber:s.currentPage-1,pageSize:s.rowsPerPage});Re.set(a);const h=await a.catch(g=>{throw console.error(g),s.setTotalRows(0),K.set(e),g});return h||K.set(e),s.setTotalRows((h==null?void 0:h.totalElements)??0),(h==null?void 0:h.content)??[]}async function Te(s){const e=u(w);s.forEach(t=>{const r=e.findIndex(a=>a.name===t.name);r!==-1?e.splice(r,1):e.push(t)}),w.set(e.sort((t,r)=>r.count-t.count))}function Je(){O.set(""),w.set([]),K.set(""),G.set(!0)}const je={selectedFacets:w,updateFacets:Te},X="picsure/proxy/dictionary-api/",j=`${X}concepts`,Fe=`${j}/detail/`,Ae="picsure/proxy/dictionary-api/dashboard-drawer/",$e=f({}),Ie=f(Promise.resolve([])),xe=f([]),v=new Map;function qe(s,e){!s||!e||(v.size>100&&v.clear(),v.set(s,e))}function _e(s="",e,t){let r={facets:e,search:s};return u(re).url.pathname.includes("/discover")||(r=Z(r)),b(`${j}?page_number=${t.pageNumber}&page_size=${t.pageSize}`,r)}function Le(s){const e=s.map(t=>({name:t.name,values:t.facets.filter(r=>r.count===0).map(r=>r.name)})).reduce((t,r)=>(t[r.name]=r.values,t),{});console.debug("Found the following facets that should be hidden:",JSON.stringify(e)),$e.set(e)}async function De(){const s=u(O);let t={facets:u(w),search:s};u(re).url.pathname.includes("/discover")||(t=Z(t));try{const r=await b(`${X}facets/`,t);Le(r),Be(r);const a=r.map(h=>h.facets.some(g=>g.count>0)?h.name:"").filter(h=>h);return xe.set(a),r}catch(r){throw console.error("Failed to update facets from search:",r),r}}function Be(s){s.forEach(e=>{e.facets.forEach(t=>{var r;t.categoryRef={name:e.name,display:e.display,description:e.description},(r=t.children)!=null&&r.length&&t.children.forEach(a=>{a.categoryRef={name:e.name,display:e.display,description:e.description},a.parentRef={name:t.name,display:t.display,description:t.description}})})})}async function Ze(s,e){const t=`${Fe}${e}`,r=String.raw`${s.replace(/\\\\/g,"\\")}`;if(v.has(r))return v.get(r);const a=await b(t,r);if(!a)throw new Error("No response");return qe(r,a),a}function Z(s){var t;const e=(t=u(ce))==null?void 0:t.queryTemplate;if(e){const a=(e.categoryFilters||{})["\\_consents\\"]||[];s.consents=a}return s}async function Ge(s=!1){let e={facets:[],search:"",consents:[]};return s||(e=Z(e)),(await b(`${j}?page_number=1&page_size=1`,e)).totalElements||Promise.reject("total not found")}async function Ke(s=!1,e){let t={facets:[],search:"",consents:[]};s||(t=Z(t));const a=(await b(`${X}facets/`,t)).find(g=>g.name===e);return a?s?a.facets.length:a.facets.filter(g=>g.count>0).length:0}async function Qe(s){return he(`${Ae}${s}`)}async function Xe(s,e,t){const r=`${j}/tree/${s}?depth=${e}`;return b(r,t)}export{ue as E,je as S,He as T,Pe as V,Ge as a,Ke as b,Ze as c,Xe as d,w as e,Ie as f,ie as g,$e as h,O as i,Re as j,K as k,G as l,ee as m,Qe as n,xe as o,ke as p,Je as r,_e as s,Q as t,Te as u};
