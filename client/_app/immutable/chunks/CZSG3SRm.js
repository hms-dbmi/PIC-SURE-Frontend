import{f as B,a as c,t as D,c as le}from"./CtfeAAbw.js";import{p as ce,d as S,b as R,a as de,c as a,n as j,s as i,r as s,g as e,h as b,t as C,f as pe,e as v}from"./B4GrenNm.js";import{s as d}from"./DxSOTiY2.js";import{a as q}from"./bf3FOAR_.js";import{i as ue}from"./CSsnQ7i2.js";import{d as fe}from"./D7VV4X-8.js";import{b as ve}from"./BPiAbArq.js";import{a as me,s as ge}from"./DvPjbdiY.js";import{u as he,k as be,m as _e,n as xe,t as F,o as ke}from"./yAhaO9Md.js";import{d as ye}from"./DR5Ig_-s.js";import{C as we}from"./DhHh3RdS.js";import{E as $e}from"./BVg5wqNm.js";import{M as Te}from"./CtCNvYvu.js";import{L as G}from"./B7pZD2Tm.js";function Ee(I,m){v(m,!e(m))}var Pe=B('<span id="expires-badge" data-testid="expires-badge"> </span>'),Ae=B('<div id="user-token" class="card preset-filled-sureface-500 svelte-nvw5lv"><header class="card-header"><h4>Personal Access Token</h4></header> <section class="p-4 grid grid-cols-2 gap-y-2 items-center svelte-nvw5lv"><label for="account" class="svelte-nvw5lv">Account:</label> <span id="account" class="w-full"> </span> <label for="token" class="svelte-nvw5lv">Token:</label> <div id="token"> </div> <label for="expires" class="svelte-nvw5lv">Expires:</label> <div><span id="expires" class="w-1/3 mr-2"> </span> <!></div></section> <footer class="card-footer mt-2"><!> <!> <button data-testid="reveal-btn" class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500"> </button></footer></div>'),De=B('<div id="user-token-container" class="svelte-nvw5lv"><!></div>');function Ge(I,m){var L;ce(m,!0);const[J,K]=ge(),g=()=>me(he,"$user",J),N="Refresh",Q="••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••";let V=S(((L=g())==null?void 0:L.email)||"There was an error retrieving your account."),_=R(!1),x=R(!1),k=R(S(Promise.resolve(N))),y=b(()=>{var r;return(r=g())==null?void 0:r.token}),p=b(()=>e(y)?X(e(y)):0),w=b(()=>e(p)&&W());function W(){if(!e(p)||e(p)===0)return"unknown";const r=Math.floor((e(p)-Date.now())/(1e3*60*60*24));return e(p)<Date.now()?"expired":r<7?"expiring soon":"valid for "+r+" more days"}function X(r){if(!r)return 0;try{return ke(r)}catch(l){return console.error(l),F.error({title:"An error occured while parsing your token. Please try again later. If this problem persists, please contact an administrator."}),0}}function Y(){v(x,!0),v(k,xe().then(()=>"Refreshed!").catch(r=>(console.log("Error: ",r),F.error({title:"An error occured while refreshing your token. Please try again later. If this problem persists, please contact an administrator."}),"Error")).finally(ye(()=>{v(k,Promise.resolve("Refresh"),!0),v(x,!1)},5e3)),!0)}var $=De(),Z=a($);q(Z,()=>_e(!0,!0),r=>{G(r,{ring:!0,size:"medium"})},r=>{var l=Ae(),h=i(a(l),2),u=i(a(h),2),ee=a(u,!0);s(u);var T=i(u,4),re=a(T,!0);s(T);var U=i(T,4),E=a(U),te=a(E,!0);s(E);var ae=i(E,2);{var se=o=>{var t=Pe(),n=a(t,!0);s(t),C(f=>{ve(t,1,`badge ${e(w)??""}`),d(n,f)},[()=>e(w).toUpperCase()]),c(o,t)};ue(ae,o=>{e(w)&&o(se)})}s(U),s(h);var M=i(h,2),z=a(M);const oe=b(()=>g().token||"");we(z,{get itemToCopy(){return e(oe)},class:"preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500"});var H=i(z,2);Te(H,{"data-testid":"refresh",title:"Please Confirm",onconfirm:Y,get disabled(){return e(x)},triggerBase:"btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500",footerButtons:!0,withDefault:!0,trigger:t=>{var n=le(),f=pe(n);q(f,()=>e(k),A=>{G(A,{ring:!0,size:"micro",label:"Refreshing"})},(A,ie)=>{var O=D();C(()=>d(O,e(ie))),c(A,O)}),c(t,n)},children:(t,n)=>{j();var f=D("Are you sure you wish to invalidate your old token and create a new one?");c(t,f)},$$slots:{trigger:!0,default:!0}});var P=i(H,2);P.__click=[Ee,_];var ne=a(P,!0);s(P),s(M),s(l),C(o=>{d(ee,V),d(re,e(_)?e(y):Q),d(te,o),d(ne,e(_)?"Hide":"Reveal")},[()=>{var o,t,n;return(n=(t=be(((o=g())==null?void 0:o.token)||""))==null?void 0:t.toString())==null?void 0:n.substring(0,24)}]),c(r,l)},r=>{$e(r,{children:(l,h)=>{j();var u=D(`An error occured while to retrieving your account. If this problem persists, please contact an
      administrator.`);c(l,u)},$$slots:{default:!0}})}),s($),c(I,$),de(),K()}fe(["click"]);export{Ge as U};
