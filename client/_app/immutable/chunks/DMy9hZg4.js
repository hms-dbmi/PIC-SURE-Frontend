var T=Object.defineProperty;var I=(a,t,s)=>t in a?T(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var r=(a,t,s)=>I(a,typeof t!="symbol"?t+"":t,s);import{f as o,a as l}from"./Di2X-GR-.js";import{l as n}from"./CDvIr29H.js";import{u as q}from"./BEf3cR2P.js";import{f as R,h as x}from"./BjYfhs4G.js";import{e as y}from"./CcXNpHEf.js";class c{constructor(t){r(this,"categoryFilters");r(this,"numericFilters");r(this,"requiredFields");r(this,"anyRecordOf");r(this,"fields");r(this,"crossCountFields");r(this,"variantInfoFilters");r(this,"expectedResultType");var i;this.categoryFilters=(t==null?void 0:t.categoryFilters)||{},this.numericFilters=(t==null?void 0:t.numericFilters)||{},this.requiredFields=(t==null?void 0:t.requiredFields)||[],this.anyRecordOf=(t==null?void 0:t.anyRecordOf)||[],this.crossCountFields=(t==null?void 0:t.crossCountFields)||void 0,this.fields=(t==null?void 0:t.fields)||[];const s=((i=t==null?void 0:t.variantInfoFilters)==null?void 0:i[0])||{categoryVariantInfoFilters:{},numericVariantInfoFilters:{}};this.variantInfoFilters=[s],this.expectedResultType=(t==null?void 0:t.expectedResultType)||"COUNT"}addCategoryFilter(t,s){this.categoryFilters[t]=s}removeCategoryFilter(t){delete this.categoryFilters[t]}addNumericFilter(t,s,i){this.numericFilters[t]={min:s.toString(),max:i.toString()}}addCategoryVariantInfoFilters(t){this.variantInfoFilters[0].categoryVariantInfoFilters={Gene_with_variant:t.Gene_with_variant,Variant_consequence_calculated:t.Variant_consequence_calculated,Variant_frequency_as_text:t.Variant_frequency_as_text}}setCrossCountFields(t){this.crossCountFields=t}addSnpFilter(t){t.forEach(s=>{this.categoryFilters[s.search]=s.constraint.split(",")})}addRequiredField(t){this.requiredFields.push(t)}addField(t){this.fields.push(t)}addAnyRecordOf(t){this.anyRecordOf.push(t)}hasFilter(){var e,d,h,F,f,u,_,m,p;const t=((h=(d=(e=this.variantInfoFilters[0])==null?void 0:e.categoryVariantInfoFilters)==null?void 0:d.Gene_with_variant)==null?void 0:h.length)||0,s=((u=(f=(F=this.variantInfoFilters[0])==null?void 0:F.categoryVariantInfoFilters)==null?void 0:f.Variant_consequence_calculated)==null?void 0:u.length)||0,i=((p=(m=(_=this.variantInfoFilters[0])==null?void 0:_.categoryVariantInfoFilters)==null?void 0:m.Variant_frequency_as_text)==null?void 0:p.length)||0;return Object.keys(this.categoryFilters).length+Object.keys(this.numericFilters).length+t+s+i+this.requiredFields.length+this.anyRecordOf.length}}const V="\\DCC Harmonized data set",O="\\_harmonized_consent\\",P="\\_topmed_consents\\";function H(a=!0,t=l.hpds,s="COUNT"){let i=new c;if(o.useQueryTemplate&&a){const e=n(q).queryTemplate;e&&(i=new c(structuredClone(e)))}return n(R).forEach(e=>{e.filterType==="Categorical"?e.displayType==="restrict"?i.addCategoryFilter(e.id,e.categoryValues):i.addRequiredField(e.id):e.filterType==="numeric"?i.addNumericFilter(e.id,e.min||"",e.max||""):e.filterType==="genomic"?i.addCategoryVariantInfoFilters({Gene_with_variant:e.Gene_with_variant,Variant_consequence_calculated:e.Variant_consequence_calculated,Variant_frequency_as_text:e.Variant_frequency_as_text}):e.filterType==="snp"&&i.addSnpFilter(e.snpValues)}),n(y).forEach(e=>{e.conceptPath&&i.addField(e.conceptPath)}),o.requireConsents&&a&&(i=v(i)),i.expectedResultType=s,{query:i,resourceUUID:t}}function b(a=!1,t="COUNT"){const s=a?l.openHPDS:l.hpds;let i=new c;if(o.useQueryTemplate&&!a){const e=n(q).queryTemplate;e&&(i=new c(structuredClone(e)))}return o.requireConsents&&!a&&(i=v(i)),i.expectedResultType=t,{query:i,resourceUUID:s}}const v=a=>(!g(a.categoryFilters)&&!g(a.numericFilters)&&!C(a.fields)&&!C(a.requiredFields)&&a.removeCategoryFilter(O),n(x)||a.removeCategoryFilter(P),a),g=a=>Object.keys(a).some(t=>t.includes(V)),C=a=>a.some(t=>t.includes(V));export{c as Q,b as a,H as g,v as u};
