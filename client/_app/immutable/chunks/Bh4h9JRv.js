import{_ as K}from"./C1FmrZbK.js";import{f as N,a as b,c as Q}from"./DKNWTM-D.js";import{o as k}from"./DpyMT7OB.js";import{p as A,g as n,d as x,b as v,t as X,a as L,e as Y,s as Z,f as C,c as D,r as $}from"./KPVYLOSR.js";import{i as O}from"./CDCmQmr-.js";import{e as tt,i as et}from"./B5lqQSsR.js";import{a as ot,s as at}from"./B2Bg6RTa.js";import{s as rt,r as P}from"./BD7x6Jnt.js";import{c as st}from"./BpV1Tt4c.js";import{s as z}from"./Be_LeCLl.js";import{b as it}from"./3gfQC4Jj.js";import{g as lt}from"./BibUdOWF.js";import{p as nt}from"./DjiALQWk.js";import{t as ct}from"./CWjZNTTC.js";import{L as ut}from"./BW_ShK1N.js";const T=60,I=6,B=rt.distributionExplorer.graphColors,mt={editable:!0,toImageButtonOptions:{format:"png"},displayModeBar:!0,modeBarButtonsToRemove:["pan2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","sendDataToCloud"]};function ft(t){const e=[];for(let o=0;o<t;o++)e.push(B[o%B.length]);return e}function E(t){return t.length>T?t.substring(0,T-3)+"...":t}function M(t,e){const o=Array(t.length).fill(I),a=[];return t.forEach((r,s)=>{r<10&&e?(o[s]=9,a[s]="< 10",t[s]=0):e?a[s]=r+" Â± 3":(o[s]=0,a[s]=r+"")}),{topBar:o,bottomBar:a}}function S(t,e){return t.map(o=>e&&o>0?o-I/2:o)}function dt(t){const e=Object.values(t.categoricalMap),{topBar:o,bottomBar:a}=M(e,t.obfuscated),r=ft(e.length),s=E(t.title),c=[{x:Object.keys(t.categoricalMap),y:S(e,t.obfuscated),name:s,type:"bar",showlegend:!1,marker:{color:r}},{x:Object.keys(t.categoricalMap),y:o,name:"Obfuscated Data",showlegend:!1,type:"bar",marker:{color:r,pattern:{shape:"/",size:20,solidity:.5}},text:a,textposition:"outside"}],m={title:{text:s},width:t.chartWidth||500,height:t.chartHeight||600,hovermode:!1,font:{family:"Nunito Sans, sans-serif"},xaxis:{title:{text:t.xaxisName},automargin:!0},yaxis:{title:{text:t.yaxisName},automargin:!0},barmode:"stack"};return{data:c,layout:m,meta:{isCategorical:!0,unformatedTitle:t.title}}}function pt(t){const e=t.obfuscated,o=[],a=[];Object.keys(t.continuousMap).sort((u,_)=>{let f=parseFloat(u.split(" -")[0]),d=parseFloat(_.split(" -")[0]);return isNaN(f)&&(f=parseFloat(u.split(" +")[0])),isNaN(d)&&(d=parseFloat(u.split(" +")[0])),f-d}).forEach(u=>{o.push(u),a.push(t.continuousMap[u])});const{topBar:r,bottomBar:s}=M(a,e),c=E(t.title),m=[{x:o,y:S(a,t.obfuscated),name:c,type:"bar",showlegend:!1,marker:{color:"#c31f3f",line:{color:"#616265",width:1}}},{x:o,y:r,name:"Obfuscated Data",showlegend:!1,type:"bar",marker:{color:"#c31f3f",pattern:{shape:"/",size:20,solidity:.5},line:{color:"#616265",width:1}},text:s,textposition:"outside"}],h={title:{text:c},width:t.chartWidth||500,height:t.chartHeight||600,autosize:!1,hovermode:!1,bargap:.01,font:{family:"Nunito Sans, sans-serif"},xaxis:{title:{text:t.xaxisName},automargin:!0},yaxis:{title:{text:t.yaxisName},automargin:!0},barmode:"stack"};return{data:m,layout:h,meta:{isCategorical:!1,unformatedTitle:t.title}}}var gt=N("<div></div>");function ht(t,e){A(e,!0);const o=e.meta.isCategorical?"Column chart showing the visualization of ":"Histogram showing the visualization of ";let a=x("");k(async()=>{e.newPlot(n(a),e.data,e.layout,{...mt,toImageButtonOptions:{filename:e.meta.unformatedTitle}})});var r=gt();it(r,s=>v(a,s),()=>n(a)),X(()=>{z(r,"id",`plot-${e.index??""}`),z(r,"aria-label",o+e.meta.unformatedTitle),z(r,"title","Visualization of "+e.meta.unformatedTitle)}),b(t,r),L()}var yt=N("<div>No Visualizations Available</div>"),bt=N('<p class="mb-8 text-center">All visualizations display the distributions of each variable filter for the specified cohort.</p> <div id="visualizations" class="flex flex-row flex-wrap gap-6 items-center justify-center"><!></div>',1);function Et(t,e){A(e,!0);const[o,a]=at(),r=()=>ot(nt,"$page",o),s="/picsure/query/sync";let c=x(Y([])),m=x(void 0),h=x(!0);const u=r().url.pathname.includes("/discover");async function _(){const i=lt(!u,P.visualization),p=localStorage.getItem("token");await st(s,{query:i.query,resourceUUID:P.visualization,resourceCredentials:p?{Authorization:"Bearer "+p}:{}}).then(l=>{v(c,[...((l==null?void 0:l.categoricalData)||[]).map(dt),...((l==null?void 0:l.continuousData)||[]).map(pt)],!0)}).catch(l=>{console.error("Viusalzation failed with query: "+JSON.stringify(i),l),ct.error({description:"An error occured while parsing your token. Please try again later. If this problem persists, please contact an administrator."})}).finally(()=>{v(h,!1)})}k(async()=>{const i=await K(()=>import("./DsmiCRqh.js").then(p=>p.p),[],import.meta.url);v(m,i.newPlot,!0),await _()});var f=bt(),d=Z(C(f),2),V=D(d);{var q=i=>{ut(i,{ring:!0,size:"medium"})},F=(i,p)=>{{var l=g=>{var y=Q(),j=C(y);tt(j,17,()=>n(c),et,(H,w,U)=>{let G=()=>n(w).data,W=()=>n(w).layout,J=()=>n(w).meta;ht(H,{index:U,get data(){return G()},get layout(){return W()},get meta(){return J()},get newPlot(){return n(m)}})}),b(g,y)},R=g=>{var y=yt();b(g,y)};O(i,g=>{n(c).length?g(l):g(R,!1)},p)}};O(V,i=>{n(h)?i(q):i(F,!1)})}$(d),b(t,f),L(),a()}export{Et as V};
