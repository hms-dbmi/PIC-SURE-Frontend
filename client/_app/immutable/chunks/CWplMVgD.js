import{p as i,u as d,g as h}from"./BB8gGrUk.js";import{p as u}from"./C4m20sN0.js";import{w as m}from"./DA0IzwqI.js";import{x as p}from"./DfqJWsAP.js";const l="picsure/proxy/dictionary-api/",f="picsure/proxy/dictionary-api/concepts",g="picsure/proxy/dictionary-api/concepts/detail/",y="picsure/proxy/dictionary-api/dashboard-drawer/",w=m({}),r=new Map;function $(n,e){!n||!e||(r.size>100&&r.clear(),r.set(n,e))}function U(n="",e,s){let t={facets:e,search:n};return p(u).url.pathname.includes("/discover")||(t=o(t)),i(`${f}?page_number=${s.pageNumber}&page_size=${s.pageSize}`,t)}function F(n){const e=n.map(s=>({name:s.name,values:s.facets.filter(t=>t.count===0).map(t=>t.name)})).reduce((s,t)=>(s[t.name]=t.values,s),{});console.log("Found the following facets that should be hidden: {}",e),w.set(e)}async function q(n,e){let s={facets:e,search:n};p(u).url.pathname.includes("/discover")||(s=o(s));try{const t=await i(`${l}facets/`,s);return e.length===0&&n.length===0&&F(t),C(t),t}catch(t){throw console.error("Failed to update facets from search:",t),t}}function C(n){n.forEach(e=>{e.facets.forEach(s=>{var t;s.categoryRef={name:e.name,display:e.display,description:e.description},(t=s.children)!=null&&t.length&&s.children.forEach(a=>{a.categoryRef={name:e.name,display:e.display,description:e.description},a.parentRef={name:s.name,display:s.display,description:s.description}})})})}async function z(n,e){const s=`${g}${e}`,t=String.raw`${n.replace(/\\\\/g,"\\")}`;if(r.has(t))return r.get(t);const a=await i(s,t);if(!a)throw new Error("No response");return $(t,a),a}function o(n){var s;const e=(s=p(d))==null?void 0:s.queryTemplate;if(e){const a=(e.categoryFilters||{})["\\_consents\\"]||[];n.consents=a}return n}async function E(n=!1){let e={facets:[],search:"",consents:[]};return n||(e=o(e)),(await i(`${f}?page_number=1&page_size=1`,e)).totalElements}async function R(n=!1){let e={facets:[],search:"",consents:[]};n||(e=o(e));const t=(await i(`${l}facets/`,e)).find(c=>c.name==="dataset_id");return t?n?t.facets.length:t.facets.filter(c=>c.count>0).length:0}async function S(n){return h(`${y}${n}`)}export{R as a,E as b,S as c,z as g,w as h,U as s,q as u};
