import{s as ae,e as m,a as A,c as _,b as N,g as I,l as q,f as T,m as p,i as F,h as n,r as B,u as x,v as se,n as Q,y as ne,w as ie,t as ee,d as te,j as le}from"./DfqJWsAP.js";import{e as W}from"./CnUKkpeB.js";import{S as re,i as oe}from"./B9sU1H0B.js";import{g as ue}from"./DA0IzwqI.js";import{g as ce}from"./D4yaORjf.js";import"./8fc_wYz-.js";import{u as fe,a as de}from"./CC3Nk4BD.js";function X(a,e,t){const i=a.slice();return i[5]=e[t][0],i[12]=e,i[13]=t,i}function Y(a){let e,t,i="UUID:",s,u,r;return{c(){e=m("label"),t=m("span"),t.textContent=i,s=A(),u=m("input"),this.h()},l(l){e=_(l,"LABEL",{class:!0});var f=N(e);t=_(f,"SPAN",{"data-svelte-h":!0}),q(t)!=="svelte-xruxbf"&&(t.textContent=i),s=I(f),u=_(f,"INPUT",{type:!0,class:!0}),f.forEach(T),this.h()},h(){var l;p(u,"type","text"),p(u,"class","input"),u.value=r=(l=a[0])==null?void 0:l.uuid,u.disabled=!0,p(e,"class","label")},m(l,f){F(l,e,f),n(e,t),n(e,s),n(e,u)},p(l,f){var d;f&1&&r!==(r=(d=l[0])==null?void 0:d.uuid)&&u.value!==r&&(u.value=r)},d(l){l&&T(e)}}}function Z(a){let e,t,i,s,u=a[5]+"",r,l,f,d;function P(){a[9].call(t,a[13])}return{c(){e=m("label"),t=m("input"),i=A(),s=m("p"),r=ee(u),l=A(),this.h()},l(g){e=_(g,"LABEL",{class:!0});var c=N(e);t=_(c,"INPUT",{class:!0,type:!0}),i=I(c),s=_(c,"P",{});var b=N(s);r=te(b,u),b.forEach(T),l=I(c),c.forEach(T),this.h()},h(){p(t,"class","checkbox"),p(t,"type","checkbox"),p(e,"class","flex items-center space-x-2")},m(g,c){F(g,e,c),n(e,t),t.checked=a[3][a[13]].checked,n(e,i),n(e,s),n(s,r),n(e,l),f||(d=x(t,"change",P),f=!0)},p(g,c){a=g,c&8&&(t.checked=a[3][a[13]].checked),c&2&&u!==(u=a[5]+"")&&le(r,u)},d(g){g&&T(e),f=!1,d()}}}function $(a){let e,t,i,s,u,r,l,f='<i class="fa-solid fa-xmark"></i> <span class="sr-only">Close</span>',d,P;return{c(){e=m("aside"),t=m("div"),i=m("p"),s=ee(a[4]),u=A(),r=m("div"),l=m("button"),l.innerHTML=f,this.h()},l(g){e=_(g,"ASIDE",{"data-testid":!0,class:!0});var c=N(e);t=_(c,"DIV",{class:!0});var b=N(t);i=_(b,"P",{});var w=N(i);s=te(w,a[4]),w.forEach(T),b.forEach(T),u=I(c),r=_(c,"DIV",{class:!0});var h=N(r);l=_(h,"BUTTON",{"data-svelte-h":!0}),q(l)!=="svelte-14sn3fl"&&(l.innerHTML=f),h.forEach(T),c.forEach(T),this.h()},h(){p(t,"class","alert-message"),p(r,"class","alert-actions"),p(e,"data-testid","validation-error"),p(e,"class","alert variant-ghost-error")},m(g,c){F(g,e,c),n(e,t),n(t,i),n(i,s),n(e,u),n(e,r),n(r,l),d||(P=x(l,"click",a[10]),d=!0)},p(g,c){c&16&&le(s,g[4])},d(g){g&&T(e),d=!1,P()}}}function he(a){var K;let e,t,i,s,u="Name:",r,l,f,d,P,g="Description:",c,b,w,h,k,D="<span>Privileges:</span>",V,O,H,R,G='<button type="submit" class="btn variant-ghost-primary hover:variant-filled-primary">Save</button> <a href="/admin/configuration" class="btn variant-ghost-secondary hover:variant-filled-secondary">Cancel</a>',j,J,y=((K=a[0])==null?void 0:K.uuid)&&Y(a),U=W(a[1]),E=[];for(let o=0;o<U.length;o+=1)E[o]=Z(X(a,U,o));let C=a[4]&&$(a);return{c(){e=m("form"),y&&y.c(),t=A(),i=m("label"),s=m("span"),s.textContent=u,r=A(),l=m("input"),f=A(),d=m("label"),P=m("span"),P.textContent=g,c=A(),b=m("input"),w=A(),h=m("fieldset"),k=m("legend"),k.innerHTML=D,V=A();for(let o=0;o<E.length;o+=1)E[o].c();O=A(),C&&C.c(),H=A(),R=m("div"),R.innerHTML=G,this.h()},l(o){e=_(o,"FORM",{class:!0});var v=N(e);y&&y.l(v),t=I(v),i=_(v,"LABEL",{class:!0});var S=N(i);s=_(S,"SPAN",{"data-svelte-h":!0}),q(s)!=="svelte-m2peuz"&&(s.textContent=u),r=I(S),l=_(S,"INPUT",{type:!0,class:!0,minlength:!0,maxlength:!0}),S.forEach(T),f=I(v),d=_(v,"LABEL",{class:!0});var L=N(d);P=_(L,"SPAN",{"data-svelte-h":!0}),q(P)!=="svelte-n5lbfe"&&(P.textContent=g),c=I(L),b=_(L,"INPUT",{type:!0,class:!0,minlength:!0,maxlength:!0}),L.forEach(T),w=I(v),h=_(v,"FIELDSET",{"data-testid":!0});var M=N(h);k=_(M,"LEGEND",{class:!0,"data-svelte-h":!0}),q(k)!=="svelte-1lw6cpx"&&(k.innerHTML=D),V=I(M);for(let z=0;z<E.length;z+=1)E[z].l(M);M.forEach(T),O=I(v),C&&C.l(v),H=I(v),R=_(v,"DIV",{"data-svelte-h":!0}),q(R)!=="svelte-1u8xx9t"&&(R.innerHTML=G),v.forEach(T),this.h()},h(){p(l,"type","text"),p(l,"class","input"),l.required=!0,p(l,"minlength","1"),p(l,"maxlength","255"),p(i,"class","label required"),p(b,"type","text"),p(b,"class","input"),b.required=!0,p(b,"minlength","1"),p(b,"maxlength","255"),p(d,"class","label required"),p(k,"class","required"),p(h,"data-testid","privilege-checkboxes"),p(e,"class","grid gap-4 my-3")},m(o,v){F(o,e,v),y&&y.m(e,null),n(e,t),n(e,i),n(i,s),n(i,r),n(i,l),B(l,a[5]),n(e,f),n(e,d),n(d,P),n(d,c),n(d,b),B(b,a[2]),n(e,w),n(e,h),n(h,k),n(h,V);for(let S=0;S<E.length;S+=1)E[S]&&E[S].m(h,null);n(e,O),C&&C.m(e,null),n(e,H),n(e,R),j||(J=[x(l,"input",a[7]),x(b,"input",a[8]),x(e,"submit",se(a[6]))],j=!0)},p(o,[v]){var S;if((S=o[0])!=null&&S.uuid?y?y.p(o,v):(y=Y(o),y.c(),y.m(e,t)):y&&(y.d(1),y=null),v&32&&l.value!==o[5]&&B(l,o[5]),v&4&&b.value!==o[2]&&B(b,o[2]),v&10){U=W(o[1]);let L;for(L=0;L<U.length;L+=1){const M=X(o,U,L);E[L]?E[L].p(M,v):(E[L]=Z(M),E[L].c(),E[L].m(h,null))}for(;L<E.length;L+=1)E[L].d(1);E.length=U.length}o[4]?C?C.p(o,v):(C=$(o),C.c(),C.m(e,H)):C&&(C.d(1),C=null)},i:Q,o:Q,d(o){o&&T(e),y&&y.d(),ne(E,o),C&&C.d(),j=!1,ie(J)}}}function pe(a,e,t){const i=ce();let{role:s=void 0}=e,{privilegeList:u}=e,r=s?s.name:"",l=s?s.description:"",f=u.map(([h,k])=>({uuid:k,checked:s?s.privileges.includes(k):!1})),d="";async function P(){const h=f.filter(D=>D.checked).map(D=>D.uuid);if(h.length===0){t(4,d="At least one privilege must be selected.");return}else t(4,d="");let k={name:r,description:l,privileges:h};try{s?(k={...k,uuid:s.uuid},await fe(k)):await de(k),i.trigger({message:`Successfully saved ${k&&"new "}role '${r}'`,background:"variant-filled-success"}),ue("/admin/configuration")}catch(D){console.error(D),i.trigger({message:`An error occured while saving ${k&&"new "}role '${r}'`,background:"variant-filled-error"})}}function g(){r=this.value,t(5,r)}function c(){l=this.value,t(2,l)}function b(h){f[h].checked=this.checked,t(3,f)}const w=()=>t(4,d="");return a.$$set=h=>{"role"in h&&t(0,s=h.role),"privilegeList"in h&&t(1,u=h.privilegeList)},[s,u,l,f,d,r,P,g,c,b,w]}class Le extends re{constructor(e){super(),oe(this,e,pe,he,ae,{role:0,privilegeList:1})}}export{Le as R};
