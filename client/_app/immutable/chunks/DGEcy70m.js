const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./D8aB4Ewb.js","./Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import{_ as Q}from"./C1FmrZbK.js";import{f as N,a as b,c as W}from"./CtfeAAbw.js";import{o as B}from"./DlIBaGjY.js";import{p as k,g as n,b as x,e as v,t as J,a as A,d as K,s as X,f as O,c as Y,r as Z}from"./B4GrenNm.js";import{i as P}from"./CSsnQ7i2.js";import{e as D,i as $}from"./BdG0KSB2.js";import{s as tt,a as et}from"./DvPjbdiY.js";import{c as ot,j as at,t as rt,r as st}from"./BRrMSDP5.js";import{s as z}from"./BPiAbArq.js";import{b as it}from"./DFQ-BVSw.js";import{s as lt}from"./CHRSknKA.js";import{a as nt}from"./fGQBOZLe.js";import{p as ct}from"./McouLZAx.js";import{L as ut}from"./DYQPks66.js";const C=60,I=6,T=lt.distributionExplorer.graphColors,mt={editable:!0,toImageButtonOptions:{format:"png"},displayModeBar:!0,modeBarButtonsToRemove:["pan2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","sendDataToCloud"]};function ft(t){const e=[];for(let o=0;o<t;o++)e.push(T[o%T.length]);return e}function L(t){return t.length>C?t.substring(0,C-3)+"...":t}function E(t,e){const o=Array(t.length).fill(I),s=[];return t.forEach((a,r)=>{a<10&&e?(o[r]=9,s[r]="< 10",t[r]=0):e?s[r]=a+" Â± 3":(o[r]=0,s[r]=a+"")}),{topBar:o,bottomBar:s}}function M(t,e){return t.map(o=>e&&o>0?o-I/2:o)}function dt(t){const e=Object.values(t.categoricalMap),{topBar:o,bottomBar:s}=E(e,t.obfuscated),a=ft(e.length),r=L(t.title),u=[{x:Object.keys(t.categoricalMap),y:M(e,t.obfuscated),name:r,type:"bar",showlegend:!1,marker:{color:a}},{x:Object.keys(t.categoricalMap),y:o,name:"Obfuscated Data",showlegend:!1,type:"bar",marker:{color:a,pattern:{shape:"/",size:20,solidity:.5}},text:s,textposition:"outside"}],m={title:{text:r},width:t.chartWidth||500,height:t.chartHeight||600,hovermode:!1,font:{family:"Nunito Sans, sans-serif"},xaxis:{title:{text:t.xaxisName},automargin:!0},yaxis:{title:{text:t.yaxisName},automargin:!0},barmode:"stack"};return{data:u,layout:m,meta:{isCategorical:!0,unformatedTitle:t.title}}}function pt(t){const e=t.obfuscated,o=[],s=[];Object.keys(t.continuousMap).sort((c,g)=>{let f=parseFloat(c.split(" -")[0]),h=parseFloat(g.split(" -")[0]);return isNaN(f)&&(f=parseFloat(c.split(" +")[0])),isNaN(h)&&(h=parseFloat(c.split(" +")[0])),f-h}).forEach(c=>{o.push(c),s.push(t.continuousMap[c])});const{topBar:a,bottomBar:r}=E(s,e),u=L(t.title),m=[{x:o,y:M(s,t.obfuscated),name:u,type:"bar",showlegend:!1,marker:{color:"#c31f3f",line:{color:"#616265",width:1}}},{x:o,y:a,name:"Obfuscated Data",showlegend:!1,type:"bar",marker:{color:"#c31f3f",pattern:{shape:"/",size:20,solidity:.5},line:{color:"#616265",width:1}},text:r,textposition:"outside"}],w={title:{text:u},width:t.chartWidth||500,height:t.chartHeight||600,autosize:!1,hovermode:!1,bargap:.01,font:{family:"Nunito Sans, sans-serif"},xaxis:{title:{text:t.xaxisName},automargin:!0},yaxis:{title:{text:t.yaxisName},automargin:!0},barmode:"stack"};return{data:m,layout:w,meta:{isCategorical:!1,unformatedTitle:t.title}}}var ht=N("<div></div>");function gt(t,e){k(e,!0);const o=e.meta.isCategorical?"Column chart showing the visualization of ":"Histogram showing the visualization of ";let s=x("");B(async()=>{e.newPlot(n(s),e.data,e.layout,{...mt,toImageButtonOptions:{filename:e.meta.unformatedTitle}})});var a=ht();it(a,r=>v(s,r),()=>n(s)),J(()=>{z(a,"id",`plot-${e.index??""}`),z(a,"aria-label",o+e.meta.unformatedTitle),z(a,"title","Visualization of "+e.meta.unformatedTitle)}),b(t,a),A()}var yt=N("<div>No Visualizations Available</div>"),bt=N('<p class="mb-8 text-center">All visualizations display the distributions of each variable filter for the specified cohort.</p> <div id="visualizations" class="flex flex-row flex-wrap gap-6 items-center justify-center"><!></div>',1);function Lt(t,e){k(e,!0);const[o,s]=tt(),a=()=>et(st,"$resources",o);let r=x(K([])),u=x(void 0),m=x(!0);const w=ct.url.pathname.includes("/discover");async function c(){const i=nt(!w,a().visualization),d=localStorage.getItem("token");await ot(at.QuerySync,{query:i.query,resourceUUID:a().visualization,resourceCredentials:d?{Authorization:"Bearer "+d}:{}}).then(l=>{v(r,[...((l==null?void 0:l.categoricalData)||[]).map(dt),...((l==null?void 0:l.continuousData)||[]).map(pt)],!0)}).catch(l=>{console.error("Viusalzation failed with query: "+JSON.stringify(i),l),rt.error({description:"An error occured while parsing your token. Please try again later. If this problem persists, please contact an administrator."})}).finally(()=>{v(m,!1)})}B(async()=>{const i=await Q(()=>import("./D8aB4Ewb.js").then(d=>d.p),__vite__mapDeps([0,1]),import.meta.url);v(u,i.newPlot,!0),await c()});var g=bt(),f=X(O(g),2),h=Y(f);{var S=i=>{ut(i,{ring:!0,size:"medium"})},V=(i,d)=>{{var l=p=>{var y=W(),F=O(y);D(F,17,()=>n(r),$,(q,_,R)=>{let H=()=>n(_).data,U=()=>n(_).layout,G=()=>n(_).meta;gt(q,{index:R,get data(){return H()},get layout(){return U()},get meta(){return G()},get newPlot(){return n(u)}})}),b(p,y)},j=p=>{var y=yt();b(p,y)};P(i,p=>{n(r).length?p(l):p(j,!1)},d)}};P(h,i=>{n(m)?i(S):i(V,!1)})}Z(f),b(t,g),A(),s()}export{Lt as V};
