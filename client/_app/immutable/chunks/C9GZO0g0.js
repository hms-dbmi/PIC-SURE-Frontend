const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CT_XtBLU.js","./Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import{_ as W}from"./C1FmrZbK.js";import{s as B,e as b,c as w,b as O,f as h,r as d,i as p,n as _,v as I,E as J,a as K,q as S,g as Q,k as X,x,B as Y}from"./CDvIr29H.js";import{S as V,i as E,g as q,a as y,b as A,t as g,d as L,e as M,m as R,f as F}from"./ByE-_V18.js";import{e as v}from"./mmDljT_r.js";import{g as Z}from"./BpCLhCzN.js";import"./4MwYNI-R.js";import{P as D}from"./Bq_4NOFD.js";import{s as $,a as C}from"./Di2X-GR-.js";import{p as tt}from"./BEf3cR2P.js";import{g as et}from"./DMy9hZg4.js";import{p as ot}from"./BYEsVfC0.js";const P=60,j=6,z=$.distributionExplorer.graphColors,at={editable:!0,toImageButtonOptions:{format:"png"},displayModeBar:!0,modeBarButtonsToRemove:["pan2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","sendDataToCloud"]};function rt(a){const t=[];for(let r=0;r<a;r++)t.push(z[r%z.length]);return t}function H(a){return a.length>P?a.substring(0,P-3)+"...":a}function U(a,t){const r=Array(a.length).fill(j),e=[];return a.forEach((o,n)=>{o<10&&t?(r[n]=9,e[n]="< 10",a[n]=0):t?e[n]=o+" Â± 3":(r[n]=0,e[n]=o+"")}),{topBar:r,bottomBar:e}}function G(a,t){return a.map(r=>t&&r>0?r-j/2:r)}function lt(a){const t=Object.values(a.categoricalMap),{topBar:r,bottomBar:e}=U(t,a.obfuscated),o=rt(t.length),n=H(a.title),l=[{x:Object.keys(a.categoricalMap),y:G(t,a.obfuscated),name:n,type:"bar",showlegend:!1,marker:{color:o}},{x:Object.keys(a.categoricalMap),y:r,name:"Obfuscated Data",showlegend:!1,type:"bar",marker:{color:o,pattern:{shape:"/",size:20,solidity:.5}},text:e,textposition:"outside"}],s={title:n,width:a.chartWidth||500,height:a.chartHeight||600,hovermode:!1,font:{family:"Nunito Sans, sans-serif"},xaxis:{title:a.xaxisName,automargin:!0},yaxis:{title:a.yaxisName,automargin:!0},barmode:"stack"};return{data:l,layout:s,meta:{isCategorical:!0,unformatedTitle:a.title}}}function nt(a){const t=a.obfuscated,r=[],e=[];Object.keys(a.continuousMap).sort((u,m)=>{let i=parseFloat(u.split(" -")[0]),f=parseFloat(m.split(" -")[0]);return isNaN(i)&&(i=parseFloat(u.split(" +")[0])),isNaN(f)&&(f=parseFloat(u.split(" +")[0])),i-f}).forEach(u=>{r.push(u),e.push(a.continuousMap[u])});const{topBar:o,bottomBar:n}=U(e,t),l=H(a.title),s=[{x:r,y:G(e,a.obfuscated),name:l,type:"bar",showlegend:!1,marker:{color:"#c31f3f",line:{color:"#616265",width:1}}},{x:r,y:o,name:"Obfuscated Data",showlegend:!1,type:"bar",marker:{color:"#c31f3f",pattern:{shape:"/",size:20,solidity:.5},line:{color:"#616265",width:1}},text:n,textposition:"outside"}],c={title:l,width:a.chartWidth||500,height:a.chartHeight||600,autosize:!1,hovermode:!1,bargap:.01,font:{family:"Nunito Sans, sans-serif"},xaxis:{title:a.xaxisName,automargin:!0},yaxis:{title:a.yaxisName,automargin:!0},barmode:"stack"};return{data:s,layout:c,meta:{isCategorical:!1,unformatedTitle:a.title}}}function it(a){let t,r,e,o;return{c(){t=b("div"),this.h()},l(n){t=w(n,"DIV",{id:!0,"aria-label":!0,title:!0}),O(t).forEach(h),this.h()},h(){d(t,"id",r="plot-"+a[0]),d(t,"aria-label",e=a[3]+a[1].unformatedTitle),d(t,"title",o="Visualization of "+a[1].unformatedTitle)},m(n,l){p(n,t,l),a[7](t)},p(n,[l]){l&1&&r!==(r="plot-"+n[0])&&d(t,"id",r),l&2&&e!==(e=n[3]+n[1].unformatedTitle)&&d(t,"aria-label",e),l&2&&o!==(o="Visualization of "+n[1].unformatedTitle)&&d(t,"title",o)},i:_,o:_,d(n){n&&h(t),a[7](null)}}}function st(a,t,r){let{index:e}=t,{data:o}=t,{meta:n}=t,{layout:l}=t,{newPlot:s}=t;const c=n.isCategorical?"Column chart showing the visualization of ":"Histogram showing the visualization of ";let u;I(async()=>{s(u,o,l,{...at,toImageButtonOptions:{filename:n.unformatedTitle}})});function m(i){J[i?"unshift":"push"](()=>{u=i,r(2,u)})}return a.$$set=i=>{"index"in i&&r(0,e=i.index),"data"in i&&r(4,o=i.data),"meta"in i&&r(1,n=i.meta),"layout"in i&&r(5,l=i.layout),"newPlot"in i&&r(6,s=i.newPlot)},[e,n,u,c,o,l,s,m]}class ct extends V{constructor(t){super(),E(this,t,st,it,B,{index:0,data:4,meta:1,layout:5,newPlot:6})}}function N(a,t,r){const e=a.slice();return e[7]=t[r].data,e[8]=t[r].layout,e[9]=t[r].meta,e[11]=r,e}function ut(a){let t,r="No Visualizations Available";return{c(){t=b("div"),t.textContent=r},l(e){t=w(e,"DIV",{"data-svelte-h":!0}),S(t)!=="svelte-1qaygid"&&(t.textContent=r)},m(e,o){p(e,t,o)},p:_,i:_,o:_,d(e){e&&h(t)}}}function ft(a){let t,r,e=v(a[0]),o=[];for(let l=0;l<e.length;l+=1)o[l]=T(N(a,e,l));const n=l=>y(o[l],1,1,()=>{o[l]=null});return{c(){for(let l=0;l<o.length;l+=1)o[l].c();t=x()},l(l){for(let s=0;s<o.length;s+=1)o[s].l(l);t=x()},m(l,s){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(l,s);p(l,t,s),r=!0},p(l,s){if(s&3){e=v(l[0]);let c;for(c=0;c<e.length;c+=1){const u=N(l,e,c);o[c]?(o[c].p(u,s),g(o[c],1)):(o[c]=T(u),o[c].c(),g(o[c],1),o[c].m(t.parentNode,t))}for(q(),c=e.length;c<o.length;c+=1)n(c);A()}},i(l){if(!r){for(let s=0;s<e.length;s+=1)g(o[s]);r=!0}},o(l){o=o.filter(Boolean);for(let s=0;s<o.length;s+=1)y(o[s]);r=!1},d(l){l&&h(t),Y(o,l)}}}function mt(a){let t,r;return t=new D({}),{c(){L(t.$$.fragment)},l(e){M(t.$$.fragment,e)},m(e,o){R(t,e,o),r=!0},p:_,i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){y(t.$$.fragment,e),r=!1},d(e){F(t,e)}}}function T(a){let t,r;return t=new ct({props:{index:a[11],data:a[7],layout:a[8],meta:a[9],newPlot:a[1]}}),{c(){L(t.$$.fragment)},l(e){M(t.$$.fragment,e)},m(e,o){R(t,e,o),r=!0},p(e,o){const n={};o&1&&(n.data=e[7]),o&1&&(n.layout=e[8]),o&1&&(n.meta=e[9]),o&2&&(n.newPlot=e[1]),t.$set(n)},i(e){r||(g(t.$$.fragment,e),r=!0)},o(e){y(t.$$.fragment,e),r=!1},d(e){F(t,e)}}}function dt(a){let t,r="All visualizations display the distributions of each variable filter for the specified cohort.",e,o,n,l,s;const c=[mt,ft,ut],u=[];function m(i,f){return i[2]?0:i[0].length?1:2}return n=m(a),l=u[n]=c[n](a),{c(){t=b("p"),t.textContent=r,e=K(),o=b("div"),l.c(),this.h()},l(i){t=w(i,"P",{class:!0,"data-svelte-h":!0}),S(t)!=="svelte-1qfu76z"&&(t.textContent=r),e=Q(i),o=w(i,"DIV",{id:!0,class:!0});var f=O(o);l.l(f),f.forEach(h),this.h()},h(){d(t,"class","mb-8 text-center"),d(o,"id","visualizations"),d(o,"class","flex flex-row flex-wrap gap-6 items-center justify-center")},m(i,f){p(i,t,f),p(i,e,f),p(i,o,f),u[n].m(o,null),s=!0},p(i,[f]){let k=n;n=m(i),n===k?u[n].p(i,f):(q(),y(u[k],1,1,()=>{u[k]=null}),A(),l=u[n],l?l.p(i,f):(l=u[n]=c[n](i),l.c()),g(l,1),l.m(o,null))},i(i){s||(g(l),s=!0)},o(i){y(l),s=!1},d(i){i&&(h(t),h(e),h(o)),u[n].d()}}}const ht="/picsure/query/sync";function gt(a,t,r){let e,o;X(a,ot,m=>r(3,o=m));const n=Z();let l=[],s;const c=o.url.pathname.includes("/discover");async function u(){const m=et(!c,C.visualization),i=localStorage.getItem("token");await tt(ht,{query:m.query,resourceUUID:C.visualization,resourceCredentials:i?{Authorization:"Bearer "+i}:{}}).then(f=>{r(0,l=[...((f==null?void 0:f.categoricalData)||[]).map(lt),...((f==null?void 0:f.continuousData)||[]).map(nt)])}).catch(f=>{console.error("Viusalzation failed with query: "+JSON.stringify(m),f),n.trigger({message:"An error occured while parsing your token. Please try again later. If this problem persists, please contact an administrator.",background:"variant-filled-error"})}).finally(()=>{r(2,e=!1)})}return I(async()=>{const m=await W(()=>import("./CT_XtBLU.js").then(i=>i.p),__vite__mapDeps([0,1]),import.meta.url);r(1,s=m.newPlot),await u()}),r(2,e=!0),[l,s,e]}class Nt extends V{constructor(t){super(),E(this,t,gt,dt,B,{})}}export{Nt as V};
