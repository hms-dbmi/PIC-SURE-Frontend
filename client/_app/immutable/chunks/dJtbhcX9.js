var Be=Object.defineProperty;var Te=r=>{throw TypeError(r)};var Ue=(r,e,l)=>e in r?Be(r,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[e]=l;var ge=(r,e,l)=>Ue(r,typeof e!="symbol"?e+"":e,l),Xe=(r,e,l)=>e.has(r)||Te("Cannot "+l);var D=(r,e,l)=>(Xe(r,e,"read from private field"),l?l.call(r):e.get(r)),de=(r,e,l)=>e.has(r)?Te("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,l);import{a5 as Ge,b8 as Ke,bb as Qe,p as le,f as y,d as o,a as ae,s as v,k as t,r as s,b as m,t as W,c as oe,e as we,u as se,i as $,h as J,l as u,n as Ye}from"./DhSNEPDw.js";import"./Bzak7iHL.js";import{w as me,g as ie,o as Ze}from"./xU7jw7XU.js";import{s as U,d as Ae}from"./DVtHS8ol.js";import{i as k}from"./BG76zvuN.js";import{b as Z,r as xe,s as Pe,d as Re,h as De,a as $e,c as et}from"./aV0zye_u.js";import{b as Ce}from"./DPXw0ygh.js";import{p as Q,s as Me,c as ve}from"./DpjY2ypC.js";import{t as he}from"./M2p3ZkHt.js";import{i as tt,j as Ve,A as at,k as rt,l as it,m as nt}from"./Bji3XOvx.js";import{c as je,d as st}from"./CHznAy_H.js";import{p as Ie}from"./B1n7kAsq.js";import{L as Fe}from"./CzbepVLR.js";import{O as lt}from"./CFI1XfO6.js";import{a as ot}from"./Jhkhy7E3.js";import{e as ze,i as He}from"./ByI6iVq5.js";import{M as dt}from"./BinYu0ZY.js";import{p as ct}from"./Jem-ehAR.js";import{E as ft}from"./CQQkdEes.js";const vt=[];function _a(r,e=!1,l=!1){return fe(r,new Map,"",vt,null,l)}function fe(r,e,l,N,a=null,A=!1){if(typeof r=="object"&&r!==null){var M=e.get(r);if(M!==void 0)return M;if(r instanceof Map)return new Map(r);if(r instanceof Set)return new Set(r);if(Ge(r)){var c=Array(r.length);e.set(r,c),a!==null&&e.set(a,c);for(var i=0;i<r.length;i+=1){var F=r[i];i in r&&(c[i]=fe(F,e,l,N,null,A))}return c}if(Ke(r)===Qe){c={},e.set(r,c),a!==null&&e.set(a,c);for(var S in r)c[S]=fe(r[S],e,l,N,null,A);return c}if(r instanceof Date)return structuredClone(r);if(typeof r.toJSON=="function"&&!A)return fe(r.toJSON(),e,l,N,r)}if(r instanceof EventTarget)return r;try{return structuredClone(r)}catch{return r}}var ut=y('<div><span class="font-bold">Name:</span> </div>'),mt=y('<div><span class="font-bold mb-1">Accession:</span> </div>'),_t=y('<div><span class="font-bold mb-1">Type:</span> </div>'),pt=y('<div><span class="font-bold">Description:</span> </div>'),bt=y('<div><span class="font-bold mb-1">Name:</span> </div>'),yt=y('<div><span class="font-bold">Accession:</span> </div>'),gt=y('<div><span class="font-bold">Description:</span> </div>'),xt=y('<section data-testid="dataset-info" class="flex flex-col w-3/4 p-4"><h3 class="text-primary-500">Dataset Information</h3> <div class="w-full flex flex-row justify-between"><!> <!></div> <!></section>'),ht=y('<div><span class="font-bold mb-1">Study Name:</span> </div>'),wt=y('<div><span class="font-bold">Study Accession:</span> </div>'),At=y('<section data-testid="study-info" class="flex flex-col w-3/4 p-4"><h3 class="text-primary-500">Study Information</h3> <div class="w-full flex flex-col"><!> <!></div></section>'),Ft=y('<section data-testid="variable-info" class="flex flex-col w-3/4 p-4"><h3 class="text-primary-500">Variable Information</h3> <div class="w-full flex flex-row justify-between"><!> <!> <!></div> <!></section> <!> <!>',1),Ot=y('<div class="card bg-surface-100 min-h-60 p-4"><div class="card-body"><!></div></div>');function kt(r,e){le(e,!0);let l=Q(e,"data",19,()=>({})),N=je(l().conceptPath,l().dataset);var a=Ot(),A=o(a),M=o(A);ot(M,()=>N,c=>{Fe(c,{ring:!0,size:"medium"})},(c,i)=>{var F=Ft(),S=ae(F),_=v(o(S),2),C=o(_);{var E=g=>{var h=ut(),L=v(o(h));s(h),W(()=>U(L,` ${t(i).display??""}`)),m(g,h)};k(C,g=>{t(i).display&&g(E)})}var p=v(C,2);{var x=g=>{var h=mt(),L=v(o(h));s(h),W(()=>U(L,` ${t(i).name??""}`)),m(g,h)};k(p,g=>{t(i).name&&g(x)})}var V=v(p,2);{var B=g=>{var h=_t(),L=v(o(h));s(h),W(()=>U(L,` ${t(i).type??""}`)),m(g,h)};k(V,g=>{t(i).type&&g(B)})}s(_);var G=v(_,2);{var R=g=>{var h=pt(),L=v(o(h));s(h),W(()=>U(L,` ${t(i).description??""}`)),m(g,h)};k(G,g=>{t(i).description&&g(R)})}s(S);var ee=v(S,2);{var re=g=>{var h=xt(),L=v(o(h),2),d=o(L);{var T=b=>{var O=bt(),q=v(o(O));s(O),W(()=>U(q,` ${t(i).table.display??""}`)),m(b,O)};k(d,b=>{t(i).table.display&&b(T)})}var j=v(d,2);{var n=b=>{var O=yt(),q=v(o(O));s(O),W(()=>U(q,` ${t(i).table.name??""}`)),m(b,O)};k(j,b=>{t(i).table.name&&b(n)})}s(L);var w=v(L,2);{var f=b=>{var O=gt(),q=v(o(O));s(O),W(()=>U(q,` ${t(i).table.description??""}`)),m(b,O)};k(w,b=>{t(i).table.description&&b(f)})}s(h),m(g,h)};k(ee,g=>{t(i).table&&g(re)})}var Y=v(ee,2);{var K=g=>{var h=At(),L=v(o(h),2),d=o(L);{var T=w=>{var f=ht(),b=v(o(f));s(f),W(()=>{var O;return U(b,` ${(t(i).study.fullName||t(i).study.display||t(i).study.studyAcronym||((O=t(i))==null?void 0:O.studyAcronym))??""}`)}),m(w,f)};k(d,w=>{var f;(t(i).study.fullName||t(i).study.display||t(i).study.studyAcronym||(f=t(i))!=null&&f.studyAcronym)&&w(T)})}var j=v(d,2);{var n=w=>{var f=wt(),b=v(o(f));s(f),W(()=>U(b,` ${t(i).study.ref??""}`)),m(w,f)};k(j,w=>{t(i).study.ref&&w(n)})}s(L),s(h),m(g,h)};k(Y,g=>{t(i).study&&g(K)})}m(c,F)}),s(A),s(a),m(r,a),oe()}var Nt=y('<i class="fa-solid fa-angle-left fa-xl -rotate-45 self-center"></i>'),St=(r,e)=>e.node.select(),Tt=y('<details class="tree-item" open><summary class="tree-item-summary list-none [&amp;::-webkit-details-marker]:hidden flex items-center cursor-pointer rounded-container p-0 hover:preset-tonal-primary space-x-1 w-full mr-2" role="treeitem"><!> <input type="radio" name="tree-radio"/> <label class="w-full"> </label></summary> <div class="tree-item-children ml-4" role="group"><!></div></details>');function We(r,e){le(e,!0);const l=Q(e,"isRoot",3,!1),N=Q(e,"disabled",3,!1);var a=Tt(),A=o(a);Z(A,"aria-expanded",!0);var M=o(A);{var c=p=>{var x=Nt();W(()=>$e(x,`margin-left: ${(e.index+1)*9}px;`)),m(p,x)};k(M,p=>{l()||p(c)})}var i=v(M,2);xe(i),i.__click=[St,e];var F=v(i,2),S=o(F,!0);s(F),s(A);var _=v(A,2),C=o(_);{var E=p=>{var x=we(),V=ae(x);ze(V,17,()=>e.node.children,He,(B,G)=>{{let R=se(()=>e.index+1);We(B,{get node(){return t(G)},get index(){return t(R)},get disabled(){return N()}})}}),m(p,x)};k(C,p=>{e.node.isLeaf||p(E)})}s(_),s(a),W(()=>{Z(a,"data-testid",`tree-item:${e.node.name??""}-${e.node.value??""}`),Z(a,"aria-disabled",e.node.disabled||N()),Z(A,"aria-selected",e.node.selected),Z(i,"id",`radio:${e.node.name??""}`),Z(i,"data-testid",`radio:${e.node.name??""}`),Pe(i,1,`radio tree-item-radio self-center ${l()?"ml-[28px]":""}`),Re(i,e.node.value),i.disabled=e.node.disabled||N(),De(i,e.node.selected),Z(F,"for",`${e.node.isLeaf?"radio:":"tree-item-btn:"}${e.node.name??""}`),U(S,e.node.name),Z(_,"data-testid",`tree-item-children:${e.node.name??""}`)}),m(r,a),oe()}Ae(["click"]);var Ct=y("<div></div>");function Et(r,e){var S,_,C;le(e,!0);let l=Q(e,"nodes",19,()=>[]),N=Q(e,"fullWidth",3,!1),a=Q(e,"onselect",3,()=>{}),A=Q(e,"disableTree",3,!1);class M{constructor(p,x,V=[],B=!1,G=!1){ge(this,"name","");ge(this,"value","");de(this,S,J(!1));de(this,_,J(A()));de(this,C,J($([])));this.name=p,this.value=x,this.children=V,this.selected=B||this.isLeaf,this.disabled=G}get selected(){return t(D(this,S))}set selected(p){u(D(this,S),p,!0)}get disabled(){return t(D(this,_))}set disabled(p){u(D(this,_),p,!0)}get children(){return t(D(this,C))}set children(p){u(D(this,C),p,!0)}get isLeaf(){return this.children.length===0}select(){this.disabled||(i.forEach(p=>{const x=V=>{V!==this&&(V.selected=!1,V.children.forEach(x))};x(p)}),this.selected=!0,a()(this.value))}}S=new WeakMap,_=new WeakMap,C=new WeakMap;function c(E){const{name:p,value:x,selected:V}=E;let B=[];return E.children.length>0&&(B=E.children.map(c)),new M(p,x,B,V)}let i=$(l().map(c));var F=Ct();ze(F,21,()=>i,He,(E,p,x)=>{We(E,{get node(){return t(p)},index:x,get disabled(){return A()},isRoot:x===0})}),s(F),W(()=>Pe(F,1,et(N()?"w-full":""))),m(r,F),oe()}async function Lt(r,e,l,N,a,A,M){if(!t(e)){u(e,!0);try{const c=await st(l().dataset,N,t(a));let i;const F={conceptPath:t(a),display:t(a).split("\\").filter(Boolean).pop()||t(a),name:t(a),allowFiltering:!0,dataset:l().dataset,studyAcronym:l().studyAcronym,description:`Any Record of ${t(a)}`,meta:l().meta,study:l().study,table:l().table,type:"AnyRecordOf"};i=tt(F,c),Ve(i),A()}catch(c){c instanceof at&&c.message==="Too many concept paths found"?u(M,!0):(console.error("Error adding selection: ",c instanceof Error?c.message:c),he.error({description:"Something went wrong when adding the filter. If the problem persists, please contact your administrator."}))}finally{u(e,!1)}}}var Pt=(r,e)=>u(e,!1),Mt=y(`<div data-testid="hierarchy-component-error-modal-content"><p class="m-0">The level of the data tree you selected exceeds 9,500 variables. This was not added as a
      filter to your query. Please make a selection lower in the data tree and try again.</p> <div class="flex justify-center mt-4"><button class="btn preset-filled-primary-500">Okay</button></div></div>`),Vt=y('<p class="m-0">Filtering is not available for this variable</p>'),jt=y('<i class="fas fa-warning"></i> <span class="sr-only">Filtering is not available for this variable</span>',1),It=y('<i class="fas fa-plus"></i>'),zt=y('<!> <div data-testid="hierarchy-component" class="flex flex-row justify-between bg-surface-100 p-4 rounded-container"><div class="flex flex-col gap-2"><!> <!></div> <button class="btn btn-icon preset-filled-primary-500 m-1" data-testid="add-filter"><!></button></div>',1);function Ht(r,e){le(e,!0);const[l,N]=Me(),a=100;let A=Q(e,"data",19,()=>({})),M=Q(e,"onclose",3,()=>{}),c=J(!1),i=se(()=>{var d;return!((d=A())!=null&&d.allowFiltering)&&ct.url.pathname.includes("/discover")}),F=$(A().conceptPath.split("\\").reduce((d,T,j,n)=>j===0&&T===""||j===n.length-1&&T===""?d:[...d,T],[])),S=$(_());function _(){if(!F.length)return null;let d=null;for(let T=F.length-1;T>=0;T--)d={name:F[T],value:`\\${F.slice(0,T+1).join("\\")}\\`,children:d?[d]:[],open:!0,selected:!1};return d}let C=J($(A().conceptPath)),E=J(!1);function p(){ve(ne,""),ve(Ie,!0),M()()}var x=zt(),V=ae(x);dt(V,{"data-testid":"hierarchy-component-error-modal",title:"Data tree selection too large",closeable:!0,width:"w-1/2",get open(){return t(c)},set open(d){u(c,d,!0)},children:(d,T)=>{var j=Mt(),n=v(o(j),2),w=o(n);w.__click=[Pt,c],s(n),s(j),m(d,j)},$$slots:{default:!0}});var B=v(V,2),G=o(B),R=o(G);{var ee=d=>{ft(d,{color:"warning",children:(T,j)=>{var n=Vt();m(T,n)},$$slots:{default:!0}})};k(R,d=>{t(i)&&d(ee)})}var re=v(R,2);{var Y=d=>{{let T=se(()=>[S]);Et(d,{fullWidth:!0,get nodes(){return t(T)},get disableTree(){return t(i)},onselect:j=>u(C,j,!0)})}};k(re,d=>{S&&d(Y)})}s(G);var K=v(G,2);K.__click=[Lt,E,A,a,C,p,c];var g=o(K);{var h=d=>{Fe(d,{size:"micro",color:"white"})},L=d=>{var T=we(),j=ae(T);{var n=f=>{var b=jt();Ye(2),m(f,b)},w=f=>{var b=It();m(f,b)};k(j,f=>{t(i)?f(n):f(w,!1)},!0)}m(d,T)};k(g,d=>{t(E)?d(h):d(L,!1)})}s(K),s(B),W(()=>{Z(K,"aria-label",t(E)?"Adding Filter...":"Add Filter"),K.disabled=t(E)||t(i)}),m(r,x),oe(),N()}Ae(["click"]);const ue={filter:()=>Qt,info:()=>kt,hierarchy:()=>Ht},Ee=me(""),ne=me(""),Le=me(ue.info()),ce=me(ue.info());function pa(r){const{row:e,table:l,component:N}=r,a=ie(ne)===e,A=!N||ie(ce)===ue[N](),M=!l||ie(Ee)===l;a&&A&&M?(ne.set(""),ce.set(ie(Le))):(ne.set(e),l&&Ee.set(l),N?ce.set(ue[N]()):ce.set(ie(Le)))}var Wt=y('<div class="variable-name"> </div>'),qt=y('<div class="variable-desc"> </div>'),Jt=y('<div class="variable-study"> </div>'),Bt=y('<div class="variable-info"><!> <!> <!></div>'),Ut=y('<div data-testid="categoical-filter" class="w-full"><!></div>'),Xt=y('<div class="card bg-surface-100 p-3 m-1 w-full"><section class="card-body flex grow gap-4" data-testid="numerical-filter"><label class="flex-auto flex-col"><span> </span> <input id="min" data-testid="min-input" type="text" placeholder="Enter value or leave blank for variable min" class="input"/></label> <label class="flex-auto flex-col"><span> </span> <input id="max" data-testid="max-input" type="text" placeholder="Enter value or leave blank for variable max" class="input"/></label></section></div>'),Gt=y('<!> <button class="btn btn-icon preset-filled-primary-500 m-1 svelte-ioyacr" data-testid="add-filter" aria-label="Add Filter"><i class="fas fa-plus"></i></button>',1),Kt=y('<div><!> <div class="flex justify-between" data-testid="filter-component"><!></div></div>');function Qt(r,e){le(e,!0);const[l,N]=Me();let a=Q(e,"data",23,()=>({})),A=Q(e,"onclose",3,()=>{}),M=J(""),c=J(""),i=J(""),F=J(""),S=20,_=J($([])),C=J($([])),E=S,p="",x=J(!1),V=J(""),B=J(""),G=J("");Ze(async()=>{var n,w,f,b,O,q,X;if(e.existingFilter)u(V,((n=a())==null?void 0:n.display)||"",!0),u(B,((w=a())==null?void 0:w.description)||"",!0),u(G,a().studyAcronym&&a().dataset?`${a().studyAcronym} (${a().dataset})`:a().studyAcronym||a().dataset||"",!0),e.existingFilter.filterType==="Categorical"?(e.existingFilter.categoryValues.length===0?u(C,((f=a())==null?void 0:f.values)||[],!0):u(C,e.existingFilter.categoryValues,!0),u(_,((O=(b=a())==null?void 0:b.values)==null?void 0:O.filter(I=>!t(C).find(P=>P===I)))||[],!0),t(_).length>=50&&u(_,t(_).slice(0,S),!0)):e.existingFilter.filterType==="numeric"&&(u(i,e.existingFilter.min!==void 0&&e.existingFilter.min!==null?e.existingFilter.min.toString():"",!0),u(F,e.existingFilter.max!==void 0&&e.existingFilter.max!==null?e.existingFilter.max.toString():"",!0));else if(((q=a())==null?void 0:q.type)==="Categorical")try{u(x,!0),a(await je(a().conceptPath,a().dataset)),u(x,!1),u(_,((X=a())==null?void 0:X.values)||[],!0),t(_).length>=50&&u(_,t(_).slice(0,S),!0)}catch(I){console.error(I),he.error({title:"An error occured while loading the filter. Please try again later."})}u(c,a().min!==void 0&&a().min!==null?a().min.toString():"",!0),u(M,a().max!==void 0&&a().max!==null?a().max.toString():"",!0)});function R(){var w,f;let n;if(a().type==="Categorical"){if(!t(Y)||t(Y).length===0)return;t(Y).length===((f=(w=a())==null?void 0:w.values)==null?void 0:f.length)?n=rt(a()):n=it(a(),t(Y))}else n=nt(a(),t(i)||void 0,t(F)||void 0);n&&(Ve(n),ee())}function ee(){ve(ne,""),ve(Ie,!0),A()()}function re(n=""){var f,b,O;if((((b=(f=a())==null?void 0:f.values)==null?void 0:b.length)||0)!==0){u(x,!0);try{let q=((O=a())==null?void 0:O.values)||[];(n!==p||!p.includes(n))&&(E=0,u(_,[],!0),p=n);let X=q.filter(z=>!t(C).includes(z)&&(!n||z.toLowerCase().includes(n.toLowerCase())));const I=Math.min(E+S,X.length),P=X.slice(E,I);u(_,[...t(_),...P],!0),E=I}catch(q){console.error(q),he.error({title:"An error occurred while loading more options. Please try again later."})}u(x,!1)}}let Y=se(()=>t(C).map(n=>n));var K=Kt(),g=o(K);{var h=n=>{var w=Bt(),f=o(w);{var b=P=>{var z=Wt(),H=o(z);s(z),W(()=>U(H,`Variable Name: ${t(V)??""}`)),m(P,z)};k(f,P=>{t(V)&&P(b)})}var O=v(f,2);{var q=P=>{var z=qt(),H=o(z);s(z),W(()=>U(H,`Variable Description: ${t(B)??""}`)),m(P,z)};k(O,P=>{t(B)&&P(q)})}var X=v(O,2);{var I=P=>{var z=Jt(),H=o(z);s(z),W(()=>U(H,`Study: ${t(G)??""}`)),m(P,z)};k(X,P=>{t(G)&&P(I)})}s(w),m(n,w)};k(g,n=>{a()&&n(h)})}var L=v(g,2),d=o(L);{var T=n=>{Fe(n,{ring:!0,size:"medium"})},j=n=>{var w=Gt(),f=ae(w);{var b=X=>{var I=Ut(),P=o(I);{let z=se(()=>{var H;return(H=a())==null?void 0:H.values});lt(P,{get allOptions(){return t(z)},onscroll:re,get unselectedOptions(){return t(_)},set unselectedOptions(H){u(_,H,!0)},get selectedOptions(){return t(C)},set selectedOptions(H){u(C,H,!0)},get currentlyLoading(){return t(x)},set currentlyLoading(H){u(x,H,!0)}})}s(I),m(X,I)},O=X=>{var I=we(),P=ae(I);{var z=H=>{var te=Xt(),Oe=o(te),_e=o(Oe),pe=o(_e),qe=o(pe);s(pe);var ke=v(pe,2);xe(ke),s(_e);var Ne=v(_e,2),be=o(Ne),Je=o(be);s(be);var Se=v(be,2);xe(Se),s(Ne),s(Oe),s(te),W(()=>{U(qe,`Min: ${t(c)??""}`),U(Je,`Max: ${t(M)??""}`)}),Ce(ke,()=>t(i),ye=>u(i,ye)),Ce(Se,()=>t(F),ye=>u(F,ye)),m(H,te)};k(P,H=>{var te;((te=a())==null?void 0:te.type)==="Continuous"&&H(z)},!0)}m(X,I)};k(f,X=>{var I;((I=a())==null?void 0:I.type)==="Categorical"?X(b):X(O,!1)})}var q=v(f,2);q.__click=R,W(()=>q.disabled=a().type==="Categorical"&&t(Y).length===0),m(n,w)};k(d,n=>{a()?n(j,!1):n(T)})}s(L),s(K),m(r,K),oe(),N()}Ae(["click"]);export{Qt as A,_a as a,ne as b,Ee as c,ce as d,pa as s};
