import{w as o,g as n}from"./B9BhT3Ut.js";import{e as S,f as y,h as w,t as C}from"./tvkVmxlD.js";import{b as d}from"./i859GThY.js";import{g as P,S as a,c as h}from"./BnndZ7_C.js";import{f as b}from"./Drejzb63.js";import{s as R,a as q}from"./D3-cXwBU.js";const v=100,r=new Map,E=o(!1),g=o([]);o(Promise.resolve());const c=o(!1),M=o(0);async function _(f){var m,u;S();try{r.size>=v&&r.clear();const s=JSON.stringify([f,n(R),n(q).map(t=>t.name),n(b).map(({uuid:t})=>t)]);if(r.has(s)){g.set(r.get(s)),c.set(!1);return}await n(y);const l=P(f,((u=(m=d)==null?void 0:m.results)==null?void 0:u.stats)||[]);g.set(l),c.set(!0),Promise.allSettled(l.flatMap(a.list).map(({promise:t})=>t)).then(t=>{t.some(a.rejected)||r.set(s,l),E.set(t.some(e=>a.fullfiled(e)&&`${h([e.value])}`!="0")),c.set(!1)});const p=l.find(t=>{var e,i;return t.key===((i=(e=d)==null?void 0:e.results)==null?void 0:i.totalStatKey)});p&&Promise.allSettled(a.list(p).map(({promise:t})=>t)).then(t=>{const e=t.filter(a.fullfiled).map(({value:i})=>i);M.set(h(e,!1))})}catch(s){console.error(s),c.set(!1),w("query-error")||C.error({id:"query-error",duration:4e3,title:"An error occured while loading patient counts. If this problem persists, please contact an administrator.",closable:!0})}}export{c,E as h,_ as l,g as r,M as t};
