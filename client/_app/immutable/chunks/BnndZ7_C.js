import{c,k as a,r as O,v as b,j as g}from"./tvkVmxlD.js";import{f as q,b as p}from"./i859GThY.js";import{g as R}from"./B9BhT3Ut.js";import{b as j}from"./D3-cXwBU.js";import{g as P,a as _}from"./CEG0RrrK.js";async function U(){var n;const e=await c(`${a.Search}/${R(O).hpdsOpen}`,{query:"\\_studies_consents\\"});return Object.keys((n=e==null?void 0:e.results)==null?void 0:n.phenotypes)}const C="Â±";function v(e){let t,n;if(String(e).startsWith("<"))n=3,t=0;else{const[r,s]=String(e).split(C);t=parseInt(r.replaceAll(",",""))||0,n=parseInt(s??"")||0}return{value:t,suffix:n}}function F(e){return e.flatMap(t=>typeof t=="object"?Object.values(t):t)}function T(e,t=!0){var u;const n=F(e);if(n.length===0)return q.federated?t?"0":0:void 0;if(n.length===1&&((u=n[0])!=null&&u.toString().startsWith("<")))return n[0];const r=n.map(v),s=r.reduce((i,{value:l})=>l>0?i+l:i,0),o=Math.max(...r.map(({suffix:i})=>i),0);return t?o>0?`${s.toLocaleString()}${C}${o}`:s.toLocaleString():s}function f(e){return e!=null&&e.errorType?Promise.reject("api error"):e}const B={list:e=>Object.entries(e.result).map(([t,n])=>({promise:n,resourceName:t})),rejected:e=>e.status==="rejected",fullfiled:e=>e.status==="fulfilled",valueOrZero:e=>e.status==="fulfilled"?e.value:0};function m(e){var n,r,s;return((n=p)!=null&&n.statFields?Object.keys((r=p)==null?void 0:r.statFields):[]).includes(e)?(s=p)==null?void 0:s.statFields[e]:[]}function S(e=!1){const t={facets:[],search:"",consents:[]};return e?t:j(t)}function k(e){return function({isOpenAccess:t}){const n=S(t);return c(a.Facets,n).then(r=>{const s=r.find(u=>u.name===e);return s?t?s.facets.length:s.facets.filter(u=>u.count>0).length:0}).then(f)}}function Q({isOpenAccess:e}){const t=S(e);return c(`${a.Concepts}?page_number=1&page_size=1`,t).then(n=>n.totalElements||Promise.reject("total not found"))}function w({request:e}){return c(a.QuerySync,e).then(f)}function x({stat:e}){return Promise.resolve((e==null?void 0:e.value)||0)}async function L(e){const t={...e.request};t.query.expectedResultType="CROSS_COUNT";const n=await U();return t.query.setCrossCountFields(n),c(a.QuerySync,t).then(f).then(r=>T([r["\\_studies_consents\\"]||0]))}function M(e){const t={...e.request};return t.query.expectedResultType="COUNT",c(a.QuerySync,t).then(f)}function N(e){return e.isOpenAccess?L(e):M(e)}function h(e,t){return function(n){const r=m(e).map(o=>o.conceptPath);if(r.length===0)return Promise.reject(`${e} feilds were not configured`);const s={...n.request};return s.query.expectedResultType=t,s.query.setCrossCountFields(r),c(a.QuerySync,s).then(f)}}function $(e){return function(t){const n=m("query:consent");if(n.length===0)return Promise.reject("consent feilds were not configured");const r=n.reduce((o,u)=>({...o,[u.conceptPath]:[...o[u.conceptPath]||[],u.id]}),{}),s={...t.request};return s.query.expectedResultType=e,Object.entries(r).forEach(([o,u])=>s.query.addCategoryFilter(o,u)),c(a.QuerySync,s).then(f)}}const d={"dict:facets:dataset_id":k("dataset_id"),"dict:concepts":Q,"query:blank":w,"query:biosample":h("query:biosample","OBSERVATION_CROSS_COUNT"),"query:genomic":h("query:genomic","CROSS_COUNT"),"query:consent":$("COUNT"),"query:patientCount":N,hardcoded:x};function K(e){const t=e.filter(n=>!!d[n.key]);return e.length===0?[]:t.reduce((n,r)=>{const s=[...n],o=(r==null?void 0:r.auth)===void 0?!0:r.auth,u=(r==null?void 0:r.auth)===void 0?!0:!r.auth;return o&&b()&&s.push({...r,auth:!0,result:{}}),q.login.open&&u&&s.push({...r,auth:!1,result:{}}),s},[])}function W(e){return e.map(t=>{const n=!t.auth;return{...t,result:g(n).reduce((r,{name:s,uuid:o})=>{const u={...r};return u[s]=d[t.key]({isOpenAccess:n,stat:t,request:P(n,o)}),u},{})}})}function Z(e,t){const n=t.filter(r=>!!d[r.key]);return n.length===0?[]:n.reduce((r,s)=>{const o=[...r];return o.push({...s,auth:!e,result:g(e).reduce((u,{name:i,uuid:l})=>{const y={...u};return y[i]=d[s.key]({isOpenAccess:e,stat:s,request:_(!e,l)}),y},{})}),o},[])}export{B as S,m as a,K as b,T as c,Z as g,W as p};
