var ne=Object.defineProperty;var Q=s=>{throw TypeError(s)};var le=(s,e,t)=>e in s?ne(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var n=(s,e,t)=>le(s,typeof e!="symbol"?e+"":e,t),oe=(s,e,t)=>e.has(s)||Q("Cannot "+t);var i=(s,e,t)=>(oe(s,e,"read from private field"),t?t.call(s):e.get(s)),l=(s,e,t)=>e.has(s)?Q("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);import{w as g,g as d}from"./DlIBaGjY.js";import{p as se}from"./McouLZAx.js";import{c as U,j as O,u as ce,g as he}from"./BRrMSDP5.js";import{b as u,g as c,e as h,d as m,h as p}from"./B4GrenNm.js";import"./CtfeAAbw.js";import{d as b}from"./D7VV4X-8.js";b(["click"]);b(["click"]);b(["input"]);b(["click"]);b(["input"]);b(["change"]);class ue{constructor(){n(this,"listeners",{change:[],clearFilters:[],clearSearch:[]});n(this,"queue",new Set)}add(e,t){this.listeners[e].push(t)}async dispatch(e){this.queue.add(e),await new Promise(t=>setTimeout(t,40)),this.queue.size>0&&this.run(),this.queue.clear()}run(){for(const e of this.queue)for(const t of this.listeners[e])t()}}var S,H,y,C,R,F,T,E,A,$,x,I,q,B,D,z,N;class de{constructor(e,t){n(this,"selectBy");n(this,"event",new ue);l(this,S,u(""));l(this,H,u(m({})));l(this,y,u(void 0));l(this,C,u(!1));l(this,R,u(10));l(this,F,u(1));l(this,T,u(m([])));l(this,E,p(()=>this.filters.length));l(this,A,u(m([])));l(this,$,p(()=>this.createRowCount()));l(this,x,p(()=>this.createPages()));l(this,I,p(()=>this.createPageCount()));l(this,q,p(()=>this.createPagesWithEllipsis()));l(this,B,u(m([])));l(this,D,p(()=>this.createIsAllSelected()));l(this,z,u(void 0));l(this,N,u(1e3));this.rows=e,this.selectBy=t.selectBy??void 0,this.totalRows=t.totalRows,this.rowsPerPage=t.rowsPerPage??10}get search(){return c(i(this,S))}set search(e){h(i(this,S),e,!0)}get sort(){return c(i(this,H))}set sort(e){h(i(this,H),e,!0)}get totalRows(){return c(i(this,y))}set totalRows(e){h(i(this,y),e,!0)}get isLoading(){return c(i(this,C))}set isLoading(e){h(i(this,C),e,!0)}get rowsPerPage(){return c(i(this,R))}set rowsPerPage(e){h(i(this,R),e,!0)}get currentPage(){return c(i(this,F))}set currentPage(e){h(i(this,F),e,!0)}get filters(){return c(i(this,T))}set filters(e){h(i(this,T),e,!0)}get filterCount(){return c(i(this,E))}set filterCount(e){h(i(this,E),e)}get rows(){return c(i(this,A))}set rows(e){h(i(this,A),e,!0)}get rowCount(){return c(i(this,$))}set rowCount(e){h(i(this,$),e)}get pages(){return c(i(this,x))}set pages(e){h(i(this,x),e)}get pageCount(){return c(i(this,I))}set pageCount(e){h(i(this,I),e)}get pagesWithEllipsis(){return c(i(this,q))}set pagesWithEllipsis(e){h(i(this,q),e)}get selected(){return c(i(this,B))}set selected(e){h(i(this,B),e,!0)}get isAllSelected(){return c(i(this,D))}set isAllSelected(e){h(i(this,D),e)}get element(){return c(i(this,z))}set element(e){h(i(this,z),e,!0)}get clientWidth(){return c(i(this,N))}set clientWidth(e){h(i(this,N),e,!0)}getState(){return{currentPage:this.currentPage,rowsPerPage:this.rowsPerPage,offset:this.rowsPerPage*(this.currentPage-1),search:this.search,sort:this.sort.field?this.sort:void 0,filters:this.filters.length>0?this.filters:void 0,setTotalRows:e=>this.totalRows=e}}createPages(){return!this.rowsPerPage||!this.totalRows?void 0:Array.from(Array(Math.ceil(this.totalRows/this.rowsPerPage))).map((t,r)=>r+1)}createPageCount(){if(this.pages)return this.pages.length}createPagesWithEllipsis(){if(!this.pages)return;if(this.pageCount<=7)return this.pages;const e=null,t=1,r=this.pageCount;return this.currentPage<=4?[...this.pages.slice(0,5),e,r]:this.currentPage<this.pageCount-3?[t,e,...this.pages.slice(this.currentPage-2,this.currentPage+1),e,r]:[t,e,...this.pages.slice(this.pageCount-5,this.pageCount)]}createRowCount(){return!this.rowsPerPage||!this.totalRows?{total:void 0,start:void 0,end:void 0,selected:this.selected.length}:{total:this.totalRows,start:this.currentPage*this.rowsPerPage-this.rowsPerPage+1,end:Math.min(this.currentPage*this.rowsPerPage,this.totalRows),selected:this.selected.length}}createIsAllSelected(){return this.rows.length===0?!1:this.rows.map(t=>t[this.selectBy]).every(t=>this.selected.includes(t))}}S=new WeakMap,H=new WeakMap,y=new WeakMap,C=new WeakMap,R=new WeakMap,F=new WeakMap,T=new WeakMap,E=new WeakMap,A=new WeakMap,$=new WeakMap,x=new WeakMap,I=new WeakMap,q=new WeakMap,B=new WeakMap,D=new WeakMap,z=new WeakMap,N=new WeakMap;class ge{constructor(e){n(this,"table");n(this,"reload");this.table=e}set(e){this.reload=e}async invalidate(){if(!this.reload)return;this.table.isLoading=!0;const e=this.table.getState(),t=await this.reload(e);this.table.isLoading=!1,t&&(this.table.rows=t)}}class fe{constructor(e){n(this,"table");this.table=e}set(e){const t=this.table.sort;!t||t.field!==e?this.asc(e):t.direction==="asc"?this.desc(e):t.direction==="desc"&&this.asc(e)}asc(e){this.table.sort={field:e,direction:"asc"},this.table.setPage(1)}desc(e){this.table.sort={field:e,direction:"desc"},this.table.setPage(1)}}class pe{constructor(e){n(this,"table");this.table=e}set(e){this.table.selected.includes(e)?this.table.selected=this.table.selected.filter(t=>t!==e):this.table.selected=[e,...this.table.selected]}all(){const e=this.table.rows.map(t=>t[this.table.selectBy]);this.table.isAllSelected?this.table.selected=this.table.selected.filter(t=>e.includes(t)===!1):this.table.selected=[...new Set([...e,...this.table.selected])]}clear(){this.table.selected=[]}}class we{constructor(e){n(this,"table");this.table=e}goto(e){this.table.rowsPerPage&&this.table.totalRows?e>=1&&e<=this.table.pageCount&&(this.table.currentPage=e,this.table.event.dispatch("change"),this.table.invalidate()):e>=1&&(this.table.currentPage=e,this.table.event.dispatch("change"),this.table.invalidate())}previous(){this.goto(this.table.currentPage-1)}next(){this.goto(this.table.currentPage+1)}}class be{constructor(e){n(this,"table");this.table=e}clear(){this.table.event.dispatch("clearSearch")}}class me{constructor(e){n(this,"table");this.table=e}set(e,t){this.table.filters=this.table.filters.filter(r=>r.field!==t&&r.value),e&&this.table.filters.push({value:e,field:t})}unset(e){this.table.filters=this.table.filters.filter(t=>t.field!==e)}clear(){this.table.filters=[],this.table.event.dispatch("clearFilters")}}var W;class Pe{constructor(e,t){l(this,W,u(m([])));n(this,"table");n(this,"interval");n(this,"mutation");this.table=e,this.columns=[],this.interval=setInterval(()=>this.createColumns(t),200)}get columns(){return c(i(this,W))}set columns(e){h(i(this,W),e,!0)}toggle(e){if(!this.table.element)return;const t=this.columns.find(r=>r.name===e);t&&t.toggle()}createColumns(e){var t;(t=this.table)!=null&&t.element&&(clearInterval(this.interval),this.columns=e.map(({name:r,index:a,isVisible:o,isFrozen:f})=>({name:r,index:a,isVisible:o!==!1,isFrozen:f===!0,element:this.table.element,toggle(){this.isVisible=!this.isVisible,this.element.querySelectorAll(`tr > *:nth-child(${this.index+1})`).forEach(ae=>{ae.classList.toggle("hidden")})}})),this.preset(),this.mutation=new MutationObserver(()=>{setTimeout(()=>{this.preset()},2)}),this.mutation.observe(this.table.element,{childList:!0,subtree:!0}))}preset(){let e=0;for(const{isVisible:t,isFrozen:r,index:a}of this.columns)r===!0&&(e=this.freeze(a,e)),t===!1&&this.table.element.querySelectorAll(`tr > *:nth-child(${a+1})`).forEach(o=>{o.classList.add("hidden")})}freeze(e,t=0){const r=this.table.element.querySelector(`thead th:nth-child(${e+1})`),{width:a}=r.getBoundingClientRect();return this.table.element.querySelectorAll(`tr > *:nth-child(${e+1})`).forEach(o=>{o.style.position="sticky",o.style.left=e*t+"px",o.style.width=a+"px"}),a}setPosition(e,t){this.table.element.querySelectorAll("tr").forEach(r=>{const a=[].slice.call(r.querySelectorAll("th, td"));e>t?a[t].parentNode.insertBefore(a[e],a[t]):a[t].parentNode.insertBefore(a[e],a[t].nextSibling)})}}W=new WeakMap;var L;class ve{constructor(e){l(this,L,u(""));n(this,"timeout");n(this,"table");this.table=e,this.cleanup()}get value(){return c(i(this,L))}set value(e){h(i(this,L),e,!0)}set(){this.table.search=this.value,clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.table.invalidate()},400)}clear(){this.value="",this.table.search="",this.table.invalidate()}cleanup(){this.table.on("clearSearch",()=>this.clear())}}L=new WeakMap;var V,_;class Se{constructor(e,t){n(this,"sortHandler");n(this,"field");l(this,V,p(()=>this.createIsActive()));l(this,_,p(()=>this.createDirection()));this.sortHandler=e,this.field=t}get isActive(){return c(i(this,V))}set isActive(e){h(i(this,V),e)}get direction(){return c(i(this,_))}set direction(e){h(i(this,_),e)}set(){this.sortHandler.set(this.field)}asc(){this.sortHandler.asc(this.field)}desc(){this.sortHandler.desc(this.field)}createIsActive(){var e;return this.field===((e=this.sortHandler.table.sort)==null?void 0:e.field)}createDirection(){var e;return this.isActive===!1?null:(e=this.sortHandler.table.sort)==null?void 0:e.direction}}V=new WeakMap,_=new WeakMap;var M;class He{constructor(e,t){l(this,M,u(""));n(this,"timeout");n(this,"filterHandler");n(this,"field");this.filterHandler=e,this.field=t,this.cleanup()}get value(){return c(i(this,M))}set value(e){h(i(this,M),e,!0)}set(){this.filterHandler.set(this.value,this.field),clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.filterHandler.table.invalidate()},400)}clear(){this.value="",this.filterHandler.unset(this.field)}cleanup(){this.filterHandler.table.on("clearFilters",()=>this.clear())}}M=new WeakMap;class ye extends de{constructor(t=[],r={rowsPerPage:5}){super(t,r);n(this,"fetchHandler");n(this,"sortHandler");n(this,"selectHandler");n(this,"pageHandler");n(this,"searchHandler");n(this,"filterHandler");n(this,"view");n(this,"i18n");this.i18n=this.translate(r.i18n),this.fetchHandler=new ge(this),this.sortHandler=new fe(this),this.selectHandler=new pe(this),this.pageHandler=new we(this),this.searchHandler=new be(this),this.filterHandler=new me(this)}load(t){this.fetchHandler.set(t)}invalidate(){this.fetchHandler.invalidate()}setRowsPerPage(t){this.rowsPerPage=t,this.setPage(1)}setPage(t){switch(t){case"previous":return this.pageHandler.previous();case"next":return this.pageHandler.next();case"last":return this.pageHandler.goto(this.pageCount);default:return this.pageHandler.goto(t)}}clearSearch(){this.searchHandler.clear()}createSearch(){return new ve(this)}createSort(t){if(typeof t=="function")throw new Error(`Invalid field argument: ${String(t)}. Function type arguments are not allowed in server-side mode`);return new Se(this.sortHandler,t)}clearFilters(){this.filterHandler.clear(),this.invalidate()}createFilter(t){if(typeof t=="function")throw new Error(`Invalid field argument: ${String(t)}. Function type arguments are not allowed in server-side mode`);return new He(this.filterHandler,t)}select(t){this.selectHandler.set(t)}selectAll(){this.selectHandler.all()}clearSelection(){this.selectHandler.clear()}on(t,r){this.event.add(t,r)}createView(t){return this.view=new Pe(this,t),this.view}getView(){return this.view}translate(t){return{search:"Search...",show:"Show",entries:"entries",filter:"Filter",rowCount:"Showing {start} to {end} of {total} entries",noRows:"No entries found",previous:"Previous",next:"Next",selectedCount:"{count} of {total} row(s).",...t}}}const j="datatableSettings",J=10,v=g(Ce());v.subscribe(s=>{localStorage.setItem(j,JSON.stringify(s))});function Ce(){if(localStorage.getItem(j))try{return JSON.parse(localStorage.getItem(j)||"{}")}catch{console.error("restoring user datatable settings failed"),localStorage.setItem(j,"{}")}return{}}function re(s){if(!s)return J;const e=d(v);return e?e[s]?e[s]:(e[s]=J,v.set(e),J):J}function Oe(s,e){const t=d(v);t[s]=e,v.set(t)}const X=g(!1),Re=g(Promise.resolve(void 0)),k=g(""),w=g([]),K=new ye([],{rowsPerPage:re("ExplorerTable")}),Z=g(!0),G=g(""),Y=g(1),ee=g(""),te=g(re("ExplorerTable"));w.subscribe(()=>{K.setPage(1)});k.subscribe(()=>{K.setPage(1)});K.load(async s=>{const e=d(k),t=d(w);X.set(!0),d(Z)&&(e||t.length>0)&&Z.set(!1);try{const r=d(Y)!==s.currentPage,a=d(te)!==s.rowsPerPage,o=d(ee)!==e,f=(r||a)&&!o;return ee.set(e),f?(Y.set(s.currentPage),te.set(s.rowsPerPage)):Ae.set(Be()),await Fe(s)}catch{return[]}finally{X.set(!1)}});async function Fe(s){const e="An error occurred while searching. If the problem persists, please contact an administrator.",t=d(w),r=d(k);if(!r&&!t.length)return s.setTotalRows(0),[];const a=Ie(r.trim(),t,{pageNumber:s.currentPage-1,pageSize:s.rowsPerPage});Re.set(a);const o=await a.catch(f=>{throw console.error(f),s.setTotalRows(0),G.set(e),f});return o||G.set(e),s.setTotalRows((o==null?void 0:o.totalElements)??0),(o==null?void 0:o.content)??[]}async function Te(s){const e=d(w);s.forEach(t=>{const r=e.findIndex(a=>a.name===t.name);r!==-1?e.splice(r,1):e.push(t)}),w.set(e.sort((t,r)=>r.count-t.count))}function ke(){k.set(""),w.set([]),G.set(""),Z.set(!0)}const Je={selectedFacets:w,updateFacets:Te},Ee=g({}),Ae=g(Promise.resolve([])),$e=g([]),P=new Map;function xe(s,e){!s||!e||(P.size>100&&P.clear(),P.set(s,e))}function Ie(s="",e,t){let r={facets:e,search:s};return se.url.pathname.includes("/discover")||(r=ie(r)),U(`${O.Concepts}?page_number=${t.pageNumber}&page_size=${t.pageSize}`,r)}function qe(s){const e=s.map(t=>({name:t.name,values:t.facets.filter(r=>r.count===0).map(r=>r.name)})).reduce((t,r)=>(t[r.name]=r.values,t),{});console.debug("Found the following facets that should be hidden:",JSON.stringify(e)),Ee.set(e)}async function Be(){const s=d(k);let t={facets:d(w),search:s};se.url.pathname.includes("/discover")||(t=ie(t));try{const r=await U(O.Facets,t);qe(r),De(r);const a=r.map(o=>o.facets.some(f=>f.count>0)?o.name:"").filter(o=>o);return $e.set(a),r}catch(r){throw console.error("Failed to update facets from search:",r),r}}function De(s){s.forEach(e=>{e.facets.forEach(t=>{var r;t.categoryRef={name:e.name,display:e.display,description:e.description},(r=t.children)!=null&&r.length&&t.children.forEach(a=>{a.categoryRef={name:e.name,display:e.display,description:e.description},a.parentRef={name:t.name,display:t.display,description:t.description}})})})}async function je(s,e){const t=`${O.Concept.Detail}/${e}`,r=String.raw`${s.replace(/\\\\/g,"\\")}`;if(P.has(r))return P.get(r);const a=await U(t,r);if(!a)throw new Error("No response");return xe(r,a),a}function ie(s){var t;const e=(t=d(ce))==null?void 0:t.queryTemplate;if(e){const a=(e.categoryFilters||{})["\\_consents\\"]||[];s.consents=a}return s}async function Ue(s){return he(`${O.DashboardDrawer}/${s}`)}async function Ze(s,e,t){const r=`${O.Concept.Tree}/${s}?depth=${e}`;return U(r,t)}export{ue as E,Je as S,ye as T,Pe as V,w as a,ie as b,je as c,Ze as d,Ie as e,Ue as f,re as g,Ee as h,Ae as i,Re as j,G as k,Z as l,X as m,Oe as n,$e as o,ke as r,k as s,K as t,Te as u};
