import{w as l,g as s}from"./xU7jw7XU.js";import{e as S,f as y,h as b,t as w}from"./BNC-bmXQ.js";import{b as p}from"./BZHGrlEE.js";import{g as C,S as o,c as g}from"./CUGspmVO.js";import{g as P,f as R,a as v}from"./DA3-ipRP.js";import{s as E,a as q}from"./CD4Ar3Xi.js";const F=100,r=new Map,M=l(!1),h=l([]);l(Promise.resolve());const c=l(!1),N=l(0);async function j(f){var m,u;S();try{r.size>=F&&r.clear();const a=JSON.stringify([f,s(E),s(q).map(t=>t.name),s(P).map(({uuid:t})=>t),s(R).map(({uuid:t,parent:e})=>t+(e==null?void 0:e.operator)),s(v)]);if(r.has(a)){h.set(r.get(a)),c.set(!1);return}await s(y);const i=C(f,((u=(m=p)==null?void 0:m.results)==null?void 0:u.stats)||[]);h.set(i),c.set(!0),Promise.allSettled(i.flatMap(o.list).map(({promise:t})=>t)).then(t=>{t.some(o.rejected)||r.set(a,i),M.set(t.some(e=>o.fullfiled(e)&&`${g([e.value])}`!="0")),c.set(!1)});const d=i.find(t=>{var e,n;return t.key===((n=(e=p)==null?void 0:e.results)==null?void 0:n.totalStatKey)});d&&Promise.allSettled(o.list(d).map(({promise:t})=>t)).then(t=>{const e=t.filter(o.fullfiled).map(({value:n})=>n);N.set(g(e,!1))})}catch(a){console.error(a),c.set(!1),b("query-error")||w.error({id:"query-error",duration:4e3,title:"An error occured while loading patient counts. If this problem persists, please contact an administrator.",closable:!0})}}export{c,M as h,j as l,h as r,N as t};
