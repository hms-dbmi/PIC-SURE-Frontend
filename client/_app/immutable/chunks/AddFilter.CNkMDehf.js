import{s as ge,e as y,a as A,c as k,b as E,g as P,f as g,m,i as F,h,k as ee,o as be,t as C,d as D,j as Q,Q as ve,O as X,n as x,U as Z,w as ye,Y as J,Z as K}from"./scheduler.bui7uCNy.js";import{S as ke,i as Oe,g as re,a as U,b as oe,t as j,d as ae,e as ue,m as ce,f as fe,j as W}from"./index.CNwEczq-.js";import{c as Ee,a as Se,b as we,O as Ve}from"./OptionsSelectionList.CL6EweHi.js";import{a as Le}from"./Filter.C-osvDvX.js";import{a as te}from"./Row.CBmsuhWK.js";import{g as Ce}from"./stores.CGVgmJb2.js";import{g as De}from"./stores.EYwnRdwT.js";import"./ProgressBar.svelte_svelte_type_style_lang.DAEU1KBT.js";import{P as Fe}from"./ProgressRadial.CbTPnjvT.js";import{g as Ie}from"./dictionary.CWXs9J8o.js";function le(o){let e,t,n,l=o[8]&&ie(o),s=o[9]&&se(o),f=o[10]&&ne(o);return{c(){e=y("div"),l&&l.c(),t=A(),s&&s.c(),n=A(),f&&f.c(),this.h()},l(a){e=k(a,"DIV",{class:!0});var i=E(e);l&&l.l(i),t=P(i),s&&s.l(i),n=P(i),f&&f.l(i),i.forEach(g),this.h()},h(){m(e,"class","variable-info")},m(a,i){F(a,e,i),l&&l.m(e,null),h(e,t),s&&s.m(e,null),h(e,n),f&&f.m(e,null)},p(a,i){a[8]?l?l.p(a,i):(l=ie(a),l.c(),l.m(e,t)):l&&(l.d(1),l=null),a[9]?s?s.p(a,i):(s=se(a),s.c(),s.m(e,n)):s&&(s.d(1),s=null),a[10]?f?f.p(a,i):(f=ne(a),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(a){a&&g(e),l&&l.d(),s&&s.d(),f&&f.d()}}}function ie(o){let e,t,n;return{c(){e=y("div"),t=C("Variable Name: "),n=C(o[8]),this.h()},l(l){e=k(l,"DIV",{class:!0});var s=E(e);t=D(s,"Variable Name: "),n=D(s,o[8]),s.forEach(g),this.h()},h(){m(e,"class","variable-name")},m(l,s){F(l,e,s),h(e,t),h(e,n)},p(l,s){s&256&&Q(n,l[8])},d(l){l&&g(e)}}}function se(o){let e,t,n;return{c(){e=y("div"),t=C("Variable Description: "),n=C(o[9]),this.h()},l(l){e=k(l,"DIV",{class:!0});var s=E(e);t=D(s,"Variable Description: "),n=D(s,o[9]),s.forEach(g),this.h()},h(){m(e,"class","variable-desc")},m(l,s){F(l,e,s),h(e,t),h(e,n)},p(l,s){s&512&&Q(n,l[9])},d(l){l&&g(e)}}}function ne(o){let e,t,n;return{c(){e=y("div"),t=C("Study: "),n=C(o[10]),this.h()},l(l){e=k(l,"DIV",{class:!0});var s=E(e);t=D(s,"Study: "),n=D(s,o[10]),s.forEach(g),this.h()},h(){m(e,"class","variable-study")},m(l,s){F(l,e,s),h(e,t),h(e,n)},p(l,s){s&1024&&Q(n,l[10])},d(l){l&&g(e)}}}function Ne(o){let e,t,n,l,s,f,a,i,v;const b=[Te,Pe],c=[];function u(r,p){var _,V;return((_=r[0])==null?void 0:_.type)==="Categorical"?0:((V=r[0])==null?void 0:V.type)==="Continuous"?1:-1}return~(e=u(o))&&(t=c[e]=b[e](o)),{c(){t&&t.c(),n=A(),l=y("button"),s=y("i"),this.h()},l(r){t&&t.l(r),n=P(r),l=k(r,"BUTTON",{class:!0,"data-testid":!0});var p=E(l);s=k(p,"I",{class:!0}),E(s).forEach(g),p.forEach(g),this.h()},h(){m(s,"class","fas fa-plus"),m(l,"class","btn btn-icon variant-filled-primary m-1 svelte-1l20iax"),m(l,"data-testid","add-filter"),l.disabled=f=o[0].type==="Categorical"&&o[11].length===0},m(r,p){~e&&c[e].m(r,p),F(r,n,p),F(r,l,p),h(l,s),a=!0,i||(v=X(l,"click",o[13]),i=!0)},p(r,p){let _=e;e=u(r),e===_?~e&&c[e].p(r,p):(t&&(re(),U(c[_],1,1,()=>{c[_]=null}),oe()),~e?(t=c[e],t?t.p(r,p):(t=c[e]=b[e](r),t.c()),j(t,1),t.m(n.parentNode,n)):t=null),(!a||p&2049&&f!==(f=r[0].type==="Categorical"&&r[11].length===0))&&(l.disabled=f)},i(r){a||(j(t),a=!0)},o(r){U(t),a=!1},d(r){r&&(g(n),g(l)),~e&&c[e].d(r),i=!1,v()}}}function Ae(o){let e,t;return e=new Fe({props:{width:"w-10",value:void 0}}),{c(){ae(e.$$.fragment)},l(n){ue(e.$$.fragment,n)},m(n,l){ce(e,n,l),t=!0},p:x,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){U(e.$$.fragment,n),t=!1},d(n){fe(e,n)}}}function Pe(o){let e,t,n,l,s,f,a,i,v,b,c,u,r,p,_,V,L;return{c(){e=y("div"),t=y("section"),n=y("label"),l=y("span"),s=C("Min: "),f=C(o[3]),a=A(),i=y("input"),v=A(),b=y("label"),c=y("span"),u=C("Max: "),r=C(o[2]),p=A(),_=y("input"),this.h()},l(O){e=k(O,"DIV",{class:!0});var S=E(e);t=k(S,"SECTION",{class:!0,"data-testid":!0});var I=E(t);n=k(I,"LABEL",{class:!0});var T=E(n);l=k(T,"SPAN",{});var B=E(l);s=D(B,"Min: "),f=D(B,o[3]),B.forEach(g),a=P(T),i=k(T,"INPUT",{id:!0,"data-testid":!0,type:!0,placeholder:!0,class:!0}),T.forEach(g),v=P(I),b=k(I,"LABEL",{class:!0});var N=E(b);c=k(N,"SPAN",{});var q=E(c);u=D(q,"Max: "),r=D(q,o[2]),q.forEach(g),p=P(N),_=k(N,"INPUT",{id:!0,"data-testid":!0,type:!0,placeholder:!0,class:!0}),N.forEach(g),I.forEach(g),S.forEach(g),this.h()},h(){m(i,"id","min"),m(i,"data-testid","min-input"),m(i,"type","text"),m(i,"placeholder","Enter value or leave blank for variable min"),m(i,"class","input"),m(n,"class","flex-auto flex-col"),m(_,"id","max"),m(_,"data-testid","max-input"),m(_,"type","text"),m(_,"placeholder","Enter value or leave blank for variable max"),m(_,"class","input"),m(b,"class","flex-auto flex-col"),m(t,"class","card-body flex flex-grow gap-4"),m(t,"data-testid","numerical-filter"),m(e,"class","card p-3 m-1 w-full")},m(O,S){F(O,e,S),h(e,t),h(t,n),h(n,l),h(l,s),h(l,f),h(n,a),h(n,i),Z(i,o[4]),h(t,v),h(t,b),h(b,c),h(c,u),h(c,r),h(b,p),h(b,_),Z(_,o[5]),V||(L=[X(i,"input",o[19]),X(_,"input",o[20])],V=!0)},p(O,S){S&8&&Q(f,O[3]),S&16&&i.value!==O[4]&&Z(i,O[4]),S&4&&Q(r,O[2]),S&32&&_.value!==O[5]&&Z(_,O[5])},i:x,o:x,d(O){O&&g(e),V=!1,ye(L)}}}function Te(o){var c;let e,t,n,l,s,f;function a(u){o[15](u)}function i(u){o[16](u)}function v(u){o[17](u)}let b={allOptions:(c=o[0])==null?void 0:c.values};return o[6]!==void 0&&(b.unselectedOptions=o[6]),o[1]!==void 0&&(b.selectedOptions=o[1]),o[7]!==void 0&&(b.currentlyLoading=o[7]),t=new Ve({props:b}),J.push(()=>W(t,"unselectedOptions",a)),J.push(()=>W(t,"selectedOptions",i)),J.push(()=>W(t,"currentlyLoading",v)),t.$on("scroll",o[18]),{c(){e=y("div"),ae(t.$$.fragment),this.h()},l(u){e=k(u,"DIV",{"data-testid":!0,class:!0});var r=E(e);ue(t.$$.fragment,r),r.forEach(g),this.h()},h(){m(e,"data-testid","categoical-filter"),m(e,"class","w-full")},m(u,r){F(u,e,r),ce(t,e,null),f=!0},p(u,r){var _;const p={};r&1&&(p.allOptions=(_=u[0])==null?void 0:_.values),!n&&r&64&&(n=!0,p.unselectedOptions=u[6],K(()=>n=!1)),!l&&r&2&&(l=!0,p.selectedOptions=u[1],K(()=>l=!1)),!s&&r&128&&(s=!0,p.currentlyLoading=u[7],K(()=>s=!1)),t.$set(p)},i(u){f||(j(t.$$.fragment,u),f=!0)},o(u){U(t.$$.fragment,u),f=!1},d(u){u&&g(e),fe(t)}}}function Me(o){let e,t,n,l,s,f,a=!!o[0]&&le(o);const i=[Ae,Ne],v=[];function b(c,u){return c[0]?1:0}return l=b(o),s=v[l]=i[l](o),{c(){e=y("div"),a&&a.c(),t=A(),n=y("div"),s.c(),this.h()},l(c){e=k(c,"DIV",{});var u=E(e);a&&a.l(u),t=P(u),n=k(u,"DIV",{class:!0,"data-testid":!0});var r=E(n);s.l(r),r.forEach(g),u.forEach(g),this.h()},h(){m(n,"class","flex justify-between"),m(n,"data-testid","filter-component")},m(c,u){F(c,e,u),a&&a.m(e,null),h(e,t),h(e,n),v[l].m(n,null),f=!0},p(c,[u]){c[0]?a?a.p(c,u):(a=le(c),a.c(),a.m(e,t)):a&&(a.d(1),a=null);let r=l;l=b(c),l===r?v[l].p(c,u):(re(),U(v[r],1,1,()=>{v[r]=null}),oe(),s=v[l],s?s.p(c,u):(s=v[l]=i[l](c),s.c()),j(s,1),s.m(n,null))},i(c){f||(j(s),f=!0)},o(c){U(s),f=!1},d(c){c&&g(e),a&&a.d(),v[l].d()}}}let G=20;function Re(o,e,t){let n,l,s;ee(o,te,d=>t(24,s=d));const f=Ce();ee(o,f,d=>t(23,l=d));const a=De();let{data:i}=e,v,b,c,u,r=[],p=[],_=G,V="",L=!1,O,S,I;be(async()=>{var d,M,z,R;if((d=l[0])!=null&&d.meta.existingFilter){const w=(M=l[0])==null?void 0:M.meta.existingFilter;t(0,i=(z=l[0])==null?void 0:z.meta.existingFilter.searchResult),t(8,O=(i==null?void 0:i.display)||""),t(9,S=(i==null?void 0:i.description)||""),t(10,I=i.studyAcronym&&i.dataset?`${i.studyAcronym} (${i.dataset})`:i.studyAcronym||i.dataset||""),w.filterType==="Categorical"?(w.categoryValues.length===0?t(1,p=(i==null?void 0:i.values)||[]):t(1,p=w.categoryValues),t(6,r=((R=i==null?void 0:i.values)==null?void 0:R.filter(Y=>!p.find(H=>H===Y)))||[]),r.length>=50&&t(6,r=r.slice(0,G))):w.filterType==="numeric"&&(t(4,c=w.min||""),t(5,u=w.max||""))}else if((i==null?void 0:i.type)==="Categorical")try{t(7,L=!0),t(0,i=await Ie(i.conceptPath,i.dataset)),t(7,L=!1),t(6,r=(i==null?void 0:i.values)||[]),r.length>=50&&t(6,r=r.slice(0,G))}catch(w){console.error(w),a.trigger({message:"An error occured while loading the filter. Please try again later.",background:"variant-filled-error"})}t(3,b=i.min?i.min.toString():""),t(2,v=i.max?i.max.toString():"")});function T(){var M;let d;if(i.type==="Categorical"){if(!n||n.length===0)return;n.length===((M=i==null?void 0:i.values)==null?void 0:M.length)?d=Ee(i):d=Se(i,n)}else d=we(i,c||void 0,u||void 0);d&&(Le(d),B())}function B(){ve(te,s="",s),l[0]&&f.close()}function N(d=""){var z;if((((z=i==null?void 0:i.values)==null?void 0:z.length)||0)!==0){t(7,L=!0);try{let R=(i==null?void 0:i.values)||[];(d!==V||!V.includes(d))&&(_=0,t(6,r=[]),V=d);let w=R.filter($=>!p.includes($)&&(!d||$.toLowerCase().includes(d.toLowerCase())));const Y=Math.min(_+G,w.length),H=w.slice(_,Y);t(6,r=[...r,...H]),_=Y}catch(R){console.error(R),a.trigger({message:"An error occurred while loading more options. Please try again later.",background:"variant-filled-error"})}t(7,L=!1)}}function q(d){r=d,t(6,r)}function de(d){p=d,t(1,p)}function pe(d){L=d,t(7,L)}const _e=d=>N(d.detail.search);function me(){c=this.value,t(4,c)}function he(){u=this.value,t(5,u)}return o.$$set=d=>{"data"in d&&t(0,i=d.data)},o.$$.update=()=>{o.$$.dirty&2&&t(11,n=p.map(d=>d))},[i,p,v,b,c,u,r,L,O,S,I,n,f,T,N,q,de,pe,_e,me,he]}class Je extends ke{constructor(e){super(),Oe(this,e,Re,Me,ge,{data:0})}}export{Je as A};
