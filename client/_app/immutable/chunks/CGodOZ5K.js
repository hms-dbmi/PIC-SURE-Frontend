import{f as E,a as S,t as ne}from"./DKNWTM-D.js";import{p as M,d as O,e as U,c as b,s as n,r as v,g as e,t as K,b as m,a as Q,f as Y,h as G,n as Z}from"./KPVYLOSR.js";import{d as ee,e as se}from"./NtGCh5xy.js";import{i as z}from"./CDCmQmr-.js";import{r as j,s as re,b as te,d as oe}from"./Be_LeCLl.js";import{b as H}from"./BlQKM0Gb.js";import{p as J}from"./CfrH0FQi.js";import{s as ae,a as le}from"./B2Bg6RTa.js";import{g as de}from"./DNfOBMJV.js";import{u as ce,a as ue}from"./BLh7o4M2.js";import{a as ie}from"./BpV1Tt4c.js";import{t as V}from"./CWjZNTTC.js";import{e as fe}from"./B5lqQSsR.js";import{p as pe}from"./wLQzkxGg.js";import{E as be}from"./P3bGLiu7.js";const ve=(x,a,i,g,P,f)=>{const o={label:e(a),id:e(i)};g()(P(),o),m(f,!1)},me=(x,a,i,g)=>{m(a,i().label,!0),m(g,i().id,!0)},_e=(x,a,i,g)=>a()({label:e(i),id:e(g)}),W=(x,a)=>m(a,!e(a));var ge=E('<button type="button" title="Reset and cancel" class="btn-icon-color" data-testid="required-field-reset-btn"><i class="fa-solid fa-arrow-rotate-right fa-xl"></i> <span class="sr-only">Reset and cancel</span></button>'),ye=E('<button type="button" title="Cancel" class="btn-icon-color" data-testid="required-field-cancel-btn"><i class="fa-solid fa-ban fa-xl"></i> <span class="sr-only">Cancel</span></button>'),he=E('<button type="button" title="Save" data-testid="required-field-save-btn" class="btn-icon-color"><i class="fa-solid fa-floppy-disk fa-xl"></i> <span class="sr-only">Save</span></button> <!>',1),xe=E('<button type="button" title="Edit" class="btn-icon-color" data-testid="required-field-edit-btn"><i class="fa-solid fa-pen fa-xl"></i> <span class="sr-only">Edit</span></button>'),we=E('<div class="flex gap-4 p-3 odd:bg-surface-100-900 even:bg-surface-50-950"><label class="label flex-1"><span>Label:</span> <input type="text" class="input" minlength="1" maxlength="255"/></label> <label class="label flex-1"><span>ID:</span> <input type="text" minlength="1" maxlength="255"/></label> <div class="flex-none content-end py-2"><!> <button type="button" title="Delete" class="btn-icon-color" data-testid="required-field-delete-btn"><i class="fa-solid fa-trash fa-xl"></i> <span class="sr-only">Delete</span></button></div></div>');function X(x,a){M(a,!0);let i=J(a,"field",19,()=>({label:"",id:""})),g=J(a,"duplicate",3,!1),P=J(a,"onsave",3,()=>{}),f=J(a,"ondelete",3,()=>{}),o=O(U(i().label)),s=O(U(i().id)),p=G(()=>i().id!==e(s)||i().label!==e(o));const q=i().label===""||i().id==="";let w=O(U(q));var k=we(),$=b(k),C=n(b($),2);j(C),v($);var y=n($,2),h=n(b(y),2);j(h),v(y);var A=n(y,2),I=b(A);{var T=d=>{var F=he(),t=Y(F);t.__click=[ve,o,s,P,i,w];var l=n(t,2);{var c=_=>{var r=ge();r.__click=[me,o,i,s],S(_,r)},D=(_,r)=>{{var u=R=>{var B=ye();B.__click=[W,w],S(R,B)};z(_,R=>{!q&&!e(p)&&R(u)},r)}};z(l,_=>{e(p)?_(c):_(D,!1)})}K(()=>t.disabled=!e(o)||!e(s)||!e(p)),S(d,F)},L=d=>{var F=xe();F.__click=[W,w],S(d,F)};z(I,d=>{e(w)?d(T):d(L,!1)})}var N=n(I,2);N.__click=[_e,f,o,s],v(A),v(k),K(()=>{re(k,"data-testid",`required-field-row-${i().id?i().id:"new"}`),C.disabled=!e(w),h.disabled=!e(w),te(h,1,`input ${(g()&&"preset-tonal-warning border border-warning-500 border-warning-600-400 focus:border-warning-800-200")??""}`)}),H(C,()=>e(o),d=>m(o,d)),H(h,()=>e(s),d=>m(s,d)),S(x,k),Q()}ee(["click"]);var Fe=(x,a)=>m(a,!e(a)),qe=E('<fieldset class="border border-surface-300-700"><legend class="px-2 ml-2">Required Fields: <button type="button" class="text-primary-700-300 hover:text-secondary-700-300" aria-label="Add New Field" title="Add New Field" data-testid="required-field-new-btn"><i></i></button></legend> <!> <!> <!></fieldset>');function ke(x,a){M(a,!0);const[i,g]=ae(),P=()=>le(ie,"$isTopAdmin",i);let f=J(a,"fields",3,"[]"),o=J(a,"onupdate",3,()=>{}),s=G(()=>pe(f())),p=G(()=>e(s).length===0||!P()),q=G(()=>e(s).filter(t=>e(s).filter(l=>l!==t).filter(l=>l.id===t.id).length>0));function w(t){return!!e(q).find(l=>l===t)}function k(t){o()(JSON.stringify(t))}function $(t,l){const c=[...e(s)];if(t.label===""||t.id==="")c.push(l),m(p,!1);else{const D=c.findIndex(_=>_.label===t.label&&_.id===t.id);D>-1&&(c[D]=l)}k(c)}function C(t){const l=e(s).filter(c=>c.label!==t.label||c.id!==t.id);k(l)}var y=qe(),h=b(y),A=n(b(h));A.__click=[Fe,p];var I=b(A);v(A),v(h);var T=n(h,2);{var L=t=>{X(t,{onsave:$,ondelete:()=>m(p,!1)})};z(T,t=>{e(p)&&t(L)})}var N=n(T,2);fe(N,19,()=>e(s),(t,l)=>`${l}-${t.label}-${t.id}`,(t,l)=>{const c=G(()=>w(e(l)));X(t,{get duplicate(){return e(c)},get field(){return e(l)},onsave:$,ondelete:C})});var d=n(N,2);{var F=t=>{be(t,{"data-testid":"validation-warn",color:"warning",children:(l,c)=>{Z();var D=ne("Fields with the same ID may not function properly.");S(l,D)},$$slots:{default:!0}})};z(d,t=>{e(q).length>0&&t(F)})}v(y),K(()=>{A.disabled=e(p),te(I,1,`fa-solid fa-square-plus fa-xl ${e(p)?"opacity-50":""}`)}),S(x,y),Q(),g()}ee(["click"]);var $e=E('<label class="label"><span>UUID:</span> <input type="text" class="input"/></label>'),Ce=E('<p class="mb-3 text-center">For details on how to set up a Connection, please refer to the <a href="https://pic-sure.gitbook.io/pic-sure-developer-guide/configuring-pic-sure/all-in-one-authentication-configuration#additional-authentication-configuration-option-s" target="_blank" class="anchor">PIC-SURE developer guide</a>.</p> <form><fieldset data-testid="connection-form" class="grid gap-4 my-3"><!> <label class="label required"><span>Label:</span> <input type="text" class="input" required minlength="1" maxlength="255"/></label> <label class="label required"><span>ID:</span> <input type="text" class="input" required minlength="1" maxlength="255"/></label> <label class="label required"><span>Sub Prefix:</span> <input type="text" class="input" required minlength="1" maxlength="255"/></label> <!> <div class="mt-2"><button type="submit" data-testid="connection-save-btn" class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500">Save</button> <a href="/admin/configuration" data-testid="connection-cancel-btn" class="btn preset-tonal-secondary border border-secondary-500 hover:preset-filled-secondary-500">Cancel</a></div></fieldset></form>',1);function Be(x,a){var l,c,D,_;M(a,!0);const[i,g]=ae(),P=()=>le(ie,"$isTopAdmin",i);let f=J(a,"connection",3,void 0),o=O(U(((l=f())==null?void 0:l.label)||"")),s=O(U(((c=f())==null?void 0:c.id)||"")),p=O(U(((D=f())==null?void 0:D.subPrefix)||"")),q=O(U(((_=f())==null?void 0:_.requiredFields)||"[]"));function w(r){m(q,r,!0)}async function k(r){r.preventDefault();let u={id:e(s),label:e(o),requiredFields:e(q),subPrefix:e(p)};try{f()?(u={...u,uuid:f().uuid},await ce(u)):await ue(u),V.success({title:`Successfully saved ${u&&"new "}connection '${e(o)}'`}),de("/admin/configuration")}catch(R){console.error(R),V.error({title:`An error occured while saving ${u&&"new "}connection '${e(o)}'`})}}var $=Ce(),C=n(Y($),2),y=b(C),h=b(y);{var A=r=>{var u=$e(),R=n(b(u),2);j(R),R.readOnly=!0,v(u),K(()=>{var B;return oe(R,(B=f())==null?void 0:B.uuid)}),S(r,u)};z(h,r=>{var u;(u=f())!=null&&u.uuid&&r(A)})}var I=n(h,2),T=n(b(I),2);j(T),v(I);var L=n(I,2),N=n(b(L),2);j(N),v(L);var d=n(L,2),F=n(b(d),2);j(F),v(d);var t=n(d,2);ke(t,{get fields(){return e(q)},onupdate:w}),Z(2),v(y),v(C),K(()=>y.disabled=!P()),se("submit",C,k),H(T,()=>e(o),r=>m(o,r)),H(N,()=>e(s),r=>m(s,r)),H(F,()=>e(p),r=>m(p,r)),S(x,$),Q(),g()}export{Be as C};
