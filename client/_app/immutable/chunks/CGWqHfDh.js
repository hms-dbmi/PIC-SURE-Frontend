import{s as ne,e as m,a as I,c as v,b as N,g as P,q as M,f as A,r as h,i as z,h as n,y as V,z as x,A as re,n as Y,B as oe,C as ue,k as ce,t as ae,d as se,j as ie}from"./CDvIr29H.js";import{e as Z}from"./mmDljT_r.js";import{S as de,i as fe}from"./ByE-_V18.js";import{g as he}from"./ClzUMQ0P.js";import{g as pe}from"./BpCLhCzN.js";import"./4MwYNI-R.js";import{u as me,a as ve}from"./DKpYsXv-.js";import{a as _e}from"./BEf3cR2P.js";function $(a,t,e){const u=a.slice();return u[6]=t[e][0],u[13]=t,u[14]=e,u}function ee(a){let t,e,u="UUID:",o,l,c;return{c(){t=m("label"),e=m("span"),e.textContent=u,o=I(),l=m("input"),this.h()},l(s){t=v(s,"LABEL",{class:!0});var i=N(t);e=v(i,"SPAN",{"data-svelte-h":!0}),M(e)!=="svelte-xruxbf"&&(e.textContent=u),o=P(i),l=v(i,"INPUT",{type:!0,class:!0}),i.forEach(A),this.h()},h(){var s;h(l,"type","text"),h(l,"class","input"),l.value=c=(s=a[0])==null?void 0:s.uuid,l.readOnly=!0,h(t,"class","label")},m(s,i){z(s,t,i),n(t,e),n(t,o),n(t,l)},p(s,i){var g;i&1&&c!==(c=(g=s[0])==null?void 0:g.uuid)&&l.value!==c&&(l.value=c)},d(s){s&&A(t)}}}function te(a){let t,e,u,o,l=a[6]+"",c,s,i,g;function b(){a[10].call(e,a[14])}return{c(){t=m("label"),e=m("input"),u=I(),o=m("p"),c=ae(l),s=I(),this.h()},l(d){t=v(d,"LABEL",{class:!0});var f=N(t);e=v(f,"INPUT",{class:!0,type:!0}),u=P(f),o=v(f,"P",{});var D=N(o);c=se(D,l),D.forEach(A),s=P(f),f.forEach(A),this.h()},h(){h(e,"class","checkbox"),h(e,"type","checkbox"),h(t,"class","flex items-center space-x-2")},m(d,f){z(d,t,f),n(t,e),e.checked=a[3][a[14]].checked,n(t,u),n(t,o),n(o,c),n(t,s),i||(g=x(e,"change",b),i=!0)},p(d,f){a=d,f&8&&(e.checked=a[3][a[14]].checked),f&2&&l!==(l=a[6]+"")&&ie(c,l)},d(d){d&&A(t),i=!1,g()}}}function le(a){let t,e,u,o,l,c,s,i='<i class="fa-solid fa-xmark"></i> <span class="sr-only">Close</span>',g,b;return{c(){t=m("aside"),e=m("div"),u=m("p"),o=ae(a[4]),l=I(),c=m("div"),s=m("button"),s.innerHTML=i,this.h()},l(d){t=v(d,"ASIDE",{"data-testid":!0,class:!0});var f=N(t);e=v(f,"DIV",{class:!0});var D=N(e);u=v(D,"P",{});var k=N(u);o=se(k,a[4]),k.forEach(A),D.forEach(A),l=P(f),c=v(f,"DIV",{class:!0});var q=N(c);s=v(q,"BUTTON",{"data-svelte-h":!0}),M(s)!=="svelte-1xe7dwh"&&(s.innerHTML=i),q.forEach(A),f.forEach(A),this.h()},h(){h(e,"class","alert-message"),h(c,"class","alert-actions"),h(t,"data-testid","validation-error"),h(t,"class","alert variant-ghost-error")},m(d,f){z(d,t,f),n(t,e),n(e,u),n(u,o),n(t,l),n(t,c),n(c,s),g||(b=x(s,"click",a[11]),g=!0)},p(d,f){f&16&&ie(o,d[4])},d(d){d&&A(t),g=!1,b()}}}function ge(a){var X;let t,e,u,o,l,c="Name:",s,i,g,b,d,f="Description:",D,k,q,p,E,w="Privileges:",j,G,F,U,Q='<button type="submit" data-testid="role-save-btn" class="btn variant-ghost-primary hover:variant-filled-primary">Save</button> <a href="/admin/configuration" data-testid="role-cancel-btn" class="btn variant-ghost-secondary hover:variant-filled-secondary">Cancel</a>',H,J,W,y=((X=a[0])==null?void 0:X.uuid)&&ee(a),B=Z(a[1]),L=[];for(let r=0;r<B.length;r+=1)L[r]=te($(a,B,r));let T=a[4]&&le(a);return{c(){t=m("form"),e=m("fieldset"),y&&y.c(),u=I(),o=m("label"),l=m("span"),l.textContent=c,s=I(),i=m("input"),g=I(),b=m("label"),d=m("span"),d.textContent=f,D=I(),k=m("input"),q=I(),p=m("fieldset"),E=m("legend"),E.textContent=w,j=I();for(let r=0;r<L.length;r+=1)L[r].c();G=I(),T&&T.c(),F=I(),U=m("div"),U.innerHTML=Q,this.h()},l(r){t=v(r,"FORM",{class:!0});var S=N(t);e=v(S,"FIELDSET",{"data-testid":!0});var _=N(e);y&&y.l(_),u=P(_),o=v(_,"LABEL",{class:!0});var C=N(o);l=v(C,"SPAN",{"data-svelte-h":!0}),M(l)!=="svelte-m2peuz"&&(l.textContent=c),s=P(C),i=v(C,"INPUT",{type:!0,class:!0,minlength:!0,maxlength:!0}),C.forEach(A),g=P(_),b=v(_,"LABEL",{class:!0});var R=N(b);d=v(R,"SPAN",{"data-svelte-h":!0}),M(d)!=="svelte-n5lbfe"&&(d.textContent=f),D=P(R),k=v(R,"INPUT",{type:!0,class:!0,minlength:!0,maxlength:!0}),R.forEach(A),q=P(_),p=v(_,"FIELDSET",{"data-testid":!0});var O=N(p);E=v(O,"LEGEND",{class:!0,"data-svelte-h":!0}),M(E)!=="svelte-1nmthtq"&&(E.textContent=w),j=P(O);for(let K=0;K<L.length;K+=1)L[K].l(O);O.forEach(A),G=P(_),T&&T.l(_),F=P(_),U=v(_,"DIV",{"data-svelte-h":!0}),M(U)!=="svelte-56gg4g"&&(U.innerHTML=Q),_.forEach(A),S.forEach(A),this.h()},h(){h(i,"type","text"),h(i,"class","input"),i.required=!0,h(i,"minlength","1"),h(i,"maxlength","255"),h(o,"class","label required"),h(k,"type","text"),h(k,"class","input"),k.required=!0,h(k,"minlength","1"),h(k,"maxlength","255"),h(b,"class","label required"),h(E,"class","required"),h(p,"data-testid","privilege-checkboxes"),h(e,"data-testid","role-form"),e.disabled=H=!a[5],h(t,"class","grid gap-4 my-3")},m(r,S){z(r,t,S),n(t,e),y&&y.m(e,null),n(e,u),n(e,o),n(o,l),n(o,s),n(o,i),V(i,a[6]),n(e,g),n(e,b),n(b,d),n(b,D),n(b,k),V(k,a[2]),n(e,q),n(e,p),n(p,E),n(p,j);for(let _=0;_<L.length;_+=1)L[_]&&L[_].m(p,null);n(e,G),T&&T.m(e,null),n(e,F),n(e,U),J||(W=[x(i,"input",a[8]),x(k,"input",a[9]),x(t,"submit",re(a[7]))],J=!0)},p(r,[S]){var _;if((_=r[0])!=null&&_.uuid?y?y.p(r,S):(y=ee(r),y.c(),y.m(e,u)):y&&(y.d(1),y=null),S&64&&i.value!==r[6]&&V(i,r[6]),S&4&&k.value!==r[2]&&V(k,r[2]),S&10){B=Z(r[1]);let C;for(C=0;C<B.length;C+=1){const R=$(r,B,C);L[C]?L[C].p(R,S):(L[C]=te(R),L[C].c(),L[C].m(p,null))}for(;C<L.length;C+=1)L[C].d(1);L.length=B.length}r[4]?T?T.p(r,S):(T=le(r),T.c(),T.m(e,F)):T&&(T.d(1),T=null),S&32&&H!==(H=!r[5])&&(e.disabled=H)},i:Y,o:Y,d(r){r&&A(t),y&&y.d(),oe(L,r),T&&T.d(),J=!1,ue(W)}}}function be(a,t,e){let u;ce(a,_e,p=>e(5,u=p));const o=pe();let{role:l=void 0}=t,{privilegeList:c}=t,s=l?l.name:"",i=l?l.description:"",g=c.map(([p,E])=>({uuid:E,checked:l?l.privileges.includes(E):!1})),b="";async function d(){const p=g.filter(w=>w.checked).map(w=>w.uuid);if(p.length===0){e(4,b="At least one privilege must be selected.");return}else e(4,b="");let E={name:s,description:i,privileges:p};try{l?(E={...E,uuid:l.uuid},await me(E)):await ve(E),o.trigger({message:`Successfully saved ${E&&"new "}role '${s}'`,background:"variant-filled-success"}),he("/admin/configuration")}catch(w){console.error(w),o.trigger({message:`An error occured while saving ${E&&"new "}role '${s}'`,background:"variant-filled-error"})}}function f(){s=this.value,e(6,s)}function D(){i=this.value,e(2,i)}function k(p){g[p].checked=this.checked,e(3,g)}const q=()=>e(4,b="");return a.$$set=p=>{"role"in p&&e(0,l=p.role),"privilegeList"in p&&e(1,c=p.privilegeList)},[l,c,i,g,b,u,s,d,f,D,k,q]}class Ie extends de{constructor(t){super(),fe(this,t,be,ge,ne,{role:0,privilegeList:1})}}export{Ie as R};
