var T=Object.defineProperty;var O=(s,t,a)=>t in s?T(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var r=(s,t,a)=>O(s,typeof t!="symbol"?t+"":t,a);import{f as o}from"./i859GThY.js";import{g as n}from"./B9BhT3Ut.js";import{u as q,r as C}from"./tvkVmxlD.js";import{f as v,h as y}from"./Drejzb63.js";import{e as I}from"./CA_H3qz9.js";class c{constructor(t){r(this,"categoryFilters");r(this,"numericFilters");r(this,"requiredFields");r(this,"anyRecordOf");r(this,"anyRecordOfMulti");r(this,"fields");r(this,"crossCountFields");r(this,"variantInfoFilters");r(this,"expectedResultType");var i;this.categoryFilters=(t==null?void 0:t.categoryFilters)||{},this.numericFilters=(t==null?void 0:t.numericFilters)||{},this.requiredFields=(t==null?void 0:t.requiredFields)||[],this.anyRecordOf=(t==null?void 0:t.anyRecordOf)||[],this.anyRecordOfMulti=(t==null?void 0:t.anyRecordOfMulti)||[],this.crossCountFields=(t==null?void 0:t.crossCountFields)||[],this.fields=(t==null?void 0:t.fields)||[];const a=((i=t==null?void 0:t.variantInfoFilters)==null?void 0:i[0])||{categoryVariantInfoFilters:{},numericVariantInfoFilters:{}};this.variantInfoFilters=[a],this.expectedResultType=(t==null?void 0:t.expectedResultType)||"COUNT"}addCategoryFilter(t,a){this.categoryFilters[t]=a}removeCategoryFilter(t){delete this.categoryFilters[t]}addNumericFilter(t,a,i){this.numericFilters[t]={min:a.toString(),max:i.toString()}}addCategoryVariantInfoFilters(t){this.variantInfoFilters[0].categoryVariantInfoFilters={Gene_with_variant:t.Gene_with_variant,Variant_consequence_calculated:t.Variant_consequence_calculated,Variant_frequency_as_text:t.Variant_frequency_as_text}}addAnyRecordOfMulti(t){this.anyRecordOfMulti.push(t)}setCrossCountFields(t){this.crossCountFields=t}addSnpFilter(t){t.forEach(a=>{this.categoryFilters[a.search]=a.constraint.split(",")})}addRequiredField(t){this.requiredFields.includes(t)||this.requiredFields.push(t)}addField(t){this.fields.includes(t)||this.fields.push(t)}addAnyRecordOf(t){this.anyRecordOf.includes(t)||this.anyRecordOf.push(t)}hasGenomicFilter(){var e,l,d,h,f,F,u,m,_;const t=((d=(l=(e=this.variantInfoFilters[0])==null?void 0:e.categoryVariantInfoFilters)==null?void 0:l.Gene_with_variant)==null?void 0:d.length)||0,a=((F=(f=(h=this.variantInfoFilters[0])==null?void 0:h.categoryVariantInfoFilters)==null?void 0:f.Variant_consequence_calculated)==null?void 0:F.length)||0,i=((_=(m=(u=this.variantInfoFilters[0])==null?void 0:u.categoryVariantInfoFilters)==null?void 0:m.Variant_frequency_as_text)==null?void 0:_.length)||0;return t+a+i}hasFilter(){return Object.keys(this.categoryFilters).length+Object.keys(this.numericFilters).length+this.hasGenomicFilter()+this.requiredFields.length+this.anyRecordOf.length}}const R="\\DCC Harmonized data set",x="\\_harmonized_consent\\",G="\\_topmed_consents\\";function S(s=!0,t=n(C).hpdsAuth,a="COUNT"){let i=new c;if(o.useQueryTemplate&&s){const e=n(q).queryTemplate;e&&(i=new c(structuredClone(e)))}return n(v).forEach(e=>{e.filterType==="Categorical"?e.displayType==="restrict"?i.addCategoryFilter(e.id,e.categoryValues):i.addRequiredField(e.id):e.filterType==="numeric"?i.addNumericFilter(e.id,e.min||"",e.max||""):e.filterType==="genomic"?i.addCategoryVariantInfoFilters({Gene_with_variant:e.Gene_with_variant,Variant_consequence_calculated:e.Variant_consequence_calculated,Variant_frequency_as_text:e.Variant_frequency_as_text}):e.filterType==="snp"?i.addSnpFilter(e.snpValues):e.filterType==="AnyRecordOf"&&i.addAnyRecordOfMulti(e.concepts)}),n(I).forEach(e=>{e.conceptPath&&i.addField(e.conceptPath)}),o.requireConsents&&s&&(i=V(i)),i.expectedResultType=a,{query:i,resourceUUID:t}}function b(s=!1,t=n(C).hpdsAuth,a="COUNT"){let i=new c;if(o.useQueryTemplate&&!s){const e=n(q).queryTemplate;e&&(i=new c(structuredClone(e)))}return o.requireConsents&&!s&&(i=V(i)),i.expectedResultType=a,{query:i,resourceUUID:t}}const V=s=>(!p(s.categoryFilters)&&!p(s.numericFilters)&&!g(s.fields)&&!g(s.requiredFields)&&s.removeCategoryFilter(x),n(y)||s.removeCategoryFilter(G),s),p=s=>Object.keys(s).some(t=>t.includes(R)),g=s=>s.some(t=>t.includes(R));export{c as Q,S as a,b as g,V as u};
