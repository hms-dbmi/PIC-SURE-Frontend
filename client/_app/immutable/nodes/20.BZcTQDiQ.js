import{c as Zt,a as i,f as l}from"../chunks/DKNWTM-D.js";import{w as j,g as E,o as te}from"../chunks/DpyMT7OB.js";import{f as F,c as s,r,s as d,t as k,R as ut,p as Ot,g as n,h as W,a as Vt,b as Dt,d as Tt,n as xt,e as ee,$ as ae,C as _t}from"../chunks/KPVYLOSR.js";import{s as H,d as Ht,h as re}from"../chunks/NtGCh5xy.js";import{i as Z}from"../chunks/CDCmQmr-.js";import{e as se,i as oe}from"../chunks/B5lqQSsR.js";import{s as At,b as pt,r as dt}from"../chunks/Be_LeCLl.js";import{a as Ct,b as jt}from"../chunks/BlQKM0Gb.js";import{b as ne}from"../chunks/BwVKHEJU.js";import{s as Nt,a as B,b as It,e as Jt}from"../chunks/B2Bg6RTa.js";import{b as ie}from"../chunks/BD7x6Jnt.js";import{d as le,u as de}from"../chunks/DR5Ig_-s.js";import{t as ce}from"../chunks/CWjZNTTC.js";import{C as ue}from"../chunks/a16e0A8-.js";import{s as vt}from"../chunks/kg2g7Go4.js";import{t as pe,s as ve}from"../chunks/nsQMHjqs.js";import{p as X}from"../chunks/CfrH0FQi.js";import{q as fe}from"../chunks/BqrDejZS.js";import{g as ct,c as me}from"../chunks/BpV1Tt4c.js";import{Q as he}from"../chunks/BuLTZ3Ym.js";import{b as be}from"../chunks/Bt-Xh7oU.js";import{M as wt}from"../chunks/D3jF9FdZ.js";var ye=l("<div><h3> </h3></div>"),ge=l('<div class="flex-auto"><!></div>'),_e=l('<div class="border rounded-md border-surface-600-400 ml-4 p-1"><!></div>'),$e=l('<div class="v-stepper mb-3 last:mb-0"><div class="flex gap-2 my-2"><div class="flex-none pt-1"><span> </span></div> <!> <!></div> <!></div>');function Rt(t,a){let e=X(a,"title",3,""),m=X(a,"collapsed",3,!1),c=X(a,"show",3,!0),p=X(a,"inline",3,!1),v=X(a,"active",3,!1);var h=Zt(),$=F(h);{var R=U=>{var S=$e(),_=s(S),q=s(_),T=s(q),A=s(T,!0);r(T),r(q);var b=d(q,2);{var J=D=>{var w=ye(),L=s(w),Ut=s(L,!0);r(L),r(w),k(()=>{pt(w,1,`flex-${p()?"none":"auto"}`),H(Ut,e())}),i(D,w)};Z(b,D=>{e()&&D(J)})}var N=d(b,2);{var x=D=>{var w=ge(),L=s(w);vt(L,()=>a.children??ut),r(w),i(D,w)};Z(N,D=>{p()&&D(x)})}r(_);var C=d(_,2);{var yt=D=>{var w=_e(),L=s(w);vt(L,()=>a.children??ut),r(w),i(D,w)};Z(C,D=>{!p()&&!m()&&D(yt)})}r(S),k(()=>{At(_,"data-testid",`v-stepper-step-${a.step}`),At(_,"aria-current",v()?"step":!1),pt(T,1,`avatar flex aspect-square justify-center items-center overflow-hidden isolate w-8 rounded-full text-xl ${v()?"preset-tonal-primary border border-primary-500":"preset-outlined-primary-500"}`),H(A,a.step)}),pe(3,S,()=>ve,()=>({duration:300,easing:fe,axis:"y"})),i(U,S)};Z($,U=>{c()&&U(R)})}i(t,h)}var xe=l("<div><!></div>");function Bt(t,a){var e=xe(),m=s(e);vt(m,()=>a.children??ut),r(e),k(()=>pt(e,1,`grid grid-cols-${a.columns} divide-x py-4`)),i(t,e)}var we=l('<div class="text-center border-surface-600-400 px-4 my-3"><div class="border-b border-primary-600-400 text-center mb-2"> <!></div> <!></div>');function lt(t,a){let e=X(a,"title",3,"");var m=we(),c=s(m),p=s(c),v=d(p);vt(v,()=>a.help??ut),r(c);var h=d(c,2);vt(h,()=>a.children??ut),r(m),k(()=>H(p,`${e()??""} `)),i(t,m)}var g=(t=>(t.Uploading="Uploading",t.Querying="Querying",t.Uploaded="Uploaded",t.Error="Error",t.Unsent="Unsent",t.Unknown="Unknown",t.Queued="Queued",t))(g||{});const De="picsure/query",Se="picsure/proxy/uploader/sites",Lt="picsure/proxy/uploader/status",qe="picsure/proxy/uploader/upload",Yt={uuid:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/,date:/^\d{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/};let ft=[];const rt=j(""),tt=j({genomic:!1,phenotypic:!1}),St=j(""),mt=j(""),ht={...St,set:t=>{Yt.uuid.test(t)&&St.set(t)}},qt={...mt,set:t=>{Yt.date.test(t)&&mt.set(t)}},zt=j(""),Gt=j(!1),Pt=j(null),kt=j(null),bt=j(null);function et(t,a=!1){return function(e){a&&Gt.set(!0),console.error(e),zt.set(t)}}function at(t){return t!=null&&t.error?Promise.reject(t.error):t}function Mt(t){bt.set(t);const a=E(qt);t.approved&&a!==t.approved&&mt.set(t.approved);const e=E(Pt);t.site?rt.set(t.site):e!=null&&e.homeSite&&rt.set(e.homeSite),tt.set({genomic:!!t.genomic&&t.genomic!==g.Unsent,phenotypic:!!t.phenotypic&&t.phenotypic!==g.Unsent})}async function Et(){const t=E(ht);await ct(`${Lt}/${t}`).then(at).then(Mt).catch(et("Error updating data request status."))}async function Qt(){const t=E(ht),a=E(kt),e=E(rt);if(!t||!a||!e)return;const m=E(tt),c=E(bt),p=v=>me(`${qe}/${e}?`+new URLSearchParams({dataType:v}),{...a.resultMetadata.queryJson.query,picSureId:t}).then(at).then(bt.set).catch(et(`Error sending ${v} data request`));m.phenotypic&&(c==null?void 0:c.phenotypic)===g.Unsent&&await p("Phenotypic"),m.genomic&&(c==null?void 0:c.genomic)===g.Unsent&&await p("Genomic")}async function Pe(){E(Pt)||await ct(Se).then(at).then(t=>{Pt.set(t),rt.set(t.homeSite)}).catch(et("Error retrieving site list."))}function ke(){ft.push(St.subscribe(async t=>{t&&await ct(`${Lt}/${t}`).then(at).then(Mt).then(()=>ct(`${De}/${t}/metadata`).then(at).then(kt.set).catch(et(`Metadata for ${t} could not be found.`,!0))).catch(et("We couldn't find any matching results. Please check to ensure the value you have entered is correct or try searching for a different Dataset Request ID",!0))})),ft.push(mt.subscribe(async t=>{const a=E(qt);if(!t||a)return;const e=E(ht);await ct(`${Lt}/${e}/approve?`+new URLSearchParams({date:t})).then(at).then(Mt).catch(et(`Status for ${e} was not found.`))}))}function Ue(){ft.forEach(t=>t()),ft=[]}function $t(){St.set(""),mt.set(""),Gt.set(!1),tt.set({genomic:!1,phenotypic:!1}),kt.set(null),bt.set(null)}var Ie=l('<section id="detail-summary-container" class="m-3"><table class="table bg-transparent"><tbody><tr><td>Dataset ID:</td><td data-testid="dataset-summary-uuid"> </td></tr></tbody></table></section> <!>',1);function Re(t,a){Ot(a,!0);const[e,m]=Nt(),c=()=>B(kt,"$metadata",e);let p=W(()=>{var b;return((b=c())==null?void 0:b.picsureResultId)||""}),v=W(()=>{var b;return((b=c())==null?void 0:b.resultMetadata.queryJson.query)||{}});var h=Ie(),$=F(h),R=s($),U=s(R),S=s(U),_=d(s(S)),q=s(_,!0);r(_),r(S),r(U),r(R),r($);var T=d($,2);{var A=b=>{he(b,{get query(){return n(v)}})};Z(T,b=>{n(v)&&b(A)})}k(()=>H(q,n(p))),i(t,h),Vt(),m()}var Ee=l(`<ul class="list-disc ml-4"><li>Select the <em class="font-bold">lead PI's home institution</em> from the drop-down menu. <ul class="list-none ml-4"><li><em>The lead PI is indicated on the RedCap form under the "Lead Principal Investigator's
          Institutional Affiliation"</em></li></ul></li> <li>The "Host Site," refers to the lead PI's home institution. The patient-level data will be stored
    in this institutional AWS-linked account.</li> <li>All collaborators listed on the RedCap form approved by the local SDAC will have access to the
    data within SWB.</li></ul>`);function Te(t){var a=Ee();i(t,a)}var Ae=l(`<ul class="list-disc ml-4"><li><em class="font-bold">Phenotypic Data:</em> Clinical data, electronic health record information.</li> <li><em class="font-bold">Annotated variant data for selected genes:</em> The annotated variant data
    is sourced from the combined, annotated VCF and represents the patient cohort selected by the applied
    genomic and clinical filters. The original sample VCFs have been annotated using the Ensembl Variant
    Effect Predictor (VEP) to provide additional annotations and determine the effects of each variant.
    Modifier variants have been removed. To learn more visit the User Guide.</li></ul>`);function Ce(t){var a=Ae();i(t,a)}async function Le(t,a,e){n(a)&&be&&localStorage.setItem("dataRequest-sendData-displayPrompt","no"),Dt(e,!1),await Qt()}var Me=l(`<p class="font-bold text-center mb-4">Sending data from PIC-SURE to Service Workbench could take several minutes.</p> <p class="font-bold text-center mb-4">To update the status of your data upload, click the refresh button <i class="fa-solid fa-arrows-rotate fa-sm text-primary-500"></i> next to "Status".</p> <div class="flex gap-2"><div class="flex-auto"><label><input data-testid="send-data-remember-checkbox" type="checkbox" class="checkbox flex-none"/> I understand, don't show this again</label></div> <div class="flex-none test-right"><button type="button" data-testid="send-data-modal-confirm-btn" class="btn preset-filled-primary-500">Okay, got it!</button></div></div>`,1),Qe=l('<button type="button" data-testid="send-data-btn" class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500">Send Data</button> <!>',1);function Oe(t,a){Ot(a,!0);let e=Tt(!1),m=Tt(!1);const c=X(a,"sendEnabled",3,!1);var p=Qe(),v=F(p);v.__click=function(...R){var U;(U=n(e)?Qt:()=>Dt(m,!0))==null||U.apply(this,R)};var h=d(v,2);const $=W(()=>!c());wt(h,{"data-testid":"send-data",get open(){return n(m)},get disabled(){return n($)},withDefault:!1,onconfirm:Qt,children:(R,U)=>{var S=Me(),_=d(F(S),4),q=s(_),T=s(q),A=s(T);dt(A),xt(),r(T),r(q);var b=d(q,2),J=s(b);J.__click=[Le,e,m],r(b),r(_),Ct(A,()=>n(e),N=>Dt(e,N)),i(R,S)},$$slots:{default:!0}}),k(()=>v.disabled=!c()),i(t,p),Vt()}Ht(["click"]);var Ve=l('<label class="inline label required"><span class="sr-only">Dataset Id:</span> <input class="input w-3/4" placeholder="001234567-89ab-cdef-fedc-98765432100"/></label>'),Ge=l('<i class="fa-regular fa-2xl fa-file-pdf"></i> <span>Data Request Summary</span>',1),We=l("<div><!></div>"),Fe=l('<label><div> </div> <input class="input w-48 mt-1" data-testid="data-approved-date" type="date"/></label>'),je=l("<!> <!>",1),Je=l('<i class="fa-regular fa-circle-question fa-sm text-primary-500"></i>'),Be=l("<option> </option>"),He=l('<select data-testid="selected-site" class="select"></select>'),Ne=l('<i class="fa-regular fa-circle-question fa-sm text-primary-500"></i>'),Ye=l('<label class="flex items-center space-x-2 my-2"><input type="checkbox" data-testid="data-pheno-checkbox" class="checkbox flex-none"/> <div>Phenotypic Data</div></label> <label class="flex space-x-2 my-2 align-top"><input type="checkbox" data-testid="data-geno-checkbox" class="checkbox flex-none"/> <div class="text-left flex-auto">Annotated variant data for selected genes</div></label> <!>',1),ze=l('<button type="button" data-testid="status-refresh-btn" title="Refresh" class="text-primary-500 disabled:text-secondary-500"><i class="fa-solid fa-arrows-rotate fa-sm"></i> <span class="sr-only">Refresh</span></button>'),Ke=l('<div class="flex space-x-2 my-2 align-top"><i></i> <div class="text-left flex-auto">Phenotypic Data: <span data-testid="status-pheno"> </span></div></div> <div class="flex space-x-2 my-2 align-top"><i></i> <div class="text-left flex-auto">Annotated variant data for selected genes: <span data-testid="status-geno"> </span></div></div>',1),Xe=l("<!> <!> <!>",1),Ze=l('<button type="button" data-testid="reset-btn" class="btn preset-tonal-secondary border border-secondary-500 float-right">Reset</button>'),ta=l("<!> <!> <!> <!>",1);function wa(t,a){Ot(a,!0);const[e,m]=Nt(),c=()=>B(Gt,"$queryError",e),p=()=>B(ht,"$queryId",e),v=()=>B(qt,"$approved",e),h=()=>B(tt,"$dataType",e),$=()=>B(bt,"$status",e),R=()=>B(Pt,"$sites",e),U=()=>B(rt,"$selectedSite",e);let S=W(()=>({show:!0,active:c()||!p()&&!v()})),_=W(()=>({show:!c()&&!!p(),active:!c()&&!!p()&&!v()})),q=W(()=>({show:!c()&&!!p()&&!!v(),active:!c()&&!!p()&&!!v()})),T=W(()=>{var x,C;return h().genomic&&((x=$())==null?void 0:x.genomic)===g.Unsent||h().phenotypic&&((C=$())==null?void 0:C.phenotypic)===g.Unsent}),A=ee({summary:!1,location:!1,type:!1});function b(x){return[{progress:[g.Uploaded],icon:"fa-regular fa-circle-check text-success-600-400",label:"Upload Successful"},{progress:[g.Queued,g.Querying,g.Uploading],icon:"fa-regular fa-paper-plane text-tertiary-600-400",label:"Uploading..."},{progress:[g.Error,g.Unknown],icon:"fa-solid fa-circle-xmark text-error-600-400",label:"Upload Failed"}].find(({progress:C})=>C.includes(x))||{icon:"fa-regular fa-circle-xmark text-primary-600-400",label:"Unsent"}}let J=W(()=>{var x,C;return{genomic:b(((x=$())==null?void 0:x.genomic)||g.Unsent),phenotypic:b(((C=$())==null?void 0:C.phenotypic)||g.Unsent)}});te(()=>(ke(),ft.push(zt.subscribe(x=>{x&&ce.error({title:x})})),Pe(),()=>{$t(),Ue()}));let N=Tt("");re(x=>{k(()=>ae.title=`${ie.applicationName??""} | Data Requests`)}),ue(t,{title:"Data Requests",children:(x,C)=>{var yt=ta(),D=F(yt);Rt(D,{step:1,title:"Search for Dataset Request ID",inline:!0,get active(){return n(S).active},children:(M,st)=>{var Q=Ve(),Y=d(s(Q),2);dt(Y);var z=W(()=>le(()=>It(ht,n(N)),500));Y.__keyup=function(...O){var K;(K=n(z))==null||K.apply(this,O)},At(Y,"pattern",de),r(Q),k(()=>Y.disabled=!n(S).active),jt(Y,()=>n(N),O=>Dt(N,O)),i(M,Q)},$$slots:{default:!0}});var w=d(D,2);Rt(w,{step:2,title:"Review Dataset Request",get show(){return n(_).show},get active(){return n(_).active},children:(M,st)=>{Bt(M,{columns:2,children:(Q,Y)=>{var z=je(),O=F(z);lt(O,{title:"View Dataset Information",children:(ot,gt)=>{var f=We(),P=s(f);wt(P,{title:"Data Request Summary","data-testid":"data-request",get open(){return A.summary},withDefault:!1,trigger:o=>{var y=Ge();xt(2),i(o,y)},children:(o,y)=>{Re(o,{})},$$slots:{trigger:!0,default:!0}}),r(f),i(ot,f)},$$slots:{default:!0}});var K=d(O,2);lt(K,{title:"Data Request Approval",children:(ot,gt)=>{var f=Fe(),P=s(f),u=s(P);r(P);var o=d(P,2);dt(o),r(f),k(()=>{var y;H(u,`Date approved by ${((y=R())==null?void 0:y.homeDisplay)??""} SDAC`),o.disabled=!n(_).active}),jt(o,v,y=>It(qt,y)),i(ot,f)},$$slots:{default:!0}}),i(Q,z)}})},$$slots:{default:!0}});var L=d(w,2);Rt(L,{step:3,title:"Share Patient-Level Data",get show(){return n(q).show},get active(){return n(q).active},children:(M,st)=>{Bt(M,{columns:3,children:(Q,Y)=>{var z=Xe(),O=F(z);lt(O,{title:"Data Storage Location",help:f=>{wt(f,{title:"Data Storage Location","data-testid":"data-loc-modal",get open(){return A.location},withDefault:!1,trigger:u=>{var o=Je();i(u,o)},children:(u,o)=>{Te(u)},$$slots:{trigger:!0,default:!0}})},children:(f,P)=>{var u=He();se(u,5,()=>{var o;return((o=R())==null?void 0:o.sites)||[]},oe,(o,y)=>{var I=Be(),V={},nt=s(I,!0);r(I),k(()=>{V!==(V=n(y))&&(I.value=(I.__value=n(y))??""),H(nt,n(y))}),i(o,I)}),r(u),k(()=>{var o;return u.disabled=!!((o=$())!=null&&o.site)}),ne(u,U,o=>It(rt,o)),i(f,u)},$$slots:{help:!0,default:!0}});var K=d(O,2);lt(K,{title:"Select & Send Data",help:f=>{wt(f,{title:"Data Types","data-testid":"data-type-modal",get open(){return A.type},withDefault:!1,trigger:u=>{var o=Ne();i(u,o)},children:(u,o)=>{Ce(u)},$$slots:{trigger:!0,default:!0}})},children:(f,P)=>{var u=Ye(),o=F(u),y=s(o);dt(y),xt(2),r(o);var I=d(o,2),V=s(I);dt(V),xt(2),r(I);var nt=d(I,2);Oe(nt,{get sendEnabled(){return n(T)}}),k(()=>{var G,it;y.disabled=((G=$())==null?void 0:G.phenotypic)!==g.Unsent,V.disabled=((it=$())==null?void 0:it.genomic)!==g.Unsent}),Ct(y,()=>h().phenotypic,G=>Jt(tt,_t(h).phenotypic=G,_t(h))),Ct(V,()=>h().genomic,G=>Jt(tt,_t(h).genomic=G,_t(h))),i(f,u)},$$slots:{help:!0,default:!0}});var ot=d(K,2);lt(ot,{title:"Status",help:f=>{var P=ze();P.__click=function(...u){Et==null||Et.apply(this,u)},i(f,P)},children:(f,P)=>{var u=Ke(),o=F(u),y=s(o),I=d(y,2),V=d(s(I)),nt=s(V,!0);r(V),r(I),r(o);var G=d(o,2),it=s(G),Wt=d(it,2),Ft=d(s(Wt)),Xt=s(Ft,!0);r(Ft),r(Wt),r(G),k(()=>{pt(y,1,`${n(J).phenotypic.icon} flex-none`),H(nt,n(J).phenotypic.label),pt(it,1,`${n(J).genomic.icon} flex-none`),H(Xt,n(J).genomic.label)}),i(f,u)},$$slots:{help:!0,default:!0}}),i(Q,z)}})},$$slots:{default:!0}});var Ut=d(L,2);{var Kt=M=>{var st=Ze();st.__click=function(...Q){$t==null||$t.apply(this,Q)},i(M,st)};Z(Ut,M=>{(n(_).show||n(q).show)&&M(Kt)})}i(x,yt)},$$slots:{default:!0}}),Vt(),m()}Ht(["keyup","click"]);export{wa as component};
