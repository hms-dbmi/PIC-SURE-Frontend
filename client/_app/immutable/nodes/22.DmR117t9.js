import{f as g,t as N,a as u,c as K}from"../chunks/CtfeAAbw.js";import{p as B,f as D,g as t,h,s as T,n as j,t as v,a as M,c as q,r as I,b as Q,d as V,$ as W,e as X}from"../chunks/B4GrenNm.js";import{s as H,h as Y}from"../chunks/DxSOTiY2.js";import{a as Z}from"../chunks/bf3FOAR_.js";import{e as tt,i as et}from"../chunks/BdG0KSB2.js";import{s as x,b as O}from"../chunks/BPiAbArq.js";import{p as z,s as at,a as rt,d as st}from"../chunks/DvPjbdiY.js";import{r as ot,d as it}from"../chunks/DlIBaGjY.js";import{g as F}from"../chunks/BNhMDwfB.js";import{b as lt}from"../chunks/CHRSknKA.js";import{E as nt}from"../chunks/BVg5wqNm.js";import{C as ut}from"../chunks/zKmJQbFp.js";import{S as ct}from"../chunks/DoWV-49m.js";import{i as dt}from"../chunks/CSsnQ7i2.js";import{d as mt}from"../chunks/D7VV4X-8.js";import{t as L}from"../chunks/BRrMSDP5.js";import{g as pt,u as ft,U as vt}from"../chunks/Dkr8_lrJ.js";import{g as gt,C as bt}from"../chunks/oNeBSBJe.js";import{g as $t,R as _t}from"../chunks/DrQstrIY.js";import{g as ht}from"../chunks/DS4yCP_l.js";import{M as xt}from"../chunks/D7DxCjf8.js";import{L as yt}from"../chunks/DYQPks66.js";function wt(m,n){m.stopPropagation(),F(`/admin/users/${n().cell}/edit`)}var At=g('<button type="button" title="Edit" aria-label="Edit" class="btn-icon-color"><i class="fa-solid fa-pen-to-square fa-xl"></i></button>'),Ct=g('<button type="button" class="btn-icon-color"><i></i></button>'),Ut=g("<!> <!>",1);function Rt(m,n){B(n,!0);let o=z(n,"data",19,()=>({cell:"",row:{status:"",email:""}}));const a=h(()=>o().row.status==="Active");async function b(l){const r=await pt(o().cell);if(!r)return;const i=await gt(r.connection),s=await Promise.all(r.roles.map(c=>$t(c).then(f=>({...f,privileges:f.privileges.map(e=>ht(e))}))));if(!(r&&i&&s.length>0))return;let p={...r,active:l,connection:i,roles:s};try{await ft(p),L.success({title:`Successfully ${l?"r":"d"}eactivated user '${p.email}'`})}catch(c){console.error(c),L.error({title:`An error occured while ${l?"r":"d"}eactivating user '${r.email}'`})}}var y=Ut(),w=D(y);{var R=l=>{var r=At();r.__click=[wt,o],v(()=>x(r,"data-testid",`user-${o().cell??""}-edit-btn`)),u(l,r)};dt(w,l=>{t(a)&&l(R)})}var E=T(w,2);const S=h(()=>o().cell),P=h(()=>t(a)?"D":"R"),A=h(()=>t(a)?"D":"R"),k=h(()=>t(a)?"D":"R");xt(E,{get"data-testid"(){return`user-${t(S)??""}-${t(P)??""}eactivate-btn`},get title(){return`${t(A)??""}eactivate User?`},get confirmText(){return`${t(k)??""}eactivate`},onconfirm:()=>b(!t(a)),withDefault:!0,trigger:r=>{var i=Ct(),s=q(i);I(i),v(()=>{x(i,"data-testid",`user-${t(a)?"d":"r"}eactivate-btn-${o().cell??""}`),x(i,"title",`${t(a)?"D":"R"}eactivate user`),x(i,"aria-label",`${t(a)?"D":"R"}eactivate user`),O(s,1,`fa-solid fa-trash${t(a)?"":"-arrow-up"} fa-xl`)}),u(r,i)},children:(r,i)=>{j();var s=N();v(()=>H(s,`Are you sure you want to ${t(a)?"d":"r"}eactiveate user '${o().row.email??""}'?`)),u(r,s)},$$slots:{trigger:!0,default:!0}}),u(m,y),M()}mt(["click"]);var Et=g("<span> </span>");function St(m,n){B(n,!0);let o=z(n,"data",19,()=>({cell:"",row:{}}));var a=Et(),b=q(a,!0);I(a),v(()=>{O(a,1,`badge last:p-1 rounded-sm preset-filled-${o().cell==="Active"?"success":"error"}-500`),H(b,o().cell)}),u(m,a),M()}var Pt=g('<div class="mb-10"><!></div>'),kt=g('<div class="flex gap-4 mb-6"><div class="flex-auto"><a data-testid="add-user-btn" class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500" href="/admin/users/new">+ Add User</a></div></div> <!>',1);function te(m,n){B(n,!0);const[o,a]=at(),b=()=>rt(t(A),"$usersByConnection",o);let{users:y,loadUsers:w}=vt,{connections:R,loadConnections:E}=bt,{roles:S,loadRoles:P}=_t,A=Q(V(ot([])));const k=[{dataElement:"email",label:"Username",sort:!0,class:"w-1/3"},{dataElement:"roles",label:"Role(s)",sort:!0,class:"normal-case!"},{dataElement:"status",label:"Status",sort:!0,class:"w-24 text-center"},{dataElement:"uuid",label:"Actions",sort:!1,class:"w-24 text-center"}],l={status:St,uuid:Rt};async function r(){await E(),await P(),await w(),st(X(A,it([y,R,S],([s,p,c])=>p.map(f=>({label:f.label,users:s.filter(e=>f.uuid===e.connection).map(e=>({uuid:e.uuid||"",email:e.email||"uuid:"+e.uuid,roles:e.roles.length===0?"none":e.roles.map(d=>{var $;return($=c.find(_=>_.uuid===d))==null?void 0:$.name}).sort().join(", "),status:e.active?"Active":"Inactive"})).sort((e,d)=>e.status.localeCompare(d.status))}))),!0),"$usersByConnection",o)}const i=s=>{const p=s==null?void 0:s.uuid;F(`/admin/users/${p}/edit`)};Y(s=>{v(()=>W.title=`${lt.applicationName??""} | Manage Users`)}),ut(m,{title:"Manage Users",children:(s,p)=>{var c=K(),f=D(c);Z(f,r,e=>{yt(e,{})},e=>{var d=kt(),$=T(D(d),2);tt($,1,b,et,(_,C)=>{var U=Pt(),G=q(U);ct(G,{get tableName(){return`Users-${t(C).label??""}`},get data(){return t(C).users},columns:k,cellOverides:l,get title(){return t(C).label},rowClickHandler:i,isClickable:!0,searchable:!0,tableAuto:!1}),I(U),v(J=>x(U,"id",J),[()=>`user-table-${t(C).label.replaceAll(" ","_")}`]),u(_,U)}),u(e,d)},e=>{nt(e,{title:"API Error",children:(d,$)=>{j();var _=N("Something went wrong when sending your request.");u(d,_)},$$slots:{default:!0}})}),u(s,c)},$$slots:{default:!0}}),M(),a()}export{te as component};
