import{r as le,s as ne,a as C,p as oe,f as u,g as y,i as p,k as B,o as se,a9 as ie,e as _,t as b,c as h,b as g,d as k,m as v,h as f,j as T,q as I,l as U,n as N,v as H,y as ce}from"../chunks/CseAM1pm.js";import{h as Q,u as ue}from"../chunks/CndaLTDj.js";import{S as fe,i as de,d as q,e as S,m as L,t as w,a as x,f as j,g as pe,b as me}from"../chunks/CUD_i9MT.js";import{g as _e}from"../chunks/xidBtgCA.js";import"../chunks/Cd9QPAjN.js";import{P as he}from"../chunks/COOwqBnE.js";import{w as F,g as ve}from"../chunks/Dx2jxSvH.js";import{s as V,b as be}from"../chunks/DOzTaxCY.js";import{C as ge}from"../chunks/BF6l3jvP.js";import{E as z}from"../chunks/DATm8Xn3.js";import{T as ke}from"../chunks/BDw-puhd.js";import{p as J}from"../chunks/C0bL_-nh.js";import{g as $e}from"../chunks/Di8U3o-F.js";var A=(i=>(i.Full="full",i.Aggregate="aggregate",i))(A||{});const K="/picsure/query/sync",Z=F(0),ee=F([]),te=F([]),re=F(""),ae=F(A.Aggregate),O=F("");async function Ee(i){i.query.expectedResultType="VARIANT_COUNT_FOR_QUERY";const e=await J(K,i).then(r=>r.count).catch(r=>(console.error(r),O.set("An error occured while retrieving variant count data. Please contact your PIC-SURE admin."),0));Z.set(e)}async function X(i){i.query.expectedResultType=le(ae)===A.Aggregate?"AGGREGATE_VCF_EXCERPT":"VCF_EXCERPT";const e=await J(K,i).catch(n=>(console.error(n),O.set("An error occured while retrieving variant data. Please contact your PIC-SURE admin."),""));if(!e)return;re.set(URL.createObjectURL(new Blob([e],{type:"octet/stream"})));const r=e.split(`
`),t=r[0].split("	"),l=r.slice(1).map(n=>n.split("	")).filter(n=>n.length>1),a=V.variantExplorer.excludeColumns.map(n=>t.indexOf(n)).filter(n=>n>=0);te.set(l.map(n=>n.reduce((s,o,c)=>(a.includes(c)||(s[t[c].toString()]=o),s),{}))),ee.set(t.filter((n,s)=>!a.includes(s)).map(n=>({dataElement:n,label:n,sort:!0})))}function Y(i){let e,r,t,l=i[1]?" (Aggregate)":"",a,n;return{c(){e=_("div"),r=_("a"),t=b("Download Variant"),a=b(l),n=b(" Data"),this.h()},l(s){e=h(s,"DIV",{});var o=g(e);r=h(o,"A",{"data-testid":!0,class:!0,href:!0,download:!0});var c=g(r);t=k(c,"Download Variant"),a=k(c,l),n=k(c," Data"),c.forEach(u),o.forEach(u),this.h()},h(){v(r,"data-testid","variant-download-btn"),v(r,"class","btn variant-ghost-primary mt-8 mr-6 float-right"),v(r,"href",i[3]),v(r,"download","variantData.tsv")},m(s,o){p(s,e,o),f(e,r),f(r,t),f(r,a),f(r,n)},p(s,o){o&2&&l!==(l=s[1]?" (Aggregate)":"")&&T(a,l),o&8&&v(r,"href",s[3])},d(s){s&&u(e)}}}function Ce(i){let e,r="Variant Explorer",t,l,a;return l=new z({props:{title:"Error",$$slots:{default:[we]},$$scope:{ctx:i}}}),{c(){e=_("h3"),e.textContent=r,t=C(),q(l.$$.fragment)},l(n){e=h(n,"H3",{"data-svelte-h":!0}),U(e)!=="svelte-10ts0do"&&(e.textContent=r),t=y(n),S(l.$$.fragment,n)},m(n,s){p(n,e,s),p(n,t,s),L(l,n,s),a=!0},p(n,s){const o={};s&8192&&(o.$$scope={dirty:s,ctx:n}),l.$set(o)},i(n){a||(w(l.$$.fragment,n),a=!0)},o(n){x(l.$$.fragment,n),a=!1},d(n){n&&(u(e),u(t)),j(l,n)}}}function ye(i){let e,r="Variant Explorer",t,l,a,n,s={ctx:i,current:null,token:null,hasCatch:!0,pending:Fe,then:Pe,catch:xe,error:12,blocks:[,,,]};return Q(a=i[0],s),{c(){e=_("h2"),e.textContent=r,t=C(),l=I(),s.block.c(),this.h()},l(o){e=h(o,"H2",{class:!0,"data-svelte-h":!0}),U(e)!=="svelte-n8q177"&&(e.textContent=r),t=y(o),l=I(),s.block.l(o),this.h()},h(){v(e,"class","text-center clear-both")},m(o,c){p(o,e,c),p(o,t,c),p(o,l,c),s.block.m(o,s.anchor=c),s.mount=()=>l.parentNode,s.anchor=l,n=!0},p(o,c){i=o,s.ctx=i,c&1&&a!==(a=i[0])&&Q(a,s)||ue(s,i,c)},i(o){n||(w(s.block),n=!0)},o(o){for(let c=0;c<3;c+=1){const d=s.blocks[c];x(d)}n=!1},d(o){o&&(u(e),u(t),u(l)),s.block.d(o),s.token=null,s=null}}}function we(i){let e,r=`Variant explorer feature has not been enabled in this environment. Please contact an admin
        if you have any questions.`;return{c(){e=_("p"),e.textContent=r},l(t){e=h(t,"P",{"data-svelte-h":!0}),U(e)!=="svelte-okrpxb"&&(e.textContent=r)},m(t,l){p(t,e,l)},p:N,d(t){t&&u(e)}}}function xe(i){let e,r;return e=new z({props:{title:"Error",$$slots:{default:[Ae]},$$scope:{ctx:i}}}),{c(){q(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,l){L(e,t,l),r=!0},p(t,l){const a={};l&8193&&(a.$$scope={dirty:l,ctx:t}),e.$set(a)},i(t){r||(w(e.$$.fragment,t),r=!0)},o(t){x(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Ae(i){let e,r=(i[12]||"An error occured while retrieving variant list.")+"",t;return{c(){e=_("p"),t=b(r)},l(l){e=h(l,"P",{});var a=g(e);t=k(a,r),a.forEach(u)},m(l,a){p(l,e,a),f(e,t)},p(l,a){a&1&&r!==(r=(l[12]||"An error occured while retrieving variant list.")+"")&&T(t,r)},d(l){l&&u(e)}}}function Pe(i){let e,r,t,l;const a=[Re,De,Ve],n=[];function s(o,c){return o[2]>V.variantExplorer.maxCount?0:o[2]>0&&o[4].length>0?1:2}return e=s(i),r=n[e]=a[e](i),{c(){r.c(),t=I()},l(o){r.l(o),t=I()},m(o,c){n[e].m(o,c),p(o,t,c),l=!0},p(o,c){let d=e;e=s(o),e===d?n[e].p(o,c):(pe(),x(n[d],1,1,()=>{n[d]=null}),me(),r=n[e],r?r.p(o,c):(r=n[e]=a[e](o),r.c()),w(r,1),r.m(t.parentNode,t))},i(o){l||(w(r),l=!0)},o(o){x(r),l=!1},d(o){o&&u(t),n[e].d(o)}}}function Ve(i){let e,r,t;return{c(){e=_("div"),r=b(i[2]),t=b(" variants found"),this.h()},l(l){e=h(l,"DIV",{"data-testid":!0,class:!0});var a=g(e);r=k(a,i[2]),t=k(a," variants found"),a.forEach(u),this.h()},h(){v(e,"data-testid","variant-count"),v(e,"class","flex-none w-full")},m(l,a){p(l,e,a),f(e,r),f(e,t)},p(l,a){a&4&&T(r,l[2])},i:N,o:N,d(l){l&&u(e)}}}function De(i){let e,r;return e=new ke({props:{tableName:"variant-explorer",data:i[4],columns:i[5],defaultRowsPerPage:10,fullWidth:!0,search:!0,$$slots:{tableActions:[Te]},$$scope:{ctx:i}}}),{c(){q(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,l){L(e,t,l),r=!0},p(t,l){const a={};l&16&&(a.data=t[4]),l&32&&(a.columns=t[5]),l&8198&&(a.$$scope={dirty:l,ctx:t}),e.$set(a)},i(t){r||(w(e.$$.fragment,t),r=!0)},o(t){x(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Re(i){let e,r,t,l,a,n,s,o,c=V.variantExplorer.maxCount+"",d,$,D,P;return{c(){e=_("aside"),r=_("i"),t=C(),l=_("div"),a=_("p"),n=b("Too many variants! Found "),s=b(i[2]),o=b(`, but cannot display more than
              `),d=b(c),$=b(" variants."),D=C(),P=_("p"),this.h()},l(E){e=h(E,"ASIDE",{class:!0});var m=g(e);r=h(m,"I",{class:!0}),g(r).forEach(u),t=y(m),l=h(m,"DIV",{class:!0});var G=g(l);a=h(G,"P",{});var R=g(a);n=k(R,"Too many variants! Found "),s=k(R,i[2]),o=k(R,`, but cannot display more than
              `),d=k(R,c),$=k(R," variants."),R.forEach(u),G.forEach(u),m.forEach(u),D=y(E),P=h(E,"P",{}),g(P).forEach(u),this.h()},h(){v(r,"class","fa-solid fa-triangle-exclamation text-4xl"),v(l,"class","alert-message"),v(e,"class","alert variant-filled-warning")},m(E,m){p(E,e,m),f(e,r),f(e,t),f(e,l),f(l,a),f(a,n),f(a,s),f(a,o),f(a,d),f(a,$),p(E,D,m),p(E,P,m)},p(E,m){m&4&&T(s,E[2])},i:N,o:N,d(E){E&&(u(e),u(D),u(P))}}}function M(i){let e,r,t,l;return{c(){e=_("div"),r=_("p"),t=b(i[2]),l=b(" variants found"),this.h()},l(a){e=h(a,"DIV",{"data-testid":!0,class:!0});var n=g(e);r=h(n,"P",{});var s=g(r);t=k(s,i[2]),l=k(s," variants found"),s.forEach(u),n.forEach(u),this.h()},h(){v(e,"data-testid","variant-count"),v(e,"class","")},m(a,n){p(a,e,n),f(e,r),f(r,t),f(r,l)},p(a,n){n&4&&T(t,a[2])},d(a){a&&u(e)}}}function Ie(i){let e,r,t,l,a,n="Aggregate data",s,o;return{c(){e=_("div"),r=_("label"),t=_("input"),l=C(),a=_("p"),a.textContent=n,this.h()},l(c){e=h(c,"DIV",{class:!0});var d=g(e);r=h(d,"LABEL",{class:!0});var $=g(r);t=h($,"INPUT",{class:!0,type:!0}),l=y($),a=h($,"P",{"data-svelte-h":!0}),U(a)!=="svelte-3s6voj"&&(a.textContent=n),$.forEach(u),d.forEach(u),this.h()},h(){v(t,"class","checkbox"),v(t,"type","checkbox"),v(r,"class","flex items-center space-x-2"),v(e,"class","")},m(c,d){p(c,e,d),f(e,r),f(r,t),t.checked=i[1],f(r,l),f(r,a),s||(o=[H(t,"change",i[7]),H(t,"click",i[6])],s=!0)},p(c,d){d&2&&(t.checked=c[1])},d(c){c&&u(e),s=!1,ce(o)}}}function Te(i){let e,r,t=i[2]>0&&M(i),l=V.variantExplorer.type===A.Full&&Ie(i);return{c(){e=_("div"),t&&t.c(),r=C(),l&&l.c(),this.h()},l(a){e=h(a,"DIV",{class:!0});var n=g(e);t&&t.l(n),r=y(n),l&&l.l(n),n.forEach(u),this.h()},h(){v(e,"class","flex-auto flex items-end justify-between")},m(a,n){p(a,e,n),t&&t.m(e,null),f(e,r),l&&l.m(e,null)},p(a,n){a[2]>0?t?t.p(a,n):(t=M(a),t.c(),t.m(e,r)):t&&(t.d(1),t=null),V.variantExplorer.type===A.Full&&l.p(a,n)},d(a){a&&u(e),t&&t.d(),l&&l.d()}}}function Fe(i){let e,r,t="Loading",l,a,n,s=i[2]>0&&W(i);return a=new he({props:{animIndeterminate:"anim-progress-bar"}}),{c(){s&&s.c(),e=C(),r=_("h3"),r.textContent=t,l=C(),q(a.$$.fragment),this.h()},l(o){s&&s.l(o),e=y(o),r=h(o,"H3",{class:!0,"data-svelte-h":!0}),U(r)!=="svelte-16fo5h6"&&(r.textContent=t),l=y(o),S(a.$$.fragment,o),this.h()},h(){v(r,"class","text-left")},m(o,c){s&&s.m(o,c),p(o,e,c),p(o,r,c),p(o,l,c),L(a,o,c),n=!0},p(o,c){o[2]>0?s?s.p(o,c):(s=W(o),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},i(o){n||(w(a.$$.fragment,o),n=!0)},o(o){x(a.$$.fragment,o),n=!1},d(o){o&&(u(e),u(r),u(l)),s&&s.d(o),j(a,o)}}}function W(i){let e,r,t;return{c(){e=_("div"),r=b(i[2]),t=b(" variants found"),this.h()},l(l){e=h(l,"DIV",{"data-testid":!0,class:!0});var a=g(e);r=k(a,i[2]),t=k(a," variants found"),a.forEach(u),this.h()},h(){v(e,"data-testid","variant-count"),v(e,"class","flex-none w-full")},m(l,a){p(l,e,a),f(e,r),f(e,t)},p(l,a){a&4&&T(r,l[2])},d(l){l&&u(e)}}}function Ne(i){let e,r,t,l;const a=[ye,Ce],n=[];function s(o,c){return 1}return e=s(),r=n[e]=a[e](i),{c(){r.c(),t=I()},l(o){r.l(o),t=I()},m(o,c){n[e].m(o,c),p(o,t,c),l=!0},p(o,c){r.p(o,c)},i(o){l||(w(r),l=!0)},o(o){x(r),l=!1},d(o){o&&u(t),n[e].d(o)}}}function Ue(i){let e,r,t,l;document.title=be.applicationName+" | Variant Explorer";let a=i[3]&&Y(i);return t=new ge({props:{full:!0,backUrl:"/explorer",backTitle:"Back to Explore",$$slots:{default:[Ne]},$$scope:{ctx:i}}}),{c(){e=C(),a&&a.c(),r=C(),q(t.$$.fragment)},l(n){oe("svelte-s876e9",document.head).forEach(u),e=y(n),a&&a.l(n),r=y(n),S(t.$$.fragment,n)},m(n,s){p(n,e,s),a&&a.m(n,s),p(n,r,s),L(t,n,s),l=!0},p(n,[s]){n[3]?a?a.p(n,s):(a=Y(n),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null);const o={};s&8247&&(o.$$scope={dirty:s,ctx:n}),t.$set(o)},i(n){l||(w(t.$$.fragment,n),l=!0)},o(n){x(t.$$.fragment,n),l=!1},d(n){n&&(u(e),u(r)),a&&a.d(n),j(t,n)}}}function qe(i,e,r){let t,l,a,n;B(i,Z,m=>r(2,t=m)),B(i,re,m=>r(3,l=m)),B(i,te,m=>r(4,a=m)),B(i,ee,m=>r(5,n=m));const s=_e();let o,c,d=V.variantExplorer.type===A.Full,$;async function D(){await Ee($),t>0&&t<=V.variantExplorer.maxCount&&await X($)}async function P(){r(1,d=!d),ae.set(d?A.Aggregate:A.Full),r(0,o=X($))}se(()=>{$=$e(!0),$.query.hasFilter()?(c=O.subscribe(m=>{m&&s.trigger({message:m,background:"variant-filled-error"})}),r(0,o=D())):(s.trigger({message:"No query provided. Please add a genomic filter to explore variant data.",background:"variant-filled-error"}),ve("/explorer"))}),ie(()=>{c&&c()});function E(){d=this.checked,r(1,d)}return[o,d,t,l,a,n,P,E]}class Je extends fe{constructor(e){super(),de(this,e,qe,Ue,ne,{})}}export{Je as component};
