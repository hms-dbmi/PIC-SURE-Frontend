import{f as C,a as b,t as le}from"../chunks/DKNWTM-D.js";import{p as Q,c as m,r as u,s as g,t as E,g as o,h as T,a as B,n as de,$ as ue,b as fe,d as me}from"../chunks/KPVYLOSR.js";import{s as L,h as ve}from"../chunks/NtGCh5xy.js";import{e as se,i as pe}from"../chunks/B5lqQSsR.js";import{s as U,b as A}from"../chunks/Be_LeCLl.js";import{b as $}from"../chunks/BD7x6Jnt.js";import{g as K}from"../chunks/DNfOBMJV.js";import{S as he}from"../chunks/CDV5rpmT.js";import{d as ae,w as z,o as ge}from"../chunks/DpyMT7OB.js";import{i as F}from"../chunks/CDCmQmr-.js";import{a as I,s as oe}from"../chunks/B2Bg6RTa.js";import{c as D,j as V}from"../chunks/BpV1Tt4c.js";import{a as W}from"../chunks/BibUdOWF.js";import{a as xe,b as _e}from"../chunks/BPGq02fb.js";import{a as ye}from"../chunks/DXJ436YI.js";import{h as be}from"../chunks/Bu63eCiy.js";import{p as $e}from"../chunks/CfrH0FQi.js";import{L as we}from"../chunks/BW_ShK1N.js";import{E as Se}from"../chunks/P3bGLiu7.js";const Y="picsure/query/sync",M=z(!1),X=z(!1),G=z([]),Z=ae(G,t=>t.filter(s=>!s.auth)),ee=ae(G,t=>t.filter(s=>s.auth));function H(t){return t!=null&&t.errorType?Promise.reject("api error"):t}function te(t,s){var e,a,c;const n=((c=(a=(e=$)==null?void 0:e.landing)==null?void 0:a.statFields[t])==null?void 0:c.map(f=>f.conceptPath))||[];if(n.length===0)return Promise.reject(`${t} feilds were not configured`);const d=W(V(),s);return d.query.setCrossCountFields(n),D(Y,d).then(H).then(f=>Object.values(f).reduce((w,v)=>w+v,0))}function Ce(){var d,i;const t=((i=(d=$)==null?void 0:d.landing)==null?void 0:i.statFields.consent)||[];if(t.length===0)return Promise.reject("consent feilds were not configured");const s=t.reduce((e,a)=>({...e,[a.conceptPath]:[...e[a.conceptPath]||[],a.id]}),{}),n=W(V(),"COUNT");return Object.entries(s).forEach(([e,a])=>n.query.addCategoryFilter(e,a)),D(Y,n).then(H)}const N={"dict:facets:dataset_id":t=>_e(t,"dataset_id"),"dict:concepts":t=>xe(t),"query:blank":t=>D(Y,W(t)).then(H),"query:biosample":()=>te("biosample","OBSERVATION_CROSS_COUNT"),"query:genomic":()=>te("genomic","CROSS_COUNT"),"query:consent":()=>Ce(),hardcoded:(t,s)=>Promise.resolve((s==null?void 0:s.value)||0)};async function je(){var n,d;const t=((d=(n=$)==null?void 0:n.landing)==null?void 0:d.stats)||[];if(t.length===0)return;X.set(!1),M.set(!1);const s=t.filter(i=>!!N[i.key]).reduce((i,e)=>{const a=[...i],c=(e==null?void 0:e.auth)===void 0?!0:e.auth,f=(e==null?void 0:e.auth)===void 0?!0:!e.auth;return c&&V()&&a.push({...e,auth:!0,value:N[e.key](!1,e)}),f&&a.push({...e,auth:!1,value:N[e.key](!0,e)}),a},[]);G.set(s),Promise.allSettled(s.map(i=>i.value)).then(i=>{i.some(e=>e.status==="rejected")&&M.set(!0),X.set(!0)})}var Pe=C('<strong class="p-1 mb-3"> </strong>'),ke=C('<i class="fa-solid fa-circle-exclamation p-1 mb-4 mt-1"></i>'),qe=C('<div class="p-4 not-last:border-r border-surface-500"><div class="flex flex-col justify-center items-center text-2xl"><!></div> <p> </p></div>'),Ee=C('<div class="w-full flex flex-col items-center"><div class="w-2/4"><!></div> <div></div></div>');function re(t,s){Q(s,!0);const[n,d]=oe(),i=()=>I(s.stats,"$stats",n);let e=$e(s,"auth",3,!1),a=T(()=>e()?"auth":"open");var c=Ee(),f=m(c),w=m(f);be(w,()=>s.description),u(f);var v=g(f,2);se(v,5,i,_=>`${o(a)}-${_.key}-${_.label}`,(_,x)=>{var y=qe(),r=m(y),l=m(r);ye(l,()=>o(x).value,S=>{we(S,{ring:!0,size:"mini"})},(S,j)=>{var k=Pe(),P=m(k,!0);u(k),E(q=>L(P,q),[()=>o(j)&&o(j).toLocaleString()]),b(S,k)},S=>{var j=ke();b(S,j)}),u(r);var p=g(r,2),h=m(p,!0);u(p),u(y),E(()=>{U(r,"data-testid",`value-${o(a)??""}-${o(x).key??""}-${o(x).label??""}`),L(h,o(x).label)}),b(_,y)}),u(v),u(c),E(()=>{U(c,"data-testid",`data-summary-${o(a)??""}`),A(v,1,`grid grid-cols-${i().length??""} grid-flow-col justify-center p-4 my-4 gap-y-9 ${i().length>4?"w-full":"w-1/2"}`)}),b(t,c),B(),d()}var Le=C('<section class="flex flex-col items-center w-full p-4 bg-surface-100-900"><h2 class="m-4">Data Summary</h2> <!> <!> <!></section>');function Oe(t,s){Q(s,!0);const[n,d]=oe(),i=()=>I(ee,"$authStats",n),e=()=>I(Z,"$stats",n),a=()=>I(M,"$hasError",n);ge(()=>je());var c=Le(),f=g(m(c),2);{var w=r=>{const l=T(()=>{var p,h;return(h=(p=$)==null?void 0:p.landing)==null?void 0:h.authExplanation});re(r,{stats:ee,auth:!0,get description(){return o(l)}})};F(f,r=>{i().length>0&&r(w)})}var v=g(f,2);{var _=r=>{const l=T(()=>{var p,h;return(h=(p=$)==null?void 0:p.landing)==null?void 0:h.explanation});re(r,{stats:Z,get description(){return o(l)}})};F(v,r=>{e().length>0&&r(_)})}var x=g(v,2);{var y=r=>{Se(r,{"data-testid":"landing-error",solid:!0,children:(l,p)=>{de();var h=le("We're having trouble fetching some data points right now. Please try again later.");b(l,h)},$$slots:{default:!0}})};F(x,r=>{a()&&r(y)})}u(c),b(t,c),B(),d()}var Ie=C('<div><div class="text-3xl my-1"> </div> <i></i> <div class="subtitle my-3"> </div> <a class="btn preset-filled-primary-500"> </a></div>'),Te=C('<div id="landing" class="flex flex-wrap flex-col justify-evenly text-center items-center w-full h-full mt-8"><section id="search-section" class="flex flex-col text-center items-center my-4 mt-auto w-2/3"><!></section> <section id="actions-section" class="flex flex-row justify-evenly items-center w-2/3 mt-auto mb-8"></section> <!></div>');function et(t,s){var x,y;Q(s,!0);let n=me("");const d=()=>!!localStorage.getItem("token");function i(){d()?K(`/explorer?search=${o(n)}`):K(`/discover?search=${o(n)}`)}const e=(y=(x=$)==null?void 0:x.landing)==null?void 0:y.actions.filter(r=>d()?r.showIfLoggedIn:r.isOpen||!r.showIfLoggedIn);var a=Te();ve(r=>{E(()=>ue.title=$.applicationName)});var c=m(a),f=m(c);const w=T(()=>{var r,l;return(l=(r=$)==null?void 0:r.landing)==null?void 0:l.searchPlaceholder});he(f,{get placeholder(){return o(w)},search:i,get searchTerm(){return o(n)},set searchTerm(r){fe(n,r,!0)}}),u(c);var v=g(c,2);se(v,21,()=>e,pe,(r,l)=>{let p=()=>o(l).title,h=()=>o(l).description,S=()=>o(l).icon,j=()=>o(l).url,k=()=>o(l).btnText;var P=Ie(),q=m(P),ne=m(q,!0);u(q);var J=g(q,2),R=g(J,2),ie=m(R,!0);u(R);var O=g(R,2),ce=m(O,!0);u(O),u(P),E(()=>{A(P,1,`flex flex-col items-center w-1/${(e==null?void 0:e.length)||3}`),L(ne,p()),A(J,1,`text-[5rem] my-3 text-secondary-600-400 ${S()??""}`),L(ie,h()),U(O,"data-testid",`landing-action-${p()??""}-btn`),U(O,"href",j()),L(ce,k())}),b(r,P)}),u(v);var _=g(v,2);Oe(_,{}),u(a),b(t,a),B()}export{et as component};
