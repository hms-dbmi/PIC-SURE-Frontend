var Kt=Object.defineProperty;var St=l=>{throw TypeError(l)};var Zt=(l,e,t)=>e in l?Kt(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var at=(l,e,t)=>Zt(l,typeof e!="symbol"?e+"":e,t),ea=(l,e,t)=>e.has(l)||St("Cannot "+t);var G=(l,e,t)=>(ea(l,e,"read from private field"),t?t.call(l):e.get(l)),he=(l,e,t)=>e.has(l)?St("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,t);import"../chunks/Bzak7iHL.js";import{p as re,at as He,f as A,d as v,s as P,B as ta,r as c,t as V,b as n,c as se,S as ne,k as a,au as Ye,e as K,a as B,j as ue,n as Y,u as L,h as O,i as fe,l as C,m as aa,o as xt}from"../chunks/DhSNEPDw.js";import{s as W,d as et}from"../chunks/DVtHS8ol.js";import{i as M}from"../chunks/BG76zvuN.js";import{p as Pe,a as Z,s as Me,e as qe,c as ra}from"../chunks/DpjY2ypC.js";import{w as Tt,a as sa,o as Ge,g as _t}from"../chunks/xU7jw7XU.js";import{a as ze}from"../chunks/Jhkhy7E3.js";import{g as bt}from"../chunks/Dkbkn6HV.js";import{c as Le,k as Ne,e as Ct,r as kt,t as nt,j as $t}from"../chunks/M2p3ZkHt.js";import{f as z,b as ge,s as oa}from"../chunks/BOAiLg0g.js";import{E as qt,e as Mt,r as na,a as la}from"../chunks/eUoM9-xI.js";import{f as wt,Q as ut,p as ia}from"../chunks/Bji3XOvx.js";import{l as ca,r as da,t as Lt}from"../chunks/Cnvmmg-i.js";import{f as Oe,c as Pt}from"../chunks/HOQb_8TW.js";import{s as st}from"../chunks/C8tG8t5X.js";import{e as We,i as Xe}from"../chunks/ByI6iVq5.js";import{s as Ue,b as J,c as Dt,r as ft,d as ua,h as fa}from"../chunks/aV0zye_u.js";import{t as lt,a as it}from"../chunks/BbooiKwf.js";import{A as mt,C as va}from"../chunks/5IRW-zVC.js";import{U as pa}from"../chunks/CZDEQpCN.js";import{E as Be}from"../chunks/CQQkdEes.js";import{L as ye}from"../chunks/CzbepVLR.js";import{a as Nt}from"../chunks/dJtbhcX9.js";import{a as ma,b as Ut}from"../chunks/DPXw0ygh.js";import{m as ha,n as ga,d as ya}from"../chunks/CHznAy_H.js";import{S as xa}from"../chunks/DoUav4w7.js";import{C as ht}from"../chunks/Cr1yGYQD.js";import{c as gt}from"../chunks/CpcxNR6b.js";import{T as rt}from"../chunks/Dmx9hz0_.js";import{C as It,T as yt}from"../chunks/D2bEea91.js";import{b as _a}from"../chunks/Bt-Xh7oU.js";import{M as ba}from"../chunks/BinYu0ZY.js";import{C as wa}from"../chunks/DGPivDrk.js";import{g as Ea}from"../chunks/C55AtZ90.js";async function Ra(l,e,t){if(e===""&&e.trim()==="")throw"Please input a Dataset ID name";const w=/^[\w \-\\/?+=[\].():"']+$/g;if(!e.match(w))throw`Name can only contain letters, numbers, and these special symbols - ? + = [ ] . ( ) : ' "`;const u={queryId:l,name:e};return t&&(u.metadata={saved:new Date().valueOf(),siteQueryIds:t}),await Le(Ne.NamedDataSet,u)}function Sa(l){return new Promise(e=>setTimeout(e,l))}function Pa(l,e=1e3,t=3e4,w=!0){const u=Math.min(e*Math.pow(2,l),t);if(w){const d=u*.25;return u+(Math.random()*2-1)*d}return u}async function Da(l,e=3,t=1e3,w=3e4,u){let d;for(let m=0;m<e;m++)try{return await l()}catch(i){if(console.warn("Backoff caught: ",i),d=i,u&&!u(i,m))throw i;if(m<e-1){const x=Pa(m,t,w);await Sa(x)}}throw d}const Ae=Tt({current:0,total:0,stepMap:[]});var Ia=A("<div><span> </span></div>"),Aa=A('<header class="stepper-header flex items-center border-t mt-[15px] mb-7 border-surface-500 gap-4"></header>'),Ta=A('<div data-testid="stepper"><!> <div class="stepper-content"><!></div></div>');function Ca(l,e){re(e,!0);const t=()=>Z(Ae,"$stepperState",w),[w,u]=Me(),d=()=>{},m=Pe(e,"buttonCompleteLabel",3,""),i=Pe(e,"class",3,""),x=Pe(e,"onnext",3,d),h=Pe(e,"onback",3,d),r=Pe(e,"oncomplete",3,d);async function s(_){if(await new Promise($=>setTimeout($)),_)return;const I=t().current+1,q=t().stepMap[I];x()(I,q,t()),qe(Ae,ne(t).current=I,ne(t))}function g(){const _=t().current===0?0:t().current-1,I=t().stepMap[_];h()(_,I,t()),qe(Ae,ne(t).current=_,ne(t))}function D(_,I){I||r()(_,t().stepMap[_],t())}function p(_){return _===t().current}He("buttonCompleteLabel",m()),He("StepperState",Ae),He("onBack",g),He("onNext",s),He("onComplete",D);var f=Ta(),y=v(f);{var b=_=>{var I=Aa();We(I,5,()=>Array.from(Array(t().total).keys()),Xe,(q,$)=>{var E=Ia();let o;var R=v(E),k=v(R,!0);c(R),c(E),V((ve,pe,xe)=>{o=Ue(E,1,"stepper-header-step -mt-[15px] transition-all duration-300",null,o,ve),J(R,"data-testid",`step-${t().stepMap[a($)]??""}`),Ue(R,1,`badge rounded-2xl text-sm ${pe??""}`),W(k,xe)},[()=>({"flex-1":p(a($))}),()=>p(a($))?"preset-filled-primary-500":"preset-filled-surface-500",()=>p(a($))?`Step ${a($)+1}`:a($)+1]),n(q,E)}),c(I),lt(1,I,()=>it,()=>({duration:100})),lt(2,I,()=>it,()=>({duration:100})),n(_,I)};M(y,_=>{t().total&&_(b)})}var T=P(y,2),S=v(T);st(S,()=>e.children??ta),c(T),c(f),V(()=>Ue(f,1,`stepper space-y-4 ${i()??""}`)),n(l,f),se(),u()}var ka=A('<header class="step-header text-2xl font-bold"><!></header>'),$a=A('<div class="step-navigation-slot"><!></div>'),qa=A("<div></div>"),Ma=A('<div class="step-navigation flex justify-between gap-4"><!> <!></div>'),La=A('<div class="step space-y-4"><!> <div class="step-content space-y-4 px-2"><!></div> <!></div>');function Je(l,e){re(e,!0);const t=()=>Z(i,"$stepperState",w),[w,u]=Me(),d=Pe(e,"locked",3,!1),m=Ye("buttonCompleteLabel"),i=Ye("StepperState"),x=Ye("onNext"),h=Ye("onBack"),r=Ye("onComplete"),s=t().total;qe(i,ne(t).stepMap=[...t().stepMap,e.name],ne(t)),qe(i,ne(t).total++,ne(t)),sa(()=>{qe(i,ne(t).total--,ne(t)),qe(i,ne(t).stepMap=t().stepMap.filter(f=>f!==e.name),ne(t))});var g=K(),D=B(g);{var p=f=>{var y=La(),b=v(y);{var T=o=>{var R=ka(),k=v(R);st(k,()=>e.header),c(R),n(o,R)};M(b,o=>{e.header&&o(T)})}var S=P(b,2),_=v(S);{var I=o=>{var R=K(),k=B(R);st(k,()=>e.children),n(o,R)},q=o=>{var R=ue();V(()=>W(R,`(Step ${s+1} Content)`)),n(o,R)};M(_,o=>{e.children?o(I):o(q,!1)})}c(S);var $=P(S,2);{var E=o=>{var R=Ma(),k=v(R);{var ve=N=>{var U=$a(),X=v(U);st(X,()=>e.navigation),c(U),n(N,U)},pe=N=>{var U=K(),X=B(U);{var F=H=>{{let we=L(()=>t().current===0);mt(H,{get onclick(){return h},get disabled(){return a(we)},children:(Ee,Re)=>{Y();var oe=ue("Back");n(Ee,oe)},$$slots:{default:!0}})}},Q=H=>{var we=qa();n(H,we)};M(X,H=>{s!==0?H(F):H(Q,!1)},!0)}n(N,U)};M(k,N=>{e.navigation?N(ve):N(pe,!1)})}var xe=P(k,2);{var Te=N=>{mt(N,{name:"next",angle:"right",variant:"filled",color:"primary-500",get disabled(){return d()},onclick:()=>x(d()),children:(U,X)=>{Y();var F=ue("Next");n(U,F)},$$slots:{default:!0}})},j=N=>{{let U=L(()=>m||"complete");mt(N,{get name(){return a(U)},angle:"right",variant:"filled",color:"primary-500",get disabled(){return d()},onclick:()=>r(s,d()),children:(X,F)=>{Y();var Q=ue();V(()=>W(Q,m||"Complete")),n(X,Q)},$$slots:{default:!0}})}};M(xe,N=>{s<t().total-1?N(Te):N(j,!1)})}c(R),lt(1,R,()=>it,()=>({duration:100})),lt(2,R,()=>it,()=>({duration:100})),n(o,R)};M($,o=>{t().total>1&&o(E)})}c(y),V(()=>J(y,"data-testid",`step-${s+1}`)),n(f,y)};M(D,f=>{s===t().current&&f(p)})}n(l,g),se(),u()}var Na=A('<i></i> <span id="site-indicator-label" class="uppercase"> </span> <span id="site-indicator-value" class="ml-1"> </span>',1),Ua=A('<i class="fa-solid fa-circle-xmark text-error-500"></i> <span id="site-indicator-label"> </span>',1),Fa=A('<i></i> <span id="site-indicator-label" class="uppercase"> </span>',1),Oa=A('<div id="site-indicator"><!></div>'),Ba=A('<div id="site-indicators" class="grid grid-cols-3 gap-y-2 gap-x-6"></div>'),ja=A('<div id="stats" class="w-full flex justify-evenly mb-5 pb-2 svelte-jecuqt"><div id="summary" class="w-full grid grid-flow-col auto-cols-auto"><div class="text-xl"><label for="summary" class="mr-8 font-bold">Summary:</label></div> <div class="flex justify-left text-xl font-light"><span id="participants" class="mr-2"> </span> <label for="participants">Participants</label></div> <div class="flex justify-left text-xl font-light"><span id="variables" class="mr-2"> </span> <label for="variables">Variables</label></div> <div class="flex justify-left text-xl font-light"><span id="dataPoints" class="mr-2"> </span> <label for="dataPoints">Data Points</label></div></div></div> <!>',1);function tt(l,e){re(e,!0);const t=()=>Z(Lt,"$totalParticipants",i),w=()=>Z(wt,"$filters",i),u=()=>Z(h,"$exports",i),d=()=>Z(Oe,"$federatedQueryMap",i),m=()=>Z(da,"$resultCounts",i),[i,x]=Me();let{exports:h}=qt,r=L(t),s=L(()=>{const j=w().filter(N=>N.filterType==="AnyRecordOf");return j.reduce((N,U)=>N+U.concepts.length,0)-j.length}),g=L(()=>w().length+u().length+a(s)),D=L(()=>typeof a(r)=="number"?a(r)*a(g):0),p=O(fe({}));function f(j){switch((j==null?void 0:j.status)!==void 0?j==null?void 0:j.status:j.count?"COMPLETE":"ERROR"){case"AVAILABLE":case"COMPLETE":return"fa-solid fa-circle-check text-success-500";case"ERROR":return"fa-solid fa-circle-xmark text-error-500";case"PENDING":return"fa-solid fa-clock text-warning-500";default:return"fa-solid fa-circle text-surface-500"}}let y=L(()=>{const j={};return Object.entries(d()).forEach(([N,U])=>{j[N]={...U}}),Object.entries(a(p)).forEach(([N,U])=>{j[N]?j[N].count=U:j[N]={count:U}}),j}),b=L(()=>a(y)?Object.fromEntries(Object.entries(a(y)).map(([j,N])=>[j,f(N)])):{});Ge(async()=>{m().length===0&&await ca(!1);const j=m().find(N=>N.key==="query:patientCount");j&&C(p,j.result,!0)});var T=ja(),S=B(T),_=v(S),I=P(v(_),2),q=v(I),$=v(q,!0);c(q),Y(2),c(I);var E=P(I,2),o=v(E),R=v(o,!0);c(o),Y(2),c(E);var k=P(E,2),ve=v(k),pe=v(ve,!0);c(ve),Y(2),c(k),c(_),c(S);var xe=P(S,2);{var Te=j=>{var N=Ba();We(N,21,()=>Object.entries(a(y)),Xe,(U,X)=>{var F=L(()=>aa(a(X),2));let Q=()=>a(F)[0],H=()=>a(F)[1];var we=Oa(),Ee=v(we);{var Re=le=>{{let ie=L(()=>`${Q()}`);ye(le,{size:"micro",get label(){return a(ie)}})}},oe=le=>{var ie=K(),Se=B(ie);{var Ce=me=>{var _e=K(),De=B(_e);ze(De,()=>{var te;return(te=H())==null?void 0:te.count},te=>{{let ce=L(()=>`${Q()}`);ye(te,{size:"micro",get label(){return a(ce)}})}},(te,ce)=>{var Ie=Na(),je=B(Ie),ee=P(je,2),be=v(ee,!0);c(ee);var $e=P(ee,2),vt=v($e);c($e),V(()=>{Ue(je,1,Dt(a(b)[Q()])),W(be,Q()),W(vt,`(${a(ce)??""})`)}),n(te,Ie)},te=>{var ce=Ua(),Ie=P(B(ce),2),je=v(Ie,!0);c(Ie),V(()=>W(je,Q())),n(te,ce)}),n(me,_e)},ke=me=>{var _e=Fa(),De=B(_e),te=P(De,2),ce=v(te,!0);c(te),V(()=>{Ue(De,1,Dt(a(b)[Q()])),W(ce,Q())}),n(me,_e)};M(Se,me=>{var _e;(_e=H())!=null&&_e.count?me(Ce):me(ke,!1)},!0)}n(le,ie)};M(Ee,le=>{var ie;((ie=H())==null?void 0:ie.status)==="PENDING"?le(Re):le(oe,!1)})}c(we),n(U,we)}),c(N),n(j,N)};M(xe,j=>{z.federated&&a(y)&&Object.keys(a(y)).length>0&&j(Te)})}V(()=>{W($,a(r)),W(R,a(g)),W(pe,a(D))}),n(l,T),se(),x()}async function Qa(l,e,t,w,u,d){var m;try{if(C(e,!0),!a(t)){const r=(m=a(w))==null?void 0:m.map(s=>s.ref);na(r||[]),C(u,a(u).filter(s=>!a(w).some(g=>g.variableId===s.variableId)));return}const x=(await d()).map(r=>({id:ia(),searchResult:r,display:(r==null?void 0:r.display)||"",conceptPath:(r==null?void 0:r.conceptPath)||""}));la(x);const h=x.map(r=>{var s,g,D;return{ref:r,variableId:(s=r==null?void 0:r.searchResult)==null?void 0:s.conceptPath,variableName:r==null?void 0:r.display,description:(g=r==null?void 0:r.searchResult)==null?void 0:g.description,type:(D=r==null?void 0:r.searchResult)==null?void 0:D.type,selected:!0}});C(u,Array.from([...a(u),...h].reduce((r,s)=>r.set(s.variableId,s),new Map).values())),C(w,h,!0)}catch(i){console.error("Error in toggleSampleIds",i),nt.error({description:"We were unable to fetch the sample IDs for your selected data. Please try again later."}),C(t,!1)}finally{C(e,!1)}}var za=A('<input type="checkbox" class="mr-1 &amp;[aria-disabled=“true”]:opacity-75" data-testid="sample-ids-checkbox" id="sample-ids-checkbox"/>'),Va=A('<div><label for="sample-ids-checkbox" class="flex items-center" data-testid="sample-ids-label"><!> <span>Include sample identifiers</span></label></div>'),Ga=A("<!> <!>",1),Wa=A('<div id="first-step-container" class="flex flex-col w-full h-full items-center"><!> <section class="w-full"><!></section></div>');function Xa(l,e){re(e,!0);const t=()=>Z(Mt,"$exports",u),w=()=>Z(kt,"$resources",u),[u,d]=Me(),m=[{dataElement:"name",label:"Variable Name",sort:!0},{dataElement:"description",label:"Variable Description",sort:!0},{dataElement:"type",label:"Type",sort:!0,class:"text-center"}];let i=L(()=>e.rows),x=O(!1),h=O(!1),r=O(fe([])),s=O(!1);Ge(async()=>{const S=t().filter(_=>_.conceptPath.includes("SAMPLE_ID"));if(S.length>0){C(s,!0);const _=await g();if(_.length>0){const I=S.filter(q=>_.some($=>$.conceptPath===q.conceptPath));C(h,I.length===_.length),C(s,!1),a(h)&&C(r,I.map(q=>{var $,E;return{ref:q,variableId:q.conceptPath,variableName:q.display,description:($=q.searchResult)==null?void 0:$.description,type:(E=q.searchResult)==null?void 0:E.type,selected:!0}}),!0)}else C(h,!1),C(s,!1)}else C(h,!1)});async function g(){await Ct();const S=await ha("",[{name:"data_source_genomic",category:"data_source",display:"Genomic",description:"Associated with genomic data",count:0}],{pageNumber:0,pageSize:1e4});if(S.content.length===0)return[];const _=new ut(structuredClone(Nt(e.query).query));_.expectedResultType="CROSS_COUNT";const I=S.content.map($=>$.conceptPath);_.setCrossCountFields(I);const q=await Le(Ne.QueryV2Sync,{query:_,resourceUUID:w().hpdsAuth});return S.content.filter($=>q[$.conceptPath]>0)}var D=Wa(),p=v(D);tt(p,{});var f=P(p,2),y=v(f);{var b=S=>{Be(S,{"data-testid":"landing-error",title:"Warning",color:"warning",closeText:"Back",onclose:()=>bt("/explorer"),children:(_,I)=>{Y();var q=ue(`Warning: Your selected data exceeds 1,000,000 estimated data points, which is too large to
        export. Please reduce the data selection or the number of selected participants.`);n(_,q)},$$slots:{default:!0}})},T=S=>{var _=K(),I=B(_);{var q=E=>{var o=Ga(),R=B(o);xa(R,{tableName:"ExportSummary",get data(){return a(i)},get columns(){return m}});var k=P(R,2);{var ve=pe=>{var xe=Va(),Te=v(xe),j=v(Te);{var N=X=>{ye(X,{size:"micro",ring:!0})},U=X=>{var F=za();ft(F),F.__change=[Qa,x,h,r,i,g],ma(F,()=>a(h),Q=>C(h,Q)),n(X,F)};M(j,X=>{a(s)?X(N):X(U,!1)})}Y(2),c(Te),c(xe),n(pe,xe)};M(k,pe=>{z.explorer.enableSampleIdCheckbox&&pe(ve)})}n(E,o)},$=E=>{ye(E,{ring:!0,size:"micro",label:"Loading sample IDs"})};M(I,E=>{a(x)?E($,!1):E(q)},!0)}n(S,_)};M(y,S=>{e.dataLimitExceeded?S(b):S(T,!1)})}c(f),c(D),n(l,D),se(),d()}et(["change"]);const Ve=Tt([]);function Ft(l){Ve.update(e=>e.includes(l)?e:[...e,l])}function Ha(l){Ve.update(e=>e.filter(t=>t!==l))}Ve.subscribe;var Ya=async(l,e)=>await e.node.toggleOpen(),Ja=A('<i class="fa-solid fa-spinner fa-spin"></i>'),Ka=A("<i></i>"),Za=A('<i class="fa-solid fa-minus"></i>'),er=async(l,e)=>await e.node.toggleSelected(),tr=A('<span class="text-error-500 text-sm ml-2"><i class="fa-solid fa-exclamation-triangle"></i></span>'),ar=A('<div class="text-error-500 text-sm p-2"> </div>'),rr=A('<details class="tree-item"><summary class="tree-item-summary list-none [&amp;::-webkit-details-marker]:hidden flex items-center cursor-pointer space-x-4 rounded-container p-0 hover:preset-tonal-primary w-full" role="treeitem"><button type="button" class="m-1 ml-2"><!></button> <input class="checkbox tree-item-checkbox mr-1" type="checkbox"/> <label class="w-full"> </label> <!></summary> <div class="tree-item-children ml-4" role="group"><!></div></details>');function Ot(l,e){re(e,!0);var t=rr(),w=v(t),u=v(w);u.__click=[Ya,e];var d=v(u);{var m=y=>{var b=K(),T=B(b);{var S=I=>{var q=Ja();n(I,q)},_=I=>{var q=Ka();V(()=>Ue(q,1,`fa-solid fa-angle-${e.node.open?"down":"right"}`)),n(I,q)};M(T,I=>{e.node.loading?I(S):I(_,!1)})}n(y,b)},i=y=>{var b=Za();n(y,b)};M(d,y=>{e.node.isLeaf?y(i,!1):y(m)})}c(u);var x=P(u,2);ft(x),x.__click=[er,e];var h=P(x,2),r=v(h,!0);c(h);var s=P(h,2);{var g=y=>{var b=tr();V(()=>J(b,"title",e.node.error)),n(y,b)};M(s,y=>{e.node.error&&y(g)})}c(w);var D=P(w,2),p=v(D);{var f=y=>{var b=K(),T=B(b);{var S=I=>{var q=ar(),$=v(q);c(q),V(()=>W($,`Error loading children: ${e.node.error??""}`)),n(I,q)},_=I=>{var q=K(),$=B(q);We($,17,()=>e.node.children,Xe,(E,o)=>{Ot(E,{get node(){return a(o)}})}),n(I,q)};M(T,I=>{e.node.error?I(S):I(_,!1)})}n(y,b)};M(p,y=>{!e.node.isLeaf&&e.node.open&&y(f)})}c(D),c(t),V(()=>{J(t,"data-testid",`tree-item:${e.node.name??""}-${e.node.value??""}`),J(t,"aria-disabled",e.node.disabled),t.open=e.node.open,J(w,"aria-selected",e.node.allSelected),J(w,"aria-expanded",e.node.open),J(u,"id",`tree-item-btn:${e.node.name??""}-${e.node.value??""}`),J(u,"data-testid",`tree-item-btn:${e.node.name??""}-${e.node.value??""}`),J(u,"title",e.node.isLeaf?void 0:`${e.node.open?"Close":"Open"} node`),J(u,"name",e.node.name),J(u,"tabindex",e.node.isLeaf?-1:0),u.disabled=e.node.loading,J(x,"id",`checkbox:${e.node.name??""}-${e.node.value??""}`),J(x,"data-testid",`checkbox:${e.node.name??""}-${e.node.value??""}`),J(x,"name",e.node.name),ua(x,e.node.value),fa(x,e.node.allSelected),x.indeterminate=e.node.indeterminant,J(h,"for",`${e.node.isLeaf?"checkbox:":"tree-item-btn:"}${e.node.name??""}-${e.node.value??""}`),W(r,e.node.value),J(D,"data-testid",`tree-item-children:${e.node.name??""}`)}),n(l,t),se()}et(["click"]);var sr=A("<div></div>");function or(l,e){var r,s,g,D,p,f,y,b,T,S,_,I,$;re(e,!0);let t=Pe(e,"initialNodes",19,()=>[]),w=Pe(e,"onselect",3,()=>{}),u=Pe(e,"onunselect",3,()=>{}),d=Pe(e,"fullWidth",3,!1);const q=class q{constructor(o){at(this,"name","");at(this,"value","");at(this,"conceptPath","");he(this,r,O(!1));he(this,s,O(!1));he(this,g,O(!1));he(this,D,O(fe([])));he(this,p,O(!1));he(this,f,O(null));he(this,y,O(!1));he(this,b,O(!1));he(this,T,L(()=>this.isLeaf?this.selected:this.children.some(o=>o.someSelected||o.selected)));he(this,S,L(()=>this.isLeaf?this.selected:this.children.length===0?this.selected:this.children.every(o=>o.allSelected)));he(this,_,L(()=>this.isLeaf?!this.selected:!this.someSelected));he(this,I,L(()=>this.isLeaf||this.children.length===0?!1:this.someSelected&&!this.allSelected));var R;this.name=o.name,this.value=o.name,this.conceptPath=o.conceptPath,this.isLeaf=!1,this.children=((R=o==null?void 0:o.children)==null?void 0:R.map(k=>new q(k)))??[],this.isLeaf&&(this.childrenLoaded=!0)}get open(){return a(G(this,r))}set open(o){C(G(this,r),o,!0)}get selected(){return a(G(this,s))}set selected(o){C(G(this,s),o,!0)}get disabled(){return a(G(this,g))}set disabled(o){C(G(this,g),o,!0)}get children(){return a(G(this,D))}set children(o){C(G(this,D),o,!0)}get loading(){return a(G(this,p))}set loading(o){C(G(this,p),o,!0)}get error(){return a(G(this,f))}set error(o){C(G(this,f),o,!0)}get isLeaf(){return a(G(this,y))}set isLeaf(o){C(G(this,y),o,!0)}get childrenLoaded(){return a(G(this,b))}set childrenLoaded(o){C(G(this,b),o,!0)}get someSelected(){return a(G(this,T))}set someSelected(o){C(G(this,T),o)}get allSelected(){return a(G(this,S))}set allSelected(o){C(G(this,S),o)}get noneSelected(){return a(G(this,_))}set noneSelected(o){C(G(this,_),o)}get indeterminant(){return a(G(this,I))}set indeterminant(o){C(G(this,I),o)}async select(){this.isLeaf?(w()(this.conceptPath),this.selected=!0):(this.childrenLoaded||await this.loadChildren(),this.children.length>0?await Promise.all(this.children.map(o=>o.select())):(w()(this.conceptPath),this.selected=!0))}async unselect(){this.isLeaf?(this.selected=!1,u()(this.conceptPath)):(this.childrenLoaded||await this.loadChildren(),await Promise.all(this.children.map(o=>o.unselect())))}async toggleSelected(){this.allSelected?await this.unselect():await this.select()}async toggleOpen(){this.isLeaf||(this.open?this.open=!1:(this.childrenLoaded||await this.loadChildren(),this.open=!0))}async loadChildren(){if(!(this.loading||this.childrenLoaded||this.isLeaf)){this.loading=!0,this.error=null;try{const o=await e.fetchChildren(this.conceptPath);this.children=o.map(R=>new q(R)),this.childrenLoaded=!0,this.isLeaf=this.children.length===0}catch(o){this.error=o instanceof Error?o.message:"Failed to load children",console.error("Error loading children for",this.conceptPath,o)}finally{this.loading=!1}}}};r=new WeakMap,s=new WeakMap,g=new WeakMap,D=new WeakMap,p=new WeakMap,f=new WeakMap,y=new WeakMap,b=new WeakMap,T=new WeakMap,S=new WeakMap,_=new WeakMap,I=new WeakMap;let m=q,i=fe((($=t())==null?void 0:$.map(E=>new m(E)))??void 0);function x(E,o){E.isLeaf?E.selected=o.includes(E.conceptPath):E.children&&E.children.length>0?(E.children.forEach(k=>x(k,o)),E.children.some(k=>k.selected||k.someSelected)&&(E.open=!0),E.selected=E.children.every(k=>k.selected)):E.selected=o.includes(E.conceptPath)}Ge(()=>{i&&e.previousSelectedConcepts&&e.previousSelectedConcepts.length>0&&i.forEach(E=>{x(E,e.previousSelectedConcepts)})});var h=sr();We(h,21,()=>i,Xe,(E,o)=>{Ot(E,{get node(){return a(o)}})}),c(h),V(()=>Ue(h,1,`overflow-auto ${d()?"w-full":""}`)),n(l,h),se()}var nr=A('<section class="flex flex-col w-full h-full items-center"><!> <div class="w-full h-full m-2 card p-4"><header class="card-header">Select <strong>additional variables</strong> you would like to be included in your final data export.</header> <hr/> <div class="card-body p-4"><!></div></div></section>');function lr(l,e){re(e,!0);const t=()=>Z(Ve,"$selectedConcepts",w),[w,u]=Me();let d=t()&&t().length>0?Math.max(...t().map(p=>p.split("\\").filter(Boolean).length)):1;async function m(p){const f=p.split("\\")[1],y=p.split("\\").filter(Boolean).length,b=await ya(f,y,p);function T(_){return!_.children||_.children.length===0?[_]:_.children.flatMap(T)}const S=T(b);return S.length===1&&S[0].conceptPath===p?[]:S}const i=p=>{Ft(p)},x=p=>{Ha(p)};var h=nr(),r=v(h);tt(r,{});var s=P(r,2),g=P(v(s),4),D=v(g);ze(D,()=>ga(d),p=>{ye(p,{ring:!0,size:"small"})},(p,f)=>{{let y=L(()=>_t(Ve));or(p,{get initialNodes(){return a(f)},fetchChildren:m,fullWidth:!0,onselect:i,onunselect:x,get previousSelectedConcepts(){return a(y)}})}}),c(g),c(s),c(h),n(l,h),se(),u()}let Bt=O(fe({resourceUUID:"",query:new ut})),jt=O(void 0),Qt=O(void 0),zt=O(void 0),Vt=O(!0),Gt=O(!1);function Ke(l){C(jt,l,!0)}function Ze(){return a(jt)}function ct(l){C(Qt,l,!0)}function ae(){return a(Qt)}function Et(l){C(zt,l,!0)}function Fe(){return a(zt)}function ot(l){C(Vt,l,!0)}function ir(){return a(Vt)}function de(){return a(Bt)}function Wt(l){C(Bt,l,!0)}function dt(l){C(Gt,l,!0)}function cr(){return a(Gt)}function At(){Ke(void 0),ct(void 0),Et(void 0),ot(!0),dt(!1),Wt({resourceUUID:"",query:new ut})}var dr=A('<section class="flex flex-col w-full h-full items-center"><!> <div class="flex flex-row justify-center"><!> <!> <!></div></section>');function ur(l,e){re(e,!0);var t=dr(),w=v(t);tt(w,{});var u=P(w,2),d=v(u);{let h=L(()=>Ze()==="DATAFRAME");ht(d,{"data-testid":"csv-export-option",title:"Export as Data Frame or CSV",subtitle:"Export data as a Python or R data frame or a comma-separated values file",size:"other",class:"flex-1 max-w-64",get active(){return a(h)},onclick:()=>Ke("DATAFRAME")})}var m=P(d,2);{var i=h=>{{let r=L(()=>Ze()==="DATAFRAME_TIMESERIES");ht(h,{"data-testid":"timeseries-export-option",title:"Export as Timeseries",subtitle:"Export as an R or Python data frame or a comma-separated values file including timestamps",size:"other",class:"flex-1 max-w-64",get active(){return a(r)},onclick:()=>Ke("DATAFRAME_TIMESERIES")})}};M(m,h=>{z.explorer.enableExportTimeseries&&h(i)})}var x=P(m,2);{let h=L(()=>Ze()==="DATAFRAME_PFB");ht(x,{"data-testid":"pfb-export-option",title:"Export as PFB",subtitle:"Export data in Portable Format for Biomedical Data file format",size:"other",class:"flex-1 max-w-64",get active(){return a(h)},onclick:()=>Ke("DATAFRAME_PFB")})}c(u),c(t),n(l,t),se()}var fr=A('<label for="dataset-id" class="font-bold mr-2">Dataset ID:</label> <div id="dataset-id" class="mr-4"> </div>',1),vr=A('<label for="dataset-id" class="font-bold mr-2">Dataset ID:</label> <!>',1),pr=A(`<div class="w-full h-full m-2 card p-4"><header class="card-header">Save the information in your final data export by clicking the Save Dataset ID button.
        Navigate to the <a class="anchor" href="/dataset">Manage Datasets page</a> to view or manage
        your Dataset IDs.</header> <hr/> <div class="card-body p-4 flex flex-col justify-center items-center"><div><div class="flex items-center m-2"><label for="dataset-name" class="font-bold mr-2">Dataset Name:</label> <input type="text" id="dataset-name" class="input w-80" placeholder="Enter a name" required/></div> <div class="flex items-center m-2"><div class="flex items-center"><!></div></div></div></div></div>`),mr=A('<div class="flex justify-center mb-4"><!></div>'),hr=A('<section class="flex flex-col w-full h-full items-center"><!> <!></section>');function gr(l,e){re(e,!0);const t=()=>Z(Ae,"$stepperState",w),[w,u]=Me(),d=7;let m=O(""),i=O(fe(Promise.resolve())),x=O(fe(Promise.resolve())),h=O(fe(Fe()));async function r(){let p;const f={initial:"Creating dataset ID...",waiting:"Hang tight. We are still working on it...",retry:"Something's taking longer than usual. We are still working on it..."};function y(b,T=!0){C(m,T?f.initial:f.retry,!0),T&&(p=setInterval(()=>{C(m,f.waiting,!0)},d*1e3)),C(i,b().finally(()=>clearInterval(p)).catch(S=>{if(T)y(b,!1);else throw S}),!0)}try{de().query.expectedResultType=Ze()||"DATAFRAME",ct(""),y(()=>Le(Ne.QueryV2,de()).then(b=>{ct(b.picsureResultId||"Error")})),await a(i)}catch(b){throw qe(Ae,ne(t).current--,ne(t)),console.error("Error in submitQuery",b),b}}xt(()=>{var p,f;dt((((p=Fe())==null?void 0:p.length)??0)>2&&(((f=ae())==null?void 0:f.length)??0)>0)}),xt(()=>{Et(a(h))}),Ge(()=>{C(x,r(),!0)});var s=hr(),g=v(s);tt(g,{});var D=P(g,2);ze(D,()=>a(x),p=>{ye(p,{ring:!0})},p=>{var f=pr(),y=P(v(f),4),b=v(y),T=v(b),S=P(v(T),2);ft(S),c(T);var _=P(T,2),I=v(_),q=v(I);ze(q,()=>a(i),$=>{var E=vr(),o=P(B(E),2);ye(o,{ring:!0,size:"micro",get label(){return a(m)}}),n($,E)},$=>{var E=fr(),o=P(B(E),2),R=v(o,!0);c(o),V(k=>W(R,k),[ae]),n($,E)},$=>{Be($,{title:"An error occurred while getting the dataset ID. Please try again later."})}),c(I),c(_),c(b),c(y),c(f),Ut(S,()=>a(h),$=>C(h,$)),n(p,f)},p=>{var f=mr(),y=v(f);Be(y,{title:`An error occurred while preparing your dataset. Please try again. If this problem persists, please
          contact an administrator.`}),c(f),n(p,f)}),c(s),n(l,s),se(),u()}async function yr(l){const e=_t(Pt);if(e)return e;const w={query:new ut,resourceUUID:_t(kt).queryIdGen};try{const d=(await Le(Ne.QueryV2,w)).picsureResultId;if(!d)throw new Error("Failed to generate common area UUID");return Pt.set(d),l.commonAreaUUID=d,d}catch(u){throw new Error(`Failed to create common area UUID: ${u instanceof Error?u.message:"Unknown error"}`)}}async function xr(l){const e={},t=$t(),w=await Promise.allSettled(t.map(m=>{const i=structuredClone(Nt(l));return i.resourceUUID=m.uuid,i.query.expectedResultType="COUNT",i.resourceCredentials=i.resourceCredentials||{},Le(Ne.QueryV2+"?isInstitute=true",i).then(x=>x.picsureResultId?{resourceName:m.name,picsureResultId:x.picsureResultId,success:!0}:(console.warn(`No picsureResultId for resource: ${m.name}`),{resourceName:m.name,error:"No result ID returned",success:!1})).catch(x=>(console.error(`Failed to query resource ${m.name}:`,x),{resourceName:m.name,error:x instanceof Error?x.message:`API Error: ${x.status||"Unknown"}`,success:!1}))}));let u=!1;const d=[];if(w.forEach(m=>{if(m.status==="fulfilled"){const i=m.value;i.success&&"picsureResultId"in i&&i.picsureResultId?(e[i.resourceName]=i.picsureResultId,Oe.update(x=>({...x,[i.resourceName]:{...x[i.resourceName]||{},queryId:i.picsureResultId,status:"COMPLETE"}})),u=!0):!i.success&&"error"in i&&(d.push(`${i.resourceName}: ${i.error}`),Oe.update(x=>({...x,[i.resourceName]:{...x[i.resourceName]||{},status:"ERROR"}})))}else d.push(`Unknown failure: ${m.reason}`)}),!u&&d.length>0)throw new Error(`All federated queries failed: ${d.join(", ")}`);return d.length>0&&console.warn("Some federated queries failed:",d),e}async function _r(l){await Ct();const e=$t(),t={};e.forEach(({name:u,uuid:d})=>{t[u]={status:"PENDING",resourceId:d,name:u}}),Oe.set(t);const w=await yr(l);l["@type"]="FederatedQueryRequest";try{return{responses:await xr(l),datasetId:w}}catch(u){throw e.map(d=>d.name).forEach(d=>{Oe.update(m=>({...m,[d]:{...m[d]||{},status:"ERROR"}}))}),u}}var br=A('<!> <span class="ml-2">Creating datasets to save...</span>',1),wr=A('<div id="dataset-id" class="mr-4"> </div>'),Er=A(`<div class="w-full h-full m-2 card p-4"><header class="card-header">Common Area Save the information in your final data export by clicking the Save Dataset ID
        button. Navigate to the <a class="anchor" href="/dataset">Manage Datasets page</a> to view or
        manage your Dataset IDs.</header> <hr/> <div class="card-body p-4 flex flex-col justify-center items-center"><div><div class="flex items-center m-2"><label for="dataset-name" class="font-bold mr-2">Dataset Name:</label> <input type="text" id="dataset-name" class="input w-80" placeholder="Enter a name" required/></div> <div class="flex items-center m-2"><div class="flex items-center"><label for="dataset-id" class="font-bold mr-2">Dataset ID:</label> <!></div></div></div></div></div>`),Rr=A('<section class="flex flex-col w-full h-full items-center"><!> <!></section>');function Sr(l,e){re(e,!0);let t=O(!0),w=O(null),u=O(fe(Fe()));Ge(async()=>{try{const r=await _r(de());ct(r.datasetId),dt(!0),C(t,!1)}catch(r){C(w,r instanceof Error?r.message:"Failed to execute federated query",!0),C(t,!1),console.error("Federated query error:",r)}}),xt(()=>{var r,s;Et(a(u)),dt((((r=Fe())==null?void 0:r.length)??0)>2&&(((s=ae())==null?void 0:s.length)??0)>0)});var d=Rr(),m=v(d);tt(m,{});var i=P(m,2);{var x=r=>{var s=br(),g=B(s);ye(g,{ring:!0,size:"small"}),Y(2),n(r,s)},h=r=>{var s=K(),g=B(s);{var D=f=>{Be(f,{title:"Failed to prepare federated query",children:(y,b)=>{Y();var T=ue();V(()=>W(T,a(w))),n(y,T)},$$slots:{default:!0}})},p=f=>{var y=Er(),b=P(v(y),4),T=v(b),S=v(T),_=P(v(S),2);ft(_),c(S);var I=P(S,2),q=v(I),$=P(v(q),2);{var E=R=>{ye(R,{ring:!0,size:"micro",label:"Generating ID..."})},o=R=>{var k=wr(),ve=v(k,!0);c(k),V(pe=>W(ve,pe),[ae]),n(R,k)};M($,R=>{ae()?R(o,!1):R(E)})}c(q),c(I),c(T),c(b),c(y),Ut(_,()=>a(u),R=>C(u,R)),n(f,y)};M(g,f=>{a(w)?f(D):f(p,!1)},!0)}n(r,s)};M(i,r=>{a(t)?r(x):r(h,!1)})}c(d),n(l,d),se()}var Pr=(l,e,t)=>z.confirmDownload?C(e,!0):t(),Dr=A('<!> <button class="btn preset-filled-primary-500"><i class="fa-solid fa-download mr-1"></i> <!></button>',1),Ir=A("<p>Downloading data is disabled. Please contact the administrator to enable this feature.</p>"),Ar=A('<div class="flex items-center m-1"><!></div>');function Xt(l,e){re(e,!0);let t=O(!1),w=O(!1);const u=L(()=>e.query.query.expectedResultType==="DATAFRAME"||e.query.query.expectedResultType==="DATAFRAME_TIMESERIES"?"Download as CSV":e.query.query.expectedResultType==="DATAFRAME_PFB"&&z.explorer.enablePfbExport?"Download as PFB":"Download is Disabled");async function d(){if(z.explorer.allowDownload){if(!e.datasetId){console.error("No dataset ID provided"),nt.error({title:"No dataset ID provided. Go back and save a dataset and try again.",closable:!0});return}try{C(w,!0);const r=await Le(`${Ne.QueryV2}/${e.datasetId}/result`,{}),s=URL.createObjectURL(new Blob([r],{type:"octet/stream"}));if(_a){const g=document.createElement("a");g.href=s,e.query.query.expectedResultType==="DATAFRAME"?g.download="pic-sure-data.csv":z.explorer.enablePfbExport&&e.query.query.expectedResultType==="DATAFRAME_PFB"&&(g.download="pic-sure-data.avro"),document.body.appendChild(g),g.click(),document.body.removeChild(g)}}catch(r){console.error("Error in onCompleteHandler",r)}finally{C(w,!1)}}}var m=Ar(),i=v(m);{var x=r=>{var s=Dr(),g=B(s);{let b=L(()=>ge.explorePage.confirmDownloadTitle||"Are you sure you want to download data?");ba(g,{get title(){return a(b)},width:"w-1/2",withDefault:!0,confirmText:"Download",cancelText:"Cancel",onconfirm:()=>d(),get open(){return a(t)},set open(T){C(t,T,!0)},children:(T,S)=>{Y();var _=ue();V(()=>W(_,ge.explorePage.confirmDownloadMessage||"This action will download the data to your local machine. Are you sure you want to proceed?")),n(T,_)},$$slots:{default:!0}})}var D=P(g,2);D.__click=[Pr,t,d];var p=P(v(D)),f=P(p);{var y=b=>{ye(b,{ring:!0,size:"micro",color:"white"})};M(f,b=>{a(w)&&b(y)})}c(D),V(()=>W(p,`${a(u)??""} `)),n(r,s)},h=r=>{Be(r,{title:"Download is disabled!",color:"warning",solid:!0,children:(s,g)=>{var D=Ir();n(s,D)},$$slots:{default:!0}})};M(i,r=>{z.explorer.allowDownload?r(x):r(h,!1)})}c(m),n(l,m),se()}et(["click"]);var Tr=A("<!> <!>",1),Cr=A("<!> <!>",1),kr=A('<div class="flex justify-center w-full"><!></div>'),$r=A("<!> <!> <!>",1);function qr(l,e){re(e,!0);let t=O(fe(z.analyzeApi?"Python":z.explorer.allowDownload?"Download":""));rt(l,{get value(){return a(t)},onValueChange:d=>C(t,d.value,!0),list:d=>{var m=Cr(),i=B(m);{var x=s=>{var g=Tr(),D=B(g);yt(D,{value:"Python",get group(){return a(t)},set group(f){C(t,f,!0)},children:(f,y)=>{Y();var b=ue("Python");n(f,b)},$$slots:{default:!0}});var p=P(D,2);yt(p,{value:"R",get group(){return a(t)},set group(f){C(t,f,!0)},children:(f,y)=>{Y();var b=ue("R");n(f,b)},$$slots:{default:!0}}),n(s,g)};M(i,s=>{z.analyzeApi&&s(x)})}var h=P(i,2);{var r=s=>{yt(s,{value:"Download",get group(){return a(t)},set group(g){C(t,g,!0)},children:(g,D)=>{Y();var p=ue("Download");n(g,p)},$$slots:{default:!0}})};M(h,s=>{z.explorer.allowDownload&&s(r)})}n(d,m)},content:d=>{var m=$r(),i=B(m);gt(i,()=>rt.Panel,(s,g)=>{g(s,{value:"Python",children:(D,p)=>{{let f=L(()=>ge.explorePage.codeBlocks.PythonExport.replace("{{queryId}}",ae()??"DATASET_ID_MISSING")||"Code not set for Python in configuration");It(D,{lang:"python",get code(){return a(f)}})}},$$slots:{default:!0}})});var x=P(i,2);gt(x,()=>rt.Panel,(s,g)=>{g(s,{value:"R",children:(D,p)=>{{let f=L(()=>ge.explorePage.codeBlocks.RExport.replace("{{queryId}}",ae()??"DATASET_ID_MISSING")||"Code not set for R in configuration");It(D,{lang:"r",get code(){return a(f)}})}},$$slots:{default:!0}})});var h=P(x,2);{var r=s=>{var g=K(),D=B(g);gt(D,()=>rt.Panel,(p,f)=>{f(p,{value:"Download",children:(y,b)=>{var T=kr(),S=v(T);{let _=L(de),I=L(ae);Xt(S,{get query(){return a(_)},get datasetId(){return a(I)}})}c(T),n(y,T)},$$slots:{default:!0}})}),n(s,g)};M(h,s=>{z.explorer.allowDownload&&s(r)})}n(d,m)},$$slots:{list:!0,content:!0}}),se()}var Mr=A(`<section class="flex flex-col w-full h-full"><p>By clicking "Request Access" you will be taken to the externally linked Request Data and
    Biosamples RedCap form where you can submit your request for data and biosamples.</p> <p class="mb-0">Before submitting the RedCap form, make sure you have:</p> <ul class="list-disc list-inside ml-8"><li>Selected all variables you would like to include in your export</li> <li><a href="/collaborate" class="anchor">Identified collaborators</a> if using data from other institutions.</li></ul> <div class="flex flex-row items-center self-center card p-4 my-4"><label for="copyable-dataset-id" class="font-bold mr-2">Dataset ID:</label> <span id="copyable-dataset-id" class="mr-2"> </span> <!></div> <p>Once the request has been submitted, the local Sample and Data Access Committee will review and
    notify you of a decision via email.</p> <p>Once approved, access to patient-level data will be provisioned in the GIC Service Workbench. To
    learn more about this, please refer to the <a href="/analyze" class="anchor">Analyze page</a>.</p></section>`);function Lr(l,e){re(e,!0);var t=Mr(),w=P(v(t),6),u=P(v(w),2),d=v(u,!0);c(u);var m=P(u,2);{let i=L(()=>ae()??"MISSING_DATASET_ID");wa(m,{get itemToCopy(){return a(i)},class:"preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500"})}c(w),Y(4),c(t),V(i=>W(d,i),[ae]),n(l,t),se()}var Nr=(l,e,t)=>e(a(t).url),Ur=A('<button class="flex-initial w-64 btn preset-filled-primary-500 disabled:preset-tonal-primary border border-primary-500"><i class="fa-solid fa-arrow-up-right-from-square"></i> <span> </span> <!></button>'),Fr=A('<section class="flex flex-col gap-8 place-items-center"><div class="flex justify-center mt-4">Select an option below to export your selected data in PFB format.</div> <!> <!></section>');function Or(l,e){re(e,!0);let t=O(!1);async function w(h){if(!h){console.warn("No URL provided for export");return}C(t,!0);try{const r=await u();r?window.open(h+encodeURIComponent(r),"_blank"):nt.error({title:"Failed to get signed URL for export.",closable:!0})}catch(r){console.error("Error during export:",r),nt.error({title:"Export failed. Please try again.",closable:!0})}finally{C(t,!1)}}async function u(){const h=`${Ne.QueryV2}/${ae()}/signed-url`;try{return(await Le(h,de())).signedUrl||null}catch(r){throw console.error("Error getting signed URL:",r),r}}var d=Fr(),m=P(v(d),2);{var i=h=>{var r=K(),s=B(r);We(s,17,()=>ge.explorePage.pfbExportUrls,Xe,(g,D)=>{var p=Ur();p.__click=[Nr,w,D];var f=P(v(p),2),y=v(f);c(f);var b=P(f,2);{var T=S=>{ye(S,{ring:!0,size:"micro",label:"Exporting"})};M(b,S=>{a(t)&&S(T)})}c(p),V(()=>{p.disabled=a(t),W(y,`Export to ${a(D).title??""}`)}),n(g,p)}),n(h,r)};M(m,h=>{var r;(r=ge.explorePage)!=null&&r.pfbExportUrls&&ge.explorePage.pfbExportUrls.length>0&&h(i)})}var x=P(m,2);{let h=L(de),r=L(ae);Xt(x,{get query(){return a(h)},get datasetId(){return a(r)}})}c(d),n(l,d),se()}et(["click"]);var Br=A('<a class="btn preset-tonal-primary border border-primary-500 m-2 hover:preset-filled-primary-500"> </a>'),jr=A('<div class="flex justify-center"></div>');function Qr(l,e){re(e,!0);var t=K(),w=B(t);{var u=d=>{var m=jr();We(m,21,()=>ge.explorePage.goTo.links,Xe,(i,x)=>{var h=Br(),r=v(h,!0);c(h),V(()=>{J(h,"href",a(x).url),J(h,"target",a(x).newTab?"_blank":"_self"),W(r,a(x).title)}),n(i,h)}),c(m),n(d,m)};M(w,d=>{ge.explorePage.goTo.links.length>0&&d(u)})}n(l,t),se()}var zr=A("<p> </p>"),Vr=A('<div class="flex justify-center"><!></div>'),Gr=A('<p class="mt-4"> </p> <!> <!> <!> <!>',1),Wr=A('<div class="flex justify-center"><!> <div class="hidden"> </div></div>'),Xr=A("<p> </p>"),Hr=A('<div class="flex justify-center"><!> <div class="hidden"> </div></div>'),Yr=A('<section class="flex flex-col w-full h-full items-center"><!></section>'),Jr=A("<!> <!> <!> <!> <!>",1);function Kr(l,e){re(e,!0);const t=()=>Z(Oe,"$federatedQueryMap",i),w=()=>Z(Ve,"$selectedConcepts",i),u=()=>Z(wt,"$filters",i),d=()=>Z(Lt,"$totalParticipants",i),m=()=>Z(Mt,"$exports",i),[i,x]=Me(),h=Pe(e,"rows",19,()=>[]);let r=O(fe(Promise.resolve())),s=fe(Promise.resolve()),g=O(fe(Promise.resolve()));const D=L(()=>(de().query.expectedResultType==="DATAFRAME"||de().query.expectedResultType==="DATAFRAME_TIMESERIES")&&!z.explorer.enableRedcapExport),p=L(()=>de().query.expectedResultType==="DATAFRAME_PFB"&&z.explorer.enablePfbExport&&!z.explorer.enableRedcapExport),f=L(()=>(de().query.expectedResultType==="DATAFRAME"||de().query.expectedResultType==="DATAFRAME_TIMESERIES")&&z.analyzeApi&&!z.explorer.enableRedcapExport);let y=O(fe([]));Ge(async()=>{Wt(e.query),ra(Oe,{}),z.explorer.enablePfbExport||Ke("DATAFRAME")});function b(){a(y).filter(E=>!w().includes(E)).forEach(E=>{const o=de().query.fields.indexOf(E);o>-1&&de().query.fields.splice(o,1)}),C(y,w(),!0),w().forEach(E=>{de().query.addField(E)})}async function T($,E){const o=z.explorer.showTreeStep&&E===(z.federated?"save-dataset":"select-type");if(E==="select-variables"&&de().query.fields.forEach(Ft),o&&b(),E==="start"){z.explorer.enableRedcapExport&&ot(!1);const R=Object.values(t()).map(k=>({resourceId:k==null?void 0:k.resourceId,name:k==null?void 0:k.name,queryId:k==null?void 0:k.queryId})).filter(k=>k.queryId);if(ae())C(g,Ra(ae()??"",Fe()??"",R.length>0?R:void 0).then(k=>z.federated?(C(r,Promise.resolve(),!0),k):(C(r,S(ae()),!0),k)),!0);else throw new Error("No dataset ID provided")}}async function S($){const o=`/${$||ae()}/status`;return Da(async()=>{const R=await Le(`${Ne.QueryV2}${o}`,e.query);if(R.status==="ERROR")throw ot(!0),new Error(`Export failed with status: ${R.status}`);if(R.status!=="SUCCESS"&&R.status!=="AVAILABLE")throw new Error(`Export not ready. Status: ${R.status}`);ot(!1)},15,500,6e4,(R,k)=>!(R instanceof Error&&R.message.includes("Export failed with status: ERROR")))}function _(){z.explorer.enableRedcapExport?(window.open("https://redcap.tch.harvard.edu/redcap_edc/surveys/?s=EWYX8X8XX77TTWFR","_blank"),At(),bt("/explorer")):(At(),bt("/explorer"))}const I=oa.maxDataPointsForExport||1e6;function q(){const $=u().filter(R=>R.filterType==="AnyRecordOf").reduce((R,k)=>R+k.concepts.length,0);return(typeof d()=="number"?d():I+1)+(u().length+$)+m().length>I}{let $=L(()=>z.explorer.enableRedcapExport?"Request Access":"Done");Ca(l,{class:"w-full h-full m-8",oncomplete:_,onnext:T,get buttonCompleteLabel(){return a($)},children:(E,o)=>{var R=Jr(),k=B(R);{const U=F=>{Y();var Q=ue("Review Cohort Details:");n(F,Q)};let X=L(q);Je(k,{name:"review",get locked(){return a(X)},header:U,children:(F,Q)=>{{let H=L(q);Xa(F,{get query(){return e.query},get rows(){return h()},get preparePromise(){return s},get dataLimitExceeded(){return a(H)}})}},$$slots:{header:!0,default:!0}})}var ve=P(k,2);{var pe=U=>{Je(U,{name:"select-variables",header:F=>{Y();var Q=ue("Finalize Data:");n(F,Q)},children:(F,Q)=>{lr(F,{})},$$slots:{header:!0,default:!0}})};M(ve,U=>{z.explorer.showTreeStep&&U(pe)})}var xe=P(ve,2);{var Te=U=>{{const X=Q=>{Y();var H=ue("Review and Save Dataset:");n(Q,H)};let F=L(()=>Ze()===void 0);Je(U,{name:"select-type",get locked(){return a(F)},header:X,children:(Q,H)=>{ur(Q,{})},$$slots:{header:!0,default:!0}})}};M(xe,U=>{z.explorer.enablePfbExport&&!z.federated&&U(Te)})}var j=P(xe,2);{const U=F=>{Y();var Q=ue("Save Dataset ID:");n(F,Q)};let X=L(()=>{var F;return!Fe()||(((F=Fe())==null?void 0:F.length)??0)<2||!ae()||!cr()});Je(j,{name:"save-dataset",get locked(){return a(X)},header:U,children:(F,Q)=>{var H=K(),we=B(H);{var Ee=oe=>{Sr(oe,{})},Re=oe=>{gr(oe,{})};M(we,oe=>{z.federated?oe(Ee):oe(Re,!1)})}n(F,H)},$$slots:{header:!0,default:!0}})}var N=P(j,2);{const U=F=>{Y();var Q=ue("Start Analysis:");n(F,Q)};let X=L(ir);Je(N,{name:"start",get locked(){return a(X)},header:U,children:(F,Q)=>{var H=Yr(),we=v(H);ze(we,()=>a(g),Ee=>{ye(Ee,{ring:!0,size:"medium",label:"Saving"})},Ee=>{var Re=K(),oe=B(Re);ze(oe,()=>a(r),le=>{ye(le,{ring:!0,size:"medium",label:"Preparing"})},le=>{var ie=Gr(),Se=B(ie),Ce=v(Se,!0);c(Se);var ke=P(Se,2);{var me=ee=>{qr(ee,{})},_e=ee=>{var be=K(),$e=B(be);{var vt=Qe=>{Or(Qe,{})},Ht=Qe=>{var Rt=K(),Yt=B(Rt);{var Jt=pt=>{Lr(pt,{})};M(Yt,pt=>{z.explorer.enableRedcapExport&&pt(Jt)},!0)}n(Qe,Rt)};M($e,Qe=>{a(p)?Qe(vt):Qe(Ht,!1)},!0)}n(ee,be)};M(ke,ee=>{a(D)?ee(me):ee(_e,!1)})}var De=P(ke,2);{var te=ee=>{var be=zr(),$e=v(be,!0);c(be),V(()=>W($e,ge.explorePage.goTo.instructions)),n(ee,be)};M(De,ee=>{ge.explorePage.goTo.instructions&&ge.explorePage.goTo.instructions.length>0&&ee(te)})}var ce=P(De,2);{var Ie=ee=>{var be=Vr(),$e=v(be);pa($e,{}),c(be),n(ee,be)};M(ce,ee=>{a(f)&&ee(Ie)})}var je=P(ce,2);Qr(je,{}),V(()=>W(Ce,ge.explorePage.analysisExportText)),n(le,ie)},(le,ie)=>{var Se=Wr(),Ce=v(Se);Be(Ce,{title:`An error occurred while preparing your dataset. Please try again. If this problem persists, please
            contact an administrator.`});var ke=P(Ce,2),me=v(ke,!0);c(ke),c(Se),V(()=>W(me,a(ie))),n(le,Se)}),n(Ee,Re)},(Ee,Re)=>{var oe=Hr(),le=v(oe);Be(le,{title:`An error occurred while saving your dataset. Please try again. If this problem persists, please
          contact an administrator.`,children:(Ce,ke)=>{var me=K(),_e=B(me);{var De=te=>{var ce=Xr(),Ie=v(ce,!0);c(ce),V(()=>W(Ie,a(Re))),n(te,ce)};M(_e,te=>{a(Re).includes("Export not ready")&&te(De)})}n(Ce,me)},$$slots:{default:!0}});var ie=P(le,2),Se=v(ie,!0);c(ie),c(oe),V(()=>W(Se,a(Re))),n(Ee,oe)}),c(H),n(F,H)},$$slots:{header:!0,default:!0}})}n(E,R)},$$slots:{default:!0}})}se(),x()}var Zr=A('<section class="flex justify-center items-center w-full h-full mt-8"><!></section>'),es=()=>{alert("This would start the tour at some step")},ts=A('<div class="flex flex-col items-center justify-center m-8"><p>No filters or exports have been created.</p> <div class="flex gap-4"><button class="btn preset-filled-primary-500 m-4">Learn How</button></div></div>');function Ns(l,e){re(e,!0);const t=()=>Z(i,"$exports",d),w=()=>Z(wt,"$filters",d),u=()=>Z(Ae,"$stepperState",d),[d,m]=Me();let{exports:i}=qt,x=Ea(!0),h=t().map(s=>{var g,D,p,f;return{ref:s,selected:!0,variableId:s.conceptPath,name:s.display||((g=s.searchResult)==null?void 0:g.display)||((D=s.searchResult)==null?void 0:D.name),description:(p=s.searchResult)==null?void 0:p.description,type:(f=s.searchResult)==null?void 0:f.type}}),r=w().map(s=>{var g,D,p;return{ref:s,selected:!0,variableId:s.id,name:((g=s.searchResult)==null?void 0:g.display)||s.variableName,description:(D=s.searchResult)==null?void 0:D.description,type:(p=s.searchResult)==null?void 0:p.type}});Ae.set({...u(),current:0,total:0}),va(l,{backUrl:"/explorer",backTitle:"Back to Explore",backAction:()=>{qe(Ae,ne(u).current=0,ne(u))},title:"Export Data for Research Analysis",children:(s,g)=>{var D=K(),p=B(D);{var f=b=>{var T=Zr(),S=v(T);{let _=L(()=>[...r,...h]);Kr(S,{get query(){return x},get rows(){return a(_)}})}c(T),n(b,T)},y=b=>{var T=ts(),S=P(v(T),2),_=v(S);_.__click=[es],c(S),c(T),n(b,T)};M(p,b=>{t().length>0||w().length>0?b(f):b(y,!1)})}n(s,D)},$$slots:{default:!0}}),se(),m()}et(["click"]);export{Ns as component};
