import{s as x,e as $,a as S,q as U,c as g,b as k,f,g as T,m as d,i as p,h as A,u as N,a0 as R,n as C,w as te,t as ae,d as le,j as se,p as re,a5 as ne,l as z,y as oe}from"../chunks/DfqJWsAP.js";import{h as ie,u as ce}from"../chunks/Cn0d3STq.js";import{e as K}from"../chunks/CnUKkpeB.js";import{S as F,i as G,d as I,e as D,m as H,t as y,a as w,f as O,g as ue,b as de}from"../chunks/B9sU1H0B.js";import{g as j,r as fe,d as me}from"../chunks/DA0IzwqI.js";import"../chunks/8fc_wYz-.js";import{P as pe}from"../chunks/CTXdiFMz.js";import{b as _e}from"../chunks/DXXfEZPn.js";import{E as be}from"../chunks/P0CHC8Ln.js";import{C as he}from"../chunks/SXpdNYfp.js";import{T as $e}from"../chunks/BOL4pBGU.js";import{g as ge}from"../chunks/BWY6sm7c.js";import{g as ve}from"../chunks/D4yaORjf.js";import{U as X}from"../chunks/BG8FnnGv.js";import{C as Y}from"../chunks/CjRA7bPa.js";import{R as Z}from"../chunks/CC3Nk4BD.js";import{P as ke}from"../chunks/Cg9HbQ4q.js";function ye(c){let e,r,a,t,l;return{c(){e=$("button"),r=$("i"),this.h()},l(s){e=g(s,"BUTTON",{"data-testid":!0,type:!0,title:!0,"aria-label":!0,class:!0});var n=k(e);r=g(n,"I",{class:!0}),k(r).forEach(f),n.forEach(f),this.h()},h(){d(r,"class","fa-solid fa-trash-arrow-up fa-xl"),d(e,"data-testid",a=`user-activate-btn-${c[0].cell}`),d(e,"type","button"),d(e,"title","Reactivate user"),d(e,"aria-label","Reactivate user"),d(e,"class","btn-icon-color")},m(s,n){p(s,e,n),A(e,r),t||(l=N(e,"click",R(c[5])),t=!0)},p(s,n){n&1&&a!==(a=`user-activate-btn-${s[0].cell}`)&&d(e,"data-testid",a)},d(s){s&&f(e),t=!1,l()}}}function Ce(c){let e,r,a,t,l,s,n,_,u;return{c(){e=$("button"),r=$("i"),t=S(),l=$("button"),s=$("i"),this.h()},l(i){e=g(i,"BUTTON",{"data-testid":!0,type:!0,title:!0,"aria-label":!0,class:!0});var o=k(e);r=g(o,"I",{class:!0}),k(r).forEach(f),o.forEach(f),t=T(i),l=g(i,"BUTTON",{"data-testid":!0,type:!0,title:!0,"aria-label":!0,class:!0});var m=k(l);s=g(m,"I",{class:!0}),k(s).forEach(f),m.forEach(f),this.h()},h(){d(r,"class","fa-solid fa-pen-to-square fa-xl"),d(e,"data-testid",a=`user-edit-btn-${c[0].cell}`),d(e,"type","button"),d(e,"title","Edit"),d(e,"aria-label","Edit"),d(e,"class","btn-icon-color"),d(s,"class","fa-solid fa-trash fa-xl"),d(l,"data-testid",n=`user-deactivate-btn-${c[0].cell}`),d(l,"type","button"),d(l,"title","Deactivate user"),d(l,"aria-label","Deactivate user"),d(l,"class","btn-icon-color")},m(i,o){p(i,e,o),A(e,r),p(i,t,o),p(i,l,o),A(l,s),_||(u=[N(e,"click",R(c[3])),N(l,"click",R(c[4]))],_=!0)},p(i,o){o&1&&a!==(a=`user-edit-btn-${i[0].cell}`)&&d(e,"data-testid",a),o&1&&n!==(n=`user-deactivate-btn-${i[0].cell}`)&&d(l,"data-testid",n)},d(i){i&&(f(e),f(t),f(l)),_=!1,te(u)}}}function we(c){let e,r,a,t,l,s,n;function _(o,m){return o[0].row.status==="Active"?Ce:ye}let u=_(c),i=u(c);return{c(){e=$("button"),r=$("i"),t=S(),i.c(),l=U(),this.h()},l(o){e=g(o,"BUTTON",{"data-testid":!0,type:!0,title:!0,"aria-label":!0,class:!0});var m=k(e);r=g(m,"I",{class:!0}),k(r).forEach(f),m.forEach(f),t=T(o),i.l(o),l=U(),this.h()},h(){d(r,"class","fa-solid fa-circle-info fa-xl"),d(e,"data-testid",a=`user-view-btn-${c[0].cell}`),d(e,"type","button"),d(e,"title","View"),d(e,"aria-label","View"),d(e,"class","btn-icon-color")},m(o,m){p(o,e,m),A(e,r),p(o,t,m),i.m(o,m),p(o,l,m),s||(n=N(e,"click",R(c[2])),s=!0)},p(o,[m]){m&1&&a!==(a=`user-view-btn-${o[0].cell}`)&&d(e,"data-testid",a),u===(u=_(o))&&i?i.p(o,m):(i.d(1),i=u(o),i&&(i.c(),i.m(l.parentNode,l)))},i:C,o:C,d(o){o&&(f(e),f(t),f(l)),i.d(o),s=!1,n()}}}function Ee(c,e,r){const a=ge(),t=ve(),{getUser:l,updateUser:s}=X,{getConnection:n}=Y,{getRole:_}=Z,{getPrivilege:u}=ke;let{data:i={cell:"",row:{status:"",email:""}}}=e;async function o(v){const b=await l(i.cell);a.trigger({type:"confirm",title:`${v?"R":"D"}eactivate User?`,body:`Are you sure you want to ${v?"r":"d"}eactiveate user '${b.email}'?`,buttonTextConfirm:v?"Reactivate":"Deactivate",response:async P=>{if(!P)return;let L={...b,active:v,connection:await n(b.connection),roles:await Promise.all(b.roles.map(E=>_(E).then(h=>({...h,privileges:h.privileges.map(B=>u(B))}))))};try{await s(L),t.trigger({message:`Successfully ${v?"activated":"deactivated"} user '${b.email}'`,background:"variant-filled-success"})}catch(E){console.error(E),t.trigger({message:`An error occured while ${v?"activating":"deactivating"} user '${b.email}'`,background:"variant-filled-error"})}}})}const m=()=>j(`/admin/users/${i.cell}`),M=()=>j(`/admin/users/${i.cell}/edit`),q=()=>o(!1),V=()=>o(!0);return c.$$set=v=>{"data"in v&&r(0,i=v.data)},[i,o,m,M,q,V]}class Ue extends F{constructor(e){super(),G(this,e,Ee,we,x,{data:0})}}function Ae(c){let e,r=c[0].cell+"",a,t;return{c(){e=$("span"),a=ae(r),this.h()},l(l){e=g(l,"SPAN",{class:!0});var s=k(e);a=le(s,r),s.forEach(f),this.h()},h(){d(e,"class",t=`badge last:p-1 rounded variant-filled-${c[0].cell==="Active"?"success":"error"}`)},m(l,s){p(l,e,s),A(e,a)},p(l,[s]){s&1&&r!==(r=l[0].cell+"")&&se(a,r),s&1&&t!==(t=`badge last:p-1 rounded variant-filled-${l[0].cell==="Active"?"success":"error"}`)&&d(e,"class",t)},i:C,o:C,d(l){l&&f(e)}}}function Se(c,e,r){let{data:a={cell:"",row:{}}}=e;return c.$$set=t=>{"data"in t&&r(0,a=t.data)},[a]}class Te extends F{constructor(e){super(),G(this,e,Se,Ae,x,{data:0})}}function Q(c,e,r){const a=c.slice();return a[12]=e[r],a}function Pe(c){let e,r;return e=new be({props:{title:"API Error",$$slots:{default:[Be]},$$scope:{ctx:c}}}),{c(){I(e.$$.fragment)},l(a){D(e.$$.fragment,a)},m(a,t){H(e,a,t),r=!0},p(a,t){const l={};t&32768&&(l.$$scope={dirty:t,ctx:a}),e.$set(l)},i(a){r||(y(e.$$.fragment,a),r=!0)},o(a){w(e.$$.fragment,a),r=!1},d(a){O(e,a)}}}function Be(c){let e,r="Something went wrong when sending your request.";return{c(){e=$("p"),e.textContent=r},l(a){e=g(a,"P",{"data-svelte-h":!0}),z(e)!=="svelte-n1xg7v"&&(e.textContent=r)},m(a,t){p(a,e,t)},p:C,d(a){a&&f(e)}}}function Ne(c){let e,r='<div class="flex-auto"><a data-testid="add-user-btn" class="btn variant-ghost-primary hover:variant-filled-primary" href="/admin/users/new">+ Add User</a></div>',a,t,l,s=K(c[1]),n=[];for(let u=0;u<s.length;u+=1)n[u]=W(Q(c,s,u));const _=u=>w(n[u],1,1,()=>{n[u]=null});return{c(){e=$("div"),e.innerHTML=r,a=S();for(let u=0;u<n.length;u+=1)n[u].c();t=U(),this.h()},l(u){e=g(u,"DIV",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-3ryyp1"&&(e.innerHTML=r),a=T(u);for(let i=0;i<n.length;i+=1)n[i].l(u);t=U(),this.h()},h(){d(e,"class","flex gap-4 mb-6")},m(u,i){p(u,e,i),p(u,a,i);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(u,i);p(u,t,i),l=!0},p(u,i){if(i&46){s=K(u[1]);let o;for(o=0;o<s.length;o+=1){const m=Q(u,s,o);n[o]?(n[o].p(m,i),y(n[o],1)):(n[o]=W(m),n[o].c(),y(n[o],1),n[o].m(t.parentNode,t))}for(ue(),o=s.length;o<n.length;o+=1)_(o);de()}},i(u){if(!l){for(let i=0;i<s.length;i+=1)y(n[i]);l=!0}},o(u){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)w(n[i]);l=!1},d(u){u&&(f(e),f(a),f(t)),oe(n,u)}}}function W(c){let e,r,a,t,l;return r=new $e({props:{tableName:"Users",data:c[12].users,columns:c[2],cellOverides:c[3],search:!0,defaultRowsPerPage:10,title:c[12].label,rowClickHandler:c[5],isClickable:!0}}),{c(){e=$("div"),I(r.$$.fragment),a=S(),this.h()},l(s){e=g(s,"DIV",{id:!0,class:!0});var n=k(e);D(r.$$.fragment,n),a=T(n),n.forEach(f),this.h()},h(){d(e,"id",t=`user-table-${c[12].label.replaceAll(" ","_")}`),d(e,"class","mb-10")},m(s,n){p(s,e,n),H(r,e,null),A(e,a),l=!0},p(s,n){const _={};n&2&&(_.data=s[12].users),n&2&&(_.title=s[12].label),r.$set(_),(!l||n&2&&t!==(t=`user-table-${s[12].label.replaceAll(" ","_")}`))&&d(e,"id",t)},i(s){l||(y(r.$$.fragment,s),l=!0)},o(s){w(r.$$.fragment,s),l=!1},d(s){s&&f(e),O(r)}}}function Re(c){let e,r="Loading",a,t,l;return t=new pe({props:{animIndeterminate:"anim-progress-bar"}}),{c(){e=$("h3"),e.textContent=r,a=S(),I(t.$$.fragment),this.h()},l(s){e=g(s,"H3",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-16fo5h6"&&(e.textContent=r),a=T(s),D(t.$$.fragment,s),this.h()},h(){d(e,"class","text-left")},m(s,n){p(s,e,n),p(s,a,n),H(t,s,n),l=!0},p:C,i(s){l||(y(t.$$.fragment,s),l=!0)},o(s){w(t.$$.fragment,s),l=!1},d(s){s&&(f(e),f(a)),O(t,s)}}}function Ie(c){let e,r,a={ctx:c,current:null,token:null,hasCatch:!0,pending:Re,then:Ne,catch:Pe,blocks:[,,,]};return ie(c[4](),a),{c(){e=U(),a.block.c()},l(t){e=U(),a.block.l(t)},m(t,l){p(t,e,l),a.block.m(t,a.anchor=l),a.mount=()=>e.parentNode,a.anchor=e,r=!0},p(t,l){c=t,ce(a,c,l)},i(t){r||(y(a.block),r=!0)},o(t){for(let l=0;l<3;l+=1){const s=a.blocks[l];w(s)}r=!1},d(t){t&&f(e),a.block.d(t),a.token=null,a=null}}}function De(c){let e,r,a;return document.title=_e.applicationName+" | Manage Users",r=new he({props:{title:"Manage Users",$$slots:{default:[Ie]},$$scope:{ctx:c}}}),{c(){e=S(),I(r.$$.fragment)},l(t){re("svelte-zefh4i",document.head).forEach(f),e=T(t),D(r.$$.fragment,t)},m(t,l){p(t,e,l),H(r,t,l),a=!0},p(t,[l]){const s={};l&32770&&(s.$$scope={dirty:l,ctx:t}),r.$set(s)},i(t){a||(y(r.$$.fragment,t),a=!0)},o(t){w(r.$$.fragment,t),a=!1},d(t){t&&f(e),O(r,t)}}}function He(c,e,r){let a,t=C,l=()=>(t(),t=ne(m,b=>r(1,a=b)),m);c.$$.on_destroy.push(()=>t());let{users:s,loadUsers:n}=X,{connections:_,loadConnections:u}=Y,{roles:i,loadRoles:o}=Z,m=fe([]);l();const M=[{dataElement:"email",label:"Username",sort:!0},{dataElement:"roles",label:"Role(s)",sort:!0,class:"!normal-case"},{dataElement:"status",label:"Status",sort:!0},{dataElement:"uuid",label:"Actions",sort:!1}],q={status:Te,uuid:Ue};async function V(){await u(),await o(),await n(),l(r(0,m=me([s,_,i],([b,P,L])=>P.map(E=>({label:E.label,users:b.filter(h=>E.uuid===h.connection).map(h=>({uuid:h.uuid||"",email:h.email||"uuid:"+h.uuid,roles:h.roles.length===0?"none":h.roles.map(B=>{var J;return(J=L.find(ee=>ee.uuid===B))==null?void 0:J.name}).sort().join(", "),status:h.active?"Active":"Inactive"})).sort((h,B)=>h.status.localeCompare(B.status))})))))}return[m,a,M,q,V,b=>{const P=b==null?void 0:b.uuid;j(`/admin/users/${P}`)}]}class et extends F{constructor(e){super(),G(this,e,He,De,x,{})}}export{et as component};
