import"../chunks/Bzak7iHL.js";import{o as yt,a as Pt}from"../chunks/B9BhT3Ut.js";import{p as dt,h as st,e as _,a as f,b as e,c as vt,n as O,j as W,t as M,k as t,f as $,s as J,d as L,r as U,l as Z,i as ft,u as it,$ as Rt}from"../chunks/pV5yBOfK.js";import{d as qt,s as K,h as Ct}from"../chunks/D3FUfhzK.js";import{i as F}from"../chunks/BAa5cEXk.js";import{p as Vt,s as bt,a as kt,c as mt}from"../chunks/C2caA9Pm.js";import{g as St}from"../chunks/BLfKYx2_.js";import{E as tt,s as lt,b as Ft,f as Lt}from"../chunks/i859GThY.js";import{c as $t,k as Tt,e as Ut,j as Nt,f as Gt,h as zt,t as Ot}from"../chunks/tvkVmxlD.js";import{p as pt}from"../chunks/DjPQy4x5.js";import{C as Qt}from"../chunks/pqdQTL-E.js";import{E as Y}from"../chunks/C6RsMIt9.js";import{a as ot}from"../chunks/CF-XIK1E.js";import{e as gt,i as _t}from"../chunks/CFqqwPkz.js";import{c as xt}from"../chunks/D2EutmVf.js";import{T as ut}from"../chunks/54ZAgvzV.js";import{a as Et}from"../chunks/CEG0RrrK.js";import{L as nt}from"../chunks/BK-nQ0m1.js";import{s as jt,r as Bt}from"../chunks/B3YVaWvx.js";import{a as Mt}from"../chunks/CMMNa4Y8.js";import{S as It}from"../chunks/Cr5GaZEj.js";function Xt(T){return T.query.expectedResultType="VARIANT_COUNT_FOR_QUERY",$t(Tt.QuerySync,T).then(o=>o.count)}function ct(T,o){return o.query.expectedResultType=T===tt.Aggregate?"AGGREGATE_VCF_EXCERPT":"VCF_EXCERPT",$t(Tt.QuerySync,o).then(N=>{const q=URL.createObjectURL(new Blob([N],{type:"octet/stream"})),C=N.split(`
`),a=C[0].split("	"),x=lt.variantExplorer.excludeColumns.map(r=>a.indexOf(r)).filter(r=>r>=0),Q=C.slice(1).map(r=>r.split("	")).filter(r=>r.length>1).map(r=>r.reduce((l,h,y)=>(x.includes(y)||(l[a[y].toString()]=h),l),{}));return{columns:a.filter((r,l)=>!x.includes(l)).map(r=>({dataElement:r,label:r,sort:!0,filter:!0})),rows:Q,downloadUrl:q}})}function Dt(T,o,N){Z(o,!t(o)),N()(t(o))}var Kt=$('<a data-testid="variant-download-btn" class="btn btn-sm preset-tonal-primary border border-primary-500" download="variantData.tsv"><i class="fa-solid fa-download"></i> </a>'),Wt=$('<div data-testid="variant-count" class="text-left w-full"> </div>'),Yt=$('<div><label class="flex items-center space-x-2"><input class="checkbox" type="checkbox"/> <p>Aggregate data</p></label></div>'),Ht=$("<!> <!> <!>",1),Jt=$('<div data-testid="variant-count" class="flex-none w-full"> </div>'),Zt=$('<div data-testid="variant-count" class="flex-none w-full"> </div>'),te=$("<!> <!>",1);function ht(T,o){dt(o,!0);let N=Vt(o,"onAggregateToggle",3,()=>{}),q=st(o.exportType===tt.Full);var C=_(),a=f(C);{var x=G=>{var Q=_(),H=f(Q);ot(H,()=>o.data,r=>{var l=te(),h=f(l);{var y=s=>{var u=Zt(),E=L(u);U(u),M(I=>K(E,`${I??""} variants found`),[()=>o.count.toLocaleString()]),e(s,u)};F(h,s=>{o.count>0&&s(y)})}var n=J(h,2);nt(n,{ring:!0,size:"medium"}),e(r,l)},(r,l)=>{var h=_(),y=f(h);{var n=u=>{Y(u,{color:"warning",children:(E,I)=>{O();var v=W();M(w=>K(v,`Too many variants! Found ${w??""}, but cannot display more than
        ${lt.variantExplorer.maxCount??""} variants.`),[()=>o.count.toLocaleString()]),e(E,v)},$$slots:{default:!0}})},s=u=>{var E=_(),I=f(E);{var v=p=>{It(p,{tableName:"variant-explorer",get data(){return t(l).rows},get columns(){return t(l).columns},fullWidth:!0,searchable:!0,tableActions:A=>{var m=Ht(),P=f(m);{var z=d=>{var c=Kt(),S=J(L(c));U(c),M(()=>{jt(c,"href",t(l).downloadUrl),K(S,` Download Variant${t(q)?" (Aggregate)":""} Data`)}),e(d,c)};F(P,d=>{t(l).downloadUrl&&d(z)})}var i=J(P,2);{var V=d=>{var c=Wt(),S=L(c);U(c),M(X=>K(S,`${X??""} variants found`),[()=>o.count.toLocaleString()]),e(d,c)};F(i,d=>{o.count>0&&d(V)})}var k=J(i,2);{var R=d=>{var c=Yt(),S=L(c),X=L(S);Bt(X),X.__click=[Dt,q,N],O(2),U(S),U(c),Mt(X,()=>t(q),j=>Z(q,j)),e(d,c)};F(k,d=>{lt.variantExplorer.type===tt.Full&&d(R)})}e(A,m)},$$slots:{tableActions:!0}})},w=p=>{var b=Jt(),A=L(b);U(b),M(m=>K(A,`${m??""} variants found`),[()=>o.count.toLocaleString()]),e(p,b)};F(I,p=>{o.count>0&&t(l)&&t(l).rows.length>0?p(v):p(w,!1)},!0)}e(u,E)};F(y,u=>{o.count>lt.variantExplorer.maxCount?u(n):u(s,!1)})}e(r,h)},r=>{Y(r,{title:"Error",children:(l,h)=>{O();var y=W("An error occured while retrieving variant list.");e(l,y)},$$slots:{default:!0}})}),e(G,Q)};F(a,G=>{o.data&&G(x)})}e(T,C),vt()}qt(["click"]);var ee=$('<span class="text-xs ml-1"> </span>'),re=$('<i class="fa-solid fa-triangle-exclamation text-error-500"></i> <span class="sr-only">Error</span>',1),ae=$('<span class="float-right"><!></span>'),oe=$('<div class="flex items-center"><span class="font-bold"> </span> <!></div>');function ne(T,o){dt(o,!0);const N=()=>kt(Gt,"$resourcesPromise",q),[q,C]=bt();let a=st(ft([])),x=st(""),G=st(ft(Promise.resolve()));async function Q(){await N(),Z(a,Nt().map(n=>{const s=Et(!0,n.uuid);return{name:n.name,exportType:tt.Aggregate,count:Xt(s),queryRequest:s}}),!0)}function H(n){Z(x,n,!0);const s=t(a).find(u=>u.name===t(x));s&&!s.data&&(s.data=ct(s.exportType,s.queryRequest))}function r(n){const s=t(a)[n];return u=>{s.exportType=u?tt.Aggregate:tt.Full,s.data=ct(s.exportType,s.queryRequest)}}function l(n){const v=(w,p)=>w%p>0?(w/p).toFixed(1):Math.round(w/p);return n>=1e12?"~"+v(n,1e12)+"T":n>=1e9?"~"+v(n,1e9)+"B":n>=1e6?"~"+v(n,1e6)+"M":n>=1e3?"~"+v(n,1e3)+"K":n.toString()}yt(()=>{Ut(),Z(G,Q().then(()=>{Z(x,t(a)[0].name,!0),t(a)[0].data=ct(t(a)[0].exportType,t(a)[0].queryRequest)}),!0)});var h=_(),y=f(h);ot(y,()=>t(G),n=>{nt(n,{ring:!0,size:"medium"})},n=>{var s=_(),u=f(s);{var E=v=>{ut(v,{get value(){return t(x)},onValueChange:b=>H(b.value),list:b=>{var A=_(),m=f(A);gt(m,17,()=>t(a),_t,(P,z)=>{let i=()=>t(z).name,V=()=>t(z).count;var k=_(),R=f(k);xt(R,()=>ut.Control,(d,c)=>{c(d,{get value(){return i()},children:(S,X)=>{var j=oe(),et=L(j),D=L(et,!0);U(et);var rt=J(et,2);ot(rt,V,B=>{var g=ae(),at=L(g);nt(at,{ring:!0,size:"micro"}),U(g),e(B,g)},(B,g)=>{var at=ee(),wt=L(at);U(at),M(At=>K(wt,`(${At??""})`),[()=>l(t(g))]),e(B,at)},B=>{var g=re();O(2),e(B,g)}),U(j),M(()=>K(D,i())),e(S,j)},$$slots:{default:!0}})}),e(P,k)}),e(b,A)},content:b=>{var A=_(),m=f(A);gt(m,17,()=>t(a),_t,(P,z,i)=>{const V=it(()=>{const{name:d,count:c}=t(z);return{name:d,count:c}});var k=_(),R=f(k);xt(R,()=>ut.Panel,(d,c)=>{c(d,{get value(){return t(V).name},children:(S,X)=>{var j=_(),et=f(j);ot(et,()=>t(V).count,D=>{nt(D,{ring:!0,size:"medium"})},(D,rt)=>{{let B=it(()=>r(i));ht(D,{get count(){return t(rt)},get onAggregateToggle(){return t(B)},get data(){return t(a)[i].data},set data(g){t(a)[i].data=g},get exportType(){return t(a)[i].exportType},set exportType(g){t(a)[i].exportType=g}})}},D=>{Y(D,{title:"Error",children:(rt,B)=>{O();var g=W("An error occured while loading counts and variant data.");e(rt,g)},$$slots:{default:!0}})}),e(S,j)},$$slots:{default:!0}})}),e(P,k)}),e(b,A)},$$slots:{list:!0,content:!0}})},I=v=>{var w=_(),p=f(w);{var b=m=>{var P=_(),z=f(P);ot(z,()=>t(a)[0].count,i=>{nt(i,{ring:!0,size:"medium"})},(i,V)=>{{let k=it(()=>r(0));ht(i,{get count(){return t(V)},get onAggregateToggle(){return t(k)},get data(){return t(a)[0].data},set data(R){t(a)[0].data=R},get exportType(){return t(a)[0].exportType},set exportType(R){t(a)[0].exportType=R}})}},i=>{Y(i,{title:"Error",children:(V,k)=>{O();var R=W("An error occured while loading counts and variant data.");e(V,R)},$$slots:{default:!0}})}),e(m,P)},A=m=>{Y(m,{title:"Error",children:(P,z)=>{O();var i=W("No resources were found to query for variant data.");e(P,i)},$$slots:{default:!0}})};F(p,m=>{t(a).length===1?m(b):m(A,!1)},!0)}e(v,w)};F(u,v=>{t(a).length>1?v(E):v(I,!1)})}e(n,s)},n=>{Y(n,{title:"Error",children:(s,u)=>{O();var E=W("An error occured while loading resource list.");e(s,E)},$$slots:{default:!0}})}),e(T,h),vt(),C()}var se=$('<h2 class="text-center clear-both">Variant Explorer</h2> <!>',1);function Re(T,o){dt(o,!0);const[N,q]=bt();yt(()=>{Et(!0).query.hasGenomicFilter()?mt(pt,!1):(zt("no-query")||Ot.error({id:"no-query",title:"No query provided. Please add a genomic filter to explore variant data.",closable:!0}),St("/explorer"))}),Pt(()=>mt(pt,!0)),Ct(C=>{M(()=>Rt.title=`${Ft.applicationName??""} | Variant Explorer`)}),Qt(T,{full:!0,backUrl:"/explorer",backTitle:"Back to Explore",children:(C,a)=>{var x=se(),G=J(f(x),2);{var Q=r=>{ne(r,{})},H=r=>{Y(r,{title:"Error",children:(l,h)=>{O();var y=W(`Variant explorer feature has not been enabled in this environment. Please contact an admin if
      you have any questions.`);e(l,y)},$$slots:{default:!0}})};F(G,r=>{Lt.explorer.variantExplorer?r(Q):r(H,!1)})}e(C,x)},$$slots:{default:!0}}),vt(),q()}export{Re as component};
