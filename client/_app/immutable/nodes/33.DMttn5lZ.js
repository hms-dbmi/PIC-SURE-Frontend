import{s as I,x as G,i as p,n as c,f as i,e as $,t as M,c as k,b as w,d as q,r as f,h as x,z as B,a5 as H,l as N,a as O,w as z,g as F,v as Q,a8 as j}from"../chunks/CDvIr29H.js";import{h as J,u as K}from"../chunks/BJ-g7xSB.js";import{S as P,i as T,d as v,e as y,m as C,t as _,a as b,f as D}from"../chunks/ByE-_V18.js";import{g as U}from"../chunks/BszA2q6R.js";import"../chunks/4MwYNI-R.js";import{P as V}from"../chunks/BaEqrwl9.js";import{f as g,b as W}from"../chunks/Di2X-GR-.js";import{C as X}from"../chunks/BXrAqdrM.js";import{T as Y}from"../chunks/BiPL43FU.js";import{w as A}from"../chunks/ClzUMQ0P.js";import{u as Z,g as ee}from"../chunks/BEf3cR2P.js";function te(o){let e,r,t,n;return{c(){e=$("a"),r=M("More Info"),this.h()},l(a){e=k(a,"A",{href:!0,title:!0,class:!0,target:!0});var s=w(e);r=q(s,"More Info"),s.forEach(i),this.h()},h(){f(e,"href",o[0]||"#"),f(e,"title",o[0]?"More Info":"Link not available"),f(e,"class","btn variant-ghost-primary hover:variant-filled-primary"+(o[0]?"":" opacity-50 cursor-not-allowed")),f(e,"target","_blank")},m(a,s){p(a,e,s),x(e,r),t||(n=B(e,"click",H(o[3])),t=!0)},p:c,d(a){a&&i(e),t=!1,n()}}}function ne(o){let e;return{c(){e=$("i"),this.h()},l(r){e=k(r,"I",{class:!0}),w(e).forEach(i),this.h()},h(){f(e,"class","fa-regular fa-circle-check text-3xl text-success-500")},m(r,t){p(r,e,t)},p:c,d(r){r&&i(e)}}}function ae(o){let e;function r(a,s){return a[1]?ne:te}let n=r(o)(o);return{c(){n.c(),e=G()},l(a){n.l(a),e=G()},m(a,s){n.m(a,s),p(a,e,s)},p(a,[s]){n.p(a,s)},i:c,o:c,d(a){a&&i(e),n.d(a)}}}function re(o,e,r){let{data:t={row:{additional_info_link:"",consentGranted:!1}}}=e,n=t.row.additional_info_link,a=t.row.consentGranted;const s=l=>!n&&l.preventDefault();return o.$$set=l=>{"data"in l&&r(2,t=l.data)},[n,a,t,s]}class oe extends P{constructor(e){super(),T(this,e,re,ae,I,{data:2})}}const E=A([]),L=A([]);function se(){return ee("picsure/proxy/dictionary-api/dashboard")}function ce(){return!!localStorage.getItem("token")}async function le(){var s,l;const o=await se();E.set(o.columns);const e=N(Z),r=g.useQueryTemplate&&ce()&&(e==null?void 0:e.queryTemplate);let t=[];r&&(t=((l=(s=e.queryTemplate)==null?void 0:s.categoryFilters)==null?void 0:l["\\_consents\\"])||[]);const a=o.rows.map(ie(t)).sort((d,m)=>{var S,R;const h=(((S=d.program_name)==null?void 0:S.toString().toLowerCase())||"")==="anvil",u=(((R=m.program_name)==null?void 0:R.toString().toLowerCase())||"")==="anvil";return h!==u?h?1:-1:d.consentGranted===m.consentGranted?ue(d,m):d.consentGranted?-1:1});L.set(a)}function ie(o){return e=>{if(!e.accession)return{...e,consentGranted:!1};const r=e.accession.toString();if(/^phs\d+\.v\d+\.p\d+\.c\d+$/.test(r)){const n=r.replace(/\.v\d+\.p\d+/,"");return{...e,consentGranted:o.includes(n)}}return{...e,consentGranted:o.includes(r)}}}function ue(o,e){var n,a;const r=((n=o.abbreviation)==null?void 0:n.toString())||"",t=((a=e.abbreviation)==null?void 0:a.toString())||"";return r.localeCompare(t)}function fe(o){return{c,l:c,m:c,p:c,i:c,o:c,d:c}}function de(o){let e,r;return e=new Y({props:{tableName:_e,data:o[1],columns:o[0],cellOverides:o[2],defaultRowsPerPage:o[1].length,search:!1,showPagination:!1,stickyHeader:!0,rowClickHandler:g.dashboardDrawer?o[4]:void 0,isClickable:g.dashboardDrawer}}),{c(){v(e.$$.fragment)},l(t){y(e.$$.fragment,t)},m(t,n){C(e,t,n),r=!0},p(t,n){const a={};n&2&&(a.data=t[1]),n&1&&(a.columns=t[0]),n&2&&(a.defaultRowsPerPage=t[1].length),e.$set(a)},i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){b(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function me(o){let e,r;return e=new V({props:{animIndeterminate:"anim-progress-bar"}}),{c(){v(e.$$.fragment)},l(t){y(e.$$.fragment,t)},m(t,n){C(e,t,n),r=!0},p:c,i(t){r||(_(e.$$.fragment,t),r=!0)},o(t){b(e.$$.fragment,t),r=!1},d(t){D(e,t)}}}function pe(o){let e,r,t={ctx:o,current:null,token:null,hasCatch:!1,pending:me,then:de,catch:fe,blocks:[,,,]};return J(o[3],t),{c(){e=$("section"),t.block.c(),this.h()},l(n){e=k(n,"SECTION",{id:!0,class:!0});var a=w(e);t.block.l(a),a.forEach(i),this.h()},h(){f(e,"id","data-container"),f(e,"class","")},m(n,a){p(n,e,a),t.block.m(e,t.anchor=null),t.mount=()=>e,t.anchor=null,r=!0},p(n,a){o=n,K(t,o,a)},i(n){r||(_(t.block),r=!0)},o(n){for(let a=0;a<3;a+=1){const s=t.blocks[a];b(s)}r=!1},d(n){n&&i(e),t.block.d(),t.token=null,t=null}}}function he(o){let e,r,t;return document.title=W.applicationName,r=new X({props:{title:"Data Dashboard",class:"content-center",full:!0,$$slots:{default:[pe]},$$scope:{ctx:o}}}),{c(){e=O(),v(r.$$.fragment)},l(n){z("svelte-1uz9aip",document.head).forEach(i),e=F(n),y(r.$$.fragment,n)},m(n,a){p(n,e,a),C(r,n,a),t=!0},p(n,[a]){const s={};a&259&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(n){t||(_(r.$$.fragment,n),t=!0)},o(n){b(r.$$.fragment,n),t=!1},d(n){n&&i(e),D(r,n)}}}const _e="ExplorerTable";function be(o,e,r){const t=U();let n,a,s=[],l=[];const d={additional_info_link:oe},m=le();Q(()=>{n=E.subscribe(u=>r(0,s=u)),a=L.subscribe(u=>{r(1,l=u)})}),j(()=>{n&&n(),a&&a()});function h(u){t.open({id:"dashboard-drawer",meta:{row:u}})}return[s,l,d,m,h]}class Ie extends P{constructor(e){super(),T(this,e,be,he,I,{})}}export{Ie as component};
