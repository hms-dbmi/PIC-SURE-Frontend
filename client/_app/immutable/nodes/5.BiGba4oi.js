import"../chunks/CsbAvI7j.js";import{r as Ve,b as Be,f as De}from"../chunks/BD7x6Jnt.js";import{k as ft,m as gt,u as mt,n as pt,c as He}from"../chunks/BpV1Tt4c.js";import{f as u,a as i,p as ht,c as pe,t as xe}from"../chunks/DKNWTM-D.js";import{o as Ae,a as Xe}from"../chunks/DpyMT7OB.js";import{c as o,s as k,r as s,t as z,p as ve,g as r,h as K,a as ue,f as re,R as be,b as U,d as de,n as Se,e as $e,aD as bt}from"../chunks/KPVYLOSR.js";import{i as S}from"../chunks/CDCmQmr-.js";import{s as ce}from"../chunks/kg2g7Go4.js";import{a as W,s as me,b as Pe}from"../chunks/B2Bg6RTa.js";import{p as Ue}from"../chunks/DjiALQWk.js";import{g as ye,a as _t,b as Je}from"../chunks/DNfOBMJV.js";import{d as xt,ac as yt,ad as kt,k as wt}from"../chunks/DCY6c1ra.js";import{T as Rt,F as Ft}from"../chunks/SJqGEIYR.js";import{t as Ge}from"../chunks/CWjZNTTC.js";import{r as Pt,b as Ze,d as Ke,f as Re,c as Ct,t as Ne,h as et,e as Fe,i as Tt,j as Et,k as St,l as At,m as It}from"../chunks/XQ4prG3n.js";import{s as Y,r as Ot,d as he}from"../chunks/NtGCh5xy.js";import{e as ke,i as Ce}from"../chunks/B5lqQSsR.js";import{b as fe,e as je,s as ge}from"../chunks/Be_LeCLl.js";import{p as y,r as Bt}from"../chunks/CfrH0FQi.js";import{c as Dt,u as Nt,n as jt}from"../chunks/CMFSw6mp.js";import{c as zt}from"../chunks/CmhHF9t-.js";import{L as Lt}from"../chunks/DTPmYdw_.js";import{P as Vt}from"../chunks/l7jJndGx.js";import{E as Me,c as Gt,e as Mt}from"../chunks/CtWAh19b.js";import{a as tt}from"../chunks/DXJ436YI.js";import{t as _e,b as at,a as rt,s as st}from"../chunks/nsQMHjqs.js";import{e as it}from"../chunks/BqrDejZS.js";import{g as qt}from"../chunks/BibUdOWF.js";import{g as Qe}from"../chunks/oR7KrioB.js";import{p as Wt,k as Ut}from"../chunks/NEMz9L9V.js";import{M as qe,a as ot}from"../chunks/D3jF9FdZ.js";import{A as $t}from"../chunks/Dqw5Xd3-.js";import{C as ze}from"../chunks/CQcdv0WS.js";import{L as nt}from"../chunks/BW_ShK1N.js";import{p as Ee}from"../chunks/5RoAwCU1.js";import{o as Ye,a as Qt}from"../chunks/CBCWFIrM.js";import{n as Yt}from"../chunks/BPGq02fb.js";import{E as lt}from"../chunks/P3bGLiu7.js";var Ht=u("<div><!></div>"),Xt=u("<div><!></div>"),Jt=u("<div><!></div>"),Zt=u('<section data-testid="app-bar-headline"><!></section>'),Kt=u('<header role="toolbar" data-testid="app-bar"><section data-testid="app-bar-toolbar"><!> <!> <!></section> <!></header>');function ea(t,e){const n=y(e,"base",3,"w-full flex flex-col"),_=y(e,"background",3,"bg-surface-100-900"),m=y(e,"spaceY",3,"space-y-4"),b=y(e,"border",3,""),l=y(e,"padding",3,"p-4"),F=y(e,"shadow",3,""),w=y(e,"classes",3,""),d=y(e,"toolbarBase",3,"flex justify-between"),v=y(e,"toolbarGridCols",3,"grid-cols-[auto_1fr_auto]"),P=y(e,"toolbarGap",3,"gap-4"),p=y(e,"toolbarClasses",3,""),T=y(e,"leadBase",3,"flex"),E=y(e,"leadSpaceX",3,"space-x-4 rtl:space-x-reverse"),f=y(e,"leadPadding",3,""),h=y(e,"leadClasses",3,""),x=y(e,"centerBase",3,"grow"),A=y(e,"centerAlign",3,"text-center"),C=y(e,"centerPadding",3,""),I=y(e,"centerClasses",3,""),O=y(e,"trailBase",3,"flex"),N=y(e,"trailSpaceX",3,"space-x-4 rtl:space-x-reverse"),L=y(e,"trailPadding",3,""),V=y(e,"trailClasses",3,""),ee=y(e,"headlineBase",3,"w-full"),te=y(e,"headlineClasses",3,"");var ae=Kt(),se=o(ae),a=o(se);{var c=B=>{var j=Ht(),oe=o(j);ce(oe,()=>e.lead),s(j),z(()=>fe(j,1,`${T()??""} ${E()??""} ${f()??""} ${h()??""}`)),i(B,j)};S(a,B=>{e.lead&&B(c)})}var D=k(a,2);{var G=B=>{var j=Xt(),oe=o(j);ce(oe,()=>e.children),s(j),z(()=>fe(j,1,`${x()??""} ${A()??""} ${C()??""} ${I()??""}`)),i(B,j)};S(D,B=>{e.children&&B(G)})}var $=k(D,2);{var M=B=>{var j=Jt(),oe=o(j);ce(oe,()=>e.trail),s(j),z(()=>fe(j,1,`${O()??""} ${N()??""} ${L()??""} ${V()??""}`)),i(B,j)};S($,B=>{e.trail&&B(M)})}s(se);var H=k(se,2);{var X=B=>{var j=Zt(),oe=o(j);ce(oe,()=>e.headline),s(j),z(()=>fe(j,1,`${ee()??""} ${te()??""}`)),i(B,j)};S(H,B=>{e.headline&&B(X)})}s(ae),z(()=>{fe(ae,1,`${n()??""} ${_()??""} ${m()??""} ${b()??""} ${l()??""} ${F()??""} ${w()??""}`),fe(se,1,`${d()??""} ${v()??""} ${P()??""} ${p()??""}`)}),i(t,ae)}var ta=wt("avatar").parts("root","image","fallback"),Le=ta.build(),dt=t=>{var e;return((e=t.ids)==null?void 0:e.root)??`avatar:${t.id}`},ct=t=>{var e;return((e=t.ids)==null?void 0:e.image)??`avatar:${t.id}:image`},aa=t=>{var e;return((e=t.ids)==null?void 0:e.fallback)??`avatar:${t.id}:fallback`},ra=t=>t.getById(dt(t)),We=t=>t.getById(ct(t));function sa(t,e){const{state:n,send:_,prop:m,scope:b}=t,l=n.matches("loaded");return{loaded:l,setSrc(F){const w=We(b);w==null||w.setAttribute("src",F)},setLoaded(){_({type:"img.loaded",src:"api"})},setError(){_({type:"img.error",src:"api"})},getRootProps(){return e.element({...Le.root.attrs,dir:m("dir"),id:dt(b)})},getImageProps(){return e.img({...Le.image.attrs,hidden:!l,dir:m("dir"),id:ct(b),"data-state":l?"visible":"hidden",onLoad(){_({type:"img.loaded",src:"element"})},onError(){_({type:"img.error",src:"element"})}})},getFallbackProps(){return e.element({...Le.fallback.attrs,dir:m("dir"),id:aa(b),hidden:l,"data-state":l?"hidden":"visible"})}}}var ia=xt({initialState(){return"loading"},effects:["trackImageRemoval","trackSrcChange"],on:{"src.change":{target:"loading"},"img.unmount":{target:"error"}},states:{loading:{entry:["checkImageStatus"],on:{"img.loaded":{target:"loaded",actions:["invokeOnLoad"]},"img.error":{target:"error",actions:["invokeOnError"]}}},error:{on:{"img.loaded":{target:"loaded",actions:["invokeOnLoad"]}}},loaded:{on:{"img.error":{target:"error",actions:["invokeOnError"]}}}},implementations:{actions:{invokeOnLoad({prop:t}){var e;(e=t("onStatusChange"))==null||e({status:"loaded"})},invokeOnError({prop:t}){var e;(e=t("onStatusChange"))==null||e({status:"error"})},checkImageStatus({send:t,scope:e}){const n=We(e);if(!(n!=null&&n.complete))return;const _=oa(n)?"img.loaded":"img.error";t({type:_,src:"ssr"})}},effects:{trackImageRemoval({send:t,scope:e}){const n=ra(e);return kt(n,{callback(_){Array.from(_[0].removedNodes).find(l=>l.nodeType===Node.ELEMENT_NODE&&l.matches("[data-scope=avatar][data-part=image]"))&&t({type:"img.unmount"})}})},trackSrcChange({send:t,scope:e}){const n=We(e);return yt(n,{attributes:["src","srcset"],callback(){t({type:"src.change"})}})}}}});function oa(t){return t.complete&&t.naturalWidth!==0&&t.naturalHeight!==0}Dt()(["dir","id","ids","onStatusChange","getRootNode"]);var na=u("<img/>"),la=u("<figure><span><!></span> <!></figure>");function da(t,e){const n=ht();ve(e,!0);const _=y(e,"base",3,"overflow-hidden isolate"),m=y(e,"background",3,"bg-surface-400-600"),b=y(e,"size",3,"size-16"),l=y(e,"font",3,""),F=y(e,"border",3,""),w=y(e,"rounded",3,"rounded-full"),d=y(e,"shadow",3,""),v=y(e,"classes",3,""),P=y(e,"imageBase",3,"w-full object-cover"),p=y(e,"imageClasses",3,""),T=y(e,"style",3,""),E=y(e,"fallbackBase",3,"w-full h-full flex justify-center items-center"),f=y(e,"fallbackClasses",3,""),h=Bt(e,["$$slots","$$events","$$legacy","src","srcset","name","base","background","size","font","border","rounded","shadow","classes","imageBase","imageClasses","style","fallbackBase","fallbackClasses","children"]),x=Nt(ia,()=>({id:n,...h})),A=K(()=>sa(x,jt));function C(a){return a.split(" ").map(c=>c[0]).join("")}var I=la();let O;var N=o(I);let L;var V=o(N);{var ee=a=>{var c=pe(),D=re(c);ce(D,()=>e.children),i(a,c)},te=a=>{var c=xe();z(D=>Y(c,D),[()=>C(e.name)]),i(a,c)};S(V,a=>{e.children?a(ee):a(te,!1)})}s(N);var ae=k(N,2);{var se=a=>{var c=na();let D;z(G=>D=je(c,D,{...G,src:e.src,srcset:e.srcset,alt:e.name,class:`${P()??""} ${p()??""}`,"data-testid":"avatar-image"}),[()=>r(A).getImageProps()]),Ot(c),i(a,c)};S(ae,a=>{(e.src||e.srcset)&&a(se)})}s(I),z((a,c)=>{O=je(I,O,{...a,class:`${_()??""} ${m()??""} ${b()??""} ${l()??""} ${F()??""} ${w()??""} ${d()??""} ${v()??""}`,style:T(),"data-testid":"avatar"}),L=je(N,L,{...c,class:`${E()??""} ${f()??""}`,"data-testid":"avatar-fallback"})},[()=>r(A).getRootProps(),()=>r(A).getFallbackProps()]),i(t,I),ue()}const ca=({url:t})=>{},ts=Object.freeze(Object.defineProperty({__proto__:null,load:ca},Symbol.toStringTag,{value:"Module"}));var va=u('<div style="display: contents"><main class="w-full h-full"><div id="appShell" class="w-full h-full flex flex-col overflow-hidden" data-testid="app-shell"><!> <div class="flex-auto w-full h-full flex overflow-hidden"><div id="page" class="flex-1 overflow-x-hidden flex flex-col"><main id="page-content" class="flex-auto"><!></main> <footer id="page-footer" class="flex-none"><!></footer></div> <!></div></div></main></div>');function ua(t,e){var n=va(),_=o(n),m=o(_),b=o(m);ce(b,()=>e.header??be);var l=k(b,2),F=o(l),w=o(F),d=o(w);ce(d,()=>e.children??be),s(w);var v=k(w,2),P=o(v);ce(P,()=>e.pageFooter??be),s(v),s(F);var p=k(F,2);ce(p,()=>e.sidebarRight??be),s(l),s(m),s(_),s(n),i(t,n)}function fa(t,e){t.stopImmediatePropagation(),ye(`/login?redirectTo=${e().url.pathname}`)}var ga=u('<a href="/" aria-current="page" data-testid="logo-home-link" class="content-center"><!></a>'),ma=(t,e)=>gt(r(e),!1),pa=u('<p class="pb-6"> </p> <button id="user-logout-btn" class="btn preset-outlined-primary-500" title="Logout">Logout</button>',1),ha=u('<button id="user-login-btn" title="Login" class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500">Login</button>'),ba=u('<div id="user-session-avatar" class="content-center"><!></div>'),_a=u('<li><a class="nav-link"> </a></li>'),xa=u('<nav id="page-navigation"><ul></ul></nav>');function ya(t,e){ve(e,!0);const[n,_]=me(),m=()=>W(Ue,"$page",n),b=()=>W(ft,"$userRoutes",n),l=()=>W(mt,"$user",n),F=()=>W(pt,"$isLoggedIn",n);let w,d=de(void 0);function v({path:p,id:T}){return"nav-link"+(T?"-"+T:p.replaceAll("/","-"))}let P=K(()=>p=>{if(p.children){for(const T of p.children)if(m().url.pathname.includes(T.path))return"page";return}return m().url.pathname.includes(p.path)?"page":void 0});Ae(async()=>{var p;if(m()){const T=sessionStorage.getItem("type");T&&(w=(p=m().data)==null?void 0:p.providers.find(E=>E.type===T),U(d,await zt(w),!0))}}),ea(t,{padding:"py-0 pl-2 pr-5",background:"bg-surface-50-950",toolbarClasses:"flex-none z-10",lead:E=>{var f=ga(),h=o(f);Lt(h,{height:4,class:"mx-1"}),s(f),i(E,f)},trail:E=>{var f=ba(),h=o(f);{var x=C=>{Vt(C,{trigger:O=>{const N=K(()=>(l().email||"").toUpperCase());da(O,{get name(){return r(N)},background:"preset-tonal-primary hover:preset-tonal-secondary",border:"border hover:border-primary-400",font:"text-2xl",size:"size-12",classes:"m-3"})},children:(O,N)=>{var L=pa(),V=re(L),ee=o(V,!0);s(V);var te=k(V,2);te.__click=[ma,d],z(()=>Y(ee,l().email)),i(O,L)},$$slots:{trigger:!0,default:!0}})},A=C=>{var I=ha();I.__click=[fa,m],i(C,I)};S(h,C=>{l()&&l().privileges&&l().email&&F()?C(x):C(A,!1)})}s(f),i(E,f)},children:(E,f)=>{var h=xa(),x=o(h);ke(x,5,b,Ce,(A,C)=>{var I=_a(),O=o(I),N=o(O,!0);s(O),s(I),z((L,V)=>{ge(O,"id",L),ge(O,"href",r(C).path),ge(O,"aria-current",V),Y(N,r(C).text)},[()=>v(r(C)),()=>r(P)(r(C))]),i(A,I)}),s(x),s(h),i(E,h)},$$slots:{lead:!0,trail:!0,default:!0}}),ue(),_()}he(["click"]);async function ka(){var n;const t=await He(`/picsure/search/${Ve.openHPDS}`,{query:"\\_studies_consents\\"});console.log("studies",t);const e=Object.keys((n=t==null?void 0:t.results)==null?void 0:n.phenotypes);return console.log("studyConcepts",e),e}var wa=u("<div> </div>"),Ra=u('<div data-testid="any-record-of-filter-modal"><header><h1 class="text-lg font-normal"> </h1></header> <!></div>');function Fa(t,e){ve(e,!0);var n=Ra(),_=o(n),m=o(_),b=o(m,!0);s(m),s(_);var l=k(_,2);{var F=d=>{var v=pe(),P=re(v);ke(P,17,()=>e.filter.concepts,Ce,(p,T)=>{var E=wa(),f=o(E,!0);s(E),z(()=>Y(f,r(T))),i(p,E)}),i(d,v)},w=d=>{var v=xe("No filter provided");i(d,v)};S(l,d=>{e.filter.filterType==="AnyRecordOf"?d(F):d(w,!1)})}s(n),z(()=>{var d,v,P,p;return Y(b,`${(v=(d=e.filter)==null?void 0:d.concepts)==null?void 0:v.length} variable(s) in ${((P=e.filter.searchResult)==null?void 0:P.display)||((p=e.filter.searchResult)==null?void 0:p.name)||e.filter.variableName} category`)}),i(t,n),ue()}function Pa(t,e,n,_){e.filter.filterType==="genomic"?(Wt(e.filter),ye("/explorer/genome-filter?edit="+Qe.Genomic)):e.filter.filterType==="snp"?(Ut(e.filter),ye("/explorer/genome-filter?edit="+Qe.SNP)):(Pe(Ze,e.filter),Pe(Ke,e.filter.searchResult))}const Ca=function(t,e){return Pt(e.filter.uuid)};var Ta=(t,e)=>(t.key==="Enter"||t.key===" ")&&e(t),Ea=u('<div class="flex-auto variable svelte-88jmke" tabindex="0" role="button"> </div>'),Sa=u('<div class="text-left"> </div>'),Aa=u('<button type="button" title="Edit Filter" class="bg-initial text-black-500 hover:text-primary-600"><i class="fa-solid fa-pen-to-square"></i> <span class="sr-only">Edit Filter</span></button>'),Ia=u('<i class="fa-solid fa-pen-to-square"></i> <span class="sr-only">Edit Filter</span>',1),Oa=u('<button type="button" title="See details" class="bg-initial text-black-500 hover:text-primary-600"><i></i> <span class="sr-only">See details</span></button>'),Ba=u("<div> </div>"),Da=u('<section class="p-1 whitespace-pre-wrap"> <!></section>'),Na=u('<div class="flex flex-col card bg-surface-100 p-1 m-1"><header class="card-header p-1 flex svelte-88jmke"><!> <div class="actions svelte-88jmke"><!> <button type="button" title="Remove Filter" class="bg-initial text-black-500 hover:text-primary-600"><i class="fa-solid fa-times-circle"></i> <span class="sr-only">Remove Filter</span></button> <!></div></header> <!></div>');function ja(t,e){ve(e,!0);const[n,_]=me(),m=()=>W(Ze,"$activeFilter",n),b=()=>W(Ke,"$activeSearch",n);let l=de(!1),F=de("fa-caret-up");const w=K(()=>["genomic","snp"].includes(e.filter.filterType)),d=K(()=>e.filter.filterType==="AnyRecordOf");let v=de(!1),P=de(!1);const p=function(a){if(a.filterType==="Categorical")if(a.displayType==="restrict"){let c=a.categoryValues.length===1?"value":"values";return`Restricting to ${a.categoryValues.length} ${c}.`}else return a.displayType==="any"||a.displayType==="anyRecordOf"?"Restricting to any value.":a.description;else{if(a.filterType==="AnyRecordOf")return"Restricting to children of the selected value.";if(a.filterType==="numeric")switch(a.displayType){case"any":return"Restricting to any value.";case"between":return`Restricting to between ${a.min} and ${a.max}.`;case"greaterThan":return`Restricting to greater than ${a.min}.`;case"lessThan":return`Restricting to less than ${a.max}.`;default:return a.description||"N/A"}else if(a.filterType==="genomic"||a.filterType==="snp")return a.description}},T=function(a){var c,D,G,$;return(c=a.searchResult)!=null&&c.studyAcronym&&((D=a.searchResult)!=null&&D.dataset)?`${a.searchResult.studyAcronym} (${a.searchResult.dataset})`:((G=a.searchResult)==null?void 0:G.studyAcronym)||(($=a.searchResult)==null?void 0:$.dataset)||""},E=function(a){a.stopPropagation(),a.preventDefault(),U(l,!r(l)),U(F,r(l)?"fa-caret-down":"fa-caret-up",!0)};var f=Na(),h=o(f),x=o(h);{var A=a=>{var c=Ea();c.__click=E,c.__keydown=[Ta,E];var D=o(c,!0);s(c),z(()=>Y(D,e.filter.variableName)),i(a,c)},C=a=>{const c=K(()=>`any-record-of-filter-modal-${e.filter.id}`);qe(a,{title:"View Variables in Filter",get"data-testid"(){return r(c)},withDefault:!1,get open(){return r(P)},set open(G){U(P,G,!0)},trigger:G=>{var $=Sa(),M=o($);s($),z(()=>{var H,X,B,j;return Y(M,`${((X=(H=e.filter)==null?void 0:H.concepts)==null?void 0:X.length)??""} variable(s) in ${(((B=e.filter.searchResult)==null?void 0:B.display)||((j=e.filter.searchResult)==null?void 0:j.name)||e.filter.variableName)??""}
            category`)}),i(G,$)},children:(G,$)=>{Fa(G,{get filter(){return e.filter}})},$$slots:{trigger:!0,default:!0}})};S(x,a=>{r(d)?a(C,!1):a(A)})}var I=k(x,2),O=o(I);{var N=a=>{var c=Aa();c.__click=[Pa,e,m,b],i(a,c)},L=(a,c)=>{{var D=G=>{qe(G,{title:"Edit Filter",triggerBase:"bg-initial text-black-500 hover:text-primary-600",withDefault:!1,get open(){return r(v)},set open(M){U(v,M,!0)},trigger:M=>{var H=Ia();Se(2),i(M,H)},children:(M,H)=>{$t(M,{get data(){return e.filter.searchResult},get existingFilter(){return e.filter},onclose:()=>U(v,!1)})},$$slots:{trigger:!0,default:!0}})};S(a,G=>{r(d)||G(D)},c)}};S(O,a=>{r(w)?a(N):a(L,!1)})}var V=k(O,2);V.__click=[Ca,e];var ee=k(V,2);{var te=a=>{var c=Oa();c.__click=E;var D=o(c);Se(2),s(c),z(()=>fe(D,1,`fa-solid ${r(F)??""}`,"svelte-88jmke")),i(a,c)};S(ee,a=>{r(d)||a(te)})}s(I),s(h);var ae=k(h,2);{var se=a=>{var c=Da(),D=o(c),G=k(D);{var $=M=>{var H=Ba(),X=o(H);s(H),z(B=>Y(X,`Values: ${B??""}`),[()=>e.filter.categoryValues.join(", ")]),i(M,H)};S(G,M=>{e.filter.filterType==="Categorical"&&e.filter.displayType!=="any"&&e.filter.displayType!=="anyRecordOf"&&M($)})}s(c),z((M,H)=>Y(D,`${M??""}
      ${H??""} `),[()=>p(e.filter),()=>T(e.filter)]),_e(3,c,()=>st,()=>({axis:"y"})),i(a,c)};S(ae,a=>{r(l)&&a(se)})}s(f),z(()=>{ge(f,"id",e.filter.uuid),ge(f,"data-testid",`added-filter-${e.filter.id??""}`)}),_e(1,f,()=>at,()=>({easing:it})),_e(2,f,()=>rt,()=>({duration:300})),i(t,f),ue(),_()}he(["click","keydown"]);const za=function(t,e,n){e(n.variable.id)};var La=u('<div class="flex flex-col card bg-surface-100 p-1 m-1"><header class="card-header p-1 flex"><div class="flex-auto"> </div> <button type="button" title="Remove Export" class="btn-icon-color" aria-label="Remove Export"><i class="fa-solid fa-times-circle"></i></button></header></div>');function Va(t,e){ve(e,!0);const{removeExport:n}=Me;var _=La(),m=o(_),b=o(m),l=o(b,!0);s(b);var F=k(b,2);F.__click=[za,n,e],s(m),s(_),z(()=>{var w,d;ge(_,"id",e.variable.studyId?`${e.variable.studyId}-${e.variable.conceptPath}`:e.variable.conceptPath),ge(_,"data-testid",`added-export-${e.variable.conceptPath??""}`),Y(l,e.variable.display||((w=e.variable.searchResult)==null?void 0:w.display)||((d=e.variable.searchResult)==null?void 0:d.name))}),_e(3,_,()=>rt,()=>({duration:300})),i(t,_),ue()}he(["click"]);var Ga=u('<i class="fa-solid fa-triangle-exclamation"></i> <span class="sr-only"></span>',1),Ma=u('<span id="result-count" class="text-4xl"><!></span>'),qa=u('<span id="result-count" class="text-4xl"><i class="fa-solid fa-triangle-exclamation"></i> <span class="sr-only"></span></span>'),Wa=()=>ye("/explorer/export"),Ua=u('<div class="h-11 mt-4"><button id="export-data-button" type="button" class="btn preset-filled-primary-500">Prepare for Analysis</button></div>'),$a=(t,e)=>U(e,!0),Qa=u('<button data-testid="clear-all-results-btn" class="anchor text-sm flex-none">Reset</button>'),Ya=u('<p class="text-center">No filters added</p>'),Ha=u('<header class="text-left ml-1">Filters</header>'),Xa=u('<div class="px-4 mb-1 w-80"><!> <section class="py-1"></section></div>'),Ja=u('<div class="px-4 mb-1 w-80"><header class="text-left ml-1" data-testid="export-header">Added Variables</header> <section class="py-1"></section></div>'),Za=u('<div class="flex flex-col items-center mt-7"><hr class="svelte-6n5r83"/> <h5 class="text-center text-xl mt-7">Tool Suite</h5> <div class="flex flex-row flex-wrap justify-items-center gap-4 w-80 justify-center"><!> <!> <!></div></div>'),Ka=u('<!> <section id="results-panel" class="flex flex-col items-center pt-8 pr-10 w-64"><div class="flex flex-col items-center mt-2"><!> <h4 class="text-center"> </h4></div> <!> <div id="export-filters" class="flex flex-col items-center mt-7 w-80"><hr class="svelte-6n5r83"/> <div class="flex content-center mt-7"><h5 class="text-xl flex-auto mr-2 mb-2">Filtered Data Summary</h5> <!></div> <!> <!></div> <!></section>',1);function er(t,e){ve(e,!0);const[n,_]=me(),m=()=>W(Ue,"$page",n),b=()=>W(Re,"$filters",n),l=()=>W(Mt,"$exports",n),F=()=>W(et,"$hasGenomicFilter",n),w="N/A";let d,v=de(0),P=de($e(Promise.resolve(0))),p=de($e(m().url.pathname.includes("/discover"))),T=de(!1),E=0;async function f(){var q,ie,ne,Q;U(h,"");const g=++E;let R=qt(!r(p),r(p)?Ve.openHPDS:Ve.hpds,r(p)?"CROSS_COUNT":"COUNT");try{if(r(p)){const Z=await ka();R.query.setCrossCountFields(Z)}const J=await He("picsure/query/sync",R);if(g!==E)return 0;if(r(p)){let Z=String(J["\\_studies_consents\\"]);Z.includes(" Â±")?(U(v,parseInt(Z.split(" ")[0]),!0),U(h,Z.split(" ")[1],!0),Ne.set(r(v))):(U(v,Z,!0),Ne.set(Z))}else Ne.set(J),U(v,J,!0);return J}catch{return b().length!==0?Ge.error({description:(ie=(q=Be)==null?void 0:q.explorePage)==null?void 0:ie.filterErrorText,closable:!1}):Ge.error({title:(Q=(ne=Be)==null?void 0:ne.explorePage)==null?void 0:Q.queryErrorText}),U(v,w),0}}let h=de(""),x=K(()=>b().length!==0||l().length!==0),A=K(()=>!r(p)&&r(v)!==w&&r(v)!==0&&r(x)),C=K(()=>b().length!==0&&!b().every(g=>g.filterType==="genomic"||g.filterType==="snp"||g.filterType==="AnyRecordOf")),I=K(()=>!r(p)&&De.explorer.distributionExplorer&&r(C)),O=K(()=>r(p)&&De.discoverFeautures.distributionExplorer&&r(C)),N=K(()=>!r(p)&&De.explorer.variantExplorer&&F()),L=K(()=>r(v)!==0&&(b().length!==0||l().length!==0)&&(r(I)||r(O)||r(N)));Ae(async()=>{d=Re.subscribe(()=>{U(P,f(),!0)})}),_t(async()=>{d&&d(),U(p,m().url.pathname.includes("/discover"),!0),(m().url.pathname.includes("/explorer")||r(p))&&(await bt(),d=Re.subscribe(()=>{U(P,f(),!0)}))}),Je(()=>{d&&d()}),Xe(()=>{d&&d()});var V=Ka(),ee=re(V);qe(ee,{title:"Clear All Filters",withDefault:!0,confirmText:"Yes",cancelText:"No",onconfirm:()=>{Ct(),Gt()},get open(){return r(T)},set open(g){U(T,g,!0)},children:(g,R)=>{Se();var q=xe("Are you sure you want to clear all filters?");i(g,q)},$$slots:{default:!0}});var te=k(ee,2),ae=o(te),se=o(ae);tt(se,()=>r(P),g=>{nt(g,{ring:!0})},g=>{var R=Ma(),q=o(R);{var ie=Q=>{var J=Ga(),Z=k(re(J),2);Z.textContent="N/A",i(Q,J)},ne=Q=>{var J=xe();z(Z=>Y(J,`${Z??""} ${(r(h)||"")??""}`),[()=>{var Z;return(Z=r(v))==null?void 0:Z.toLocaleString()}]),i(Q,J)};S(q,Q=>{r(v)===w?Q(ie):Q(ne,!1)})}s(R),i(g,R)},g=>{var R=qa(),q=k(o(R),2);q.textContent="N/A",s(R),i(g,R)});var a=k(se,2),c=o(a,!0);s(a),s(ae);var D=k(ae,2);{var G=g=>{var R=Ua(),q=o(R);q.__click=[Wa],s(R),_e(3,q,()=>at,()=>({easing:it})),i(g,R)};S(D,g=>{r(A)&&g(G)})}var $=k(D,2),M=k(o($),2),H=k(o(M),2);{var X=g=>{var R=Qa();R.__click=[$a,T],i(g,R)};S(H,g=>{r(x)&&g(X)})}s(M);var B=k(M,2);{var j=g=>{var R=Ya();i(g,R)},oe=g=>{var R=Xa(),q=o(R);{var ie=Q=>{var J=Ha();i(Q,J)};S(q,Q=>{b().length!==0&&Q(ie)})}var ne=k(q,2);ke(ne,5,b,Ce,(Q,J)=>{ja(Q,{get filter(){return r(J)}})}),s(ne),s(R),i(g,R)};S(B,g=>{b().length===0&&l().length===0?g(j):g(oe,!1)})}var Te=k(B,2);{var Ie=g=>{var R=Ja(),q=k(o(R),2);ke(q,5,l,ie=>ie.id,(ie,ne)=>{Va(ie,{get variable(){return r(ne)}})}),s(q),s(R),i(g,R)};S(Te,g=>{l().length!==0&&g(Ie)})}s($);var Oe=k($,2);{var we=g=>{var R=Za(),q=k(o(R),4),ie=o(q);{var ne=le=>{ze(le,{href:"/explorer/distributions","data-testid":"distributions-btn",title:"Variable Distributions",icon:"fa-solid fa-chart-pie",size:"md"})};S(ie,le=>{r(I)&&le(ne)})}var Q=k(ie,2);{var J=le=>{ze(le,{href:"/discover/distributions","data-testid":"distributions-btn",title:"Variable Distributions",icon:"fa-solid fa-chart-pie",size:"md"})};S(Q,le=>{r(O)&&le(J)})}var Z=k(Q,2);{var vt=le=>{const ut=K(()=>m().url.pathname.includes("explorer/variant"));ze(le,{href:"/explorer/variant","data-testid":"variant-explorer-btn",title:"Variant Explorer",icon:"fa-solid fa-dna",size:"md",get active(){return r(ut)}})};S(Z,le=>{r(N)&&le(vt)})}s(q),s(R),i(g,R)};S(Oe,g=>{r(L)&&g(we)})}s(te),z(()=>{var g,R;return Y(c,(R=(g=Be)==null?void 0:g.explorePage)==null?void 0:R.totalPatientsText)}),_e(3,te,()=>st,()=>({axis:"x"})),i(t,V),ue(),_()}he(["click"]);var tr=u('<div id="side-panel"><div id="side-panel-bar" class="svelte-uj3z3w"><button type="button" id="results-panel-toggle" class="btn-icon btn-icon-sm preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500 svelte-uj3z3w" aria-label="Toggle Results Panel"><i></i></button></div> <!></div>');function ar(t,e){ve(e,!0);const[n,_]=me(),m=()=>W(Re,"$filters",n),b=()=>W(F,"$exports",n),l=()=>W(Ee,"$panelOpen",n);let{exports:F}=Me,w,d;function v(){Ee.set(!0)}Ae(()=>{w=Re.subscribe(()=>{var x;((x=m())==null?void 0:x.length)!==0&&v()}),d=Me.subscribe(()=>{var x;((x=b())==null?void 0:x.length)!==0&&v()})}),Xe(()=>{w&&w(),d&&d()});var P=tr(),p=o(P),T=o(p);T.__click=()=>{Ee.update(x=>!x)};var E=o(T);s(T),s(p);var f=k(p,2);{var h=x=>{er(x,{})};S(f,x=>{l()&&x(h)})}s(P),z(()=>{fe(P,1,`flex ${l()?"open":"closed"}-panel`),ge(T,"title",`${l()?"Hide":"Show"} Results`),fe(E,1,`fa-solid ${l()?"fa-arrow-right":"fa-arrow-left"}`)}),i(t,P),ue(),_()}he(["click"]);function rr(t,e){const[n,_]=me(),m=()=>W(Ye,"$drawerState",n);let b=y(e,"position",3,"right"),l=y(e,"width",3,"w-[480px]");const F=b()==="left"?"justify-start":"justify-end";ot(t,{get open(){return m()},onOpenChange:d=>Pe(Ye,d.open),triggerBase:"btn preset-tonal",get contentBase(){return`bg-surface-50-950 p-4 space-y-4 shadow-xl ${l()??""} h-screen overflow-auto`},positionerJustify:F,positionerAlign:"",positionerPadding:"",transitionsPositionerIn:{x:-480,duration:200},transitionsPositionerOut:{x:-480,duration:200},ids:{content:"drawer"},get trigger(){return e.trigger},content:d=>{var v=pe(),P=re(v);ce(P,()=>e.children??be),i(d,v)},$$slots:{content:!0}}),_()}var sr=u('<h2 data-testid="drawer-title" class="text-2xl font-bold ml-4"></h2>'),ir=u('<li class="ml-8"> </li>'),or=u('<ul class="list-disc"></ul>'),nr=u('<li class="m-2"><strong class="capitalize"> </strong>: <!></li>'),lr=t=>t.stopPropagation(),dr=u('<div class="flex justify-center items-center mb-4"><a class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500" target="_blank">More Info</a></div>'),cr=u('<ul data-testid="drawer-details" class="m-4 p-4"></ul> <!>',1),vr=u("<!> <hr/> <!>",1);function ur(t,e){var T,E,f;ve(e,!0);const[n,_]=me(),m=()=>W(Qt,"$activeRow",n),b=((T=m())==null?void 0:T.dataset_id)||"",l=((E=m())==null?void 0:E.name)||"",F=((f=m())==null?void 0:f.additional_info_link)||"";async function w(){const h=await Yt(b);if(!h||Object.keys(h).length===0)throw new Error("No details found");return h.datasetId&&delete h.datasetId,h.studyFullname&&delete h.studyFullname,h}var d=vr(),v=re(d);{var P=h=>{var x=sr();x.textContent=l,i(h,x)};S(v,h=>{l&&h(P)})}var p=k(v,4);tt(p,w,h=>{nt(h,{ring:!0,size:"medium"})},(h,x)=>{var A=cr(),C=re(A);ke(C,21,()=>Object.entries(r(x)),Ce,(N,L)=>{let V=()=>r(L)[0],ee=()=>r(L)[1];var te=pe(),ae=re(te);{var se=a=>{var c=nr(),D=o(c),G=o(D,!0);s(D);var $=k(D,2);{var M=X=>{var B=or();ke(B,21,ee,Ce,(j,oe)=>{var Te=pe(),Ie=re(Te);{var Oe=we=>{var g=ir(),R=o(g,!0);s(g),z(()=>Y(R,r(oe))),i(we,g)};S(Ie,we=>{r(oe)&&we(Oe)})}i(j,Te)}),s(B),i(X,B)},H=X=>{var B=xe();z(()=>Y(B,ee())),i(X,B)};S($,X=>{Array.isArray(ee())?X(M):X(H,!1)})}s(c),z(X=>Y(G,X),[()=>V().replace(/([A-Z])/g," $1").toLowerCase().trim()]),i(a,c)};S(ae,a=>{ee()&&a(se)})}i(N,te)}),s(C);var I=k(C,2);{var O=N=>{var L=dr(),V=o(L);ge(V,"href",F||"#"),V.__click=[lr],s(L),i(N,L)};S(I,N=>{F&&N(O)})}i(h,A)},h=>{lt(h,{title:"An Error Occured",children:(x,A)=>{Se();var C=xe("We're having trouble fetching the dataset details right now. Please try again later.");i(x,C)},$$slots:{default:!0}})}),i(t,d),ue(),_()}he(["click"]);var fr=u('<p> </p> <p> </p> <div><button class="btn preset-outlined-warning-500 hover:preset-filled-warning-500">Remove Invalid Filters</button> <button class="btn preset-outlined-warning-500 hover:preset-filled-warning-500"> </button></div>',1);function gr(t,e){ve(e,!0);const[n,_]=me(),m=()=>W(Fe,"$filterWarning",n);let b=y(e,"open",15,!1);const l={stigmatizing:{message:"Your selected filters contain stigmatizing variables and/or genomic filters, which are not supported with Discover",backTo:"Explore",path:"/discover",back:"/explorer",resetQuery:()=>{Et(),St()}},notAuthorized:{message:"You are not authorized to access the data in Explore based on your selected filters.",backTo:"Discover",path:"/explorer",back:"/discover",resetQuery:()=>Tt()},undefined:{message:"",backTo:"",path:"/",back:"/",resetQuery:()=>{}}},F=K(()=>l[m()||"undefined"]);function w(){const v=r(F).back;Fe.set(void 0),b(!1),ye(v)}function d(){const v=r(F).path;r(F).resetQuery(),Ee.set(!1),Fe.set(void 0),b(!1),ye(v)}ot(t,{get open(){return b()},onOpenChange:P=>b(P.open),contentBase:"overflow-auto max-w-screen w-1/2 max-h-screen",backdropClasses:"backdrop-blur-sm",ids:{content:"modal-component"},content:P=>{lt(P,{"data-testid":"sendfilter-warning",color:"warning",children:(p,T)=>{var E=fr(),f=re(E),h=o(f,!0);s(f);var x=k(f,2),A=o(x);s(x);var C=k(x,2),I=o(C);I.__click=d;var O=k(I,2);O.__click=w;var N=o(O);s(O),s(C),z(()=>{Y(h,r(F).message),Y(A,`Would you like to remove the invalid filters or go back to ${r(F).backTo??""}?`),Y(N,`Back to ${r(F).backTo??""}`)}),i(p,E)},$$slots:{default:!0}})},$$slots:{content:!0}}),ue(),_()}he(["click"]);var mr=u('<div id="sidebar-right" class="flex overflow-auto"><!></div>'),pr=u("<!> <!> <!> <!>",1);function as(t,e){ve(e,!0);const[n,_]=me(),m=()=>W(Ue,"$page",n),b=()=>W(At,"$hasInvalidFilter",n),l=()=>W(et,"$hasGenomicFilter",n),F=()=>W(It,"$hasUnallowedFilter",n);let w=de(!1);Ae(()=>{document.body.classList.add("started")});let d=K(()=>(m().url.pathname.includes("/explorer")||m().url.pathname.includes("/discover"))&&!m().url.pathname.includes("/export")&&!m().url.pathname.includes("/distributions"));Je(({to:f,cancel:h})=>{const x=(f==null?void 0:f.url.pathname.includes("/explorer"))&&b(),A=(f==null?void 0:f.url.pathname.includes("/discover"))&&(l()||F());(A||x)&&(A?Pe(Fe,"stigmatizing"):x&&Pe(Fe,"notAuthorized"),h(),U(w,!0))});var v=pr(),P=re(v);Rt(P,{toaster:Ge});var p=k(P,2);gr(p,{get open(){return r(w)},set open(f){U(w,f,!0)}});var T=k(p,2);rr(T,{position:"right",width:"w-1/2",children:(f,h)=>{ur(f,{})},$$slots:{default:!0}});var E=k(T,2);ua(E,{header:A=>{ya(A,{})},sidebarRight:A=>{var C=pe(),I=re(C);{var O=N=>{var L=mr(),V=o(L);ar(V,{}),s(L),i(N,L)};S(I,N=>{r(d)&&N(O)})}i(A,C)},pageFooter:A=>{Ft(A,{})},children:(A,C)=>{var I=pe(),O=re(I);ce(O,()=>e.children??be),i(A,I)}}),i(t,v),ue(),_()}export{as as component,ts as universal};
