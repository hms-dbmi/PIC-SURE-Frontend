import{f as i,a as t,c as We,t as ae}from"../chunks/CtfeAAbw.js";import{p as at,aO as Ze,c as r,s as d,F as Qt,r as a,t as Re,a as rt,C as V,g as e,aP as et,f as fe,n as M,h as ce,b as I,d as Qe,e as n}from"../chunks/B4GrenNm.js";import{d as Tt}from"../chunks/D7VV4X-8.js";import{i as P}from"../chunks/CSsnQ7i2.js";import{p as Ae,a as de,s as ot,e as Be}from"../chunks/DvPjbdiY.js";import{w as Ot,a as zt,o as Vt}from"../chunks/DlIBaGjY.js";import{s as ge}from"../chunks/DxSOTiY2.js";import{a as nt}from"../chunks/bf3FOAR_.js";import{e as yt,i as wt}from"../chunks/BdG0KSB2.js";import{c as ht}from"../chunks/10UUyb-S.js";import{b as xt,s as pt,r as At}from"../chunks/BPiAbArq.js";import{b as Wt,a as Ht}from"../chunks/CJCVGGPV.js";import{c as ze,j as Ve,r as Gt,t as Xt}from"../chunks/yAhaO9Md.js";import{T as it}from"../chunks/BaZNUrV8.js";import{g as Yt}from"../chunks/CsA2x4iF.js";import{b as Jt}from"../chunks/Bt-Xh7oU.js";import{f as Ne,b as xe,s as Kt}from"../chunks/CHRSknKA.js";import{Q as Zt,a as ea}from"../chunks/TFI6d4jL.js";import{E as It,e as ta,r as aa,a as ra}from"../chunks/BK8ReYLX.js";import{f as Pt,v as oa}from"../chunks/CwvcP1kx.js";import{t as Mt}from"../chunks/4cc1tg3A.js";import{e as sa}from"../chunks/BtrPhJEK.js";import{s as ut}from"../chunks/BWMYve5J.js";import{t as vt,a as ft}from"../chunks/C4-uZRU6.js";import{A as gt,C as la}from"../chunks/DpviI_uJ.js";import{S as na}from"../chunks/CMu1-vVn.js";import{U as ia}from"../chunks/CZSG3SRm.js";import{E as ct}from"../chunks/BVg5wqNm.js";import{C as Ct}from"../chunks/C8guQpMT.js";import{M as ca}from"../chunks/CtCNvYvu.js";import{T as bt,C as Et}from"../chunks/CxpkWrXI.js";import{L as Oe}from"../chunks/B7pZD2Tm.js";const Ce=Ot({current:0,total:0,stepMap:[]});async function da(W,s){if(s===""&&s.trim()==="")throw"Please input a Dataset ID name";const p=/^[\w \-\\/?+=[\].():"']+$/g;if(!s.match(p))throw`Name can only contain letters, numbers, and these special symbols - ? + = [ ] . ( ) : ' "`;return await ze(Ve.NamedDataSet,{queryId:W,name:s})}var ua=i("<div><span> </span></div>"),pa=i('<header class="stepper-header flex items-center border-t mt-[15px] mb-7 border-surface-500 gap-4"></header>'),va=i('<div data-testid="stepper"><!> <div class="stepper-content"><!></div></div>');function fa(W,s){at(s,!0);const[p,re]=ot(),o=()=>de(Ce,"$stepperState",p),R=()=>{},L=Ae(s,"buttonCompleteLabel",3,""),Q=Ae(s,"class",3,""),X=Ae(s,"onnext",3,R),g=Ae(s,"onback",3,R),c=Ae(s,"oncomplete",3,R);async function l(v){if(await new Promise(Y=>setTimeout(Y)),v)return;const h=o().current+1,Ee=o().stepMap[h];X()(h,Ee,o()),Be(Ce,V(o).current=h,V(o))}function b(){const v=o().current===0?0:o().current-1,h=o().stepMap[v];g()(v,h,o()),Be(Ce,V(o).current=v,V(o))}function y(v,h){h||c()(v,o().stepMap[v],o())}function A(v){return v===o().current}Ze("buttonCompleteLabel",L()),Ze("StepperState",Ce),Ze("onBack",b),Ze("onNext",l),Ze("onComplete",y);var S=va(),w=r(S);{var F=v=>{var h=pa();yt(h,5,()=>Array.from(Array(o().total).keys()),wt,(Ee,Y)=>{var J=ua();let $;var x=r(J),oe=r(x,!0);a(x),a(J),Re((ue,Te,K)=>{$=xt(J,1,"stepper-header-step -mt-[15px] transition-all duration-300",null,$,ue),pt(x,"data-testid",`step-${o().stepMap[e(Y)]??""}`),xt(x,1,`badge rounded-2xl text-sm ${Te??""}`),ge(oe,K)},[()=>({"flex-1":A(e(Y))}),()=>A(e(Y))?"preset-filled-primary-500":"preset-filled-surface-500",()=>A(e(Y))?`Step ${e(Y)+1}`:e(Y)+1]),t(Ee,J)}),a(h),vt(1,h,()=>ft,()=>({duration:100})),vt(2,h,()=>ft,()=>({duration:100})),t(v,h)};P(w,v=>{o().total&&v(F)})}var N=d(w,2),B=r(N);ut(B,()=>s.children??Qt),a(N),a(S),Re(()=>xt(S,1,`stepper space-y-4 ${Q()??""}`)),t(W,S),rt(),re()}var ma=i('<header class="step-header text-2xl font-bold"><!></header>'),_a=i('<div class="step-navigation-slot"><!></div>'),ha=i("<div></div>"),xa=i('<div class="step-navigation flex justify-between gap-4"><!> <!></div>'),ga=i('<div class="step space-y-4"><!> <div class="step-content space-y-4 px-2"><!></div> <!></div>');function tt(W,s){at(s,!0);const[p,re]=ot(),o=()=>de(Q,"$stepperState",p),R=Ae(s,"locked",3,!1),L=et("buttonCompleteLabel"),Q=et("StepperState"),X=et("onNext"),g=et("onBack"),c=et("onComplete"),l=o().total;Be(Q,V(o).stepMap=[...o().stepMap,s.name],V(o)),Be(Q,V(o).total++,V(o)),zt(()=>{Be(Q,V(o).total--,V(o)),Be(Q,V(o).stepMap=o().stepMap.filter(S=>S!==s.name),V(o))});var b=We(),y=fe(b);{var A=S=>{var w=ga();pt(w,"data-testid",`step-${l+1}`);var F=r(w);{var N=$=>{var x=ma(),oe=r(x);ut(oe,()=>s.header),a(x),t($,x)};P(F,$=>{s.header&&$(N)})}var B=d(F,2),v=r(B);{var h=$=>{var x=We(),oe=fe(x);ut(oe,()=>s.children),t($,x)},Ee=$=>{var x=ae();x.nodeValue=`(Step ${l+1} Content)`,t($,x)};P(v,$=>{s.children?$(h):$(Ee,!1)})}a(B);var Y=d(B,2);{var J=$=>{var x=xa(),oe=r(x);{var ue=q=>{var me=_a(),qe=r(me);ut(qe,()=>s.navigation),a(me),t(q,me)},Te=(q,me)=>{{var qe=$e=>{const Le=ce(()=>o().current===0);gt($e,{onclick:g,get disabled(){return e(Le)},children:(st,$t)=>{M();var lt=ae("Back");t(st,lt)},$$slots:{default:!0}})},Ie=$e=>{var Le=ha();t($e,Le)};P(q,$e=>{l!==0?$e(qe):$e(Ie,!1)},me)}};P(oe,q=>{s.navigation?q(ue):q(Te,!1)})}var K=d(oe,2);{var He=q=>{gt(q,{name:"next",angle:"right",variant:"filled",color:"primary-500",get disabled(){return R()},onclick:()=>X(R()),children:(me,qe)=>{M();var Ie=ae("Next");t(me,Ie)},$$slots:{default:!0}})},Ge=q=>{gt(q,{name:L||"complete",angle:"right",variant:"filled",color:"primary-500",get disabled(){return R()},onclick:()=>c(l,R()),children:(me,qe)=>{M();var Ie=ae();Ie.nodeValue=L||"Complete",t(me,Ie)},$$slots:{default:!0}})};P(K,q=>{l<o().total-1?q(He):q(Ge,!1)})}a(x),vt(1,x,()=>ft,()=>({duration:100})),vt(2,x,()=>ft,()=>({duration:100})),t($,x)};P(Y,$=>{o().total>1&&$(J)})}a(w),t(S,w)};P(y,S=>{l===o().current&&S(A)})}t(W,b),rt(),re()}var ba=i('<div id="stats" class="w-full flex justify-evenly mb-5 pb-2 svelte-10e6ctx"><div id="summary" class="w-full grid grid-flow-col auto-cols-auto"><div class="text-xl"><label for="summary" class="mr-8 font-bold">Summary:</label></div> <div class="flex justify-left text-xl font-light"><span id="participants" class="mr-2"> </span> <label for="participants">Participants</label></div> <div class="flex justify-left text-xl font-light"><span id="variables" class="mr-2"> </span> <label for="variables">Variables</label></div> <div class="flex justify-left text-xl font-light"><span id="dataPoints" class="mr-2"> </span> <label for="dataPoints">Data Points</label></div></div></div>');function dt(W,s){at(s,!0);const[p,re]=ot(),o=()=>de(Mt,"$totalParticipants",p),R=()=>de(Pt,"$filters",p),L=()=>de(Q,"$exports",p);let{exports:Q}=It,X=ce(o),g=ce(()=>R().length+L().length),c=ce(()=>typeof e(X)=="number"?e(X)*e(g):0);var l=ba(),b=r(l),y=d(r(b),2),A=r(y),S=r(A,!0);a(A),M(2),a(y);var w=d(y,2),F=r(w),N=r(F,!0);a(F),M(2),a(w);var B=d(w,2),v=r(B),h=r(v,!0);a(v),M(2),a(B),a(b),a(l),Re(()=>{ge(S,e(X)),ge(N,e(g)),ge(h,e(c))}),t(W,l),rt(),re()}async function ya(W,s,p,re,o,R){var L;try{if(n(s,!0),!e(p)){const c=(L=e(re))==null?void 0:L.map(l=>l.ref);aa(c||[]),n(o,e(o).filter(l=>!e(re).some(b=>b.variableId===l.variableId)),!0);return}const X=(await R()).map(c=>({id:oa(),searchResult:c,display:(c==null?void 0:c.display)||"",conceptPath:(c==null?void 0:c.conceptPath)||""}));ra(X);const g=X.map(c=>{var l,b,y;return{ref:c,variableId:(l=c==null?void 0:c.searchResult)==null?void 0:l.conceptPath,variableName:c==null?void 0:c.display,description:(b=c==null?void 0:c.searchResult)==null?void 0:b.description,type:(y=c==null?void 0:c.searchResult)==null?void 0:y.type,selected:!0}});n(o,Array.from([...e(o),...g].reduce((c,l)=>c.set(l.variableId,l),new Map).values()),!0),n(re,g,!0)}catch(Q){console.error("Error in toggleSampleIds",Q),Xt.error({description:"We were unable to fetch the sample IDs for your selected data. Please try again later."}),n(p,!1)}finally{n(s,!1)}}var wa=i('<div class="flex justify-center mb-4"><!></div>'),Pa=i('<input type="checkbox" class="mr-1 &amp;[aria-disabled=“true”]:opacity-75" data-testid="sample-ids-checkbox" id="sample-ids-checkbox"/>'),$a=i('<div><label for="sample-ids-checkbox" class="flex items-center" data-testid="sample-ids-label"><!> <span>Include sample identifiers</span></label></div>'),Da=i("<!> <!>",1),Sa=i("<!> <!>",1),ka=i('<div id="first-step-container" class="flex flex-col w-full h-full items-center"><!> <section class="w-full"><!></section></div>'),Ra=i(`<section class="flex flex-col w-full h-full items-center"><!> <div class="w-full h-full m-2 card p-4"><header class="card-header">Select <strong>additional variables</strong> you would like to be included in your final
            data export.</header> <hr/> <div class="card-body p-4">Tree Component Here</div></div></section>`),Aa=i('<section class="flex flex-col w-full h-full items-center"><!> <div class="grid gap-10 grid-cols-2"><!> <!></div></section>'),Ca=i('<div id="dataset-id" class="mr-4"> </div>'),Ea=i("<div>An error occurred while getting the dataset ID. Please try again later.</div>"),Ta=i(`<section class="flex flex-col w-full h-full items-center"><!> <div class="w-full h-full m-2 card p-4"><header class="card-header">Save the information in your final data export by clicking the Save Dataset ID button.
          Navigate to the <a class="anchor" href="/dataset">Manage Datasets page</a> to view or manage
          your Dataset IDs.</header> <hr/> <div class="card-body p-4 flex flex-col justify-center items-center"><div><div class="flex items-center m-2"><label for="dataset-name" class="font-bold mr-2">Dataset Name:</label> <input type="text" id="dataset-name" class="input w-80" placeholder="Enter a name" required/></div> <div class="flex items-center m-2"><div class="flex items-center"><label for="dataset-id" class="font-bold mr-2">Dataset ID:</label> <!></div></div></div></div></div></section>`),Ia=i("<!> <!> <!>",1),Ma=(W,s,p)=>Ne.confirmDownload?n(s,!0):p(),Fa=i('<button class="btn preset-filled-primary-500"><i class="fa-solid fa-download mr-1"></i>Download as CSV</button>'),Na=i("<!> <!> <!>",1),Ba=i('<a class="btn preset-tonal-primary border border-primary-500 m-2 hover:preset-filled-primary-500"> </a>'),qa=i('<div class="flex justify-center"></div>'),Ua=i('<section class="flex flex-col gap-8"><p class="mt-4"> </p> <!> <p> </p> <div class="flex justify-center"><!></div> <!></section>'),ja=(W,s,p)=>s(e(p).url),La=i('<button class="flex-initial w-64 btn preset-filled-primary-500 disabled:preset-tonal-primary border border-primary-500"><i class="fa-solid fa-arrow-up-right-from-square"></i> </button>'),Qa=(W,s,p)=>Ne.confirmDownload?n(s,!0):p(),Oa=i('<section class="flex flex-col gap-8 place-items-center"><div class="flex justify-center mt-4">Select an option below to export your selected data in PFB format.</div> <!> <button class="flex-initial w-64 btn preset-filled-primary-500"><i class="fa-solid fa-download"></i>Download as PFB</button></section>'),za=i('<div class="flex justify-center"><!> <div class="hidden"> </div></div>'),Va=i('<div class="flex justify-center"><!></div>'),Wa=i('<div class="flex justify-center"><!></div>'),Ha=i('<section class="flex flex-col w-full h-full items-center"><!></section>'),Ga=i("<!> <!> <!> <!> <!>",1),Xa=i("<!> <!>",1);function Ya(W,s){at(s,!0);const[p,re]=ot(),o=()=>de(ta,"$exports",p),R=()=>de(Ce,"$stepperState",p),L=()=>de(Mt,"$totalParticipants",p),Q=()=>de(Pt,"$filters",p),X=()=>de(Gt,"$resources",p),g=Ae(s,"query",7),c=Ae(s,"showTreeStep",3,!1),l=Ae(s,"rows",19,()=>[]);let b=I(Qe(l()));const y=Kt.maxDataPointsForExport||1e6,A=7,S=[{dataElement:"variableName",label:"Variable Name",sort:!0},{dataElement:"description",label:"Variable Description",sort:!0},{dataElement:"type",label:"Type",sort:!0,class:"text-center"}];let w=I(void 0),F=I(Qe(Promise.resolve())),N=I(Qe(Promise.resolve())),B=I(Qe(Promise.resolve())),v=I(Qe(Promise.resolve())),h=I(""),Ee=I(""),Y=I(!0),J=I(!1),$=I(Qe([])),x=I(!1),oe=I(!1),ue=I("Python"),Te=I(!1),K=I(""),He=I(""),Ge=I(!1);Vt(async()=>{const f=o().filter(m=>m.conceptPath.includes("SAMPLE_ID"));if(f.length>0){n(oe,!0);const m=await st();if(m.length>0){const u=f.filter(_=>m.some(U=>U.conceptPath===_.conceptPath));n(J,u.length===m.length),n(oe,!1),e(J)&&n($,u.map(_=>{var U,Ue;return{ref:_,variableId:_.conceptPath,variableName:_.display,description:(U=_.searchResult)==null?void 0:U.description,type:(Ue=_.searchResult)==null?void 0:Ue.type,selected:!0}}),!0)}else n(J,!1),n(oe,!1)}else n(J,!1);Ne.explorer.enablePfbExport||n(w,"DATAFRAME")});async function q(){try{const f=await ze(`${Ve.Query}/${e(K)}/result`,{}),m=URL.createObjectURL(new Blob([f],{type:"octet/stream"}));if(Jt){const u=document.createElement("a");u.href=m,g().query.expectedResultType==="DATAFRAME"?u.download="pic-sure-data.csv":g().query.expectedResultType==="DATAFRAME_PFB"&&(u.download="pic-sure-data.avro"),document.body.appendChild(u),u.click(),document.body.removeChild(u)}}catch(f){console.error("Error in onCompleteHandler",f)}}async function me(f,m){m!=="review"&&(m==="save-dataset"&&n(N,qe(),!0),m==="start"&&n(v,da(e(K),e(h)).then(u=>(n(F,Ie(e(Ee)),!0),u)),!0))}async function qe(){let f;const m={initial:"Creating dataset ID...",waiting:"Hang tight. We are still working on it...",retry:"Something's taking longer than usual. We are still working on it..."};function u(_,U=!0){n(He,U?m.initial:m.retry,!0),U&&(f=setInterval(()=>{n(He,m.waiting,!0)},A*1e3)),n(B,_().finally(()=>clearInterval(f)).catch(Ue=>{if(U)u(_,!1);else throw Ue}),!0)}try{g().query.fields=o().map(_=>_.conceptPath),g().query.expectedResultType=e(w)||"DATAFRAME",n(K,""),u(()=>ze(Ve.Query,g()).then(_=>{n(K,_.picsureResultId||"Error",!0)})),await e(B)}catch(_){throw Be(Ce,V(R).current--,V(R)),console.error("Error in submitQuery",_),_}}function Ie(f){const m=f||e(K);return ze(`${Ve.Query}/${m}/status`,g()).then(u=>{if(u.status==="ERROR")return n(Y,!0),Promise.reject(u.status);n(Ee,u.picsureResultId,!0),n(Y,!1)})}function $e(){Yt("/explorer")}function Le(){return(typeof L()=="number"?L():y+1)+Q().length+o().length>y}async function st(){const f=await sa("",[{name:"data_source_genomic",category:"data_source",display:"Genomic",description:"Associated with genomic data",count:0}],{pageNumber:0,pageSize:1e4});if(f.content.length===0)return[];const m=new Zt(structuredClone(g().query));m.expectedResultType="CROSS_COUNT";const u=f.content.map(U=>U.conceptPath);m.setCrossCountFields(u);const _=await ze(Ve.QuerySync,{query:m,resourceUUID:X().hpdsAuth});return f.content.filter(U=>_[U.conceptPath]>0)}async function $t(f){async function m(){const _=`${Ve.Query}/${e(K)}/signed-url`;try{return(await ze(_,g())).signedUrl}catch(U){console.error("Error in getSignedUrl",U)}}if(!f)return;n(Ge,!0);let u=await m();u&&window.open(f+encodeURIComponent(u)),n(Ge,!1)}var lt=Xa(),Dt=fe(lt);const Ft=ce(()=>xe.explorePage.confirmDownloadTitle||"Are you sure you want to download data?");ca(Dt,{get title(){return e(Ft)},width:"w-1/2",withDefault:!0,confirmText:"Download",cancelText:"Cancel",onconfirm:()=>q(),get open(){return e(Te)},set open(f){n(Te,f,!0)},children:(f,m)=>{M();var u=ae();Re(()=>ge(u,xe.explorePage.confirmDownloadMessage||"This action will download the data to your local machine. Are you sure you want to proceed?")),t(f,u)},$$slots:{default:!0}});var Nt=d(Dt,2);fa(Nt,{class:"w-full h-full m-8",oncomplete:$e,onnext:me,buttonCompleteLabel:"Done",children:(f,m)=>{var u=Ga(),_=fe(u);const U=ce(Le);tt(_,{name:"review",get locked(){return e(U)},header:Z=>{M();var se=ae("Review Cohort Details:");t(Z,se)},children:(Z,se)=>{var C=ka(),ee=r(C);dt(ee,{});var j=d(ee,2),H=r(j);{var _e=O=>{ct(O,{"data-testid":"landing-error",title:"Warning",color:"warning",closeText:"Back",onclose:$e,children:(G,le)=>{M();var ye=ae(`Warning: Your selected data exceeds 1,000,000 estimated data points, which is too large
            to export. Please reduce the data selection or the number of selected participants.`);t(G,ye)},$$slots:{default:!0}})},te=O=>{var G=Sa(),le=fe(G);nt(le,()=>e(N),T=>{Oe(T,{ring:!0,label:"Preparing"})},void 0,T=>{var pe=wa(),he=r(pe);ct(he,{title:`An error occurred while preparing your dataset. Please try again. If this problem persists, please
                  contact an administrator.`}),a(pe),t(T,pe)});var ye=d(le,2);{var E=T=>{var pe=Da(),he=fe(pe);na(he,{tableName:"ExportSummary",get data(){return e(b)},columns:S});var Me=d(he,2);{var Xe=De=>{var Se=$a(),we=r(Se),Ye=r(we);{var Fe=D=>{Oe(D,{size:"micro",ring:!0})},ke=D=>{var z=Pa();At(z),z.__change=[ya,x,J,$,b,st],Ht(z,()=>e(J),ie=>n(J,ie)),t(D,z)};P(Ye,D=>{e(oe)?D(Fe):D(ke,!1)})}M(2),a(we),a(Se),t(De,Se)};P(Me,De=>{Ne.explorer.enableSampleIdCheckbox&&De(Xe)})}t(T,pe)},ne=T=>{Oe(T,{ring:!0,size:"micro",label:"Loading sample IDs"})};P(ye,T=>{e(x)?T(ne,!1):T(E)})}t(O,G)};P(H,O=>{Le()?O(_e):O(te,!1)})}a(j),a(C),t(Z,C)},$$slots:{header:!0,default:!0}});var Ue=d(_,2);{var Bt=be=>{tt(be,{name:"select-variables",header:se=>{M();var C=ae("Finalize Data:");t(se,C)},children:(se,C)=>{var ee=Ra(),j=r(ee);dt(j,{}),M(2),a(ee),t(se,ee)},$$slots:{header:!0,default:!0}})};P(Ue,be=>{c()&&be(Bt)})}var St=d(Ue,2);{var qt=be=>{const Z=ce(()=>e(w)===void 0);tt(be,{name:"select-type",get locked(){return e(Z)},header:C=>{M();var ee=ae("Review and Save Dataset:");t(C,ee)},children:(C,ee)=>{var j=Aa(),H=r(j);dt(H,{});var _e=d(H,2),te=r(_e);const O=ce(()=>e(w)==="DATAFRAME");Ct(te,{"data-testid":"csv-export-option",title:"Export as Data Frame or CSV",subtitle:"Export data as a Python or R data frame or a comma-separated values file",size:"other",get active(){return e(O)},onclick:()=>n(w,"DATAFRAME")});var G=d(te,2);const le=ce(()=>e(w)==="DATAFRAME_PFB");Ct(G,{"data-testid":"pfb-export-option",title:"Export as PFB",subtitle:"Export data in Portable Format for Biomedical Data file format",size:"other",get active(){return e(le)},onclick:()=>n(w,"DATAFRAME_PFB")}),a(_e),a(j),t(C,j)},$$slots:{header:!0,default:!0}})};P(St,be=>{Ne.explorer.enablePfbExport&&be(qt)})}var kt=d(St,2);const Ut=ce(()=>!e(h)||e(h).length<2||!e(K));tt(kt,{name:"save-dataset",get locked(){return e(Ut)},header:Z=>{M();var se=ae("Save Dataset ID:");t(Z,se)},children:(Z,se)=>{var C=Ta(),ee=r(C);dt(ee,{});var j=d(ee,2),H=d(r(j),4),_e=r(H),te=r(_e),O=d(r(te),2);At(O),a(te);var G=d(te,2),le=r(G),ye=d(r(le),2);nt(ye,()=>e(B),E=>{Oe(E,{ring:!0,size:"micro",get label(){return e(He)}})},E=>{var ne=Ca(),T=r(ne,!0);a(ne),Re(()=>ge(T,e(K))),t(E,ne)},E=>{var ne=Ea();t(E,ne)}),a(le),a(G),a(_e),a(H),a(j),a(C),Wt(O,()=>e(h),E=>n(h,E)),t(Z,C)},$$slots:{header:!0,default:!0}});var jt=d(kt,2);tt(jt,{name:"start",get locked(){return e(Y)},header:Z=>{M();var se=ae("Start Analysis:");t(Z,se)},children:(Z,se)=>{var C=Ha(),ee=r(C);nt(ee,()=>e(v),j=>{Oe(j,{ring:!0,size:"medium",label:"Saving"})},j=>{var H=Va(),_e=r(H);nt(_e,()=>e(F),te=>{Oe(te,{ring:!0,size:"medium",label:"Preparing"})},te=>{var O=We(),G=fe(O);{var le=E=>{var ne=Ua(),T=r(ne),pe=r(T,!0);a(T);var he=d(T,2);it(he,{get value(){return e(ue)},onValueChange:D=>n(ue,D.value,!0),list:D=>{var z=Ia(),ie=fe(z);bt(ie,{value:"Python",get group(){return e(ue)},set group(k){n(ue,k,!0)},children:(k,ve)=>{M();var Pe=ae("Python");t(k,Pe)},$$slots:{default:!0}});var je=d(ie,2);bt(je,{value:"R",get group(){return e(ue)},set group(k){n(ue,k,!0)},children:(k,ve)=>{M();var Pe=ae("R");t(k,Pe)},$$slots:{default:!0}});var mt=d(je,2);{var _t=k=>{bt(k,{value:"Download",get group(){return e(ue)},set group(ve){n(ue,ve,!0)},children:(ve,Pe)=>{M();var Je=ae("Download");t(ve,Je)},$$slots:{default:!0}})};P(mt,k=>{Ne.explorer.allowDownload&&k(_t)})}t(D,z)},content:D=>{var z=Na(),ie=fe(z);ht(ie,()=>it.Panel,(k,ve)=>{ve(k,{value:"Python",children:(Pe,Je)=>{const Ke=ce(()=>xe.explorePage.codeBlocks.PythonExport.replace("{{queryId}}",e(K))||"Code not set");Et(Pe,{lang:"python",get code(){return e(Ke)}})},$$slots:{default:!0}})});var je=d(ie,2);ht(je,()=>it.Panel,(k,ve)=>{ve(k,{value:"R",children:(Pe,Je)=>{const Ke=ce(()=>xe.explorePage.codeBlocks.RExport.replace("{{queryId}}",e(K))||"Code not set");Et(Pe,{lang:"r",get code(){return e(Ke)}})},$$slots:{default:!0}})});var mt=d(je,2);{var _t=k=>{var ve=We(),Pe=fe(ve);ht(Pe,()=>it.Panel,(Je,Ke)=>{Ke(Je,{value:"Download",children:(Lt,er)=>{var Rt=Fa();Rt.__click=[Ma,Te,q],t(Lt,Rt)},$$slots:{default:!0}})}),t(k,ve)};P(mt,k=>{Ne.explorer.allowDownload&&k(_t)})}t(D,z)},$$slots:{list:!0,content:!0}});var Me=d(he,2),Xe=r(Me,!0);a(Me);var De=d(Me,2),Se=r(De);ia(Se,{}),a(De);var we=d(De,2);{var Ye=Fe=>{var ke=qa();yt(ke,21,()=>xe.explorePage.goTo.links,wt,(D,z)=>{var ie=Ba(),je=r(ie,!0);a(ie),Re(()=>{pt(ie,"href",e(z).url),pt(ie,"target",e(z).newTab?"_blank":"_self"),ge(je,e(z).title)}),t(D,ie)}),a(ke),t(Fe,ke)};P(we,Fe=>{xe.explorePage.goTo.links.length>0&&Fe(Ye)})}a(ne),Re(()=>{ge(pe,xe.explorePage.analysisExportText),ge(Xe,xe.explorePage.goTo.instructions)}),t(E,ne)},ye=(E,ne)=>{{var T=pe=>{var he=Oa(),Me=d(r(he),2);{var Xe=Se=>{var we=We(),Ye=fe(we);yt(Ye,17,()=>xe.explorePage.pfbExportUrls,wt,(Fe,ke)=>{var D=La();D.__click=[ja,$t,ke];var z=d(r(D));a(D),Re(()=>{D.disabled=e(Ge),ge(z,`Export to ${e(ke).title??""}`)}),t(Fe,D)}),t(Se,we)};P(Me,Se=>{var we;(we=xe.explorePage)!=null&&we.pfbExportUrls&&xe.explorePage.pfbExportUrls.length>0&&Se(Xe)})}var De=d(Me,2);De.__click=[Qa,Te,q],a(he),t(pe,he)};P(E,pe=>{g().query.expectedResultType==="DATAFRAME_PFB"&&Ne.explorer.enablePfbExport&&pe(T)},ne)}};P(G,E=>{g().query.expectedResultType==="DATAFRAME"?E(le):E(ye,!1)})}t(te,O)},(te,O)=>{var G=za(),le=r(G);ct(le,{title:`An error occurred while preparing your dataset. Please try again. If this problem persists, please
                contact an administrator.`});var ye=d(le,2),E=r(ye,!0);a(ye),a(G),Re(()=>ge(E,e(O))),t(te,G)}),a(H),t(j,H)},j=>{var H=Wa(),_e=r(H);ct(_e,{title:`An error occurred while saving your dataset. Please try again. If this problem persists, please
            contact an administrator.`}),a(H),t(j,H)}),a(C),t(Z,C)},$$slots:{header:!0,default:!0}}),t(f,u)},$$slots:{default:!0}}),t(W,lt),rt(),re()}Tt(["change","click"]);var Ja=i('<section class="flex justify-center items-center w-full h-full mt-8"><!></section>'),Ka=()=>{alert("This would start the tour at some step")},Za=i('<div class="flex flex-col items-center justify-center m-8"><p>No filters or exports have been created.</p> <div class="flex gap-4"><button class="btn preset-filled-primary-500 m-4">Learn How</button></div></div>');function Ir(W,s){at(s,!0);const[p,re]=ot(),o=()=>de(Q,"$exports",p),R=()=>de(Pt,"$filters",p),L=()=>de(Ce,"$stepperState",p);let{exports:Q}=It,X=ea(!0),g=o().map(l=>{var b,y,A,S;return{ref:l,selected:!0,variableId:l.conceptPath,variableName:l.display||((b=l.searchResult)==null?void 0:b.display)||((y=l.searchResult)==null?void 0:y.name),description:(A=l.searchResult)==null?void 0:A.description,type:(S=l.searchResult)==null?void 0:S.type}}),c=R().map(l=>{var b,y,A;return{ref:l,selected:!0,variableId:l.id,variableName:((b=l.searchResult)==null?void 0:b.display)||l.variableName,description:(y=l.searchResult)==null?void 0:y.description,type:(A=l.searchResult)==null?void 0:A.type}});Ce.set({...L(),current:0,total:0}),la(W,{backUrl:"/explorer",backTitle:"Back to Explore",backAction:()=>{Be(Ce,V(L).current=0,V(L))},title:"Export Data for Research Analysis",children:(l,b)=>{var y=We(),A=fe(y);{var S=F=>{var N=Ja(),B=r(N);const v=ce(()=>[...c,...g]);Ya(B,{query:X,get rows(){return e(v)}}),a(N),t(F,N)},w=F=>{var N=Za(),B=d(r(N),2),v=r(B);v.__click=[Ka],a(B),a(N),t(F,N)};P(A,F=>{o().length>0||R().length>0?F(S):F(w,!1)})}t(l,y)},$$slots:{default:!0}}),rt(),re()}Tt(["click"]);export{Ir as component};
