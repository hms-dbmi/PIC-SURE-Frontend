var Kt=Object.defineProperty;var Et=n=>{throw TypeError(n)};var Zt=(n,e,t)=>e in n?Kt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var at=(n,e,t)=>Zt(n,typeof e!="symbol"?e+"":e,t),ea=(n,e,t)=>e.has(n)||Et("Cannot "+t);var W=(n,e,t)=>(ea(n,e,"read from private field"),t?t.call(n):e.get(n)),he=(n,e,t)=>e.has(n)?Et("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t);import"../chunks/Bzak7iHL.js";import{p as oe,ar as He,f as T,d as v,s as D,B as ta,r as c,t as G,b as o,c as ne,S as ie,k as a,as as Ye,e as K,a as O,j as ve,n as Y,u as L,h as j,i as pe,l as k,m as aa,o as _t}from"../chunks/pV5yBOfK.js";import{s as V,d as et}from"../chunks/D3FUfhzK.js";import{i as M}from"../chunks/BAa5cEXk.js";import{p as Ie,a as Z,s as Me,e as qe,c as ra}from"../chunks/C2caA9Pm.js";import{w as Tt,a as sa,o as We,g as xt}from"../chunks/B9BhT3Ut.js";import{a as ze}from"../chunks/CF-XIK1E.js";import{g as bt}from"../chunks/BLfKYx2_.js";import{c as Le,k as Ne,e as Ct,r as kt,t as nt,j as $t}from"../chunks/tvkVmxlD.js";import{f as Q,b as ye,s as oa}from"../chunks/i859GThY.js";import{E as qt,e as Mt,r as na,a as la}from"../chunks/CA_H3qz9.js";import{f as wt,g as ia}from"../chunks/Drejzb63.js";import{l as ca,r as da,t as Lt}from"../chunks/nhyXhP8M.js";import{f as je,c as It}from"../chunks/DWCskTD4.js";import{s as st}from"../chunks/CPDBQclr.js";import{e as Ve,i as Xe}from"../chunks/CFqqwPkz.js";import{a as Fe,s as J,c as Dt,r as ut,d as ua,h as fa}from"../chunks/B3YVaWvx.js";import{t as lt,a as it}from"../chunks/Dj8TqXX2.js";import{A as mt,C as va}from"../chunks/pqdQTL-E.js";import{U as pa}from"../chunks/BQDbPBkQ.js";import{E as Oe}from"../chunks/C6RsMIt9.js";import{L as ge}from"../chunks/BK-nQ0m1.js";import{s as Nt}from"../chunks/B4XBV-Hj.js";import{a as ma,b as Ft}from"../chunks/CMMNa4Y8.js";import{n as ha,p as ya,d as ga}from"../chunks/D3-cXwBU.js";import{Q as ft,a as _a}from"../chunks/CEG0RrrK.js";import{S as xa}from"../chunks/Cr5GaZEj.js";import{C as ht}from"../chunks/vuHm70bx.js";import{c as yt}from"../chunks/D2EutmVf.js";import{T as rt}from"../chunks/54ZAgvzV.js";import{C as Rt,T as gt}from"../chunks/5_zJexd7.js";import{b as ba}from"../chunks/Bt-Xh7oU.js";import{M as wa}from"../chunks/DBMsBZi4.js";import{C as Pa}from"../chunks/C24VzmQy.js";async function Sa(n,e,t){if(e===""&&e.trim()==="")throw"Please input a Dataset ID name";const S=/^[\w \-\\/?+=[\].():"']+$/g;if(!e.match(S))throw`Name can only contain letters, numbers, and these special symbols - ? + = [ ] . ( ) : ' "`;const f={queryId:n,name:e};return t&&(f.metadata={saved:new Date().valueOf(),siteQueryIds:t}),await Le(Ne.NamedDataSet,f)}function Ea(n){return new Promise(e=>setTimeout(e,n))}function Ia(n,e=1e3,t=3e4,S=!0){const f=Math.min(e*Math.pow(2,n),t);if(S){const d=f*.25;return f+(Math.random()*2-1)*d}return f}async function Da(n,e=3,t=1e3,S=3e4,f){let d;for(let y=0;y<e;y++)try{return await n()}catch(i){if(console.warn("Backoff caught: ",i),d=i,f&&!f(i,y))throw i;if(y<e-1){const w=Ia(y,t,S);await Ea(w)}}throw d}const Ae=Tt({current:0,total:0,stepMap:[]});var Ra=T("<div><span> </span></div>"),Aa=T('<header class="stepper-header flex items-center border-t mt-[15px] mb-7 border-surface-500 gap-4"></header>'),Ta=T('<div data-testid="stepper"><!> <div class="stepper-content"><!></div></div>');function Ca(n,e){oe(e,!0);const t=()=>Z(Ae,"$stepperState",S),[S,f]=Me(),d=()=>{},y=Ie(e,"buttonCompleteLabel",3,""),i=Ie(e,"class",3,""),w=Ie(e,"onnext",3,d),m=Ie(e,"onback",3,d),r=Ie(e,"oncomplete",3,d);async function u(l){if(await new Promise(A=>setTimeout(A)),l)return;const b=t().current+1,E=t().stepMap[b];w()(b,E,t()),qe(Ae,ie(t).current=b,ie(t))}function P(){const l=t().current===0?0:t().current-1,b=t().stepMap[l];m()(l,b,t()),qe(Ae,ie(t).current=l,ie(t))}function $(l,b){b||r()(l,t().stepMap[l],t())}function g(l){return l===t().current}He("buttonCompleteLabel",y()),He("StepperState",Ae),He("onBack",P),He("onNext",u),He("onComplete",$);var h=Ta(),_=v(h);{var I=l=>{var b=Aa();Ve(b,5,()=>Array.from(Array(t().total).keys()),Xe,(E,A)=>{var p=Ra();let s;var x=v(p),C=v(x,!0);c(x),c(p),G((ee,ae,_e)=>{s=Fe(p,1,"stepper-header-step -mt-[15px] transition-all duration-300",null,s,ee),J(x,"data-testid",`step-${t().stepMap[a(A)]??""}`),Fe(x,1,`badge rounded-2xl text-sm ${ae??""}`),V(C,_e)},[()=>({"flex-1":g(a(A))}),()=>g(a(A))?"preset-filled-primary-500":"preset-filled-surface-500",()=>g(a(A))?`Step ${a(A)+1}`:a(A)+1]),o(E,p)}),c(b),lt(1,b,()=>it,()=>({duration:100})),lt(2,b,()=>it,()=>({duration:100})),o(l,b)};M(_,l=>{t().total&&l(I)})}var q=D(_,2),R=v(q);st(R,()=>e.children??ta),c(q),c(h),G(()=>Fe(h,1,`stepper space-y-4 ${i()??""}`)),o(n,h),ne(),f()}var ka=T('<header class="step-header text-2xl font-bold"><!></header>'),$a=T('<div class="step-navigation-slot"><!></div>'),qa=T("<div></div>"),Ma=T('<div class="step-navigation flex justify-between gap-4"><!> <!></div>'),La=T('<div class="step space-y-4"><!> <div class="step-content space-y-4 px-2"><!></div> <!></div>');function Je(n,e){oe(e,!0);const t=()=>Z(i,"$stepperState",S),[S,f]=Me(),d=Ie(e,"locked",3,!1),y=Ye("buttonCompleteLabel"),i=Ye("StepperState"),w=Ye("onNext"),m=Ye("onBack"),r=Ye("onComplete"),u=t().total;qe(i,ie(t).stepMap=[...t().stepMap,e.name],ie(t)),qe(i,ie(t).total++,ie(t)),sa(()=>{qe(i,ie(t).total--,ie(t)),qe(i,ie(t).stepMap=t().stepMap.filter(h=>h!==e.name),ie(t))});var P=K(),$=O(P);{var g=h=>{var _=La(),I=v(_);{var q=s=>{var x=ka(),C=v(x);st(C,()=>e.header),c(x),o(s,x)};M(I,s=>{e.header&&s(q)})}var R=D(I,2),l=v(R);{var b=s=>{var x=K(),C=O(x);st(C,()=>e.children),o(s,x)},E=s=>{var x=ve();G(()=>V(x,`(Step ${u+1} Content)`)),o(s,x)};M(l,s=>{e.children?s(b):s(E,!1)})}c(R);var A=D(R,2);{var p=s=>{var x=Ma(),C=v(x);{var ee=N=>{var F=$a(),X=v(F);st(X,()=>e.navigation),c(F),o(N,F)},ae=N=>{var F=K(),X=O(F);{var U=H=>{{let we=L(()=>t().current===0);mt(H,{get onclick(){return m},get disabled(){return a(we)},children:(Pe,Se)=>{Y();var le=ve("Back");o(Pe,le)},$$slots:{default:!0}})}},z=H=>{var we=qa();o(H,we)};M(X,H=>{u!==0?H(U):H(z,!1)},!0)}o(N,F)};M(C,N=>{e.navigation?N(ee):N(ae,!1)})}var _e=D(C,2);{var Te=N=>{mt(N,{name:"next",angle:"right",variant:"filled",color:"primary-500",get disabled(){return d()},onclick:()=>w(d()),children:(F,X)=>{Y();var U=ve("Next");o(F,U)},$$slots:{default:!0}})},B=N=>{{let F=L(()=>y||"complete");mt(N,{get name(){return a(F)},angle:"right",variant:"filled",color:"primary-500",get disabled(){return d()},onclick:()=>r(u,d()),children:(X,U)=>{Y();var z=ve();G(()=>V(z,y||"Complete")),o(X,z)},$$slots:{default:!0}})}};M(_e,N=>{u<t().total-1?N(Te):N(B,!1)})}c(x),lt(1,x,()=>it,()=>({duration:100})),lt(2,x,()=>it,()=>({duration:100})),o(s,x)};M(A,s=>{t().total>1&&s(p)})}c(_),G(()=>J(_,"data-testid",`step-${u+1}`)),o(h,_)};M($,h=>{u===t().current&&h(g)})}o(n,P),ne(),f()}var Na=T('<i></i> <span id="site-indicator-label" class="uppercase"> </span> <span id="site-indicator-value" class="ml-1"> </span>',1),Fa=T('<i class="fa-solid fa-circle-xmark text-error-500"></i> <span id="site-indicator-label"> </span>',1),Ua=T('<i></i> <span id="site-indicator-label" class="uppercase"> </span>',1),ja=T('<div id="site-indicator"><!></div>'),Oa=T('<div id="site-indicators" class="grid grid-cols-3 gap-y-2 gap-x-6"></div>'),Ba=T('<div id="stats" class="w-full flex justify-evenly mb-5 pb-2 svelte-jecuqt"><div id="summary" class="w-full grid grid-flow-col auto-cols-auto"><div class="text-xl"><label for="summary" class="mr-8 font-bold">Summary:</label></div> <div class="flex justify-left text-xl font-light"><span id="participants" class="mr-2"> </span> <label for="participants">Participants</label></div> <div class="flex justify-left text-xl font-light"><span id="variables" class="mr-2"> </span> <label for="variables">Variables</label></div> <div class="flex justify-left text-xl font-light"><span id="dataPoints" class="mr-2"> </span> <label for="dataPoints">Data Points</label></div></div></div> <!>',1);function tt(n,e){oe(e,!0);const t=()=>Z(Lt,"$totalParticipants",i),S=()=>Z(wt,"$filters",i),f=()=>Z(m,"$exports",i),d=()=>Z(je,"$federatedQueryMap",i),y=()=>Z(da,"$resultCounts",i),[i,w]=Me();let{exports:m}=qt,r=L(t),u=L(()=>{const B=S().filter(N=>N.filterType==="AnyRecordOf");return B.reduce((N,F)=>N+F.concepts.length,0)-B.length}),P=L(()=>S().length+f().length+a(u)),$=L(()=>typeof a(r)=="number"?a(r)*a(P):0),g=j(pe({}));function h(B){switch((B==null?void 0:B.status)!==void 0?B==null?void 0:B.status:B.count?"COMPLETE":"ERROR"){case"AVAILABLE":case"COMPLETE":return"fa-solid fa-circle-check text-success-500";case"ERROR":return"fa-solid fa-circle-xmark text-error-500";case"PENDING":return"fa-solid fa-clock text-warning-500";default:return"fa-solid fa-circle text-surface-500"}}let _=L(()=>{const B={};return Object.entries(d()).forEach(([N,F])=>{B[N]={...F}}),Object.entries(a(g)).forEach(([N,F])=>{B[N]?B[N].count=F:B[N]={count:F}}),B}),I=L(()=>a(_)?Object.fromEntries(Object.entries(a(_)).map(([B,N])=>[B,h(N)])):{});We(async()=>{y().length===0&&await ca(!1);const B=y().find(N=>N.key==="query:patientCount");B&&k(g,B.result,!0)});var q=Ba(),R=O(q),l=v(R),b=D(v(l),2),E=v(b),A=v(E,!0);c(E),Y(2),c(b);var p=D(b,2),s=v(p),x=v(s,!0);c(s),Y(2),c(p);var C=D(p,2),ee=v(C),ae=v(ee,!0);c(ee),Y(2),c(C),c(l),c(R);var _e=D(R,2);{var Te=B=>{var N=Oa();Ve(N,21,()=>Object.entries(a(_)),Xe,(F,X)=>{var U=L(()=>aa(a(X),2));let z=()=>a(U)[0],H=()=>a(U)[1];var we=ja(),Pe=v(we);{var Se=ce=>{{let de=L(()=>`${z()}`);ge(ce,{size:"micro",get label(){return a(de)}})}},le=ce=>{var de=K(),Ee=O(de);{var Ce=me=>{var xe=K(),De=O(xe);ze(De,()=>{var re;return(re=H())==null?void 0:re.count},re=>{{let ue=L(()=>`${z()}`);ge(re,{size:"micro",get label(){return a(ue)}})}},(re,ue)=>{var Re=Na(),Be=O(Re),te=D(Be,2),be=v(te,!0);c(te);var $e=D(te,2),vt=v($e);c($e),G(()=>{Fe(Be,1,Dt(a(I)[z()])),V(be,z()),V(vt,`(${a(ue)??""})`)}),o(re,Re)},re=>{var ue=Fa(),Re=D(O(ue),2),Be=v(Re,!0);c(Re),G(()=>V(Be,z())),o(re,ue)}),o(me,xe)},ke=me=>{var xe=Ua(),De=O(xe),re=D(De,2),ue=v(re,!0);c(re),G(()=>{Fe(De,1,Dt(a(I)[z()])),V(ue,z())}),o(me,xe)};M(Ee,me=>{var xe;(xe=H())!=null&&xe.count?me(Ce):me(ke,!1)},!0)}o(ce,de)};M(Pe,ce=>{var de;((de=H())==null?void 0:de.status)==="PENDING"?ce(Se):ce(le,!1)})}c(we),o(F,we)}),c(N),o(B,N)};M(_e,B=>{Q.federated&&a(_)&&Object.keys(a(_)).length>0&&B(Te)})}G(()=>{V(A,a(r)),V(x,a(P)),V(ae,a($))}),o(n,q),ne(),w()}async function Qa(n,e,t,S,f,d){var y;try{if(k(e,!0),!a(t)){const r=(y=a(S))==null?void 0:y.map(u=>u.ref);na(r||[]),k(f,a(f).filter(u=>!a(S).some(P=>P.variableId===u.variableId)));return}const w=(await d()).map(r=>({id:ia(),searchResult:r,display:(r==null?void 0:r.display)||"",conceptPath:(r==null?void 0:r.conceptPath)||""}));la(w);const m=w.map(r=>{var u,P,$;return{ref:r,variableId:(u=r==null?void 0:r.searchResult)==null?void 0:u.conceptPath,variableName:r==null?void 0:r.display,description:(P=r==null?void 0:r.searchResult)==null?void 0:P.description,type:($=r==null?void 0:r.searchResult)==null?void 0:$.type,selected:!0}});k(f,Array.from([...a(f),...m].reduce((r,u)=>r.set(u.variableId,u),new Map).values())),k(S,m,!0)}catch(i){console.error("Error in toggleSampleIds",i),nt.error({description:"We were unable to fetch the sample IDs for your selected data. Please try again later."}),k(t,!1)}finally{k(e,!1)}}var za=T('<input type="checkbox" class="mr-1 &amp;[aria-disabled=“true”]:opacity-75" data-testid="sample-ids-checkbox" id="sample-ids-checkbox"/>'),Ga=T('<div><label for="sample-ids-checkbox" class="flex items-center" data-testid="sample-ids-label"><!> <span>Include sample identifiers</span></label></div>'),Wa=T("<!> <!>",1),Va=T('<div id="first-step-container" class="flex flex-col w-full h-full items-center"><!> <section class="w-full"><!></section></div>');function Xa(n,e){oe(e,!0);const t=()=>Z(Mt,"$exports",f),S=()=>Z(kt,"$resources",f),[f,d]=Me(),y=[{dataElement:"name",label:"Variable Name",sort:!0},{dataElement:"description",label:"Variable Description",sort:!0},{dataElement:"type",label:"Type",sort:!0,class:"text-center"}];let i=L(()=>e.rows),w=j(!1),m=j(!1),r=j(pe([])),u=j(!1);We(async()=>{const R=t().filter(l=>l.conceptPath.includes("SAMPLE_ID"));if(R.length>0){k(u,!0);const l=await P();if(l.length>0){const b=R.filter(E=>l.some(A=>A.conceptPath===E.conceptPath));k(m,b.length===l.length),k(u,!1),a(m)&&k(r,b.map(E=>{var A,p;return{ref:E,variableId:E.conceptPath,variableName:E.display,description:(A=E.searchResult)==null?void 0:A.description,type:(p=E.searchResult)==null?void 0:p.type,selected:!0}}),!0)}else k(m,!1),k(u,!1)}else k(m,!1)});async function P(){await Ct();const R=await ha("",[{name:"data_source_genomic",category:"data_source",display:"Genomic",description:"Associated with genomic data",count:0}],{pageNumber:0,pageSize:1e4});if(R.content.length===0)return[];const l=new ft(structuredClone(Nt(e.query).query));l.expectedResultType="CROSS_COUNT";const b=R.content.map(A=>A.conceptPath);l.setCrossCountFields(b);const E=await Le(Ne.QuerySync,{query:l,resourceUUID:S().hpdsAuth});return R.content.filter(A=>E[A.conceptPath]>0)}var $=Va(),g=v($);tt(g,{});var h=D(g,2),_=v(h);{var I=R=>{Oe(R,{"data-testid":"landing-error",title:"Warning",color:"warning",closeText:"Back",onclose:()=>bt("/explorer"),children:(l,b)=>{Y();var E=ve(`Warning: Your selected data exceeds 1,000,000 estimated data points, which is too large to
        export. Please reduce the data selection or the number of selected participants.`);o(l,E)},$$slots:{default:!0}})},q=R=>{var l=K(),b=O(l);{var E=p=>{var s=Wa(),x=O(s);xa(x,{tableName:"ExportSummary",get data(){return a(i)},get columns(){return y}});var C=D(x,2);{var ee=ae=>{var _e=Ga(),Te=v(_e),B=v(Te);{var N=X=>{ge(X,{size:"micro",ring:!0})},F=X=>{var U=za();ut(U),U.__change=[Qa,w,m,r,i,P],ma(U,()=>a(m),z=>k(m,z)),o(X,U)};M(B,X=>{a(u)?X(N):X(F,!1)})}Y(2),c(Te),c(_e),o(ae,_e)};M(C,ae=>{Q.explorer.enableSampleIdCheckbox&&ae(ee)})}o(p,s)},A=p=>{ge(p,{ring:!0,size:"micro",label:"Loading sample IDs"})};M(b,p=>{a(w)?p(A,!1):p(E)},!0)}o(R,l)};M(_,R=>{e.dataLimitExceeded?R(I):R(q,!1)})}c(h),c($),o(n,$),ne(),d()}et(["change"]);const Ge=Tt([]);function Ut(n){Ge.update(e=>e.includes(n)?e:[...e,n])}function Ha(n){Ge.update(e=>e.filter(t=>t!==n))}Ge.subscribe;var Ya=async(n,e)=>await e.node.toggleOpen(),Ja=T('<i class="fa-solid fa-spinner fa-spin"></i>'),Ka=T("<i></i>"),Za=T('<i class="fa-solid fa-minus"></i>'),er=async(n,e)=>await e.node.toggleSelected(),tr=T('<span class="text-error-500 text-sm ml-2"><i class="fa-solid fa-exclamation-triangle"></i></span>'),ar=T('<div class="text-error-500 text-sm p-2"> </div>'),rr=T('<details class="tree-item"><summary class="tree-item-summary list-none [&amp;::-webkit-details-marker]:hidden flex items-center cursor-pointer space-x-4 rounded-container p-0 hover:preset-tonal-primary w-full" role="treeitem"><button type="button" class="m-1 ml-2"><!></button> <input class="checkbox tree-item-checkbox mr-1" type="checkbox"/> <label class="w-full"> </label> <!></summary> <div class="tree-item-children ml-4" role="group"><!></div></details>');function jt(n,e){oe(e,!0);var t=rr(),S=v(t),f=v(S);f.__click=[Ya,e];var d=v(f);{var y=_=>{var I=K(),q=O(I);{var R=b=>{var E=Ja();o(b,E)},l=b=>{var E=Ka();G(()=>Fe(E,1,`fa-solid fa-angle-${e.node.open?"down":"right"}`)),o(b,E)};M(q,b=>{e.node.loading?b(R):b(l,!1)})}o(_,I)},i=_=>{var I=Za();o(_,I)};M(d,_=>{e.node.isLeaf?_(i,!1):_(y)})}c(f);var w=D(f,2);ut(w),w.__click=[er,e];var m=D(w,2),r=v(m,!0);c(m);var u=D(m,2);{var P=_=>{var I=tr();G(()=>J(I,"title",e.node.error)),o(_,I)};M(u,_=>{e.node.error&&_(P)})}c(S);var $=D(S,2),g=v($);{var h=_=>{var I=K(),q=O(I);{var R=b=>{var E=ar(),A=v(E);c(E),G(()=>V(A,`Error loading children: ${e.node.error??""}`)),o(b,E)},l=b=>{var E=K(),A=O(E);Ve(A,17,()=>e.node.children,Xe,(p,s)=>{jt(p,{get node(){return a(s)}})}),o(b,E)};M(q,b=>{e.node.error?b(R):b(l,!1)})}o(_,I)};M(g,_=>{!e.node.isLeaf&&e.node.open&&_(h)})}c($),c(t),G(()=>{J(t,"data-testid",`tree-item:${e.node.name??""}-${e.node.value??""}`),J(t,"aria-disabled",e.node.disabled),t.open=e.node.open,J(S,"aria-selected",e.node.allSelected),J(S,"aria-expanded",e.node.open),J(f,"id",`tree-item-btn:${e.node.name??""}-${e.node.value??""}`),J(f,"data-testid",`tree-item-btn:${e.node.name??""}-${e.node.value??""}`),J(f,"title",e.node.isLeaf?void 0:`${e.node.open?"Close":"Open"} node`),J(f,"name",e.node.name),J(f,"tabindex",e.node.isLeaf?-1:0),f.disabled=e.node.loading,J(w,"id",`checkbox:${e.node.name??""}-${e.node.value??""}`),J(w,"data-testid",`checkbox:${e.node.name??""}-${e.node.value??""}`),J(w,"name",e.node.name),ua(w,e.node.value),fa(w,e.node.allSelected),w.indeterminate=e.node.indeterminant,J(m,"for",`${e.node.isLeaf?"checkbox:":"tree-item-btn:"}${e.node.name??""}-${e.node.value??""}`),V(r,e.node.value),J($,"data-testid",`tree-item-children:${e.node.name??""}`)}),o(n,t),ne()}et(["click"]);var sr=T("<div></div>");function or(n,e){var r,u,P,$,g,h,_,I,q,R,l,b,A;oe(e,!0);let t=Ie(e,"initialNodes",19,()=>[]),S=Ie(e,"onselect",3,()=>{}),f=Ie(e,"onunselect",3,()=>{}),d=Ie(e,"fullWidth",3,!1);const E=class E{constructor(s){at(this,"name","");at(this,"value","");at(this,"conceptPath","");he(this,r,j(!1));he(this,u,j(!1));he(this,P,j(!1));he(this,$,j(pe([])));he(this,g,j(!1));he(this,h,j(null));he(this,_,j(!1));he(this,I,j(!1));he(this,q,L(()=>this.isLeaf?this.selected:this.children.some(s=>s.someSelected||s.selected)));he(this,R,L(()=>this.isLeaf?this.selected:this.children.length===0?this.selected:this.children.every(s=>s.allSelected)));he(this,l,L(()=>this.isLeaf?!this.selected:!this.someSelected));he(this,b,L(()=>this.isLeaf||this.children.length===0?!1:this.someSelected&&!this.allSelected));var x;this.name=s.name,this.value=s.name,this.conceptPath=s.conceptPath,this.isLeaf=!1,this.children=((x=s==null?void 0:s.children)==null?void 0:x.map(C=>new E(C)))??[],this.isLeaf&&(this.childrenLoaded=!0)}get open(){return a(W(this,r))}set open(s){k(W(this,r),s,!0)}get selected(){return a(W(this,u))}set selected(s){k(W(this,u),s,!0)}get disabled(){return a(W(this,P))}set disabled(s){k(W(this,P),s,!0)}get children(){return a(W(this,$))}set children(s){k(W(this,$),s,!0)}get loading(){return a(W(this,g))}set loading(s){k(W(this,g),s,!0)}get error(){return a(W(this,h))}set error(s){k(W(this,h),s,!0)}get isLeaf(){return a(W(this,_))}set isLeaf(s){k(W(this,_),s,!0)}get childrenLoaded(){return a(W(this,I))}set childrenLoaded(s){k(W(this,I),s,!0)}get someSelected(){return a(W(this,q))}set someSelected(s){k(W(this,q),s)}get allSelected(){return a(W(this,R))}set allSelected(s){k(W(this,R),s)}get noneSelected(){return a(W(this,l))}set noneSelected(s){k(W(this,l),s)}get indeterminant(){return a(W(this,b))}set indeterminant(s){k(W(this,b),s)}async select(){this.isLeaf?(S()(this.conceptPath),this.selected=!0):(this.childrenLoaded||await this.loadChildren(),this.children.length>0?await Promise.all(this.children.map(s=>s.select())):(S()(this.conceptPath),this.selected=!0))}async unselect(){this.isLeaf?(this.selected=!1,f()(this.conceptPath)):(this.childrenLoaded||await this.loadChildren(),await Promise.all(this.children.map(s=>s.unselect())))}async toggleSelected(){this.allSelected?await this.unselect():await this.select()}async toggleOpen(){this.isLeaf||(this.open?this.open=!1:(this.childrenLoaded||await this.loadChildren(),this.open=!0))}async loadChildren(){if(!(this.loading||this.childrenLoaded||this.isLeaf)){this.loading=!0,this.error=null;try{const s=await e.fetchChildren(this.conceptPath);this.children=s.map(x=>new E(x)),this.childrenLoaded=!0,this.isLeaf=this.children.length===0}catch(s){this.error=s instanceof Error?s.message:"Failed to load children",console.error("Error loading children for",this.conceptPath,s)}finally{this.loading=!1}}}};r=new WeakMap,u=new WeakMap,P=new WeakMap,$=new WeakMap,g=new WeakMap,h=new WeakMap,_=new WeakMap,I=new WeakMap,q=new WeakMap,R=new WeakMap,l=new WeakMap,b=new WeakMap;let y=E,i=pe(((A=t())==null?void 0:A.map(p=>new y(p)))??void 0);function w(p,s){p.isLeaf?p.selected=s.includes(p.conceptPath):p.children&&p.children.length>0?(p.children.forEach(C=>w(C,s)),p.children.some(C=>C.selected||C.someSelected)&&(p.open=!0),p.selected=p.children.every(C=>C.selected)):p.selected=s.includes(p.conceptPath)}We(()=>{i&&e.previousSelectedConcepts&&e.previousSelectedConcepts.length>0&&i.forEach(p=>{w(p,e.previousSelectedConcepts)})});var m=sr();Ve(m,21,()=>i,Xe,(p,s)=>{jt(p,{get node(){return a(s)}})}),c(m),G(()=>Fe(m,1,`overflow-auto ${d()?"w-full":""}`)),o(n,m),ne()}var nr=T('<section class="flex flex-col w-full h-full items-center"><!> <div class="w-full h-full m-2 card p-4"><header class="card-header">Select <strong>additional variables</strong> you would like to be included in your final data export.</header> <hr/> <div class="card-body p-4"><!></div></div></section>');function lr(n,e){oe(e,!0);const t=()=>Z(Ge,"$selectedConcepts",S),[S,f]=Me();let d=t()&&t().length>0?Math.max(...t().map(g=>g.split("\\").filter(Boolean).length)):1;async function y(g){const h=g.split("\\")[1],_=g.split("\\").filter(Boolean).length,I=await ga(h,_,g);function q(l){return!l.children||l.children.length===0?[l]:l.children.flatMap(q)}const R=q(I);return R.length===1&&R[0].conceptPath===g?[]:R}const i=g=>{Ut(g)},w=g=>{Ha(g)};var m=nr(),r=v(m);tt(r,{});var u=D(r,2),P=D(v(u),4),$=v(P);ze($,()=>ya(d),g=>{ge(g,{ring:!0,size:"small"})},(g,h)=>{{let _=L(()=>xt(Ge));or(g,{get initialNodes(){return a(h)},fetchChildren:y,fullWidth:!0,onselect:i,onunselect:w,get previousSelectedConcepts(){return a(_)}})}}),c(P),c(u),c(m),o(n,m),ne(),f()}let Ot=j(pe({resourceUUID:"",query:new ft})),Bt=j(void 0),Qt=j(void 0),zt=j(void 0),Gt=j(!0),Wt=j(!1);function Ke(n){k(Bt,n,!0)}function Ze(){return a(Bt)}function ct(n){k(Qt,n,!0)}function se(){return a(Qt)}function Pt(n){k(zt,n,!0)}function Ue(){return a(zt)}function ot(n){k(Gt,n,!0)}function ir(){return a(Gt)}function fe(){return a(Ot)}function Vt(n){k(Ot,n,!0)}function dt(n){k(Wt,n,!0)}function cr(){return a(Wt)}function At(){Ke(void 0),ct(void 0),Pt(void 0),ot(!0),dt(!1),Vt({resourceUUID:"",query:new ft})}var dr=T('<section class="flex flex-col w-full h-full items-center"><!> <div class="flex flex-row justify-center"><!> <!> <!></div></section>');function ur(n,e){oe(e,!0);var t=dr(),S=v(t);tt(S,{});var f=D(S,2),d=v(f);{let m=L(()=>Ze()==="DATAFRAME");ht(d,{"data-testid":"csv-export-option",title:"Export as Data Frame or CSV",subtitle:"Export data as a Python or R data frame or a comma-separated values file",size:"other",class:"flex-1 max-w-64",get active(){return a(m)},onclick:()=>Ke("DATAFRAME")})}var y=D(d,2);{var i=m=>{{let r=L(()=>Ze()==="DATAFRAME_TIMESERIES");ht(m,{"data-testid":"timeseries-export-option",title:"Export as Timeseries",subtitle:"Export as an R or Python data frame or a comma-separated values file including timestamps",size:"other",class:"flex-1 max-w-64",get active(){return a(r)},onclick:()=>Ke("DATAFRAME_TIMESERIES")})}};M(y,m=>{Q.explorer.enableExportTimeseries&&m(i)})}var w=D(y,2);{let m=L(()=>Ze()==="DATAFRAME_PFB");ht(w,{"data-testid":"pfb-export-option",title:"Export as PFB",subtitle:"Export data in Portable Format for Biomedical Data file format",size:"other",class:"flex-1 max-w-64",get active(){return a(m)},onclick:()=>Ke("DATAFRAME_PFB")})}c(f),c(t),o(n,t),ne()}var fr=T('<label for="dataset-id" class="font-bold mr-2">Dataset ID:</label> <div id="dataset-id" class="mr-4"> </div>',1),vr=T('<label for="dataset-id" class="font-bold mr-2">Dataset ID:</label> <!>',1),pr=T(`<div class="w-full h-full m-2 card p-4"><header class="card-header">Save the information in your final data export by clicking the Save Dataset ID button.
        Navigate to the <a class="anchor" href="/dataset">Manage Datasets page</a> to view or manage
        your Dataset IDs.</header> <hr/> <div class="card-body p-4 flex flex-col justify-center items-center"><div><div class="flex items-center m-2"><label for="dataset-name" class="font-bold mr-2">Dataset Name:</label> <input type="text" id="dataset-name" class="input w-80" placeholder="Enter a name" required/></div> <div class="flex items-center m-2"><div class="flex items-center"><!></div></div></div></div></div>`),mr=T('<div class="flex justify-center mb-4"><!></div>'),hr=T('<section class="flex flex-col w-full h-full items-center"><!> <!></section>');function yr(n,e){oe(e,!0);const t=()=>Z(Ae,"$stepperState",S),[S,f]=Me(),d=7;let y=j(""),i=j(pe(Promise.resolve())),w=j(pe(Promise.resolve())),m=j(pe(Ue()));async function r(){let g;const h={initial:"Creating dataset ID...",waiting:"Hang tight. We are still working on it...",retry:"Something's taking longer than usual. We are still working on it..."};function _(I,q=!0){k(y,q?h.initial:h.retry,!0),q&&(g=setInterval(()=>{k(y,h.waiting,!0)},d*1e3)),k(i,I().finally(()=>clearInterval(g)).catch(R=>{if(q)_(I,!1);else throw R}),!0)}try{fe().query.expectedResultType=Ze()||"DATAFRAME",ct(""),_(()=>Le(Ne.Query,fe()).then(I=>{ct(I.picsureResultId||"Error")})),await a(i)}catch(I){throw qe(Ae,ie(t).current--,ie(t)),console.error("Error in submitQuery",I),I}}_t(()=>{var g,h;dt((((g=Ue())==null?void 0:g.length)??0)>2&&(((h=se())==null?void 0:h.length)??0)>0)}),_t(()=>{Pt(a(m))}),We(()=>{k(w,r(),!0)});var u=hr(),P=v(u);tt(P,{});var $=D(P,2);ze($,()=>a(w),g=>{ge(g,{ring:!0})},g=>{var h=pr(),_=D(v(h),4),I=v(_),q=v(I),R=D(v(q),2);ut(R),c(q);var l=D(q,2),b=v(l),E=v(b);ze(E,()=>a(i),A=>{var p=vr(),s=D(O(p),2);ge(s,{ring:!0,size:"micro",get label(){return a(y)}}),o(A,p)},A=>{var p=fr(),s=D(O(p),2),x=v(s,!0);c(s),G(C=>V(x,C),[se]),o(A,p)},A=>{Oe(A,{title:"An error occurred while getting the dataset ID. Please try again later."})}),c(b),c(l),c(I),c(_),c(h),Ft(R,()=>a(m),A=>k(m,A)),o(g,h)},g=>{var h=mr(),_=v(h);Oe(_,{title:`An error occurred while preparing your dataset. Please try again. If this problem persists, please
          contact an administrator.`}),c(h),o(g,h)}),c(u),o(n,u),ne(),f()}async function gr(n){const e=xt(It);if(e)return e;const S={query:new ft,resourceUUID:xt(kt).queryIdGen};try{const d=(await Le(Ne.Query,S)).picsureResultId;if(!d)throw new Error("Failed to generate common area UUID");return It.set(d),n.commonAreaUUID=d,d}catch(f){throw new Error(`Failed to create common area UUID: ${f instanceof Error?f.message:"Unknown error"}`)}}async function _r(n){const e={},t=$t(),S=await Promise.allSettled(t.map(y=>{const i=structuredClone(Nt(n));return i.resourceUUID=y.uuid,i.query.expectedResultType="COUNT",i.resourceCredentials=i.resourceCredentials||{},Le(Ne.Query+"?isInstitute=true",i).then(w=>w.picsureResultId?{resourceName:y.name,picsureResultId:w.picsureResultId,success:!0}:(console.warn(`No picsureResultId for resource: ${y.name}`),{resourceName:y.name,error:"No result ID returned",success:!1})).catch(w=>(console.error(`Failed to query resource ${y.name}:`,w),{resourceName:y.name,error:w instanceof Error?w.message:`API Error: ${w.status||"Unknown"}`,success:!1}))}));let f=!1;const d=[];if(S.forEach(y=>{if(y.status==="fulfilled"){const i=y.value;i.success&&"picsureResultId"in i&&i.picsureResultId?(e[i.resourceName]=i.picsureResultId,je.update(w=>({...w,[i.resourceName]:{...w[i.resourceName]||{},queryId:i.picsureResultId,status:"COMPLETE"}})),f=!0):!i.success&&"error"in i&&(d.push(`${i.resourceName}: ${i.error}`),je.update(w=>({...w,[i.resourceName]:{...w[i.resourceName]||{},status:"ERROR"}})))}else d.push(`Unknown failure: ${y.reason}`)}),!f&&d.length>0)throw new Error(`All federated queries failed: ${d.join(", ")}`);return d.length>0&&console.warn("Some federated queries failed:",d),e}async function xr(n){await Ct();const e=$t(),t={};e.forEach(({name:f,uuid:d})=>{t[f]={status:"PENDING",resourceId:d,name:f}}),je.set(t);const S=await gr(n);n["@type"]="FederatedQueryRequest";try{return{responses:await _r(n),datasetId:S}}catch(f){throw e.map(d=>d.name).forEach(d=>{je.update(y=>({...y,[d]:{...y[d]||{},status:"ERROR"}}))}),f}}var br=T('<!> <span class="ml-2">Creating datasets to save...</span>',1),wr=T('<div id="dataset-id" class="mr-4"> </div>'),Pr=T(`<div class="w-full h-full m-2 card p-4"><header class="card-header">Common Area Save the information in your final data export by clicking the Save Dataset ID
        button. Navigate to the <a class="anchor" href="/dataset">Manage Datasets page</a> to view or
        manage your Dataset IDs.</header> <hr/> <div class="card-body p-4 flex flex-col justify-center items-center"><div><div class="flex items-center m-2"><label for="dataset-name" class="font-bold mr-2">Dataset Name:</label> <input type="text" id="dataset-name" class="input w-80" placeholder="Enter a name" required/></div> <div class="flex items-center m-2"><div class="flex items-center"><label for="dataset-id" class="font-bold mr-2">Dataset ID:</label> <!></div></div></div></div></div>`),Sr=T('<section class="flex flex-col w-full h-full items-center"><!> <!></section>');function Er(n,e){oe(e,!0);let t=j(!0),S=j(null),f=j(pe(Ue()));We(async()=>{try{const r=await xr(fe());ct(r.datasetId),dt(!0),k(t,!1)}catch(r){k(S,r instanceof Error?r.message:"Failed to execute federated query",!0),k(t,!1),console.error("Federated query error:",r)}}),_t(()=>{var r,u;Pt(a(f)),dt((((r=Ue())==null?void 0:r.length)??0)>2&&(((u=se())==null?void 0:u.length)??0)>0)});var d=Sr(),y=v(d);tt(y,{});var i=D(y,2);{var w=r=>{var u=br(),P=O(u);ge(P,{ring:!0,size:"small"}),Y(2),o(r,u)},m=r=>{var u=K(),P=O(u);{var $=h=>{Oe(h,{title:"Failed to prepare federated query",children:(_,I)=>{Y();var q=ve();G(()=>V(q,a(S))),o(_,q)},$$slots:{default:!0}})},g=h=>{var _=Pr(),I=D(v(_),4),q=v(I),R=v(q),l=D(v(R),2);ut(l),c(R);var b=D(R,2),E=v(b),A=D(v(E),2);{var p=x=>{ge(x,{ring:!0,size:"micro",label:"Generating ID..."})},s=x=>{var C=wr(),ee=v(C,!0);c(C),G(ae=>V(ee,ae),[se]),o(x,C)};M(A,x=>{se()?x(s,!1):x(p)})}c(E),c(b),c(q),c(I),c(_),Ft(l,()=>a(f),x=>k(f,x)),o(h,_)};M(P,h=>{a(S)?h($):h(g,!1)},!0)}o(r,u)};M(i,r=>{a(t)?r(w):r(m,!1)})}c(d),o(n,d),ne()}var Ir=(n,e,t)=>Q.confirmDownload?k(e,!0):t(),Dr=T('<!> <button class="btn preset-filled-primary-500"><i class="fa-solid fa-download mr-1"></i> <!></button>',1),Rr=T("<p>Downloading data is disabled. Please contact the administrator to enable this feature.</p>"),Ar=T('<div class="flex items-center m-1"><!></div>');function Xt(n,e){oe(e,!0);let t=j(!1),S=j(!1);const f=L(()=>e.query.query.expectedResultType==="DATAFRAME"||e.query.query.expectedResultType==="DATAFRAME_TIMESERIES"?"Download as CSV":e.query.query.expectedResultType==="DATAFRAME_PFB"&&Q.explorer.enablePfbExport?"Download as PFB":"Download is Disabled");async function d(){if(Q.explorer.allowDownload){if(!e.datasetId){console.error("No dataset ID provided"),nt.error({title:"No dataset ID provided. Go back and save a dataset and try again.",closable:!0});return}try{k(S,!0);const r=await Le(`${Ne.Query}/${e.datasetId}/result`,{}),u=URL.createObjectURL(new Blob([r],{type:"octet/stream"}));if(ba){const P=document.createElement("a");P.href=u,e.query.query.expectedResultType==="DATAFRAME"?P.download="pic-sure-data.csv":Q.explorer.enablePfbExport&&e.query.query.expectedResultType==="DATAFRAME_PFB"&&(P.download="pic-sure-data.avro"),document.body.appendChild(P),P.click(),document.body.removeChild(P)}}catch(r){console.error("Error in onCompleteHandler",r)}finally{k(S,!1)}}}var y=Ar(),i=v(y);{var w=r=>{var u=Dr(),P=O(u);{let I=L(()=>ye.explorePage.confirmDownloadTitle||"Are you sure you want to download data?");wa(P,{get title(){return a(I)},width:"w-1/2",withDefault:!0,confirmText:"Download",cancelText:"Cancel",onconfirm:()=>d(),get open(){return a(t)},set open(q){k(t,q,!0)},children:(q,R)=>{Y();var l=ve();G(()=>V(l,ye.explorePage.confirmDownloadMessage||"This action will download the data to your local machine. Are you sure you want to proceed?")),o(q,l)},$$slots:{default:!0}})}var $=D(P,2);$.__click=[Ir,t,d];var g=D(v($)),h=D(g);{var _=I=>{ge(I,{ring:!0,size:"micro",color:"white"})};M(h,I=>{a(S)&&I(_)})}c($),G(()=>V(g,`${a(f)??""} `)),o(r,u)},m=r=>{Oe(r,{title:"Download is disabled!",color:"warning",solid:!0,children:(u,P)=>{var $=Rr();o(u,$)},$$slots:{default:!0}})};M(i,r=>{Q.explorer.allowDownload?r(w):r(m,!1)})}c(y),o(n,y),ne()}et(["click"]);var Tr=T("<!> <!>",1),Cr=T("<!> <!>",1),kr=T('<div class="flex justify-center w-full"><!></div>'),$r=T("<!> <!> <!>",1);function qr(n,e){oe(e,!0);let t=j(pe(Q.analyzeApi?"Python":Q.explorer.allowDownload?"Download":""));rt(n,{get value(){return a(t)},onValueChange:d=>k(t,d.value,!0),list:d=>{var y=Cr(),i=O(y);{var w=u=>{var P=Tr(),$=O(P);gt($,{value:"Python",get group(){return a(t)},set group(h){k(t,h,!0)},children:(h,_)=>{Y();var I=ve("Python");o(h,I)},$$slots:{default:!0}});var g=D($,2);gt(g,{value:"R",get group(){return a(t)},set group(h){k(t,h,!0)},children:(h,_)=>{Y();var I=ve("R");o(h,I)},$$slots:{default:!0}}),o(u,P)};M(i,u=>{Q.analyzeApi&&u(w)})}var m=D(i,2);{var r=u=>{gt(u,{value:"Download",get group(){return a(t)},set group(P){k(t,P,!0)},children:(P,$)=>{Y();var g=ve("Download");o(P,g)},$$slots:{default:!0}})};M(m,u=>{Q.explorer.allowDownload&&u(r)})}o(d,y)},content:d=>{var y=$r(),i=O(y);yt(i,()=>rt.Panel,(u,P)=>{P(u,{value:"Python",children:($,g)=>{{let h=L(()=>ye.explorePage.codeBlocks.PythonExport.replace("{{queryId}}",se()??"DATASET_ID_MISSING")||"Code not set for Python in configuration");Rt($,{lang:"python",get code(){return a(h)}})}},$$slots:{default:!0}})});var w=D(i,2);yt(w,()=>rt.Panel,(u,P)=>{P(u,{value:"R",children:($,g)=>{{let h=L(()=>ye.explorePage.codeBlocks.RExport.replace("{{queryId}}",se()??"DATASET_ID_MISSING")||"Code not set for R in configuration");Rt($,{lang:"r",get code(){return a(h)}})}},$$slots:{default:!0}})});var m=D(w,2);{var r=u=>{var P=K(),$=O(P);yt($,()=>rt.Panel,(g,h)=>{h(g,{value:"Download",children:(_,I)=>{var q=kr(),R=v(q);{let l=L(fe),b=L(se);Xt(R,{get query(){return a(l)},get datasetId(){return a(b)}})}c(q),o(_,q)},$$slots:{default:!0}})}),o(u,P)};M(m,u=>{Q.explorer.allowDownload&&u(r)})}o(d,y)},$$slots:{list:!0,content:!0}}),ne()}var Mr=T(`<section class="flex flex-col w-full h-full"><p>By clicking "Request Access" you will be taken to the externally linked Request Data and
    Biosamples RedCap form where you can submit your request for data and biosamples.</p> <p class="mb-0">Before submitting the RedCap form, make sure you have:</p> <ul class="list-disc list-inside ml-8"><li>Selected all variables you would like to include in your export</li> <li><a href="/collaborate" class="anchor">Identified collaborators</a> if using data from other institutions.</li></ul> <div class="flex flex-row items-center self-center card p-4 my-4"><label for="copyable-dataset-id" class="font-bold mr-2">Dataset ID:</label> <span id="copyable-dataset-id" class="mr-2"> </span> <!></div> <p>Once the request has been submitted, the local Sample and Data Access Committee will review and
    notify you of a decision via email.</p> <p>Once approved, access to patient-level data will be provisioned in the GIC Service Workbench. To
    learn more about this, please refer to the <a href="/analyze" class="anchor">Analyze page</a>.</p></section>`);function Lr(n,e){oe(e,!0);var t=Mr(),S=D(v(t),6),f=D(v(S),2),d=v(f,!0);c(f);var y=D(f,2);{let i=L(()=>se()??"MISSING_DATASET_ID");Pa(y,{get itemToCopy(){return a(i)},class:"preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500"})}c(S),Y(4),c(t),G(i=>V(d,i),[se]),o(n,t),ne()}var Nr=(n,e,t)=>e(a(t).url),Fr=T('<button class="flex-initial w-64 btn preset-filled-primary-500 disabled:preset-tonal-primary border border-primary-500"><i class="fa-solid fa-arrow-up-right-from-square"></i> <span> </span> <!></button>'),Ur=T('<section class="flex flex-col gap-8 place-items-center"><div class="flex justify-center mt-4">Select an option below to export your selected data in PFB format.</div> <!> <!></section>');function jr(n,e){oe(e,!0);let t=j(!1);async function S(m){if(!m){console.warn("No URL provided for export");return}k(t,!0);try{const r=await f();r?window.open(m+encodeURIComponent(r),"_blank"):nt.error({title:"Failed to get signed URL for export.",closable:!0})}catch(r){console.error("Error during export:",r),nt.error({title:"Export failed. Please try again.",closable:!0})}finally{k(t,!1)}}async function f(){const m=`${Ne.Query}/${se()}/signed-url`;try{return(await Le(m,fe())).signedUrl||null}catch(r){throw console.error("Error getting signed URL:",r),r}}var d=Ur(),y=D(v(d),2);{var i=m=>{var r=K(),u=O(r);Ve(u,17,()=>ye.explorePage.pfbExportUrls,Xe,(P,$)=>{var g=Fr();g.__click=[Nr,S,$];var h=D(v(g),2),_=v(h);c(h);var I=D(h,2);{var q=R=>{ge(R,{ring:!0,size:"micro",label:"Exporting"})};M(I,R=>{a(t)&&R(q)})}c(g),G(()=>{g.disabled=a(t),V(_,`Export to ${a($).title??""}`)}),o(P,g)}),o(m,r)};M(y,m=>{var r;(r=ye.explorePage)!=null&&r.pfbExportUrls&&ye.explorePage.pfbExportUrls.length>0&&m(i)})}var w=D(y,2);{let m=L(fe),r=L(se);Xt(w,{get query(){return a(m)},get datasetId(){return a(r)}})}c(d),o(n,d),ne()}et(["click"]);var Or=T('<a class="btn preset-tonal-primary border border-primary-500 m-2 hover:preset-filled-primary-500"> </a>'),Br=T('<div class="flex justify-center"></div>');function Qr(n,e){oe(e,!0);var t=K(),S=O(t);{var f=d=>{var y=Br();Ve(y,21,()=>ye.explorePage.goTo.links,Xe,(i,w)=>{var m=Or(),r=v(m,!0);c(m),G(()=>{J(m,"href",a(w).url),J(m,"target",a(w).newTab?"_blank":"_self"),V(r,a(w).title)}),o(i,m)}),c(y),o(d,y)};M(S,d=>{ye.explorePage.goTo.links.length>0&&d(f)})}o(n,t),ne()}var zr=T("<p> </p>"),Gr=T('<div class="flex justify-center"><!></div>'),Wr=T('<p class="mt-4"> </p> <!> <!> <!> <!>',1),Vr=T('<div class="flex justify-center"><!> <div class="hidden"> </div></div>'),Xr=T("<p> </p>"),Hr=T('<div class="flex justify-center"><!> <div class="hidden"> </div></div>'),Yr=T('<section class="flex flex-col w-full h-full items-center"><!></section>'),Jr=T("<!> <!> <!> <!> <!>",1);function Kr(n,e){oe(e,!0);const t=()=>Z(je,"$federatedQueryMap",i),S=()=>Z(Ge,"$selectedConcepts",i),f=()=>Z(wt,"$filters",i),d=()=>Z(Lt,"$totalParticipants",i),y=()=>Z(Mt,"$exports",i),[i,w]=Me(),m=Ie(e,"rows",19,()=>[]);let r=j(pe(Promise.resolve())),u=pe(Promise.resolve()),P=j(pe(Promise.resolve()));const $=L(()=>(fe().query.expectedResultType==="DATAFRAME"||fe().query.expectedResultType==="DATAFRAME_TIMESERIES")&&!Q.explorer.enableRedcapExport),g=L(()=>fe().query.expectedResultType==="DATAFRAME_PFB"&&Q.explorer.enablePfbExport&&!Q.explorer.enableRedcapExport),h=L(()=>(fe().query.expectedResultType==="DATAFRAME"||fe().query.expectedResultType==="DATAFRAME_TIMESERIES")&&Q.analyzeApi&&!Q.explorer.enableRedcapExport);let _=j(pe([]));We(async()=>{Vt(e.query),ra(je,{}),Q.explorer.enablePfbExport||Ke("DATAFRAME")});function I(){a(_).filter(p=>!S().includes(p)).forEach(p=>{const s=fe().query.fields.indexOf(p);s>-1&&fe().query.fields.splice(s,1)}),k(_,S(),!0),S().forEach(p=>{fe().query.addField(p)})}async function q(A,p){const s=Q.explorer.showTreeStep&&p===(Q.federated?"save-dataset":"select-type");if(p==="select-variables"&&fe().query.fields.forEach(Ut),s&&I(),p==="start"){Q.explorer.enableRedcapExport&&ot(!1);const x=Object.values(t()).map(C=>({resourceId:C==null?void 0:C.resourceId,name:C==null?void 0:C.name,queryId:C==null?void 0:C.queryId})).filter(C=>C.queryId);if(se())k(P,Sa(se()??"",Ue()??"",x.length>0?x:void 0).then(C=>Q.federated?(k(r,Promise.resolve(),!0),C):(k(r,R(se()),!0),C)),!0);else throw new Error("No dataset ID provided")}}async function R(A){const s=`/${A||se()}/status`;return Da(async()=>{const x=await Le(`${Ne.Query}${s}`,e.query);if(x.status==="ERROR")throw ot(!0),new Error(`Export failed with status: ${x.status}`);if(x.status!=="SUCCESS"&&x.status!=="AVAILABLE")throw new Error(`Export not ready. Status: ${x.status}`);ot(!1)},15,500,6e4,(x,C)=>!(x instanceof Error&&x.message.includes("Export failed with status: ERROR")))}function l(){Q.explorer.enableRedcapExport?(window.open("https://redcap.tch.harvard.edu/redcap_edc/surveys/?s=EWYX8X8XX77TTWFR","_blank"),At(),bt("/explorer")):(At(),bt("/explorer"))}const b=oa.maxDataPointsForExport||1e6;function E(){const A=f().filter(x=>x.filterType==="AnyRecordOf").reduce((x,C)=>x+C.concepts.length,0);return(typeof d()=="number"?d():b+1)+(f().length+A)+y().length>b}{let A=L(()=>Q.explorer.enableRedcapExport?"Request Access":"Done");Ca(n,{class:"w-full h-full m-8",oncomplete:l,onnext:q,get buttonCompleteLabel(){return a(A)},children:(p,s)=>{var x=Jr(),C=O(x);{const F=U=>{Y();var z=ve("Review Cohort Details:");o(U,z)};let X=L(E);Je(C,{name:"review",get locked(){return a(X)},header:F,children:(U,z)=>{{let H=L(E);Xa(U,{get query(){return e.query},get rows(){return m()},get preparePromise(){return u},get dataLimitExceeded(){return a(H)}})}},$$slots:{header:!0,default:!0}})}var ee=D(C,2);{var ae=F=>{Je(F,{name:"select-variables",header:U=>{Y();var z=ve("Finalize Data:");o(U,z)},children:(U,z)=>{lr(U,{})},$$slots:{header:!0,default:!0}})};M(ee,F=>{Q.explorer.showTreeStep&&F(ae)})}var _e=D(ee,2);{var Te=F=>{{const X=z=>{Y();var H=ve("Review and Save Dataset:");o(z,H)};let U=L(()=>Ze()===void 0);Je(F,{name:"select-type",get locked(){return a(U)},header:X,children:(z,H)=>{ur(z,{})},$$slots:{header:!0,default:!0}})}};M(_e,F=>{Q.explorer.enablePfbExport&&!Q.federated&&F(Te)})}var B=D(_e,2);{const F=U=>{Y();var z=ve("Save Dataset ID:");o(U,z)};let X=L(()=>{var U;return!Ue()||(((U=Ue())==null?void 0:U.length)??0)<2||!se()||!cr()});Je(B,{name:"save-dataset",get locked(){return a(X)},header:F,children:(U,z)=>{var H=K(),we=O(H);{var Pe=le=>{Er(le,{})},Se=le=>{yr(le,{})};M(we,le=>{Q.federated?le(Pe):le(Se,!1)})}o(U,H)},$$slots:{header:!0,default:!0}})}var N=D(B,2);{const F=U=>{Y();var z=ve("Start Analysis:");o(U,z)};let X=L(ir);Je(N,{name:"start",get locked(){return a(X)},header:F,children:(U,z)=>{var H=Yr(),we=v(H);ze(we,()=>a(P),Pe=>{ge(Pe,{ring:!0,size:"medium",label:"Saving"})},Pe=>{var Se=K(),le=O(Se);ze(le,()=>a(r),ce=>{ge(ce,{ring:!0,size:"medium",label:"Preparing"})},ce=>{var de=Wr(),Ee=O(de),Ce=v(Ee,!0);c(Ee);var ke=D(Ee,2);{var me=te=>{qr(te,{})},xe=te=>{var be=K(),$e=O(be);{var vt=Qe=>{jr(Qe,{})},Ht=Qe=>{var St=K(),Yt=O(St);{var Jt=pt=>{Lr(pt,{})};M(Yt,pt=>{Q.explorer.enableRedcapExport&&pt(Jt)},!0)}o(Qe,St)};M($e,Qe=>{a(g)?Qe(vt):Qe(Ht,!1)},!0)}o(te,be)};M(ke,te=>{a($)?te(me):te(xe,!1)})}var De=D(ke,2);{var re=te=>{var be=zr(),$e=v(be,!0);c(be),G(()=>V($e,ye.explorePage.goTo.instructions)),o(te,be)};M(De,te=>{ye.explorePage.goTo.instructions&&ye.explorePage.goTo.instructions.length>0&&te(re)})}var ue=D(De,2);{var Re=te=>{var be=Gr(),$e=v(be);pa($e,{}),c(be),o(te,be)};M(ue,te=>{a(h)&&te(Re)})}var Be=D(ue,2);Qr(Be,{}),G(()=>V(Ce,ye.explorePage.analysisExportText)),o(ce,de)},(ce,de)=>{var Ee=Vr(),Ce=v(Ee);Oe(Ce,{title:`An error occurred while preparing your dataset. Please try again. If this problem persists, please
            contact an administrator.`});var ke=D(Ce,2),me=v(ke,!0);c(ke),c(Ee),G(()=>V(me,a(de))),o(ce,Ee)}),o(Pe,Se)},(Pe,Se)=>{var le=Hr(),ce=v(le);Oe(ce,{title:`An error occurred while saving your dataset. Please try again. If this problem persists, please
          contact an administrator.`,children:(Ce,ke)=>{var me=K(),xe=O(me);{var De=re=>{var ue=Xr(),Re=v(ue,!0);c(ue),G(()=>V(Re,a(Se))),o(re,ue)};M(xe,re=>{a(Se).includes("Export not ready")&&re(De)})}o(Ce,me)},$$slots:{default:!0}});var de=D(ce,2),Ee=v(de,!0);c(de),c(le),G(()=>V(Ee,a(Se))),o(Pe,le)}),c(H),o(U,H)},$$slots:{header:!0,default:!0}})}o(p,x)},$$slots:{default:!0}})}ne(),w()}var Zr=T('<section class="flex justify-center items-center w-full h-full mt-8"><!></section>'),es=()=>{alert("This would start the tour at some step")},ts=T('<div class="flex flex-col items-center justify-center m-8"><p>No filters or exports have been created.</p> <div class="flex gap-4"><button class="btn preset-filled-primary-500 m-4">Learn How</button></div></div>');function Ns(n,e){var u,P,$,g,h,_,I,q,R;oe(e,!0);const t=()=>Z(i,"$exports",d),S=()=>Z(wt,"$filters",d),f=()=>Z(Ae,"$stepperState",d),[d,y]=Me();let{exports:i}=qt,w=_a(!0),m=t().map(l=>{var b,E,A,p;return{ref:l,selected:!0,variableId:l.conceptPath,name:l.display||((b=l.searchResult)==null?void 0:b.display)||((E=l.searchResult)==null?void 0:E.name),description:(A=l.searchResult)==null?void 0:A.description,type:(p=l.searchResult)==null?void 0:p.type}}),r=S().map(l=>{var b,E,A;return{ref:l,selected:!0,variableId:l.id,name:((b=l.searchResult)==null?void 0:b.display)||l.variableName,description:(E=l.searchResult)==null?void 0:E.description,type:(A=l.searchResult)==null?void 0:A.type}});if(Q.useQueryTemplate){const l={id:"\\_Patient ID\\",conceptPath:"\\_Patient ID\\",display:"Patient ID",searchResult:{conceptPath:"\\_Patient ID\\",name:"_Patient ID",dataset:"",display:"Patient ID",studyAcronym:"",description:"Patient identifier.",type:"Categorical",allowFiltering:!0}};let b={ref:l,selected:!0,variableId:l.conceptPath,name:l.display||((u=l.searchResult)==null?void 0:u.name),description:(P=l.searchResult)==null?void 0:P.description,type:($=l.searchResult)==null?void 0:$.type};if(m.push(b),Q.useQueryTemplate){const E={id:"\\_Topmed Study Accession with Subject ID\\",conceptPath:"\\_Topmed Study Accession with Subject ID\\",display:"TOPMed Study Accession with Subject ID",searchResult:{conceptPath:"\\_Topmed Study Accession with Subject ID\\",name:"_TOPMed Study Accession with Subject ID",dataset:"TOPMed",display:"TOPMed Study Accession with Subject ID",studyAcronym:"TOPMed",description:"TOPMed study accession number and subject identifier.",type:"Categorical",allowFiltering:!0}};let A={ref:E,selected:!0,variableId:E.conceptPath,name:E.display||((g=E.searchResult)==null?void 0:g.name),description:(h=E.searchResult)==null?void 0:h.description,type:(_=E.searchResult)==null?void 0:_.type};m.push(A);const p={id:"\\_Parent Study Accession with Subject ID\\",conceptPath:"\\_Parent Study Accession with Subject ID\\",display:"Parent Study Accession with Subject ID",searchResult:{conceptPath:"\\_Parent Study Accession with Subject ID\\",name:"_Parent Study Accession with Subject ID",dataset:"",display:"Parent Study Accession with Subject ID",studyAcronym:"",description:"Parent study accession number and subject identifier.",type:"Categorical",allowFiltering:!0}};let s={ref:p,selected:!0,variableId:p.conceptPath,name:p.display||((I=p.searchResult)==null?void 0:I.name),description:(q=p.searchResult)==null?void 0:q.description,type:(R=p.searchResult)==null?void 0:R.type};m.push(s)}}Ae.set({...f(),current:0,total:0}),va(n,{backUrl:"/explorer",backTitle:"Back to Explore",backAction:()=>{qe(Ae,ie(f).current=0,ie(f))},title:"Export Data for Research Analysis",children:(l,b)=>{var E=K(),A=O(E);{var p=x=>{var C=Zr(),ee=v(C);{let ae=L(()=>[...r,...m]);Kr(ee,{get query(){return w},get rows(){return a(ae)}})}c(C),o(x,C)},s=x=>{var C=ts(),ee=D(v(C),2),ae=v(ee);ae.__click=[es],c(ee),c(C),o(x,C)};M(A,x=>{t().length>0||S().length>0?x(p):x(s,!1)})}o(l,E)},$$slots:{default:!0}}),ne(),y()}et(["click"]);export{Ns as component};
