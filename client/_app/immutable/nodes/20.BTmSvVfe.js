import{s as x,e as $,a as S,q as U,c as g,b as k,f,g as T,m as d,i as p,h as A,O as N,a0 as R,n as C,w as te,t as ae,d as se,j as le,p as re,a6 as ne,l as z,R as oe}from"../chunks/scheduler.bui7uCNy.js";import{h as ie,u as ce}from"../chunks/await_block.B6WJ5gpV.js";import{e as K}from"../chunks/each.VHlBgARd.js";import{S as F,i as G,d as I,e as O,m as H,t as y,a as w,f as D,g as ue,b as de}from"../chunks/index.CNwEczq-.js";import{g as j,r as fe,d as me}from"../chunks/entry.DxzR7bMM.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.CGDEO2C7.js";import{P as pe}from"../chunks/ProgressBar.DUWWvR9O.js";import{b as _e}from"../chunks/configuration.CsqyQUvi.js";import{E as he}from"../chunks/ErrorAlert.VXgRa8sz.js";import{C as be}from"../chunks/Content.CIGh1jUC.js";import{T as $e}from"../chunks/Table.DI27nJGp.js";import{g as ge}from"../chunks/stores.CxgLQ31Y.js";import{g as ve}from"../chunks/stores.De0gTmA3.js";import{U as X,C as Y}from"../chunks/Connections.VFt9SGqk.js";import{R as Z}from"../chunks/Roles.BhunY428.js";import{P as ke}from"../chunks/Privileges.DJD_jgKf.js";function ye(c){let e,r,a,t,s;return{c(){e=$("button"),r=$("i"),this.h()},l(l){e=g(l,"BUTTON",{"data-testid":!0,type:!0,title:!0,class:!0});var n=k(e);r=g(n,"I",{class:!0}),k(r).forEach(f),n.forEach(f),this.h()},h(){d(r,"class","fa-solid fa-trash-arrow-up fa-xl"),d(e,"data-testid",a=`user-activate-btn-${c[0].cell}`),d(e,"type","button"),d(e,"title","Reactivate user"),d(e,"class","btn-icon-color")},m(l,n){p(l,e,n),A(e,r),t||(s=N(e,"click",R(c[5])),t=!0)},p(l,n){n&1&&a!==(a=`user-activate-btn-${l[0].cell}`)&&d(e,"data-testid",a)},d(l){l&&f(e),t=!1,s()}}}function Ce(c){let e,r,a,t,s,l,n,_,u;return{c(){e=$("button"),r=$("i"),t=S(),s=$("button"),l=$("i"),this.h()},l(i){e=g(i,"BUTTON",{"data-testid":!0,type:!0,title:!0,class:!0});var o=k(e);r=g(o,"I",{class:!0}),k(r).forEach(f),o.forEach(f),t=T(i),s=g(i,"BUTTON",{"data-testid":!0,type:!0,title:!0,class:!0});var m=k(s);l=g(m,"I",{class:!0}),k(l).forEach(f),m.forEach(f),this.h()},h(){d(r,"class","fa-solid fa-pen-to-square fa-xl"),d(e,"data-testid",a=`user-edit-btn-${c[0].cell}`),d(e,"type","button"),d(e,"title","Edit"),d(e,"class","btn-icon-color"),d(l,"class","fa-solid fa-trash fa-xl"),d(s,"data-testid",n=`user-deactivate-btn-${c[0].cell}`),d(s,"type","button"),d(s,"title","Deactivate user"),d(s,"class","btn-icon-color")},m(i,o){p(i,e,o),A(e,r),p(i,t,o),p(i,s,o),A(s,l),_||(u=[N(e,"click",R(c[3])),N(s,"click",R(c[4]))],_=!0)},p(i,o){o&1&&a!==(a=`user-edit-btn-${i[0].cell}`)&&d(e,"data-testid",a),o&1&&n!==(n=`user-deactivate-btn-${i[0].cell}`)&&d(s,"data-testid",n)},d(i){i&&(f(e),f(t),f(s)),_=!1,te(u)}}}function we(c){let e,r,a,t,s,l,n;function _(o,m){return o[0].row.status==="Active"?Ce:ye}let u=_(c),i=u(c);return{c(){e=$("button"),r=$("i"),t=S(),i.c(),s=U(),this.h()},l(o){e=g(o,"BUTTON",{"data-testid":!0,type:!0,title:!0,class:!0});var m=k(e);r=g(m,"I",{class:!0}),k(r).forEach(f),m.forEach(f),t=T(o),i.l(o),s=U(),this.h()},h(){d(r,"class","fa-solid fa-circle-info fa-xl"),d(e,"data-testid",a=`user-view-btn-${c[0].cell}`),d(e,"type","button"),d(e,"title","View"),d(e,"class","btn-icon-color")},m(o,m){p(o,e,m),A(e,r),p(o,t,m),i.m(o,m),p(o,s,m),l||(n=N(e,"click",R(c[2])),l=!0)},p(o,[m]){m&1&&a!==(a=`user-view-btn-${o[0].cell}`)&&d(e,"data-testid",a),u===(u=_(o))&&i?i.p(o,m):(i.d(1),i=u(o),i&&(i.c(),i.m(s.parentNode,s)))},i:C,o:C,d(o){o&&(f(e),f(t),f(s)),i.d(o),l=!1,n()}}}function Ee(c,e,r){const a=ge(),t=ve(),{getUser:s,updateUser:l}=X,{getConnection:n}=Y,{getRole:_}=Z,{getPrivilege:u}=ke;let{data:i={cell:"",row:{status:"",email:""}}}=e;async function o(v){const h=await s(i.cell);a.trigger({type:"confirm",title:`${v?"R":"D"}eactivate User?`,body:`Are you sure you want to ${v?"r":"d"}eactiveate user '${h.email}'?`,buttonTextConfirm:v?"Reactivate":"Deactivate",response:async P=>{if(!P)return;let V={...h,active:v,connection:await n(h.connection),roles:await Promise.all(h.roles.map(E=>_(E).then(b=>({...b,privileges:b.privileges.map(B=>u(B))}))))};try{await l(V),t.trigger({message:`Successfully ${v?"activated":"deactivated"} user '${h.email}'`,background:"variant-filled-success"})}catch(E){console.error(E),t.trigger({message:`An error occured while ${v?"activating":"deactivating"} user '${h.email}'`,background:"variant-filled-error"})}}})}const m=()=>j(`/admin/users/${i.cell}`),M=()=>j(`/admin/users/${i.cell}/edit`),q=()=>o(!1),L=()=>o(!0);return c.$$set=v=>{"data"in v&&r(0,i=v.data)},[i,o,m,M,q,L]}class Ue extends F{constructor(e){super(),G(this,e,Ee,we,x,{data:0})}}function Ae(c){let e,r=c[0].cell+"",a,t;return{c(){e=$("span"),a=ae(r),this.h()},l(s){e=g(s,"SPAN",{class:!0});var l=k(e);a=se(l,r),l.forEach(f),this.h()},h(){d(e,"class",t=`badge last:p-1 rounded variant-filled-${c[0].cell==="Active"?"success":"error"}`)},m(s,l){p(s,e,l),A(e,a)},p(s,[l]){l&1&&r!==(r=s[0].cell+"")&&le(a,r),l&1&&t!==(t=`badge last:p-1 rounded variant-filled-${s[0].cell==="Active"?"success":"error"}`)&&d(e,"class",t)},i:C,o:C,d(s){s&&f(e)}}}function Se(c,e,r){let{data:a={cell:"",row:{}}}=e;return c.$$set=t=>{"data"in t&&r(0,a=t.data)},[a]}class Te extends F{constructor(e){super(),G(this,e,Se,Ae,x,{data:0})}}function Q(c,e,r){const a=c.slice();return a[12]=e[r],a}function Pe(c){let e,r;return e=new he({props:{title:"API Error",$$slots:{default:[Be]},$$scope:{ctx:c}}}),{c(){I(e.$$.fragment)},l(a){O(e.$$.fragment,a)},m(a,t){H(e,a,t),r=!0},p(a,t){const s={};t&32768&&(s.$$scope={dirty:t,ctx:a}),e.$set(s)},i(a){r||(y(e.$$.fragment,a),r=!0)},o(a){w(e.$$.fragment,a),r=!1},d(a){D(e,a)}}}function Be(c){let e,r="Something went wrong when sending your request.";return{c(){e=$("p"),e.textContent=r},l(a){e=g(a,"P",{"data-svelte-h":!0}),z(e)!=="svelte-n1xg7v"&&(e.textContent=r)},m(a,t){p(a,e,t)},p:C,d(a){a&&f(e)}}}function Ne(c){let e,r='<div class="flex-auto"><a data-testid="add-user-btn" class="btn variant-ghost-primary hover:variant-filled-primary" href="/admin/users/new">+ Add User</a></div>',a,t,s,l=K(c[1]),n=[];for(let u=0;u<l.length;u+=1)n[u]=W(Q(c,l,u));const _=u=>w(n[u],1,1,()=>{n[u]=null});return{c(){e=$("div"),e.innerHTML=r,a=S();for(let u=0;u<n.length;u+=1)n[u].c();t=U(),this.h()},l(u){e=g(u,"DIV",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-3ryyp1"&&(e.innerHTML=r),a=T(u);for(let i=0;i<n.length;i+=1)n[i].l(u);t=U(),this.h()},h(){d(e,"class","flex gap-4 mb-6")},m(u,i){p(u,e,i),p(u,a,i);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(u,i);p(u,t,i),s=!0},p(u,i){if(i&46){l=K(u[1]);let o;for(o=0;o<l.length;o+=1){const m=Q(u,l,o);n[o]?(n[o].p(m,i),y(n[o],1)):(n[o]=W(m),n[o].c(),y(n[o],1),n[o].m(t.parentNode,t))}for(ue(),o=l.length;o<n.length;o+=1)_(o);de()}},i(u){if(!s){for(let i=0;i<l.length;i+=1)y(n[i]);s=!0}},o(u){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)w(n[i]);s=!1},d(u){u&&(f(e),f(a),f(t)),oe(n,u)}}}function W(c){let e,r,a,t,s;return r=new $e({props:{tableName:"Users",data:c[12].users,columns:c[2],cellOverides:c[3],search:!0,defaultRowsPerPage:10,title:c[12].label,rowClickHandler:c[5],isClickable:!0}}),{c(){e=$("div"),I(r.$$.fragment),a=S(),this.h()},l(l){e=g(l,"DIV",{id:!0,class:!0});var n=k(e);O(r.$$.fragment,n),a=T(n),n.forEach(f),this.h()},h(){d(e,"id",t=`user-table-${c[12].label.replaceAll(" ","_")}`),d(e,"class","mb-10")},m(l,n){p(l,e,n),H(r,e,null),A(e,a),s=!0},p(l,n){const _={};n&2&&(_.data=l[12].users),n&2&&(_.title=l[12].label),r.$set(_),(!s||n&2&&t!==(t=`user-table-${l[12].label.replaceAll(" ","_")}`))&&d(e,"id",t)},i(l){s||(y(r.$$.fragment,l),s=!0)},o(l){w(r.$$.fragment,l),s=!1},d(l){l&&f(e),D(r)}}}function Re(c){let e,r="Loading",a,t,s;return t=new pe({props:{animIndeterminate:"anim-progress-bar"}}),{c(){e=$("h3"),e.textContent=r,a=S(),I(t.$$.fragment),this.h()},l(l){e=g(l,"H3",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-16fo5h6"&&(e.textContent=r),a=T(l),O(t.$$.fragment,l),this.h()},h(){d(e,"class","text-left")},m(l,n){p(l,e,n),p(l,a,n),H(t,l,n),s=!0},p:C,i(l){s||(y(t.$$.fragment,l),s=!0)},o(l){w(t.$$.fragment,l),s=!1},d(l){l&&(f(e),f(a)),D(t,l)}}}function Ie(c){let e,r,a={ctx:c,current:null,token:null,hasCatch:!0,pending:Re,then:Ne,catch:Pe,blocks:[,,,]};return ie(c[4](),a),{c(){e=U(),a.block.c()},l(t){e=U(),a.block.l(t)},m(t,s){p(t,e,s),a.block.m(t,a.anchor=s),a.mount=()=>e.parentNode,a.anchor=e,r=!0},p(t,s){c=t,ce(a,c,s)},i(t){r||(y(a.block),r=!0)},o(t){for(let s=0;s<3;s+=1){const l=a.blocks[s];w(l)}r=!1},d(t){t&&f(e),a.block.d(t),a.token=null,a=null}}}function Oe(c){let e,r,a;return document.title=_e.applicationName+" | Manage Users",r=new be({props:{title:"Manage Users",$$slots:{default:[Ie]},$$scope:{ctx:c}}}),{c(){e=S(),I(r.$$.fragment)},l(t){re("svelte-zefh4i",document.head).forEach(f),e=T(t),O(r.$$.fragment,t)},m(t,s){p(t,e,s),H(r,t,s),a=!0},p(t,[s]){const l={};s&32770&&(l.$$scope={dirty:s,ctx:t}),r.$set(l)},i(t){a||(y(r.$$.fragment,t),a=!0)},o(t){w(r.$$.fragment,t),a=!1},d(t){t&&f(e),D(r,t)}}}function He(c,e,r){let a,t=C,s=()=>(t(),t=ne(m,h=>r(1,a=h)),m);c.$$.on_destroy.push(()=>t());let{users:l,loadUsers:n}=X,{connections:_,loadConnections:u}=Y,{roles:i,loadRoles:o}=Z,m=fe([]);s();const M=[{dataElement:"email",label:"Username",sort:!0},{dataElement:"roles",label:"Role(s)",sort:!0,class:"!normal-case"},{dataElement:"status",label:"Status",sort:!0},{dataElement:"uuid",label:"Actions",sort:!1}],q={status:Te,uuid:Ue};async function L(){await u(),await o(),await n(),s(r(0,m=me([l,_,i],([h,P,V])=>P.map(E=>({label:E.label,users:h.filter(b=>E.uuid===b.connection).map(b=>({uuid:b.uuid||"",email:b.email||"uuid:"+b.uuid,roles:b.roles.length===0?"none":b.roles.map(B=>{var J;return(J=V.find(ee=>ee.uuid===B))==null?void 0:J.name}).sort().join(", "),status:b.active?"Active":"Inactive"})).sort((b,B)=>b.status.localeCompare(B.status))})))))}return[m,a,M,q,L,h=>{const P=h==null?void 0:h.uuid;j(`/admin/users/${P}`)}]}class Ze extends F{constructor(e){super(),G(this,e,He,Oe,x,{})}}export{Ze as component};
