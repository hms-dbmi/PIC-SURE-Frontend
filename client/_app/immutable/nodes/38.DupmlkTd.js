import{c as R,a as e,t as D,f as T}from"../chunks/CtfeAAbw.js";import{o as yt,a as Pt}from"../chunks/DlIBaGjY.js";import{p as dt,b as nt,f as g,a as vt,n as z,t as M,g as t,s as H,c as S,r as k,e as J,d as ft,h as it,$ as Rt}from"../chunks/B4GrenNm.js";import{s as X,h as Ct}from"../chunks/DxSOTiY2.js";import{i as F}from"../chunks/CSsnQ7i2.js";import{p as qt,s as bt,a as Vt,c as mt}from"../chunks/DvPjbdiY.js";import{g as Ft}from"../chunks/BNhMDwfB.js";import{E as Z,s as st,b as St,f as kt}from"../chunks/CHRSknKA.js";import{c as $t,j as Tt,e as Lt,h as Ut,f as Nt,t as Gt}from"../chunks/BRrMSDP5.js";import{p as pt}from"../chunks/M_WnVc2Q.js";import{C as zt}from"../chunks/zKmJQbFp.js";import{E as K}from"../chunks/BVg5wqNm.js";import{a as at}from"../chunks/bf3FOAR_.js";import{e as gt,i as _t}from"../chunks/BdG0KSB2.js";import{c as xt}from"../chunks/10UUyb-S.js";import{T as ut}from"../chunks/DzMRxw8g.js";import{a as Et}from"../chunks/fGQBOZLe.js";import{L as ot}from"../chunks/DYQPks66.js";import{s as Ot,r as Qt}from"../chunks/BPiAbArq.js";import{d as Bt}from"../chunks/D7VV4X-8.js";import{a as Mt}from"../chunks/CJCVGGPV.js";import{S as jt}from"../chunks/DoWV-49m.js";function It(E){return E.query.expectedResultType="VARIANT_COUNT_FOR_QUERY",$t(Tt.QuerySync,E).then(o=>o.count)}function ct(E,o){return o.query.expectedResultType=E===Z.Aggregate?"AGGREGATE_VCF_EXCERPT":"VCF_EXCERPT",$t(Tt.QuerySync,o).then(L=>{const C=URL.createObjectURL(new Blob([L],{type:"octet/stream"})),q=L.split(`
`),a=q[0].split("	"),h=st.variantExplorer.excludeColumns.map(r=>a.indexOf(r)).filter(r=>r>=0),O=q.slice(1).map(r=>r.split("	")).filter(r=>r.length>1).map(r=>r.reduce((l,y,b)=>(h.includes(b)||(l[a[b].toString()]=y),l),{}));return{columns:a.filter((r,l)=>!h.includes(l)).map(r=>({dataElement:r,label:r,sort:!0,filter:!0})),rows:O,downloadUrl:C}})}function Xt(E,o,L){J(o,!t(o)),L()(t(o))}var Dt=T('<a data-testid="variant-download-btn" class="btn btn-sm preset-tonal-primary border border-primary-500" download="variantData.tsv"><i class="fa-solid fa-download"></i> </a>'),Kt=T('<div data-testid="variant-count" class="text-left w-full"> </div>'),Wt=T('<div><label class="flex items-center space-x-2"><input class="checkbox" type="checkbox"/> <p>Aggregate data</p></label></div>'),Yt=T("<!> <!> <!>",1),Ht=T('<div data-testid="variant-count" class="flex-none w-full"> </div>'),Jt=T('<div data-testid="variant-count" class="flex-none w-full"> </div>'),Zt=T("<!> <!>",1);function ht(E,o){dt(o,!0);let L=qt(o,"onAggregateToggle",3,()=>{}),C=nt(o.exportType===Z.Full);var q=R(),a=g(q);{var h=U=>{var O=R(),W=g(O);at(W,()=>o.data,r=>{var l=Zt(),y=g(l);{var b=s=>{var i=Jt(),V=S(i);k(i),M(j=>X(V,`${j??""} variants found`),[()=>o.count.toLocaleString()]),e(s,i)};F(y,s=>{o.count>0&&s(b)})}var n=H(y,2);ot(n,{ring:!0,size:"medium"}),e(r,l)},(r,l)=>{var y=R(),b=g(y);{var n=i=>{K(i,{color:"warning",children:(V,j)=>{z();var d=D();M(v=>X(d,`Too many variants! Found ${v??""}, but cannot display more than
        ${st.variantExplorer.maxCount??""} variants.`),[()=>o.count.toLocaleString()]),e(V,d)},$$slots:{default:!0}})},s=(i,V)=>{{var j=v=>{jt(v,{tableName:"variant-explorer",get data(){return t(l).rows},get columns(){return t(l).columns},fullWidth:!0,searchable:!0,tableActions:A=>{var c=Yt(),P=g(c);{var Q=m=>{var u=Dt(),$=H(S(u));k(u),M(()=>{Ot(u,"href",t(l).downloadUrl),X($,` Download Variant${t(C)?" (Aggregate)":""} Data`)}),e(m,u)};F(P,m=>{t(l).downloadUrl&&m(Q)})}var f=H(P,2);{var p=m=>{var u=Kt(),$=S(u);k(u),M(G=>X($,`${G??""} variants found`),[()=>o.count.toLocaleString()]),e(m,u)};F(f,m=>{o.count>0&&m(p)})}var N=H(f,2);{var _=m=>{var u=Wt(),$=S(u),G=S($);Qt(G),G.__click=[Xt,C,L],z(2),k($),k(u),Mt(G,()=>t(C),lt=>J(C,lt)),e(m,u)};F(N,m=>{st.variantExplorer.type===Z.Full&&m(_)})}e(A,c)},$$slots:{tableActions:!0}})},d=v=>{var w=Ht(),A=S(w);k(w),M(c=>X(A,`${c??""} variants found`),[()=>o.count.toLocaleString()]),e(v,w)};F(i,v=>{o.count>0&&t(l)&&t(l).rows.length>0?v(j):v(d,!1)},V)}};F(b,i=>{o.count>st.variantExplorer.maxCount?i(n):i(s,!1)})}e(r,y)},r=>{K(r,{title:"Error",children:(l,y)=>{z();var b=D("An error occured while retrieving variant list.");e(l,b)},$$slots:{default:!0}})}),e(U,O)};F(a,U=>{o.data&&U(h)})}e(E,q),vt()}Bt(["click"]);var te=T('<span class="text-xs ml-1"> </span>'),ee=T('<i class="fa-solid fa-triangle-exclamation text-error-500"></i> <span class="sr-only">Error</span>',1),re=T('<span class="float-right"><!></span>'),ae=T('<div class="flex items-center"><span class="font-bold"> </span> <!></div>');function oe(E,o){dt(o,!0);const[L,C]=bt(),q=()=>Vt(Nt,"$resourcesPromise",L);let a=nt(ft([])),h=nt(""),U=nt(ft(Promise.resolve()));async function O(){await q(),J(a,Ut().map(n=>{const s=Et(!0,n.uuid);return{name:n.name,exportType:Z.Aggregate,count:It(s),queryRequest:s}}),!0)}function W(n){J(h,n,!0);const s=t(a).find(i=>i.name===t(h));s&&!s.data&&(s.data=ct(s.exportType,s.queryRequest))}function r(n){const s=t(a)[n];return i=>{s.exportType=i?Z.Aggregate:Z.Full,s.data=ct(s.exportType,s.queryRequest)}}function l(n){const d=(v,w)=>v%w>0?(v/w).toFixed(1):Math.round(v/w);return n>=1e12?"~"+d(n,1e12)+"T":n>=1e9?"~"+d(n,1e9)+"B":n>=1e6?"~"+d(n,1e6)+"M":n>=1e3?"~"+d(n,1e3)+"K":n.toString()}yt(()=>{Lt(),J(U,O().then(()=>{J(h,t(a)[0].name,!0),t(a)[0].data=ct(t(a)[0].exportType,t(a)[0].queryRequest)}),!0)});var y=R(),b=g(y);at(b,()=>t(U),n=>{ot(n,{ring:!0,size:"medium"})},n=>{var s=R(),i=g(s);{var V=d=>{ut(d,{get value(){return t(h)},onValueChange:A=>W(A.value),list:A=>{var c=R(),P=g(c);gt(P,17,()=>t(a),_t,(Q,f)=>{let p=()=>t(f).name,N=()=>t(f).count;var _=R(),m=g(_);xt(m,()=>ut.Control,(u,$)=>{$(u,{get value(){return p()},children:(G,lt)=>{var Y=ae(),tt=S(Y),I=S(tt,!0);k(tt);var et=H(tt,2);at(et,N,B=>{var x=re(),rt=S(x);ot(rt,{ring:!0,size:"micro"}),k(x),e(B,x)},(B,x)=>{var rt=te(),wt=S(rt);k(rt),M(At=>X(wt,`(${At??""})`),[()=>l(t(x))]),e(B,rt)},B=>{var x=ee();z(2),e(B,x)}),k(Y),M(()=>X(I,p())),e(G,Y)},$$slots:{default:!0}})}),e(Q,_)}),e(A,c)},content:A=>{var c=R(),P=g(c);gt(P,17,()=>t(a),_t,(Q,f,p)=>{var N=R();const _=it(()=>{const{name:u,count:$}=t(f);return{name:u,count:$}});var m=g(N);xt(m,()=>ut.Panel,(u,$)=>{$(u,{get value(){return t(_).name},children:(G,lt)=>{var Y=R(),tt=g(Y);at(tt,()=>t(_).count,I=>{ot(I,{ring:!0,size:"medium"})},(I,et)=>{const B=it(()=>r(p));ht(I,{get count(){return t(et)},get onAggregateToggle(){return t(B)},get data(){return t(a)[p].data},set data(x){t(a)[p].data=x},get exportType(){return t(a)[p].exportType},set exportType(x){t(a)[p].exportType=x}})},I=>{K(I,{title:"Error",children:(et,B)=>{z();var x=D("An error occured while loading counts and variant data.");e(et,x)},$$slots:{default:!0}})}),e(G,Y)},$$slots:{default:!0}})}),e(Q,N)}),e(A,c)},$$slots:{list:!0,content:!0}})},j=(d,v)=>{{var w=c=>{var P=R(),Q=g(P);at(Q,()=>t(a)[0].count,f=>{ot(f,{ring:!0,size:"medium"})},(f,p)=>{const N=it(()=>r(0));ht(f,{get count(){return t(p)},get onAggregateToggle(){return t(N)},get data(){return t(a)[0].data},set data(_){t(a)[0].data=_},get exportType(){return t(a)[0].exportType},set exportType(_){t(a)[0].exportType=_}})},f=>{K(f,{title:"Error",children:(p,N)=>{z();var _=D("An error occured while loading counts and variant data.");e(p,_)},$$slots:{default:!0}})}),e(c,P)},A=c=>{K(c,{title:"Error",children:(P,Q)=>{z();var f=D("No resources were found to query for variant data.");e(P,f)},$$slots:{default:!0}})};F(d,c=>{t(a).length===1?c(w):c(A,!1)},v)}};F(i,d=>{t(a).length>1?d(V):d(j,!1)})}e(n,s)},n=>{K(n,{title:"Error",children:(s,i)=>{z();var V=D("An error occured while loading resource list.");e(s,V)},$$slots:{default:!0}})}),e(E,y),vt(),C()}var ne=T('<h2 class="text-center clear-both">Variant Explorer</h2> <!>',1);function Re(E,o){dt(o,!0);const[L,C]=bt();yt(()=>{Et(!0).query.hasGenomicFilter()?mt(pt,!1):(Gt.error({title:"No query provided. Please add a genomic filter to explore variant data."}),Ft("/explorer"))}),Pt(()=>mt(pt,!0)),Ct(q=>{M(()=>Rt.title=`${St.applicationName??""} | Variant Explorer`)}),zt(E,{full:!0,backUrl:"/explorer",backTitle:"Back to Explore",children:(q,a)=>{var h=ne(),U=H(g(h),2);{var O=r=>{oe(r,{})},W=r=>{K(r,{title:"Error",children:(l,y)=>{z();var b=D(`Variant explorer feature has not been enabled in this environment. Please contact an admin if
      you have any questions.`);e(l,b)},$$slots:{default:!0}})};F(U,r=>{kt.explorer.variantExplorer?r(O):r(W,!1)})}e(q,h)},$$slots:{default:!0}}),vt(),C()}export{Re as component};
