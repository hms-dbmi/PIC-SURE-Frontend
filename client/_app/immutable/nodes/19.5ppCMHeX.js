import{s as O,q as w,i as m,n as y,f,e as b,c as h,b as g,m as d,h as A,v as H,a3 as M,a as U,g as S,y as Y,t as Z,d as ee,j as te,p as ae,a8 as se,l as q,x as le}from"../chunks/CseAM1pm.js";import{h as re,u as ne}from"../chunks/CndaLTDj.js";import{e as G}from"../chunks/Ba1MNdbe.js";import{S as L,i as j,d as P,e as R,m as B,t as v,a as C,f as N,g as oe,b as ie}from"../chunks/CUD_i9MT.js";import{g as Q,r as ce,d as ue}from"../chunks/Dx2jxSvH.js";import"../chunks/Cd9QPAjN.js";import{P as de}from"../chunks/COOwqBnE.js";import{b as fe}from"../chunks/DOzTaxCY.js";import{E as me}from"../chunks/DATm8Xn3.js";import{C as pe}from"../chunks/BF6l3jvP.js";import{T as _e}from"../chunks/BDw-puhd.js";import{g as be}from"../chunks/DBO1dhJT.js";import{g as he}from"../chunks/xidBtgCA.js";import{b as $e,u as ge,U as ve}from"../chunks/CA0uc3Kj.js";import{g as ke,C as ye}from"../chunks/6olxXDPS.js";import{g as Ce,R as we}from"../chunks/CsSNk8K0.js";import{g as Ee}from"../chunks/DRAZuV9j.js";function Ae(o){let e,r,s,t,a;return{c(){e=b("button"),r=b("i"),this.h()},l(l){e=h(l,"BUTTON",{"data-testid":!0,type:!0,title:!0,"aria-label":!0,class:!0});var n=g(e);r=h(n,"I",{class:!0}),g(r).forEach(f),n.forEach(f),this.h()},h(){d(r,"class","fa-solid fa-trash-arrow-up fa-xl"),d(e,"data-testid",s=`user-activate-btn-${o[0].cell}`),d(e,"type","button"),d(e,"title","Reactivate user"),d(e,"aria-label","Reactivate user"),d(e,"class","btn-icon-color")},m(l,n){m(l,e,n),A(e,r),t||(a=H(e,"click",M(o[4])),t=!0)},p(l,n){n&1&&s!==(s=`user-activate-btn-${l[0].cell}`)&&d(e,"data-testid",s)},d(l){l&&f(e),t=!1,a()}}}function Ue(o){let e,r,s,t,a,l,n,p,u;return{c(){e=b("button"),r=b("i"),t=U(),a=b("button"),l=b("i"),this.h()},l(i){e=h(i,"BUTTON",{"data-testid":!0,type:!0,title:!0,"aria-label":!0,class:!0});var c=g(e);r=h(c,"I",{class:!0}),g(r).forEach(f),c.forEach(f),t=S(i),a=h(i,"BUTTON",{"data-testid":!0,type:!0,title:!0,"aria-label":!0,class:!0});var _=g(a);l=h(_,"I",{class:!0}),g(l).forEach(f),_.forEach(f),this.h()},h(){d(r,"class","fa-solid fa-pen-to-square fa-xl"),d(e,"data-testid",s=`user-edit-btn-${o[0].cell}`),d(e,"type","button"),d(e,"title","Edit"),d(e,"aria-label","Edit"),d(e,"class","btn-icon-color"),d(l,"class","fa-solid fa-trash fa-xl"),d(a,"data-testid",n=`user-deactivate-btn-${o[0].cell}`),d(a,"type","button"),d(a,"title","Deactivate user"),d(a,"aria-label","Deactivate user"),d(a,"class","btn-icon-color")},m(i,c){m(i,e,c),A(e,r),m(i,t,c),m(i,a,c),A(a,l),p||(u=[H(e,"click",M(o[2])),H(a,"click",M(o[3]))],p=!0)},p(i,c){c&1&&s!==(s=`user-edit-btn-${i[0].cell}`)&&d(e,"data-testid",s),c&1&&n!==(n=`user-deactivate-btn-${i[0].cell}`)&&d(a,"data-testid",n)},d(i){i&&(f(e),f(t),f(a)),p=!1,Y(u)}}}function Se(o){let e;function r(a,l){return a[0].row.status==="Active"?Ue:Ae}let s=r(o),t=s(o);return{c(){t.c(),e=w()},l(a){t.l(a),e=w()},m(a,l){t.m(a,l),m(a,e,l)},p(a,[l]){s===(s=r(a))&&t?t.p(a,l):(t.d(1),t=s(a),t&&(t.c(),t.m(e.parentNode,e)))},i:y,o:y,d(a){a&&f(e),t.d(a)}}}function Te(o,e,r){const s=be(),t=he();let{data:a={cell:"",row:{status:"",email:""}}}=e;async function l(i){const c=await $e(a.cell);s.trigger({type:"confirm",title:`${i?"R":"D"}eactivate User?`,body:`Are you sure you want to ${i?"r":"d"}eactiveate user '${c.email}'?`,buttonTextConfirm:i?"Reactivate":"Deactivate",response:async _=>{if(!_)return;let I={...c,active:i,connection:await ke(c.connection),roles:await Promise.all(c.roles.map(E=>Ce(E).then(T=>({...T,privileges:T.privileges.map(V=>Ee(V))}))))};try{await ge(I),t.trigger({message:`Successfully ${i?"r":"d"}eactivated user '${c.email}'`,background:"variant-filled-success"})}catch(E){console.error(E),t.trigger({message:`An error occured while ${i?"r":"d"}eactivating user '${c.email}'`,background:"variant-filled-error"})}}})}const n=()=>Q(`/admin/users/${a.cell}/edit`),p=()=>l(!1),u=()=>l(!0);return o.$$set=i=>{"data"in i&&r(0,a=i.data)},[a,l,n,p,u]}class Pe extends L{constructor(e){super(),j(this,e,Te,Se,O,{data:0})}}function Re(o){let e,r=o[0].cell+"",s,t;return{c(){e=b("span"),s=Z(r),this.h()},l(a){e=h(a,"SPAN",{class:!0});var l=g(e);s=ee(l,r),l.forEach(f),this.h()},h(){d(e,"class",t=`badge last:p-1 rounded variant-filled-${o[0].cell==="Active"?"success":"error"}`)},m(a,l){m(a,e,l),A(e,s)},p(a,[l]){l&1&&r!==(r=a[0].cell+"")&&te(s,r),l&1&&t!==(t=`badge last:p-1 rounded variant-filled-${a[0].cell==="Active"?"success":"error"}`)&&d(e,"class",t)},i:y,o:y,d(a){a&&f(e)}}}function Be(o,e,r){let{data:s={cell:"",row:{}}}=e;return o.$$set=t=>{"data"in t&&r(0,s=t.data)},[s]}class Ne extends L{constructor(e){super(),j(this,e,Be,Re,O,{data:0})}}function J(o,e,r){const s=o.slice();return s[12]=e[r],s}function Ie(o){let e,r;return e=new me({props:{title:"API Error",$$slots:{default:[xe]},$$scope:{ctx:o}}}),{c(){P(e.$$.fragment)},l(s){R(e.$$.fragment,s)},m(s,t){B(e,s,t),r=!0},p(s,t){const a={};t&32768&&(a.$$scope={dirty:t,ctx:s}),e.$set(a)},i(s){r||(v(e.$$.fragment,s),r=!0)},o(s){C(e.$$.fragment,s),r=!1},d(s){N(e,s)}}}function xe(o){let e,r="Something went wrong when sending your request.";return{c(){e=b("p"),e.textContent=r},l(s){e=h(s,"P",{"data-svelte-h":!0}),q(e)!=="svelte-n1xg7v"&&(e.textContent=r)},m(s,t){m(s,e,t)},p:y,d(s){s&&f(e)}}}function De(o){let e,r='<div class="flex-auto"><a data-testid="add-user-btn" class="btn variant-ghost-primary hover:variant-filled-primary" href="/admin/users/new">+ Add User</a></div>',s,t,a,l=G(o[1]),n=[];for(let u=0;u<l.length;u+=1)n[u]=K(J(o,l,u));const p=u=>C(n[u],1,1,()=>{n[u]=null});return{c(){e=b("div"),e.innerHTML=r,s=U();for(let u=0;u<n.length;u+=1)n[u].c();t=w(),this.h()},l(u){e=h(u,"DIV",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-3ryyp1"&&(e.innerHTML=r),s=S(u);for(let i=0;i<n.length;i+=1)n[i].l(u);t=w(),this.h()},h(){d(e,"class","flex gap-4 mb-6")},m(u,i){m(u,e,i),m(u,s,i);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(u,i);m(u,t,i),a=!0},p(u,i){if(i&46){l=G(u[1]);let c;for(c=0;c<l.length;c+=1){const _=J(u,l,c);n[c]?(n[c].p(_,i),v(n[c],1)):(n[c]=K(_),n[c].c(),v(n[c],1),n[c].m(t.parentNode,t))}for(oe(),c=l.length;c<n.length;c+=1)p(c);ie()}},i(u){if(!a){for(let i=0;i<l.length;i+=1)v(n[i]);a=!0}},o(u){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)C(n[i]);a=!1},d(u){u&&(f(e),f(s),f(t)),le(n,u)}}}function K(o){let e,r,s,t,a;return r=new _e({props:{tableName:"Users",data:o[12].users,columns:o[2],cellOverides:o[3],search:!0,defaultRowsPerPage:10,title:o[12].label,rowClickHandler:o[5],isClickable:!0,tableAuto:!1}}),{c(){e=b("div"),P(r.$$.fragment),s=U(),this.h()},l(l){e=h(l,"DIV",{id:!0,class:!0});var n=g(e);R(r.$$.fragment,n),s=S(n),n.forEach(f),this.h()},h(){d(e,"id",t=`user-table-${o[12].label.replaceAll(" ","_")}`),d(e,"class","mb-10")},m(l,n){m(l,e,n),B(r,e,null),A(e,s),a=!0},p(l,n){const p={};n&2&&(p.data=l[12].users),n&2&&(p.title=l[12].label),r.$set(p),(!a||n&2&&t!==(t=`user-table-${l[12].label.replaceAll(" ","_")}`))&&d(e,"id",t)},i(l){a||(v(r.$$.fragment,l),a=!0)},o(l){C(r.$$.fragment,l),a=!1},d(l){l&&f(e),N(r)}}}function He(o){let e,r="Loading",s,t,a;return t=new de({props:{animIndeterminate:"anim-progress-bar"}}),{c(){e=b("h3"),e.textContent=r,s=U(),P(t.$$.fragment),this.h()},l(l){e=h(l,"H3",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-16fo5h6"&&(e.textContent=r),s=S(l),R(t.$$.fragment,l),this.h()},h(){d(e,"class","text-left")},m(l,n){m(l,e,n),m(l,s,n),B(t,l,n),a=!0},p:y,i(l){a||(v(t.$$.fragment,l),a=!0)},o(l){C(t.$$.fragment,l),a=!1},d(l){l&&(f(e),f(s)),N(t,l)}}}function Me(o){let e,r,s={ctx:o,current:null,token:null,hasCatch:!0,pending:He,then:De,catch:Ie,blocks:[,,,]};return re(o[4](),s),{c(){e=w(),s.block.c()},l(t){e=w(),s.block.l(t)},m(t,a){m(t,e,a),s.block.m(t,s.anchor=a),s.mount=()=>e.parentNode,s.anchor=e,r=!0},p(t,a){o=t,ne(s,o,a)},i(t){r||(v(s.block),r=!0)},o(t){for(let a=0;a<3;a+=1){const l=s.blocks[a];C(l)}r=!1},d(t){t&&f(e),s.block.d(t),s.token=null,s=null}}}function Oe(o){let e,r,s;return document.title=fe.applicationName+" | Manage Users",r=new pe({props:{title:"Manage Users",$$slots:{default:[Me]},$$scope:{ctx:o}}}),{c(){e=U(),P(r.$$.fragment)},l(t){ae("svelte-zefh4i",document.head).forEach(f),e=S(t),R(r.$$.fragment,t)},m(t,a){m(t,e,a),B(r,t,a),s=!0},p(t,[a]){const l={};a&32770&&(l.$$scope={dirty:a,ctx:t}),r.$set(l)},i(t){s||(v(r.$$.fragment,t),s=!0)},o(t){C(r.$$.fragment,t),s=!1},d(t){t&&f(e),N(r,t)}}}function qe(o,e,r){let s,t=y,a=()=>(t(),t=se(_,k=>r(1,s=k)),_);o.$$.on_destroy.push(()=>t());let{users:l,loadUsers:n}=ve,{connections:p,loadConnections:u}=ye,{roles:i,loadRoles:c}=we,_=ce([]);a();const I=[{dataElement:"email",label:"Username",sort:!0,class:"w-1/3"},{dataElement:"roles",label:"Role(s)",sort:!0,class:"!normal-case"},{dataElement:"status",label:"Status",sort:!0,class:"w-24 text-center"},{dataElement:"uuid",label:"Actions",sort:!1,class:"w-24 text-center"}],E={status:Ne,uuid:Pe};async function T(){await u(),await c(),await n(),a(r(0,_=ue([l,p,i],([k,x,W])=>x.map(z=>({label:z.label,users:k.filter($=>z.uuid===$.connection).map($=>({uuid:$.uuid||"",email:$.email||"uuid:"+$.uuid,roles:$.roles.length===0?"none":$.roles.map(D=>{var F;return(F=W.find(X=>X.uuid===D))==null?void 0:F.name}).sort().join(", "),status:$.active?"Active":"Inactive"})).sort(($,D)=>$.status.localeCompare(D.status))})))))}return[_,s,I,E,T,k=>{const x=k==null?void 0:k.uuid;Q(`/admin/users/${x}/edit`)}]}class lt extends L{constructor(e){super(),j(this,e,qe,Oe,O,{})}}export{lt as component};
