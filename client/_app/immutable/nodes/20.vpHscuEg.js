import{s as O,x as w,i as m,n as y,f,e as b,c as h,b as g,r as d,h as A,z as H,a5 as M,a as U,g as S,C as Y,t as Z,d as ee,j as te,w as ae,a9 as se,q,B as re}from"../chunks/CDvIr29H.js";import{h as le,u as ne}from"../chunks/BJ-g7xSB.js";import{e as G}from"../chunks/mmDljT_r.js";import{S as L,i as j,d as B,e as P,m as R,t as v,a as C,f as N,g as oe,b as ie}from"../chunks/ByE-_V18.js";import{g as Q,r as ce,d as ue}from"../chunks/ClzUMQ0P.js";import"../chunks/4MwYNI-R.js";import{P as de}from"../chunks/BaEqrwl9.js";import{b as fe}from"../chunks/Di2X-GR-.js";import{E as me}from"../chunks/CjJvbZ1d.js";import{C as pe}from"../chunks/BXrAqdrM.js";import{T as _e}from"../chunks/BiPL43FU.js";import{g as be}from"../chunks/DYMkpHtv.js";import{g as he}from"../chunks/BpCLhCzN.js";import{b as $e,u as ge,U as ve}from"../chunks/Gsk-f-oD.js";import{g as ke,C as ye}from"../chunks/C_QDulIY.js";import{g as Ce,R as we}from"../chunks/DKpYsXv-.js";import{g as Ee}from"../chunks/66EJst6g.js";function Ae(o){let e,l,s,t,a;return{c(){e=b("button"),l=b("i"),this.h()},l(r){e=h(r,"BUTTON",{"data-testid":!0,type:!0,title:!0,"aria-label":!0,class:!0});var n=g(e);l=h(n,"I",{class:!0}),g(l).forEach(f),n.forEach(f),this.h()},h(){d(l,"class","fa-solid fa-trash-arrow-up fa-xl"),d(e,"data-testid",s=`user-activate-btn-${o[0].cell}`),d(e,"type","button"),d(e,"title","Reactivate user"),d(e,"aria-label","Reactivate user"),d(e,"class","btn-icon-color")},m(r,n){m(r,e,n),A(e,l),t||(a=H(e,"click",M(o[4])),t=!0)},p(r,n){n&1&&s!==(s=`user-activate-btn-${r[0].cell}`)&&d(e,"data-testid",s)},d(r){r&&f(e),t=!1,a()}}}function Ue(o){let e,l,s,t,a,r,n,p,u;return{c(){e=b("button"),l=b("i"),t=U(),a=b("button"),r=b("i"),this.h()},l(i){e=h(i,"BUTTON",{"data-testid":!0,type:!0,title:!0,"aria-label":!0,class:!0});var c=g(e);l=h(c,"I",{class:!0}),g(l).forEach(f),c.forEach(f),t=S(i),a=h(i,"BUTTON",{"data-testid":!0,type:!0,title:!0,"aria-label":!0,class:!0});var _=g(a);r=h(_,"I",{class:!0}),g(r).forEach(f),_.forEach(f),this.h()},h(){d(l,"class","fa-solid fa-pen-to-square fa-xl"),d(e,"data-testid",s=`user-edit-btn-${o[0].cell}`),d(e,"type","button"),d(e,"title","Edit"),d(e,"aria-label","Edit"),d(e,"class","btn-icon-color"),d(r,"class","fa-solid fa-trash fa-xl"),d(a,"data-testid",n=`user-deactivate-btn-${o[0].cell}`),d(a,"type","button"),d(a,"title","Deactivate user"),d(a,"aria-label","Deactivate user"),d(a,"class","btn-icon-color")},m(i,c){m(i,e,c),A(e,l),m(i,t,c),m(i,a,c),A(a,r),p||(u=[H(e,"click",M(o[2])),H(a,"click",M(o[3]))],p=!0)},p(i,c){c&1&&s!==(s=`user-edit-btn-${i[0].cell}`)&&d(e,"data-testid",s),c&1&&n!==(n=`user-deactivate-btn-${i[0].cell}`)&&d(a,"data-testid",n)},d(i){i&&(f(e),f(t),f(a)),p=!1,Y(u)}}}function Se(o){let e;function l(a,r){return a[0].row.status==="Active"?Ue:Ae}let s=l(o),t=s(o);return{c(){t.c(),e=w()},l(a){t.l(a),e=w()},m(a,r){t.m(a,r),m(a,e,r)},p(a,[r]){s===(s=l(a))&&t?t.p(a,r):(t.d(1),t=s(a),t&&(t.c(),t.m(e.parentNode,e)))},i:y,o:y,d(a){a&&f(e),t.d(a)}}}function Te(o,e,l){const s=be(),t=he();let{data:a={cell:"",row:{status:"",email:""}}}=e;async function r(i){const c=await $e(a.cell);s.trigger({type:"confirm",title:`${i?"R":"D"}eactivate User?`,body:`Are you sure you want to ${i?"r":"d"}eactiveate user '${c.email}'?`,buttonTextConfirm:i?"Reactivate":"Deactivate",response:async _=>{if(!_)return;let I={...c,active:i,connection:await ke(c.connection),roles:await Promise.all(c.roles.map(E=>Ce(E).then(T=>({...T,privileges:T.privileges.map(z=>Ee(z))}))))};try{await ge(I),t.trigger({message:`Successfully ${i?"r":"d"}eactivated user '${c.email}'`,background:"variant-filled-success"})}catch(E){console.error(E),t.trigger({message:`An error occured while ${i?"r":"d"}eactivating user '${c.email}'`,background:"variant-filled-error"})}}})}const n=()=>Q(`/admin/users/${a.cell}/edit`),p=()=>r(!1),u=()=>r(!0);return o.$$set=i=>{"data"in i&&l(0,a=i.data)},[a,r,n,p,u]}class Be extends L{constructor(e){super(),j(this,e,Te,Se,O,{data:0})}}function Pe(o){let e,l=o[0].cell+"",s,t;return{c(){e=b("span"),s=Z(l),this.h()},l(a){e=h(a,"SPAN",{class:!0});var r=g(e);s=ee(r,l),r.forEach(f),this.h()},h(){d(e,"class",t=`badge last:p-1 rounded variant-filled-${o[0].cell==="Active"?"success":"error"}`)},m(a,r){m(a,e,r),A(e,s)},p(a,[r]){r&1&&l!==(l=a[0].cell+"")&&te(s,l),r&1&&t!==(t=`badge last:p-1 rounded variant-filled-${a[0].cell==="Active"?"success":"error"}`)&&d(e,"class",t)},i:y,o:y,d(a){a&&f(e)}}}function Re(o,e,l){let{data:s={cell:"",row:{}}}=e;return o.$$set=t=>{"data"in t&&l(0,s=t.data)},[s]}class Ne extends L{constructor(e){super(),j(this,e,Re,Pe,O,{data:0})}}function J(o,e,l){const s=o.slice();return s[12]=e[l],s}function Ie(o){let e,l;return e=new me({props:{title:"API Error",$$slots:{default:[xe]},$$scope:{ctx:o}}}),{c(){B(e.$$.fragment)},l(s){P(e.$$.fragment,s)},m(s,t){R(e,s,t),l=!0},p(s,t){const a={};t&32768&&(a.$$scope={dirty:t,ctx:s}),e.$set(a)},i(s){l||(v(e.$$.fragment,s),l=!0)},o(s){C(e.$$.fragment,s),l=!1},d(s){N(e,s)}}}function xe(o){let e,l="Something went wrong when sending your request.";return{c(){e=b("p"),e.textContent=l},l(s){e=h(s,"P",{"data-svelte-h":!0}),q(e)!=="svelte-n1xg7v"&&(e.textContent=l)},m(s,t){m(s,e,t)},p:y,d(s){s&&f(e)}}}function De(o){let e,l='<div class="flex-auto"><a data-testid="add-user-btn" class="btn variant-ghost-primary hover:variant-filled-primary" href="/admin/users/new">+ Add User</a></div>',s,t,a,r=G(o[1]),n=[];for(let u=0;u<r.length;u+=1)n[u]=K(J(o,r,u));const p=u=>C(n[u],1,1,()=>{n[u]=null});return{c(){e=b("div"),e.innerHTML=l,s=U();for(let u=0;u<n.length;u+=1)n[u].c();t=w(),this.h()},l(u){e=h(u,"DIV",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-3ryyp1"&&(e.innerHTML=l),s=S(u);for(let i=0;i<n.length;i+=1)n[i].l(u);t=w(),this.h()},h(){d(e,"class","flex gap-4 mb-6")},m(u,i){m(u,e,i),m(u,s,i);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(u,i);m(u,t,i),a=!0},p(u,i){if(i&46){r=G(u[1]);let c;for(c=0;c<r.length;c+=1){const _=J(u,r,c);n[c]?(n[c].p(_,i),v(n[c],1)):(n[c]=K(_),n[c].c(),v(n[c],1),n[c].m(t.parentNode,t))}for(oe(),c=r.length;c<n.length;c+=1)p(c);ie()}},i(u){if(!a){for(let i=0;i<r.length;i+=1)v(n[i]);a=!0}},o(u){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)C(n[i]);a=!1},d(u){u&&(f(e),f(s),f(t)),re(n,u)}}}function K(o){let e,l,s,t,a;return l=new _e({props:{tableName:"Users",data:o[12].users,columns:o[2],cellOverides:o[3],search:!0,defaultRowsPerPage:10,title:o[12].label,rowClickHandler:o[5],isClickable:!0,tableAuto:!1}}),{c(){e=b("div"),B(l.$$.fragment),s=U(),this.h()},l(r){e=h(r,"DIV",{id:!0,class:!0});var n=g(e);P(l.$$.fragment,n),s=S(n),n.forEach(f),this.h()},h(){d(e,"id",t=`user-table-${o[12].label.replaceAll(" ","_")}`),d(e,"class","mb-10")},m(r,n){m(r,e,n),R(l,e,null),A(e,s),a=!0},p(r,n){const p={};n&2&&(p.data=r[12].users),n&2&&(p.title=r[12].label),l.$set(p),(!a||n&2&&t!==(t=`user-table-${r[12].label.replaceAll(" ","_")}`))&&d(e,"id",t)},i(r){a||(v(l.$$.fragment,r),a=!0)},o(r){C(l.$$.fragment,r),a=!1},d(r){r&&f(e),N(l)}}}function He(o){let e,l="Loading",s,t,a;return t=new de({props:{animIndeterminate:"anim-progress-bar"}}),{c(){e=b("h3"),e.textContent=l,s=U(),B(t.$$.fragment),this.h()},l(r){e=h(r,"H3",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-16fo5h6"&&(e.textContent=l),s=S(r),P(t.$$.fragment,r),this.h()},h(){d(e,"class","text-left")},m(r,n){m(r,e,n),m(r,s,n),R(t,r,n),a=!0},p:y,i(r){a||(v(t.$$.fragment,r),a=!0)},o(r){C(t.$$.fragment,r),a=!1},d(r){r&&(f(e),f(s)),N(t,r)}}}function Me(o){let e,l,s={ctx:o,current:null,token:null,hasCatch:!0,pending:He,then:De,catch:Ie,blocks:[,,,]};return le(o[4](),s),{c(){e=w(),s.block.c()},l(t){e=w(),s.block.l(t)},m(t,a){m(t,e,a),s.block.m(t,s.anchor=a),s.mount=()=>e.parentNode,s.anchor=e,l=!0},p(t,a){o=t,ne(s,o,a)},i(t){l||(v(s.block),l=!0)},o(t){for(let a=0;a<3;a+=1){const r=s.blocks[a];C(r)}l=!1},d(t){t&&f(e),s.block.d(t),s.token=null,s=null}}}function Oe(o){let e,l,s;return document.title=fe.applicationName+" | Manage Users",l=new pe({props:{title:"Manage Users",$$slots:{default:[Me]},$$scope:{ctx:o}}}),{c(){e=U(),B(l.$$.fragment)},l(t){ae("svelte-zefh4i",document.head).forEach(f),e=S(t),P(l.$$.fragment,t)},m(t,a){m(t,e,a),R(l,t,a),s=!0},p(t,[a]){const r={};a&32770&&(r.$$scope={dirty:a,ctx:t}),l.$set(r)},i(t){s||(v(l.$$.fragment,t),s=!0)},o(t){C(l.$$.fragment,t),s=!1},d(t){t&&f(e),N(l,t)}}}function qe(o,e,l){let s,t=y,a=()=>(t(),t=se(_,k=>l(1,s=k)),_);o.$$.on_destroy.push(()=>t());let{users:r,loadUsers:n}=ve,{connections:p,loadConnections:u}=ye,{roles:i,loadRoles:c}=we,_=ce([]);a();const I=[{dataElement:"email",label:"Username",sort:!0,class:"w-1/3"},{dataElement:"roles",label:"Role(s)",sort:!0,class:"!normal-case"},{dataElement:"status",label:"Status",sort:!0,class:"w-24 text-center"},{dataElement:"uuid",label:"Actions",sort:!1,class:"w-24 text-center"}],E={status:Ne,uuid:Be};async function T(){await u(),await c(),await n(),a(l(0,_=ue([r,p,i],([k,x,W])=>x.map(V=>({label:V.label,users:k.filter($=>V.uuid===$.connection).map($=>({uuid:$.uuid||"",email:$.email||"uuid:"+$.uuid,roles:$.roles.length===0?"none":$.roles.map(D=>{var F;return(F=W.find(X=>X.uuid===D))==null?void 0:F.name}).sort().join(", "),status:$.active?"Active":"Inactive"})).sort(($,D)=>$.status.localeCompare(D.status))})))))}return[_,s,I,E,T,k=>{const x=k==null?void 0:k.uuid;Q(`/admin/users/${x}/edit`)}]}class rt extends L{constructor(e){super(),j(this,e,qe,Oe,O,{})}}export{rt as component};
