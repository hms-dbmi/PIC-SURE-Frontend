import{l as le,s as ne,a as C,w as oe,f as u,g as x,i as p,k as B,v as se,a8 as ie,e as m,t as b,c as h,b as g,d as k,r as v,h as f,j as I,x as T,q,n as U,z as H,C as ce}from"../chunks/CDvIr29H.js";import{h as Q,u as ue}from"../chunks/BJ-g7xSB.js";import{S as fe,i as de,d as F,e as S,m as L,t as y,a as w,f as j,g as pe,b as _e}from"../chunks/ByE-_V18.js";import{g as me}from"../chunks/BpCLhCzN.js";import"../chunks/4MwYNI-R.js";import{P as he}from"../chunks/BaEqrwl9.js";import{w as N,g as ve}from"../chunks/ClzUMQ0P.js";import{E as P,s as V,b as be,f as ge}from"../chunks/Di2X-GR-.js";import{C as ke}from"../chunks/BXrAqdrM.js";import{E as W}from"../chunks/CjJvbZ1d.js";import{T as $e}from"../chunks/BiPL43FU.js";import{p as J}from"../chunks/BEf3cR2P.js";import{g as Ee}from"../chunks/DMy9hZg4.js";const K="/picsure/query/sync",Z=N(0),ee=N([]),te=N([]),re=N(""),ae=N(P.Aggregate),O=N("");async function Ce(i){i.query.expectedResultType="VARIANT_COUNT_FOR_QUERY";const e=await J(K,i).then(r=>r.count).catch(r=>(console.error(r),O.set("An error occured while retrieving variant count data. Please contact your PIC-SURE admin."),0));Z.set(e)}async function X(i){i.query.expectedResultType=le(ae)===P.Aggregate?"AGGREGATE_VCF_EXCERPT":"VCF_EXCERPT";const e=await J(K,i).catch(n=>(console.error(n),O.set("An error occured while retrieving variant data. Please contact your PIC-SURE admin."),""));if(!e)return;re.set(URL.createObjectURL(new Blob([e],{type:"octet/stream"})));const r=e.split(`
`),t=r[0].split("	"),l=r.slice(1).map(n=>n.split("	")).filter(n=>n.length>1),a=V.variantExplorer.excludeColumns.map(n=>t.indexOf(n)).filter(n=>n>=0);te.set(l.map(n=>n.reduce((s,o,c)=>(a.includes(c)||(s[t[c].toString()]=o),s),{}))),ee.set(t.filter((n,s)=>!a.includes(s)).map(n=>({dataElement:n,label:n,sort:!0})))}function Y(i){let e,r,t,l=i[1]?" (Aggregate)":"",a,n;return{c(){e=m("div"),r=m("a"),t=b("Download Variant"),a=b(l),n=b(" Data"),this.h()},l(s){e=h(s,"DIV",{});var o=g(e);r=h(o,"A",{"data-testid":!0,class:!0,href:!0,download:!0});var c=g(r);t=k(c,"Download Variant"),a=k(c,l),n=k(c," Data"),c.forEach(u),o.forEach(u),this.h()},h(){v(r,"data-testid","variant-download-btn"),v(r,"class","btn variant-ghost-primary mt-8 mr-6 float-right"),v(r,"href",i[3]),v(r,"download","variantData.tsv")},m(s,o){p(s,e,o),f(e,r),f(r,t),f(r,a),f(r,n)},p(s,o){o&2&&l!==(l=s[1]?" (Aggregate)":"")&&I(a,l),o&8&&v(r,"href",s[3])},d(s){s&&u(e)}}}function xe(i){let e,r="Variant Explorer",t,l,a;return l=new W({props:{title:"Error",$$slots:{default:[we]},$$scope:{ctx:i}}}),{c(){e=m("h3"),e.textContent=r,t=C(),F(l.$$.fragment)},l(n){e=h(n,"H3",{"data-svelte-h":!0}),q(e)!=="svelte-10ts0do"&&(e.textContent=r),t=x(n),S(l.$$.fragment,n)},m(n,s){p(n,e,s),p(n,t,s),L(l,n,s),a=!0},p(n,s){const o={};s&8192&&(o.$$scope={dirty:s,ctx:n}),l.$set(o)},i(n){a||(y(l.$$.fragment,n),a=!0)},o(n){w(l.$$.fragment,n),a=!1},d(n){n&&(u(e),u(t)),j(l,n)}}}function ye(i){let e,r="Variant Explorer",t,l,a,n,s={ctx:i,current:null,token:null,hasCatch:!0,pending:Ue,then:Ve,catch:Ae,error:12,blocks:[,,,]};return Q(a=i[0],s),{c(){e=m("h2"),e.textContent=r,t=C(),l=T(),s.block.c(),this.h()},l(o){e=h(o,"H2",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-n8q177"&&(e.textContent=r),t=x(o),l=T(),s.block.l(o),this.h()},h(){v(e,"class","text-center clear-both")},m(o,c){p(o,e,c),p(o,t,c),p(o,l,c),s.block.m(o,s.anchor=c),s.mount=()=>l.parentNode,s.anchor=l,n=!0},p(o,c){i=o,s.ctx=i,c&1&&a!==(a=i[0])&&Q(a,s)||ue(s,i,c)},i(o){n||(y(s.block),n=!0)},o(o){for(let c=0;c<3;c+=1){const d=s.blocks[c];w(d)}n=!1},d(o){o&&(u(e),u(t),u(l)),s.block.d(o),s.token=null,s=null}}}function we(i){let e,r=`Variant explorer feature has not been enabled in this environment. Please contact an admin
        if you have any questions.`;return{c(){e=m("p"),e.textContent=r},l(t){e=h(t,"P",{"data-svelte-h":!0}),q(e)!=="svelte-okrpxb"&&(e.textContent=r)},m(t,l){p(t,e,l)},p:U,d(t){t&&u(e)}}}function Ae(i){let e,r;return e=new W({props:{title:"Error",$$slots:{default:[Pe]},$$scope:{ctx:i}}}),{c(){F(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,l){L(e,t,l),r=!0},p(t,l){const a={};l&8193&&(a.$$scope={dirty:l,ctx:t}),e.$set(a)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Pe(i){let e,r=(i[12]||"An error occured while retrieving variant list.")+"",t;return{c(){e=m("p"),t=b(r)},l(l){e=h(l,"P",{});var a=g(e);t=k(a,r),a.forEach(u)},m(l,a){p(l,e,a),f(e,t)},p(l,a){a&1&&r!==(r=(l[12]||"An error occured while retrieving variant list.")+"")&&I(t,r)},d(l){l&&u(e)}}}function Ve(i){let e,r,t,l;const a=[Te,Re,De],n=[];function s(o,c){return o[2]>V.variantExplorer.maxCount?0:o[2]>0&&o[4].length>0?1:2}return e=s(i),r=n[e]=a[e](i),{c(){r.c(),t=T()},l(o){r.l(o),t=T()},m(o,c){n[e].m(o,c),p(o,t,c),l=!0},p(o,c){let d=e;e=s(o),e===d?n[e].p(o,c):(pe(),w(n[d],1,1,()=>{n[d]=null}),_e(),r=n[e],r?r.p(o,c):(r=n[e]=a[e](o),r.c()),y(r,1),r.m(t.parentNode,t))},i(o){l||(y(r),l=!0)},o(o){w(r),l=!1},d(o){o&&u(t),n[e].d(o)}}}function De(i){let e,r,t;return{c(){e=m("div"),r=b(i[2]),t=b(" variants found"),this.h()},l(l){e=h(l,"DIV",{"data-testid":!0,class:!0});var a=g(e);r=k(a,i[2]),t=k(a," variants found"),a.forEach(u),this.h()},h(){v(e,"data-testid","variant-count"),v(e,"class","flex-none w-full")},m(l,a){p(l,e,a),f(e,r),f(e,t)},p(l,a){a&4&&I(r,l[2])},i:U,o:U,d(l){l&&u(e)}}}function Re(i){let e,r;return e=new $e({props:{tableName:"variant-explorer",data:i[4],columns:i[5],defaultRowsPerPage:10,fullWidth:!0,search:!0,$$slots:{tableActions:[Ne]},$$scope:{ctx:i}}}),{c(){F(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,l){L(e,t,l),r=!0},p(t,l){const a={};l&16&&(a.data=t[4]),l&32&&(a.columns=t[5]),l&8198&&(a.$$scope={dirty:l,ctx:t}),e.$set(a)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){j(e,t)}}}function Te(i){let e,r,t,l,a,n,s,o,c=V.variantExplorer.maxCount+"",d,$,D,A;return{c(){e=m("aside"),r=m("i"),t=C(),l=m("div"),a=m("p"),n=b("Too many variants! Found "),s=b(i[2]),o=b(`, but cannot display more than
              `),d=b(c),$=b(" variants."),D=C(),A=m("p"),this.h()},l(E){e=h(E,"ASIDE",{class:!0});var _=g(e);r=h(_,"I",{class:!0}),g(r).forEach(u),t=x(_),l=h(_,"DIV",{class:!0});var G=g(l);a=h(G,"P",{});var R=g(a);n=k(R,"Too many variants! Found "),s=k(R,i[2]),o=k(R,`, but cannot display more than
              `),d=k(R,c),$=k(R," variants."),R.forEach(u),G.forEach(u),_.forEach(u),D=x(E),A=h(E,"P",{}),g(A).forEach(u),this.h()},h(){v(r,"class","fa-solid fa-triangle-exclamation text-4xl"),v(l,"class","alert-message"),v(e,"class","alert variant-filled-warning")},m(E,_){p(E,e,_),f(e,r),f(e,t),f(e,l),f(l,a),f(a,n),f(a,s),f(a,o),f(a,d),f(a,$),p(E,D,_),p(E,A,_)},p(E,_){_&4&&I(s,E[2])},i:U,o:U,d(E){E&&(u(e),u(D),u(A))}}}function z(i){let e,r,t,l;return{c(){e=m("div"),r=m("p"),t=b(i[2]),l=b(" variants found"),this.h()},l(a){e=h(a,"DIV",{"data-testid":!0,class:!0});var n=g(e);r=h(n,"P",{});var s=g(r);t=k(s,i[2]),l=k(s," variants found"),s.forEach(u),n.forEach(u),this.h()},h(){v(e,"data-testid","variant-count"),v(e,"class","")},m(a,n){p(a,e,n),f(e,r),f(r,t),f(r,l)},p(a,n){n&4&&I(t,a[2])},d(a){a&&u(e)}}}function Ie(i){let e,r,t,l,a,n="Aggregate data",s,o;return{c(){e=m("div"),r=m("label"),t=m("input"),l=C(),a=m("p"),a.textContent=n,this.h()},l(c){e=h(c,"DIV",{class:!0});var d=g(e);r=h(d,"LABEL",{class:!0});var $=g(r);t=h($,"INPUT",{class:!0,type:!0}),l=x($),a=h($,"P",{"data-svelte-h":!0}),q(a)!=="svelte-3s6voj"&&(a.textContent=n),$.forEach(u),d.forEach(u),this.h()},h(){v(t,"class","checkbox"),v(t,"type","checkbox"),v(r,"class","flex items-center space-x-2"),v(e,"class","")},m(c,d){p(c,e,d),f(e,r),f(r,t),t.checked=i[1],f(r,l),f(r,a),s||(o=[H(t,"change",i[7]),H(t,"click",i[6])],s=!0)},p(c,d){d&2&&(t.checked=c[1])},d(c){c&&u(e),s=!1,ce(o)}}}function Ne(i){let e,r,t=i[2]>0&&z(i),l=V.variantExplorer.type===P.Full&&Ie(i);return{c(){e=m("div"),t&&t.c(),r=C(),l&&l.c(),this.h()},l(a){e=h(a,"DIV",{class:!0});var n=g(e);t&&t.l(n),r=x(n),l&&l.l(n),n.forEach(u),this.h()},h(){v(e,"class","flex-auto flex items-end justify-between")},m(a,n){p(a,e,n),t&&t.m(e,null),f(e,r),l&&l.m(e,null)},p(a,n){a[2]>0?t?t.p(a,n):(t=z(a),t.c(),t.m(e,r)):t&&(t.d(1),t=null),V.variantExplorer.type===P.Full&&l.p(a,n)},d(a){a&&u(e),t&&t.d(),l&&l.d()}}}function Ue(i){let e,r,t="Loading",l,a,n,s=i[2]>0&&M(i);return a=new he({props:{animIndeterminate:"anim-progress-bar"}}),{c(){s&&s.c(),e=C(),r=m("h3"),r.textContent=t,l=C(),F(a.$$.fragment),this.h()},l(o){s&&s.l(o),e=x(o),r=h(o,"H3",{class:!0,"data-svelte-h":!0}),q(r)!=="svelte-16fo5h6"&&(r.textContent=t),l=x(o),S(a.$$.fragment,o),this.h()},h(){v(r,"class","text-left")},m(o,c){s&&s.m(o,c),p(o,e,c),p(o,r,c),p(o,l,c),L(a,o,c),n=!0},p(o,c){o[2]>0?s?s.p(o,c):(s=M(o),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},i(o){n||(y(a.$$.fragment,o),n=!0)},o(o){w(a.$$.fragment,o),n=!1},d(o){o&&(u(e),u(r),u(l)),s&&s.d(o),j(a,o)}}}function M(i){let e,r,t;return{c(){e=m("div"),r=b(i[2]),t=b(" variants found"),this.h()},l(l){e=h(l,"DIV",{"data-testid":!0,class:!0});var a=g(e);r=k(a,i[2]),t=k(a," variants found"),a.forEach(u),this.h()},h(){v(e,"data-testid","variant-count"),v(e,"class","flex-none w-full")},m(l,a){p(l,e,a),f(e,r),f(e,t)},p(l,a){a&4&&I(r,l[2])},d(l){l&&u(e)}}}function qe(i){let e,r,t,l;const a=[ye,xe],n=[];function s(o,c){return ge.explorer.variantExplorer?0:1}return e=s(),r=n[e]=a[e](i),{c(){r.c(),t=T()},l(o){r.l(o),t=T()},m(o,c){n[e].m(o,c),p(o,t,c),l=!0},p(o,c){r.p(o,c)},i(o){l||(y(r),l=!0)},o(o){w(r),l=!1},d(o){o&&u(t),n[e].d(o)}}}function Fe(i){let e,r,t,l;document.title=be.applicationName+" | Variant Explorer";let a=i[3]&&Y(i);return t=new ke({props:{full:!0,backUrl:"/explorer",backTitle:"Back to Explore",$$slots:{default:[qe]},$$scope:{ctx:i}}}),{c(){e=C(),a&&a.c(),r=C(),F(t.$$.fragment)},l(n){oe("svelte-s876e9",document.head).forEach(u),e=x(n),a&&a.l(n),r=x(n),S(t.$$.fragment,n)},m(n,s){p(n,e,s),a&&a.m(n,s),p(n,r,s),L(t,n,s),l=!0},p(n,[s]){n[3]?a?a.p(n,s):(a=Y(n),a.c(),a.m(r.parentNode,r)):a&&(a.d(1),a=null);const o={};s&8247&&(o.$$scope={dirty:s,ctx:n}),t.$set(o)},i(n){l||(y(t.$$.fragment,n),l=!0)},o(n){w(t.$$.fragment,n),l=!1},d(n){n&&(u(e),u(r)),a&&a.d(n),j(t,n)}}}function Se(i,e,r){let t,l,a,n;B(i,Z,_=>r(2,t=_)),B(i,re,_=>r(3,l=_)),B(i,te,_=>r(4,a=_)),B(i,ee,_=>r(5,n=_));const s=me();let o,c,d=V.variantExplorer.type===P.Full,$;async function D(){await Ce($),t>0&&t<=V.variantExplorer.maxCount&&await X($)}async function A(){r(1,d=!d),ae.set(d?P.Aggregate:P.Full),r(0,o=X($))}se(()=>{$=Ee(!0),$.query.hasFilter()?(c=O.subscribe(_=>{_&&s.trigger({message:_,background:"variant-filled-error"})}),r(0,o=D())):(s.trigger({message:"No query provided. Please add a genomic filter to explore variant data.",background:"variant-filled-error"}),ve("/explorer"))}),ie(()=>{c&&c()});function E(){d=this.checked,r(1,d)}return[o,d,t,l,a,n,A,E]}class Ke extends fe{constructor(e){super(),de(this,e,Se,Fe,ne,{})}}export{Ke as component};
