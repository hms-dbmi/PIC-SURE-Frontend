import{s as G,q as R,i as p,n as c,f as i,e as g,t as T,c as $,b as k,d as q,m as f,h as M,O,a0 as B,r as H,a as N,p as x,g as z,o as F,a3 as j}from"../chunks/scheduler.bui7uCNy.js";import{h as J,u as K}from"../chunks/await_block.B6WJ5gpV.js";import{S as I,i as P,d as w,e as v,m as y,t as h,a as b,f as C}from"../chunks/index.CNwEczq-.js";import{g as Q}from"../chunks/stores.CC2Z_udF.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.BCRmI_eu.js";import{P as U}from"../chunks/ProgressBar.D2arWQOT.js";import{b as V,f as W}from"../chunks/configuration.CsqyQUvi.js";import{C as X}from"../chunks/Content._KXHMYbh.js";import{T as Y}from"../chunks/Table.DNK98PK2.js";import{w as A}from"../chunks/entry.Bvh0VnfG.js";import{u as Z,g as ee}from"../chunks/User.C-oF0fl0.js";function te(o){let e,r,t,n;return{c(){e=g("a"),r=T("More Info"),this.h()},l(a){e=$(a,"A",{href:!0,title:!0,class:!0,target:!0});var s=k(e);r=q(s,"More Info"),s.forEach(i),this.h()},h(){f(e,"href",o[0]||"#"),f(e,"title",o[0]?"More Info":"Link not available"),f(e,"class","btn variant-ghost-primary hover:variant-filled-primary"+(o[0]?"":" opacity-50 cursor-not-allowed")),f(e,"target","_blank")},m(a,s){p(a,e,s),M(e,r),t||(n=O(e,"click",B(o[3])),t=!0)},p:c,d(a){a&&i(e),t=!1,n()}}}function ne(o){let e;return{c(){e=g("i"),this.h()},l(r){e=$(r,"I",{class:!0}),k(e).forEach(i),this.h()},h(){f(e,"class","fa-regular fa-circle-check text-3xl text-success-500")},m(r,t){p(r,e,t)},p:c,d(r){r&&i(e)}}}function ae(o){let e;function r(a,s){return a[1]?ne:te}let n=r(o)(o);return{c(){n.c(),e=R()},l(a){n.l(a),e=R()},m(a,s){n.m(a,s),p(a,e,s)},p(a,[s]){n.p(a,s)},i:c,o:c,d(a){a&&i(e),n.d(a)}}}function re(o,e,r){let{data:t={row:{additional_info_link:"",consentGranted:!1}}}=e,n=t.row.additional_info_link,a=t.row.consentGranted;const s=l=>!n&&l.preventDefault();return o.$$set=l=>{"data"in l&&r(2,t=l.data)},[n,a,t,s]}class oe extends I{constructor(e){super(),P(this,e,re,ae,G,{data:2})}}const E=A([]),L=A([]);function se(){return ee("picsure/proxy/dictionary-api/dashboard")}function ce(){return!!localStorage.getItem("token")}async function le(){var s,l;const o=await se();E.set(o.columns);const e=H(Z),r=ce()&&(e==null?void 0:e.queryTemplate);let t=[];r&&(t=((l=(s=e.queryTemplate)==null?void 0:s.categoryFilters)==null?void 0:l["\\_consents\\"])||[]);const a=o.rows.map(ie(t)).sort((d,m)=>{var D,S;const _=(((D=d.program_name)==null?void 0:D.toString().toLowerCase())||"")==="anvil",u=(((S=m.program_name)==null?void 0:S.toString().toLowerCase())||"")==="anvil";return _!==u?_?1:-1:d.consentGranted===m.consentGranted?ue(d,m):d.consentGranted?-1:1});L.set(a)}function ie(o){return e=>{if(!e.accession)return{...e,consentGranted:!1};const r=e.accession.toString();if(/^phs\d+\.v\d+\.p\d+\.c\d+$/.test(r)){const n=r.replace(/\.v\d+\.p\d+/,"");return{...e,consentGranted:o.includes(n)}}return{...e,consentGranted:o.includes(r)}}}function ue(o,e){var n,a;const r=((n=o.abbreviation)==null?void 0:n.toString())||"",t=((a=e.abbreviation)==null?void 0:a.toString())||"";return r.localeCompare(t)}function fe(o){return{c,l:c,m:c,p:c,i:c,o:c,d:c}}function de(o){let e,r;return e=new Y({props:{tableName:he,data:o[1],columns:o[0],cellOverides:o[2],defaultRowsPerPage:o[1].length,search:!1,showPagination:!1,stickyHeader:!0,rowClickHandler:o[4],isClickable:W.dashboardDrawer}}),{c(){w(e.$$.fragment)},l(t){v(e.$$.fragment,t)},m(t,n){y(e,t,n),r=!0},p(t,n){const a={};n&2&&(a.data=t[1]),n&1&&(a.columns=t[0]),n&2&&(a.defaultRowsPerPage=t[1].length),e.$set(a)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){b(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function me(o){let e,r;return e=new U({props:{animIndeterminate:"anim-progress-bar"}}),{c(){w(e.$$.fragment)},l(t){v(e.$$.fragment,t)},m(t,n){y(e,t,n),r=!0},p:c,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){b(e.$$.fragment,t),r=!1},d(t){C(e,t)}}}function pe(o){let e,r,t={ctx:o,current:null,token:null,hasCatch:!1,pending:me,then:de,catch:fe,blocks:[,,,]};return J(o[3],t),{c(){e=g("section"),t.block.c(),this.h()},l(n){e=$(n,"SECTION",{id:!0,class:!0});var a=k(e);t.block.l(a),a.forEach(i),this.h()},h(){f(e,"id","data-container"),f(e,"class","")},m(n,a){p(n,e,a),t.block.m(e,t.anchor=null),t.mount=()=>e,t.anchor=null,r=!0},p(n,a){o=n,K(t,o,a)},i(n){r||(h(t.block),r=!0)},o(n){for(let a=0;a<3;a+=1){const s=t.blocks[a];b(s)}r=!1},d(n){n&&i(e),t.block.d(),t.token=null,t=null}}}function _e(o){let e,r,t;return document.title=V.applicationName,r=new X({props:{title:"Data Dashboard",class:"content-center",full:!0,$$slots:{default:[pe]},$$scope:{ctx:o}}}),{c(){e=N(),w(r.$$.fragment)},l(n){x("svelte-1uz9aip",document.head).forEach(i),e=z(n),v(r.$$.fragment,n)},m(n,a){p(n,e,a),y(r,n,a),t=!0},p(n,[a]){const s={};a&259&&(s.$$scope={dirty:a,ctx:n}),r.$set(s)},i(n){t||(h(r.$$.fragment,n),t=!0)},o(n){b(r.$$.fragment,n),t=!1},d(n){n&&i(e),C(r,n)}}}const he="ExplorerTable";function be(o,e,r){const t=Q();let n,a,s=[],l=[];const d={additional_info_link:oe},m=le();F(()=>{n=E.subscribe(u=>r(0,s=u)),a=L.subscribe(u=>{r(1,l=u)})}),j(()=>{n&&n(),a&&a()});function _(u){t.open({id:"dashboard-drawer",meta:{row:u}})}return[s,l,d,m,_]}class Ie extends I{constructor(e){super(),P(this,e,be,_e,G,{})}}export{Ie as component};
