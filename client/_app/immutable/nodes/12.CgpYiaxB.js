import"../chunks/Bzak7iHL.js";import{p as F,f as T,d as c,r,s as m,a as Q,k as t,t as N,u as h,b as j,e as xt,c as G,$ as _t,l as bt,h as wt}from"../chunks/DhSNEPDw.js";import{s as q,h as $t}from"../chunks/DVtHS8ol.js";import{e as it,i as yt}from"../chunks/ByI6iVq5.js";import{s as O,a as W}from"../chunks/CJ66PCUx.js";import{b as P,f as X}from"../chunks/BZHGrlEE.js";import{g as Y}from"../chunks/BPde4ukL.js";import{S as St}from"../chunks/DT7C_vX2.js";import{d as lt,w as J,g as jt,o as It}from"../chunks/xU7jw7XU.js";import{i as H}from"../chunks/BG76zvuN.js";import{p as Lt,a as B,s as nt}from"../chunks/DpjY2ypC.js";import{e as Pt,f as Tt,h as kt,t as Rt}from"../chunks/BNC-bmXQ.js";import{b as zt,p as Nt,S as $,c as qt}from"../chunks/CUGspmVO.js";import{a as Ht}from"../chunks/Jhkhy7E3.js";import{h as Mt}from"../chunks/DgX2KM8m.js";import{s as Ct}from"../chunks/COZ3s8UQ.js";import{L as Et}from"../chunks/bwStxD3u.js";import{H as Z}from"../chunks/DAS9fB1J.js";const tt=J(!1),et=J(!1),K=J([]),st=lt(K,f=>f.filter(a=>!a.auth)),rt=lt(K,f=>f.filter(a=>a.auth));let at="";async function At(){var f,a;Pt();try{const o=zt(((a=(f=P)==null?void 0:f.landing)==null?void 0:a.stats)||[]),v=o.map(({auth:i,key:d})=>[i,d].join(",")).join(";");if(at===v)return;at=v,await jt(Tt),et.set(!1),tt.set(!1);const g=Nt(o);K.set(g),Promise.allSettled(g.flatMap($.list).map(({promise:i})=>i)).then(i=>{i.some($.rejected)&&tt.set(!0),et.set(!0)})}catch(o){console.error(o),kt("stats-error")||Rt.error({id:"stats-error",title:"An error occured while loading statistics. If this problem persists, please contact an administrator.",closable:!0})}}var Dt=T('<div class="flex flex-row h-full"><strong class="p-1 mb-3"> </strong> <!></div> <!>',1),Ot=T('<div class="p-2 not-last:border-r border-surface-500"><div class="flex flex-col justify-center items-center text-2xl"><!></div> <p> </p></div>'),Ut=T('<div class="w-full flex flex-col items-center"><div class="w-2/4"><!></div> <div></div></div>');function ot(f,a){F(a,!0);const o=()=>B(a.stats,"$stats",v),[v,g]=nt();let i=Lt(a,"auth",3,!1),d=h(()=>i()?"auth":"open"),x=h(()=>o().length>4?"w-full":"w-1/2");const k={1:"grid-cols-1",2:"grid-cols-2",3:"grid-cols-3",4:"grid-cols-4",5:"grid-cols-5",6:"grid-cols-6",7:"grid-cols-7",8:"grid-cols-8",9:"grid-cols-9",10:"grid-cols-10",11:"grid-cols-11",12:"grid-cols-12"},y=h(()=>k[o().length]||"grid-cols-1");var _=Ut(),l=c(_),b=c(l);Mt(b,()=>Ct(a.description)),r(l);var s=m(l,2);it(s,5,o,e=>`${t(d)}-${e.key}-${e.label}`,(e,u)=>{var R=Ot(),I=c(R),U=c(I);Ht(U,()=>Promise.allSettled($.list(t(u)).map(({promise:p})=>p)),p=>{Et(p,{ring:!0,size:"mini"})},(p,C)=>{const E=h(()=>$.list(t(u))),S=h(()=>t(C).map((n,D)=>({...n,resourceName:t(E)[D].resourceName})));var A=Dt(),w=Q(A),z=c(w),ct=c(z,!0);r(z);var dt=m(z,2);{var ft=n=>{var D=xt(),vt=Q(D);{var gt=V=>{const pt=h(()=>t(S).filter($.rejected).map(ht=>ht.resourceName).join(", "));Z(V,{type:"exclamation",color:"warning",id:"result-count-error",size:"text-xs",popoverSize:"text-sm",get text(){return`The following sites are not included as they did not return patient counts: ${t(pt)??""}.`}})};H(vt,V=>{t(S).some($.rejected)&&V(gt)})}j(n,D)};H(dt,n=>{X.federated&&n(ft)})}r(w);var ut=m(w,2);{var mt=n=>{Z(n,{type:"exclamation",color:"warning",id:"result-count-error",text:"We're having trouble fetching some data points right now. Please try again later."})};H(ut,n=>{!X.federated&&t(C).some($.rejected)&&n(mt)})}N(n=>q(ct,n),[()=>qt(t(S).filter($.fullfiled).map(n=>n.status==="fulfilled"?n.value:0))]),j(p,A)}),r(I);var M=m(I,2),L=c(M,!0);r(M),r(R),N(()=>{O(I,"data-testid",`value-${t(d)??""}-${t(u).key??""}-${t(u).label??""}`),q(L,t(u).label)}),j(e,R)}),r(s),r(_),N(()=>{O(_,"data-testid",`data-summary-${t(d)??""}`),W(s,1,`grid ${t(y)??""} grid-flow-col justify-center p-2 my-2 gap-y-9 ${t(x)??""}`)}),j(f,_),G(),g()}var Vt=T('<section class="flex flex-col items-center w-full p-4 my-3 bg-surface-100-900"><h2 class="m-2">Data Summary</h2> <!> <!></section>');function Wt(f,a){F(a,!0);const o=()=>B(rt,"$authStats",g),v=()=>B(st,"$stats",g),[g,i]=nt();It(At);var d=Vt(),x=m(c(d),2);{var k=l=>{{let b=h(()=>{var s,e;return(e=(s=P)==null?void 0:s.landing)==null?void 0:e.authExplanation});ot(l,{get stats(){return rt},auth:!0,get description(){return t(b)}})}};H(x,l=>{o().length>0&&l(k)})}var y=m(x,2);{var _=l=>{{let b=h(()=>{var s,e;return(e=(s=P)==null?void 0:s.landing)==null?void 0:e.explanation});ot(l,{get stats(){return st},get description(){return t(b)}})}};H(y,l=>{v().length>0&&l(_)})}r(d),j(f,d),G(),i()}var Bt=T('<div><div class="text-3xl my-1"> </div> <i></i> <div class="subtitle my-3"> </div> <a class="btn preset-filled-primary-500"> </a></div>'),Ft=T('<div id="landing" class="flex flex-wrap flex-col justify-evenly text-center items-center w-full h-full mt-8"><section id="search-section" class="flex flex-col text-center items-center my-auto w-2/3"><!></section> <section id="actions-section" class="flex flex-row justify-evenly items-center mb-auto w-2/3"></section> <!></div>');function fe(f,a){var l,b;F(a,!0);let o=wt("");const v=()=>!!localStorage.getItem("token");function g(){v()?Y(`/explorer?search=${t(o)}`):Y(`/discover?search=${t(o)}`)}const i=(b=(l=P)==null?void 0:l.landing)==null?void 0:b.actions.filter(s=>v()?s.showIfLoggedIn:s.isOpen||!s.showIfLoggedIn);var d=Ft();$t(s=>{N(()=>_t.title=P.applicationName)});var x=c(d),k=c(x);{let s=h(()=>{var e,u;return(u=(e=P)==null?void 0:e.landing)==null?void 0:u.searchPlaceholder});St(k,{get placeholder(){return t(s)},search:g,get searchTerm(){return t(o)},set searchTerm(e){bt(o,e,!0)}})}r(x);var y=m(x,2);it(y,21,()=>i,yt,(s,e)=>{let u=()=>t(e).title,R=()=>t(e).description,I=()=>t(e).icon,U=()=>t(e).url,M=()=>t(e).btnText;var L=Bt(),p=c(L),C=c(p,!0);r(p);var E=m(p,2),S=m(E,2),A=c(S,!0);r(S);var w=m(S,2),z=c(w,!0);r(w),r(L),N(()=>{W(L,1,`flex flex-col items-center w-1/${(i==null?void 0:i.length)||3}`),q(C,u()),W(E,1,`text-[5rem] my-3 text-secondary-600-400 ${I()??""}`),q(A,R()),O(w,"data-testid",`landing-action-${u()??""}-btn`),O(w,"href",U()),q(z,M())}),j(s,L)}),r(y);var _=m(y,2);Wt(_,{}),r(d),j(f,d),G()}export{fe as component};
