import"../chunks/Bzak7iHL.js";import{p as B,f as b,a as D,k as t,u as y,s as L,n as N,j as O,t as $,b as c,c as M,d as j,r as q,h as K,i as Q,e as V,$ as W,l as X}from"../chunks/DhSNEPDw.js";import{d as Y,s as T,h as Z}from"../chunks/DVtHS8ol.js";import{a as tt}from"../chunks/Jhkhy7E3.js";import{e as et,i as at}from"../chunks/ByI6iVq5.js";import{s as w,a as H}from"../chunks/CJ66PCUx.js";import{p as z,s as rt,a as st,d as ot}from"../chunks/DpjY2ypC.js";import{r as lt,d as it}from"../chunks/xU7jw7XU.js";import{g as F}from"../chunks/BPde4ukL.js";import{b as nt}from"../chunks/BZHGrlEE.js";import{E as ut}from"../chunks/nxdkf_Tf.js";import{C as ct}from"../chunks/DCcVgSs7.js";import{S as dt}from"../chunks/D0Q9DqMU.js";import{i as mt}from"../chunks/BG76zvuN.js";import{t as I}from"../chunks/BNC-bmXQ.js";import{b as pt,u as ft,U as vt}from"../chunks/Due1mG5I.js";import{g as $t,C as bt}from"../chunks/7RAg21gG.js";import{g as gt,R as _t}from"../chunks/DQg6N8Wr.js";import{g as ht}from"../chunks/owRDBXmR.js";import{M as yt}from"../chunks/B9gq-btx.js";import{L as wt}from"../chunks/bwStxD3u.js";function xt(m,n){m.stopPropagation(),F(`/admin/users/${n().cell}/edit`)}var At=b('<button type="button" title="Edit" aria-label="Edit" class="btn-icon-color"><i class="fa-solid fa-pen-to-square fa-xl"></i></button>'),Ct=b('<button type="button" class="btn-icon-color"><i></i></button>'),Ut=b("<!> <!>",1);function Rt(m,n){B(n,!0);let o=z(n,"data",19,()=>({cell:"",row:{status:"",email:""}}));const e=y(()=>o().row.status==="Active");async function g(i){const s=await pt(o().cell);if(!s)return;const p=await $t(s.connection),f=await Promise.all(s.roles.map(u=>gt(u).then(l=>({...l,privileges:l.privileges.map(r=>ht(r))}))));if(!(s&&p&&f.length>0))return;let v={...s,active:i,connection:p,roles:f};try{await ft(v),I.success({title:`Successfully ${i?"r":"d"}eactivated user '${v.email}'`})}catch(u){console.error(u),I.error({title:`An error occured while ${i?"r":"d"}eactivating user '${s.email}'`})}}var x=Ut(),A=D(x);{var k=i=>{var s=At();s.__click=[xt,o],$(()=>w(s,"data-testid",`user-${o().cell??""}-edit-btn`)),c(i,s)};mt(A,i=>{t(e)&&i(k)})}var P=L(A,2);{const i=u=>{var l=Ct(),r=j(l);q(l),$(()=>{w(l,"data-testid",`user-${t(e)?"d":"r"}eactivate-btn-${o().cell??""}`),w(l,"title",`${t(e)?"D":"R"}eactivate user`),w(l,"aria-label",`${t(e)?"D":"R"}eactivate user`),H(r,1,`fa-solid fa-trash${t(e)?"":"-arrow-up"} fa-xl`)}),c(u,l)};let s=y(()=>o().cell),p=y(()=>t(e)?"D":"R"),f=y(()=>t(e)?"D":"R"),v=y(()=>t(e)?"D":"R");yt(P,{get"data-testid"(){return`user-${t(s)??""}-${t(p)??""}eactivate-btn`},get title(){return`${t(f)??""}eactivate User?`},get confirmText(){return`${t(v)??""}eactivate`},onconfirm:()=>g(!t(e)),withDefault:!0,trigger:i,children:(u,l)=>{N();var r=O();$(()=>T(r,`Are you sure you want to ${t(e)?"d":"r"}eactiveate user '${o().row.email??""}'?`)),c(u,r)},$$slots:{trigger:!0,default:!0}})}c(m,x),M()}Y(["click"]);var Et=b("<span> </span>");function St(m,n){B(n,!0);let o=z(n,"data",19,()=>({cell:"",row:{}}));var e=Et(),g=j(e,!0);q(e),$(()=>{H(e,1,`badge last:p-1 rounded-sm preset-filled-${o().cell==="Active"?"success":"error"}-500`),T(g,o().cell)}),c(m,e),M()}var kt=b('<div class="mb-10"><!></div>'),Pt=b('<div class="flex gap-4 mb-6"><div class="flex-auto"><a data-testid="add-user-btn" class="btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500" href="/admin/users/new">+ Add User</a></div></div> <!>',1);function Zt(m,n){B(n,!0);const o=()=>st(t(p),"$usersByConnection",e),[e,g]=rt();let{users:x,loadUsers:A}=vt,{connections:k,loadConnections:P}=bt,{roles:i,loadRoles:s}=_t,p=K(Q(lt([])));const f=[{dataElement:"email",label:"Username",sort:!0,class:"w-1/3"},{dataElement:"roles",label:"Role(s)",sort:!0,class:"normal-case!"},{dataElement:"status",label:"Status",sort:!0,class:"w-24 text-center"},{dataElement:"uuid",label:"Actions",sort:!1,class:"w-24 text-center"}],v={status:St,uuid:Rt};async function u(){await P(),await s(),await A(),ot(X(p,it([x,k,i],([r,C,U])=>C.map(R=>({label:R.label,users:r.filter(a=>R.uuid===a.connection).map(a=>({uuid:a.uuid||"",email:a.email||"uuid:"+a.uuid,roles:a.roles.length===0?"none":a.roles.map(d=>{var _;return(_=U.find(h=>h.uuid===d))==null?void 0:_.name}).sort().join(", "),status:a.active?"Active":"Inactive"})).sort((a,d)=>a.status.localeCompare(d.status))}))),!0),"$usersByConnection",e)}const l=r=>{const C=r==null?void 0:r.uuid;F(`/admin/users/${C}/edit`)};Z(r=>{$(()=>W.title=`${nt.applicationName??""} | Manage Users`)}),ct(m,{title:"Manage Users",children:(r,C)=>{var U=V(),R=D(U);tt(R,u,a=>{wt(a,{})},a=>{var d=Pt(),_=L(D(d),2);et(_,1,o,at,(h,E)=>{var S=kt(),G=j(S);dt(G,{get tableName(){return`Users-${t(E).label??""}`},get data(){return t(E).users},get columns(){return f},get cellOverides(){return v},get title(){return t(E).label},rowClickHandler:l,isClickable:!0,searchable:!0,tableAuto:!1}),q(S),$(J=>w(S,"id",J),[()=>`user-table-${t(E).label.replaceAll(" ","_")}`]),c(h,S)}),c(a,d)},a=>{ut(a,{title:"API Error",children:(d,_)=>{N();var h=O("Something went wrong when sending your request.");c(d,h)},$$slots:{default:!0}})}),c(r,U)},$$slots:{default:!0}}),M(),g()}export{Zt as component};
