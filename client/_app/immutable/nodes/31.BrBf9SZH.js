import{f as i,a as t,c as Qe,t as te}from"../chunks/DKNWTM-D.js";import{p as tt,aO as Ke,c as s,s as d,R as Ut,r as a,t as ke,a as at,C as Q,g as e,aP as Ze,f as fe,n as F,h as ue,d as j,e as Le,b as l}from"../chunks/KPVYLOSR.js";import{s as xe,d as kt}from"../chunks/NtGCh5xy.js";import{i as D}from"../chunks/CDCmQmr-.js";import{a as me,s as rt,e as je}from"../chunks/B2Bg6RTa.js";import{w as Ot,a as Lt,o as Vt}from"../chunks/DpyMT7OB.js";import{a as ot}from"../chunks/DXJ436YI.js";import{e as bt,i as Pt}from"../chunks/B5lqQSsR.js";import{c as ht}from"../chunks/BgGYXS0j.js";import{b as yt,s as dt,r as Rt}from"../chunks/Be_LeCLl.js";import{b as zt,a as Qt}from"../chunks/BlQKM0Gb.js";import{p as Te}from"../chunks/CfrH0FQi.js";import"../chunks/DCY6c1ra.js";import{T as nt,a as gt,C as At}from"../chunks/DFefMeLI.js";import{g as Wt}from"../chunks/DNfOBMJV.js";import{b as Ht}from"../chunks/Bt-Xh7oU.js";import{c as ze}from"../chunks/BpV1Tt4c.js";import{f as Ue,r as Gt,b as ge,s as Xt}from"../chunks/BD7x6Jnt.js";import{Q as Yt,g as Jt}from"../chunks/BibUdOWF.js";import{E as Tt,e as Kt,r as Zt,a as ea}from"../chunks/CtWAh19b.js";import{t as Et,f as wt}from"../chunks/XQ4prG3n.js";import{s as ta}from"../chunks/BPGq02fb.js";import{t as aa}from"../chunks/CWjZNTTC.js";import{s as ct}from"../chunks/kg2g7Go4.js";import{t as ut,a as pt}from"../chunks/nsQMHjqs.js";import{A as xt,C as ra}from"../chunks/a16e0A8-.js";import{S as sa}from"../chunks/C92RFBuR.js";import{U as oa}from"../chunks/Ud7Jrm2s.js";import{E as lt}from"../chunks/P3bGLiu7.js";import{C as It}from"../chunks/CQcdv0WS.js";import{M as na}from"../chunks/D3jF9FdZ.js";import{L as Ve}from"../chunks/BW_ShK1N.js";import{v as la}from"../chunks/oR7KrioB.js";const Ee=Ot({current:0,total:0,stepMap:[]});async function ia(W,n){if(n===""&&n.trim()==="")throw"Please input a Dataset ID name";const _=/^[\w \-\\/?+=[\].():"']+$/g;if(!n.match(_))throw`Name can only contain letters, numbers, and these special symbols - ? + = [ ] . ( ) : ' "`;return await ze("picsure/dataset/named",{queryId:W,name:n})}var ca=i("<div><span> </span></div>"),da=i('<header class="stepper-header flex items-center border-t mt-[15px] mb-7 border-surface-500 gap-4"></header>'),ua=i('<div data-testid="stepper"><!> <div class="stepper-content"><!></div></div>');function pa(W,n){tt(n,!0);const[_,ae]=rt(),o=()=>me(Ee,"$stepperState",_),I=()=>{},U=Te(n,"buttonCompleteLabel",3,""),O=Te(n,"class",3,""),w=Te(n,"onnext",3,I),L=Te(n,"onback",3,I),c=Te(n,"oncomplete",3,I);async function f(r){if(await new Promise(m=>setTimeout(m)),r)return;const p=o().current+1,g=o().stepMap[p];w()(p,g,o()),je(Ee,Q(o).current=p,Q(o))}function k(){const r=o().current===0?0:o().current-1,p=o().stepMap[r];L()(r,p,o()),je(Ee,Q(o).current=r,Q(o))}function H(r,p){p||c()(r,o().stepMap[r],o())}function re(r){return r===o().current}Ke("buttonCompleteLabel",U()),Ke("StepperState",Ee),Ke("onBack",k),Ke("onNext",f),Ke("onComplete",H);var $=ua(),N=s($);{var se=r=>{var p=da();bt(p,5,()=>Array.from(Array(o().total).keys()),Pt,(g,m)=>{var S=ca();let b;var u=s(S),x=s(u,!0);a(u),a(S),ke((ne,T,Fe)=>{b=yt(S,1,"stepper-header-step -mt-[15px] transition-all duration-300",null,b,ne),dt(u,"data-testid",`step-${o().stepMap[e(m)]??""}`),yt(u,1,`badge rounded-2xl text-sm ${T??""}`),xe(x,Fe)},[()=>({"flex-1":re(e(m))}),()=>re(e(m))?"preset-filled-primary-500":"preset-filled-surface-500",()=>re(e(m))?`Step ${e(m)+1}`:e(m)+1]),t(g,S)}),a(p),ut(1,p,()=>pt,()=>({duration:100})),ut(2,p,()=>pt,()=>({duration:100})),t(r,p)};D(N,r=>{o().total&&r(se)})}var oe=d(N,2),J=s(oe);ct(J,()=>n.children??Ut),a(oe),a($),ke(()=>yt($,1,`stepper space-y-4 ${O()??""}`)),t(W,$),at(),ae()}var va=i('<header class="step-header text-2xl font-bold"><!></header>'),fa=i('<div class="step-navigation-slot"><!></div>'),ma=i("<div></div>"),_a=i('<div class="step-navigation flex justify-between gap-4"><!> <!></div>'),ha=i('<div class="step space-y-4"><!> <div class="step-content space-y-4 px-2"><!></div> <!></div>');function et(W,n){tt(n,!0);const[_,ae]=rt(),o=()=>me(O,"$stepperState",_),I=Te(n,"locked",3,!1),U=Ze("buttonCompleteLabel"),O=Ze("StepperState"),w=Ze("onNext"),L=Ze("onBack"),c=Ze("onComplete"),f=o().total;je(O,Q(o).stepMap=[...o().stepMap,n.name],Q(o)),je(O,Q(o).total++,Q(o)),Lt(()=>{je(O,Q(o).total--,Q(o)),je(O,Q(o).stepMap=o().stepMap.filter($=>$!==n.name),Q(o))});var k=Qe(),H=fe(k);{var re=$=>{var N=ha();dt(N,"data-testid",`step-${f+1}`);var se=s(N);{var oe=b=>{var u=va(),x=s(u);ct(x,()=>n.header),a(u),t(b,u)};D(se,b=>{n.header&&b(oe)})}var J=d(se,2),r=s(J);{var p=b=>{var u=Qe(),x=fe(u);ct(x,()=>n.children),t(b,u)},g=b=>{var u=te();u.nodeValue=`(Step ${f+1} Content)`,t(b,u)};D(r,b=>{n.children?b(p):b(g,!1)})}a(J);var m=d(J,2);{var S=b=>{var u=_a(),x=s(u);{var ne=G=>{var _e=fa(),Ne=s(_e);ct(Ne,()=>n.navigation),a(_e),t(G,_e)},T=(G,_e)=>{{var Ne=De=>{const Oe=ue(()=>o().current===0);xt(De,{onclick:L,get disabled(){return e(Oe)},children:(vt,ft)=>{F();var st=te("Back");t(vt,st)},$$slots:{default:!0}})},Se=De=>{var Oe=ma();t(De,Oe)};D(G,De=>{f!==0?De(Ne):De(Se,!1)},_e)}};D(x,G=>{n.navigation?G(ne):G(T,!1)})}var Fe=d(x,2);{var We=G=>{xt(G,{name:"next",angle:"right",variant:"filled",color:"primary-500",get disabled(){return I()},onclick:()=>w(I()),children:(_e,Ne)=>{F();var Se=te("Next");t(_e,Se)},$$slots:{default:!0}})},He=G=>{xt(G,{name:U||"complete",angle:"right",variant:"filled",color:"primary-500",get disabled(){return I()},onclick:()=>c(f,I()),children:(_e,Ne)=>{F();var Se=te();Se.nodeValue=U||"Complete",t(_e,Se)},$$slots:{default:!0}})};D(Fe,G=>{f<o().total-1?G(We):G(He,!1)})}a(u),ut(1,u,()=>pt,()=>({duration:100})),ut(2,u,()=>pt,()=>({duration:100})),t(b,u)};D(m,b=>{o().total>1&&b(S)})}a(N),t($,N)};D(H,$=>{f===o().current&&$(re)})}t(W,k),at(),ae()}var ya=i('<div id="stats" class="w-full flex justify-evenly mb-5 pb-2 svelte-10e6ctx"><div id="summary" class="w-full grid grid-flow-col auto-cols-auto"><div class="text-xl"><label for="summary" class="mr-8 font-bold">Summary:</label></div> <div class="flex justify-left text-xl font-light"><span id="participants" class="mr-2"> </span> <label for="participants">Participants</label></div> <div class="flex justify-left text-xl font-light"><span id="variables" class="mr-2"> </span> <label for="variables">Variables</label></div> <div class="flex justify-left text-xl font-light"><span id="dataPoints" class="mr-2"> </span> <label for="dataPoints">Data Points</label></div></div></div>');function it(W,n){tt(n,!0);const[_,ae]=rt(),o=()=>me(Et,"$totalParticipants",_),I=()=>me(wt,"$filters",_),U=()=>me(O,"$exports",_);let{exports:O}=Tt,w=ue(o),L=ue(()=>I().length+U().length),c=ue(()=>typeof e(w)=="number"?e(w)*e(L):0);var f=ya(),k=s(f),H=d(s(k),2),re=s(H),$=s(re,!0);a(re),F(2),a(H);var N=d(H,2),se=s(N),oe=s(se,!0);a(se),F(2),a(N);var J=d(N,2),r=s(J),p=s(r,!0);a(r),F(2),a(J),a(k),a(f),ke(()=>{xe($,e(w)),xe(oe,e(L)),xe(p,e(c))}),t(W,f),at(),ae()}async function ga(W,n,_,ae,o,I){var U;try{if(l(n,!0),!e(_)){const c=(U=e(ae))==null?void 0:U.map(f=>f.ref);Zt(c||[]),l(o,e(o).filter(f=>!e(ae).some(k=>k.variableId===f.variableId)),!0);return}const w=(await I()).map(c=>({id:la(),searchResult:c,display:(c==null?void 0:c.display)||"",conceptPath:(c==null?void 0:c.conceptPath)||""}));ea(w);const L=w.map(c=>{var f,k,H;return{ref:c,variableId:(f=c==null?void 0:c.searchResult)==null?void 0:f.conceptPath,variableName:c==null?void 0:c.display,description:(k=c==null?void 0:c.searchResult)==null?void 0:k.description,type:(H=c==null?void 0:c.searchResult)==null?void 0:H.type,selected:!0}});l(o,Array.from([...e(o),...L].reduce((c,f)=>c.set(f.variableId,f),new Map).values()),!0),l(ae,L,!0)}catch(O){console.error("Error in toggleSampleIds",O),aa.error({description:"We were unable to fetch the sample IDs for your selected data. Please try again later."}),l(_,!1)}finally{l(n,!1)}}var xa=i('<div class="flex justify-center mb-4"><!></div>'),ba=i('<input type="checkbox" class="mr-1 &amp;[aria-disabled=“true”]:opacity-75" data-testid="sample-ids-checkbox" id="sample-ids-checkbox"/>'),Pa=i('<div><label for="sample-ids-checkbox" class="flex items-center" data-testid="sample-ids-label"><!> <span>Include sample identifiers</span></label></div>'),wa=i("<!> <!>",1),$a=i("<!> <!>",1),Sa=i('<div id="first-step-container" class="flex flex-col w-full h-full items-center"><!> <section class="w-full"><!></section></div>'),Da=i(`<section class="flex flex-col w-full h-full items-center"><!> <div class="w-full h-full m-2 card p-4"><header class="card-header">Select <strong>additional variables</strong> you would like to be included in your final
            data export.</header> <hr/> <div class="card-body p-4">Tree Component Here</div></div></section>`),Ra=i('<section class="flex flex-col w-full h-full items-center"><!> <div class="grid gap-10 grid-cols-2"><!> <!></div></section>'),Aa=i('<div id="dataset-id" class="mr-4"> </div>'),Ia=i("<div>An error occurred while getting the dataset ID. Please try again later.</div>"),ka=i(`<section class="flex flex-col w-full h-full items-center"><!> <div class="w-full h-full m-2 card p-4"><header class="card-header">Save the information in your final data export by clicking the Save Dataset ID button.
          Navigate to the <a class="anchor" href="/dataset">Manage Datasets page</a> to view or manage
          your Dataset IDs.</header> <hr/> <div class="card-body p-4 flex flex-col justify-center items-center"><div><div class="flex items-center m-2"><label for="dataset-name" class="font-bold mr-2">Dataset Name:</label> <input type="text" id="dataset-name" class="input w-80" placeholder="Enter a name" required/></div> <div class="flex items-center m-2"><div class="flex items-center"><label for="dataset-id" class="font-bold mr-2">Dataset ID:</label> <!></div></div></div></div></div></section>`),Ta=i("<!> <!> <!>",1),Ea=(W,n,_)=>Ue.confirmDownload?l(n,!0):_(),Ca=i('<button class="btn preset-filled-primary-500"><i class="fa-solid fa-download mr-1"></i>Download as CSV</button>'),Ma=i("<!> <!> <!>",1),ja=i('<a class="btn preset-tonal-primary border border-primary-500 m-2 hover:preset-filled-primary-500"> </a>'),Fa=i('<div class="flex justify-center"></div>'),Na=i('<section class="flex flex-col gap-8"><p class="mt-4"> </p> <!> <p> </p> <div class="flex justify-center"><!></div> <!></section>'),qa=(W,n,_)=>n(e(_).url),Ba=i('<button class="flex-initial w-64 btn preset-filled-primary-500 disabled:preset-tonal-primary border border-primary-500"><i class="fa-solid fa-arrow-up-right-from-square"></i> </button>'),Ua=(W,n,_)=>Ue.confirmDownload?l(n,!0):_(),Oa=i('<section class="flex flex-col gap-8 place-items-center"><div class="flex justify-center mt-4">Select an option below to export your selected data in PFB format.</div> <!> <button class="flex-initial w-64 btn preset-filled-primary-500"><i class="fa-solid fa-download"></i>Download as PFB</button></section>'),La=i('<div class="flex justify-center"><!> <div class="hidden"> </div></div>'),Va=i('<div class="flex justify-center"><!></div>'),za=i('<div class="flex justify-center"><!></div>'),Qa=i('<section class="flex flex-col w-full h-full items-center"><!></section>'),Wa=i("<!> <!> <!> <!> <!>",1),Ha=i("<!> <!>",1);function Ga(W,n){tt(n,!0);const[_,ae]=rt(),o=()=>me(Kt,"$exports",_),I=()=>me(Ee,"$stepperState",_),U=()=>me(Et,"$totalParticipants",_),O=()=>me(wt,"$filters",_),w=Te(n,"query",7),L=Te(n,"showTreeStep",3,!1),c=Te(n,"rows",19,()=>[]);let f=j(Le(c()));const k=Xt.maxDataPointsForExport||1e6,H=7,re=[{dataElement:"variableName",label:"Variable Name",sort:!0},{dataElement:"description",label:"Variable Description",sort:!0},{dataElement:"type",label:"Type",sort:!0,class:"text-center"}];let $=j(void 0),N=j(Le(Promise.resolve())),se=j(Le(Promise.resolve())),oe=j(Le(Promise.resolve())),J=j(Le(Promise.resolve())),r=j(""),p=j(""),g=j(!0),m=j(!1),S=j(Le([])),b=j(!1),u=j(!1),x=j("Python"),ne=j(!1),T=j(""),Fe=j(""),We=j(!1);Vt(async()=>{const h=o().filter(y=>y.conceptPath.includes("SAMPLE_ID"));if(h.length>0){l(u,!0);const y=await Oe();if(y.length>0){const v=h.filter(P=>y.some(q=>q.conceptPath===P.conceptPath));l(m,v.length===y.length),l(u,!1),e(m)&&l(S,v.map(P=>{var q,qe;return{ref:P,variableId:P.conceptPath,variableName:P.display,description:(q=P.searchResult)==null?void 0:q.description,type:(qe=P.searchResult)==null?void 0:qe.type,selected:!0}}),!0)}else l(m,!1),l(u,!1)}else l(m,!1);Ue.explorer.enablePfbExport||l($,"DATAFRAME")});async function He(){try{const h=await ze(`picsure/query/${e(T)}/result`,{}),y=URL.createObjectURL(new Blob([h],{type:"octet/stream"}));if(Ht){const v=document.createElement("a");v.href=y,w().query.expectedResultType==="DATAFRAME"?v.download="pic-sure-data.csv":w().query.expectedResultType==="DATAFRAME_PFB"&&(v.download="pic-sure-data.avro"),document.body.appendChild(v),v.click(),document.body.removeChild(v)}}catch(h){console.error("Error in onCompleteHandler",h)}}async function G(h,y){y!=="review"&&(y==="save-dataset"&&l(se,_e(),!0),y==="start"&&l(J,ia(e(T),e(r)).then(v=>(l(N,Ne(e(p)),!0),v)),!0))}async function _e(){let h;const y={initial:"Creating dataset ID...",waiting:"Hang tight. We are still working on it...",retry:"Something's taking longer than usual. We are still working on it..."};function v(P,q=!0){l(Fe,q?y.initial:y.retry,!0),q&&(h=setInterval(()=>{l(Fe,y.waiting,!0)},H*1e3)),l(oe,P().finally(()=>clearInterval(h)).catch(qe=>{if(q)v(P,!1);else throw qe}),!0)}try{w().query.fields=o().map(P=>P.conceptPath),w().query.expectedResultType=e($)||"DATAFRAME",l(T,""),v(()=>ze("picsure/query",w()).then(P=>{l(T,P.picsureResultId||"Error",!0)})),await e(oe)}catch(P){throw je(Ee,Q(I).current--,Q(I)),console.error("Error in submitQuery",P),P}}function Ne(h){const y=h||e(T);return ze("picsure/query/"+y+"/status",w()).then(v=>{if(v.status==="ERROR")return l(g,!0),Promise.reject(v.status);l(p,v.picsureResultId,!0),l(g,!1)})}function Se(){Wt("/explorer")}function De(){return(typeof U()=="number"?U():k+1)+O().length+o().length>k}async function Oe(){const h=await ta("",[{name:"data_source_genomic",category:"data_source",display:"Genomic",description:"Associated with genomic data",count:0}],{pageNumber:0,pageSize:1e4});if(h.content.length===0)return[];const y=new Yt(structuredClone(w().query));y.expectedResultType="CROSS_COUNT";const v=h.content.map(q=>q.conceptPath);y.setCrossCountFields(v);const P=await ze("picsure/query/sync",{query:y,resourceUUID:Gt.hpds});return h.content.filter(q=>P[q.conceptPath]>0)}async function vt(h){async function y(){const P="picsure/query/"+e(T)+"/signed-url";try{return(await ze(P,w())).signedUrl}catch(q){console.error("Error in getSignedUrl",q)}}if(!h)return;l(We,!0);let v=await y();v&&window.open(h+encodeURIComponent(v)),l(We,!1)}var ft=Ha(),st=fe(ft);const Ct=ue(()=>ge.explorePage.confirmDownloadTitle||"Are you sure you want to download data?");na(st,{get title(){return e(Ct)},width:"w-1/2",withDefault:!0,confirmText:"Download",cancelText:"Cancel",onconfirm:()=>He(),get open(){return e(ne)},set open(h){l(ne,h,!0)},children:(h,y)=>{F();var v=te();ke(()=>xe(v,ge.explorePage.confirmDownloadMessage||"This action will download the data to your local machine. Are you sure you want to proceed?")),t(h,v)},$$slots:{default:!0}});var Mt=d(st,2);pa(Mt,{class:"w-full h-full m-8",oncomplete:Se,onnext:G,buttonCompleteLabel:"Done",children:(h,y)=>{var v=Wa(),P=fe(v);const q=ue(De);et(P,{name:"review",get locked(){return e(q)},header:K=>{F();var le=te("Review Cohort Details:");t(K,le)},children:(K,le)=>{var E=Sa(),Z=s(E);it(Z,{});var B=d(Z,2),X=s(B);{var he=V=>{lt(V,{"data-testid":"landing-error",title:"Warning",color:"warning",closeText:"Back",onclose:Se,children:(Y,ie)=>{F();var Pe=te(`Warning: Your selected data exceeds 1,000,000 estimated data points, which is too large
            to export. Please reduce the data selection or the number of selected participants.`);t(Y,Pe)},$$slots:{default:!0}})},ee=V=>{var Y=$a(),ie=fe(Y);ot(ie,()=>e(se),M=>{Ve(M,{ring:!0,label:"Preparing"})},void 0,M=>{var pe=xa(),ye=s(pe);lt(ye,{title:`An error occurred while preparing your dataset. Please try again. If this problem persists, please
                  contact an administrator.`}),a(pe),t(M,pe)});var Pe=d(ie,2);{var C=M=>{var pe=wa(),ye=fe(pe);sa(ye,{tableName:"ExportSummary",get data(){return e(f)},columns:re});var Ce=d(ye,2);{var Ge=Re=>{var Ae=Pa(),we=s(Ae),Xe=s(we);{var Me=R=>{Ve(R,{ring:!0})},Ie=R=>{var z=ba();Rt(z),z.__change=[ga,b,m,S,f,Oe],Qt(z,()=>e(m),de=>l(m,de)),t(R,z)};D(Xe,R=>{e(u)?R(Me):R(Ie,!1)})}F(2),a(we),a(Ae),t(Re,Ae)};D(Ce,Re=>{Re(Ge)})}t(M,pe)},ce=M=>{Ve(M,{ring:!0,size:"micro",label:"Loading sample IDs"})};D(Pe,M=>{e(b)?M(ce,!1):M(C)})}t(V,Y)};D(X,V=>{De()?V(he):V(ee,!1)})}a(B),a(E),t(K,E)},$$slots:{header:!0,default:!0}});var qe=d(P,2);{var jt=be=>{et(be,{name:"select-variables",header:le=>{F();var E=te("Finalize Data:");t(le,E)},children:(le,E)=>{var Z=Da(),B=s(Z);it(B,{}),F(2),a(Z),t(le,Z)},$$slots:{header:!0,default:!0}})};D(qe,be=>{L()&&be(jt)})}var $t=d(qe,2);{var Ft=be=>{const K=ue(()=>e($)===void 0);et(be,{name:"select-type",get locked(){return e(K)},header:E=>{F();var Z=te("Review and Save Dataset:");t(E,Z)},children:(E,Z)=>{var B=Ra(),X=s(B);it(X,{});var he=d(X,2),ee=s(he);const V=ue(()=>e($)==="DATAFRAME");It(ee,{"data-testid":"csv-export-option",title:"Export as Data Frame or CSV",subtitle:"Export data as a Python or R data frame or a comma-separated values file",size:"other",get active(){return e(V)},onclick:()=>l($,"DATAFRAME")});var Y=d(ee,2);const ie=ue(()=>e($)==="DATAFRAME_PFB");It(Y,{"data-testid":"pfb-export-option",title:"Export as PFB",subtitle:"Export data in Portable Format for Biomedical Data file format",size:"other",get active(){return e(ie)},onclick:()=>l($,"DATAFRAME_PFB")}),a(he),a(B),t(E,B)},$$slots:{header:!0,default:!0}})};D($t,be=>{Ue.explorer.enablePfbExport&&be(Ft)})}var St=d($t,2);const Nt=ue(()=>!e(r)||e(r).length<2||!e(T));et(St,{name:"save-dataset",get locked(){return e(Nt)},header:K=>{F();var le=te("Save Dataset ID:");t(K,le)},children:(K,le)=>{var E=ka(),Z=s(E);it(Z,{});var B=d(Z,2),X=d(s(B),4),he=s(X),ee=s(he),V=d(s(ee),2);Rt(V),a(ee);var Y=d(ee,2),ie=s(Y),Pe=d(s(ie),2);ot(Pe,()=>e(oe),C=>{Ve(C,{ring:!0,size:"micro",get label(){return e(Fe)}})},C=>{var ce=Aa(),M=s(ce,!0);a(ce),ke(()=>xe(M,e(T))),t(C,ce)},C=>{var ce=Ia();t(C,ce)}),a(ie),a(Y),a(he),a(X),a(B),a(E),zt(V,()=>e(r),C=>l(r,C)),t(K,E)},$$slots:{header:!0,default:!0}});var qt=d(St,2);et(qt,{name:"start",get locked(){return e(g)},header:K=>{F();var le=te("Start Analysis:");t(K,le)},children:(K,le)=>{var E=Qa(),Z=s(E);ot(Z,()=>e(J),B=>{Ve(B,{ring:!0,size:"medium",label:"Saving"})},B=>{var X=Va(),he=s(X);ot(he,()=>e(N),ee=>{Ve(ee,{ring:!0,size:"medium",label:"Preparing"})},ee=>{var V=Qe(),Y=fe(V);{var ie=C=>{var ce=Na(),M=s(ce),pe=s(M,!0);a(M);var ye=d(M,2);nt(ye,{get value(){return e(x)},onValueChange:R=>l(x,R.value,!0),list:R=>{var z=Ta(),de=fe(z);gt(de,{value:"Python",get group(){return e(x)},set group(A){l(x,A,!0)},children:(A,ve)=>{F();var $e=te("Python");t(A,$e)},$$slots:{default:!0}});var Be=d(de,2);gt(Be,{value:"R",get group(){return e(x)},set group(A){l(x,A,!0)},children:(A,ve)=>{F();var $e=te("R");t(A,$e)},$$slots:{default:!0}});var mt=d(Be,2);{var _t=A=>{gt(A,{value:"Download",get group(){return e(x)},set group(ve){l(x,ve,!0)},children:(ve,$e)=>{F();var Ye=te("Download");t(ve,Ye)},$$slots:{default:!0}})};D(mt,A=>{Ue.explorer.allowDownload&&A(_t)})}t(R,z)},content:R=>{var z=Ma(),de=fe(z);ht(de,()=>nt.Panel,(A,ve)=>{ve(A,{value:"Python",children:($e,Ye)=>{const Je=ue(()=>ge.explorePage.codeBlocks.PythonExport.replace("{{queryId}}",e(T))||"Code not set");At($e,{lang:"python",get code(){return e(Je)}})},$$slots:{default:!0}})});var Be=d(de,2);ht(Be,()=>nt.Panel,(A,ve)=>{ve(A,{value:"R",children:($e,Ye)=>{const Je=ue(()=>ge.explorePage.codeBlocks.RExport.replace("{{queryId}}",e(T))||"Code not set");At($e,{lang:"r",get code(){return e(Je)}})},$$slots:{default:!0}})});var mt=d(Be,2);{var _t=A=>{var ve=Qe(),$e=fe(ve);ht($e,()=>nt.Panel,(Ye,Je)=>{Je(Ye,{value:"Download",children:(Bt,Ka)=>{var Dt=Ca();Dt.__click=[Ea,ne,He],t(Bt,Dt)},$$slots:{default:!0}})}),t(A,ve)};D(mt,A=>{Ue.explorer.allowDownload&&A(_t)})}t(R,z)},$$slots:{list:!0,content:!0}});var Ce=d(ye,2),Ge=s(Ce,!0);a(Ce);var Re=d(Ce,2),Ae=s(Re);oa(Ae,{}),a(Re);var we=d(Re,2);{var Xe=Me=>{var Ie=Fa();bt(Ie,21,()=>ge.explorePage.goTo.links,Pt,(R,z)=>{var de=ja(),Be=s(de,!0);a(de),ke(()=>{dt(de,"href",e(z).url),dt(de,"target",e(z).newTab?"_blank":"_self"),xe(Be,e(z).title)}),t(R,de)}),a(Ie),t(Me,Ie)};D(we,Me=>{ge.explorePage.goTo.links.length>0&&Me(Xe)})}a(ce),ke(()=>{xe(pe,ge.explorePage.analysisExportText),xe(Ge,ge.explorePage.goTo.instructions)}),t(C,ce)},Pe=(C,ce)=>{{var M=pe=>{var ye=Oa(),Ce=d(s(ye),2);{var Ge=Ae=>{var we=Qe(),Xe=fe(we);bt(Xe,17,()=>ge.explorePage.pfbExportUrls,Pt,(Me,Ie)=>{var R=Ba();R.__click=[qa,vt,Ie];var z=d(s(R));a(R),ke(()=>{R.disabled=e(We),xe(z,`Export to ${e(Ie).title??""}`)}),t(Me,R)}),t(Ae,we)};D(Ce,Ae=>{var we;(we=ge.explorePage)!=null&&we.pfbExportUrls&&ge.explorePage.pfbExportUrls.length>0&&Ae(Ge)})}var Re=d(Ce,2);Re.__click=[Ua,ne,He],a(ye),t(pe,ye)};D(C,pe=>{w().query.expectedResultType==="DATAFRAME_PFB"&&Ue.explorer.enablePfbExport&&pe(M)},ce)}};D(Y,C=>{w().query.expectedResultType==="DATAFRAME"?C(ie):C(Pe,!1)})}t(ee,V)},(ee,V)=>{var Y=La(),ie=s(Y);lt(ie,{title:`An error occurred while preparing your dataset. Please try again. If this problem persists, please
                contact an administrator.`});var Pe=d(ie,2),C=s(Pe,!0);a(Pe),a(Y),ke(()=>xe(C,e(V))),t(ee,Y)}),a(X),t(B,X)},B=>{var X=za(),he=s(X);lt(he,{title:`An error occurred while saving your dataset. Please try again. If this problem persists, please
            contact an administrator.`}),a(X),t(B,X)}),a(E),t(K,E)},$$slots:{header:!0,default:!0}}),t(h,v)},$$slots:{default:!0}}),t(W,ft),at(),ae()}kt(["change","click"]);var Xa=i('<section class="flex justify-center items-center w-full h-full mt-8"><!></section>'),Ya=()=>{alert("This would start the tour at some step")},Ja=i('<div class="flex flex-col items-center justify-center m-8"><p>No filters or exports have been created.</p> <div class="flex gap-4"><button class="btn preset-filled-primary-500 m-4">Learn How</button></div></div>');function Er(W,n){var f,k,H,re,$,N,se,oe,J;tt(n,!0);const[_,ae]=rt(),o=()=>me(O,"$exports",_),I=()=>me(wt,"$filters",_),U=()=>me(Ee,"$stepperState",_);let{exports:O}=Tt,w=Jt(!0),L=o().map(r=>{var p,g,m,S;return{ref:r,selected:!0,variableId:r.conceptPath,variableName:r.display||((p=r.searchResult)==null?void 0:p.display)||((g=r.searchResult)==null?void 0:g.name),description:(m=r.searchResult)==null?void 0:m.description,type:(S=r.searchResult)==null?void 0:S.type}}),c=I().map(r=>{var p,g,m;return{ref:r,selected:!0,variableId:r.id,variableName:((p=r.searchResult)==null?void 0:p.display)||r.variableName,description:(g=r.searchResult)==null?void 0:g.description,type:(m=r.searchResult)==null?void 0:m.type}});{const r={id:"\\_Patient ID\\",conceptPath:"\\_Patient ID\\",display:"Patient ID",searchResult:{conceptPath:"\\_Patient ID\\",name:"_Patient ID",dataset:"",display:"Patient ID",studyAcronym:"",description:"Patient identifier.",type:"Categorical",allowFiltering:!0}};let p={ref:r,selected:!0,variableId:r.conceptPath,variableName:r.display||((f=r.searchResult)==null?void 0:f.name),description:(k=r.searchResult)==null?void 0:k.description,type:(H=r.searchResult)==null?void 0:H.type};L.push(p);{const g={id:"\\_Topmed Study Accession with Subject ID\\",conceptPath:"\\_Topmed Study Accession with Subject ID\\",display:"TOPMed Study Accession with Subject ID",searchResult:{conceptPath:"\\_Topmed Study Accession with Subject ID\\",name:"_TOPMed Study Accession with Subject ID",dataset:"TOPMed",display:"TOPMed Study Accession with Subject ID",studyAcronym:"TOPMed",description:"TOPMed study accession number and subject identifier.",type:"Categorical",allowFiltering:!0}};let m={ref:g,selected:!0,variableId:g.conceptPath,variableName:g.display||((re=g.searchResult)==null?void 0:re.name),description:($=g.searchResult)==null?void 0:$.description,type:(N=g.searchResult)==null?void 0:N.type};L.push(m);const S={id:"\\_Parent Study Accession with Subject ID\\",conceptPath:"\\_Parent Study Accession with Subject ID\\",display:"Parent Study Accession with Subject ID",searchResult:{conceptPath:"\\_Parent Study Accession with Subject ID\\",name:"_Parent Study Accession with Subject ID",dataset:"",display:"Parent Study Accession with Subject ID",studyAcronym:"",description:"Parent study accession number and subject identifier.",type:"Categorical",allowFiltering:!0}};let b={ref:S,selected:!0,variableId:S.conceptPath,variableName:S.display||((se=S.searchResult)==null?void 0:se.name),description:(oe=S.searchResult)==null?void 0:oe.description,type:(J=S.searchResult)==null?void 0:J.type};L.push(b)}}Ee.set({...U(),current:0,total:0}),ra(W,{backUrl:"/explorer",backTitle:"Back to Explore",backAction:()=>{je(Ee,Q(U).current=0,Q(U))},title:"Export Data for Research Analysis",children:(r,p)=>{var g=Qe(),m=fe(g);{var S=u=>{var x=Xa(),ne=s(x);const T=ue(()=>[...c,...L]);Ga(ne,{query:w,get rows(){return e(T)}}),a(x),t(u,x)},b=u=>{var x=Ja(),ne=d(s(x),2),T=s(ne);T.__click=[Ya],a(ne),a(x),t(u,x)};D(m,u=>{o().length>0||I().length>0?u(S):u(b,!1)})}t(r,g)},$$slots:{default:!0}}),at(),ae()}kt(["click"]);export{Er as component};
