{"version":3,"file":"_page.svelte-DdXqfXxI.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(picsure)/(public)/dashboard/_page.svelte.js"],"sourcesContent":["import { g as get_store_value, o as onDestroy, i as is_promise, d as noop } from \"../../../../../chunks/lifecycle.js\";\nimport { c as create_ssr_component, a as add_attribute, e as escape, v as validate_component } from \"../../../../../chunks/ssr.js\";\nimport { g as getDrawerStore } from \"../../../../../chunks/stores3.js\";\nimport \"../../../../../chunks/ProgressBar.svelte_svelte_type_style_lang.js\";\nimport { P as ProgressBar } from \"../../../../../chunks/ProgressBar.js\";\nimport { f as features, b as branding } from \"../../../../../chunks/configuration.js\";\nimport { C as Content } from \"../../../../../chunks/Content.js\";\nimport { T as Table } from \"../../../../../chunks/Table.js\";\nimport { w as writable } from \"../../../../../chunks/index2.js\";\nimport { u as user, g as get } from \"../../../../../chunks/User.js\";\nconst DashboardLink = create_ssr_component(($$result, $$props, $$bindings, slots) => {\n  let { data = {\n    row: {\n      additional_info_link: \"\",\n      consentGranted: false\n    }\n  } } = $$props;\n  let link = data.row.additional_info_link;\n  let consentGranted = data.row.consentGranted;\n  if ($$props.data === void 0 && $$bindings.data && data !== void 0) $$bindings.data(data);\n  return `${consentGranted ? `<i class=\"fa-regular fa-circle-check text-3xl text-success-500\"></i>` : `<a${add_attribute(\"href\", link || \"#\", 0)}${add_attribute(\"title\", link ? \"More Info\" : \"Link not available\", 0)} class=\"${\"btn variant-ghost-primary hover:variant-filled-primary\" + escape(!link ? \" opacity-50 cursor-not-allowed\" : \"\", true)}\" target=\"_blank\">More Info</a>`}`;\n});\nconst columns = writable([]);\nconst rows = writable([]);\nfunction fetchDashboard() {\n  return get(\"picsure/proxy/dictionary-api/dashboard\");\n}\nfunction isUserLoggedIn() {\n  return false;\n}\nasync function loadDashboardData() {\n  const dashboardData = await fetchDashboard();\n  columns.set(dashboardData.columns);\n  const loggedInUser = get_store_value(user);\n  const useConsents = isUserLoggedIn() && loggedInUser?.queryTemplate;\n  let consents = [];\n  if (useConsents) {\n    consents = loggedInUser.queryTemplate?.categoryFilters?.[\"\\\\_consents\\\\\"] || [];\n  }\n  const processedRows = dashboardData.rows.map(processRow(consents));\n  const sortedRows = processedRows.sort((a, b) => {\n    const aIsAnvil = (a.program_name?.toString().toLowerCase() || \"\") === \"anvil\";\n    const bIsAnvil = (b.program_name?.toString().toLowerCase() || \"\") === \"anvil\";\n    if (aIsAnvil !== bIsAnvil) {\n      return aIsAnvil ? 1 : -1;\n    }\n    if (a.consentGranted === b.consentGranted) {\n      return sortByAbbreviation(a, b);\n    }\n    return a.consentGranted ? -1 : 1;\n  });\n  rows.set(sortedRows);\n}\nfunction processRow(consents) {\n  return (row) => {\n    if (!row.accession) {\n      return { ...row, consentGranted: false };\n    }\n    const accession = row.accession.toString();\n    const accessionRegex = /^phs\\d+\\.v\\d+\\.p\\d+\\.c\\d+$/;\n    if (accessionRegex.test(accession)) {\n      const accessionBase = accession.replace(/\\.v\\d+\\.p\\d+/, \"\");\n      return { ...row, consentGranted: consents.includes(accessionBase) };\n    }\n    return { ...row, consentGranted: consents.includes(accession) };\n  };\n}\nfunction sortByAbbreviation(a, b) {\n  const aAbbr = a.abbreviation?.toString() || \"\";\n  const bAbbr = b.abbreviation?.toString() || \"\";\n  return aAbbr.localeCompare(bAbbr);\n}\nconst tableName = \"ExplorerTable\";\nconst Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {\n  const drawerStore = getDrawerStore();\n  let currentColumns = [];\n  let currentRows = [];\n  const cellOverides = { additional_info_link: DashboardLink };\n  const dataLoadPromise = loadDashboardData();\n  onDestroy(() => {\n  });\n  function rowClickHandler(row) {\n    drawerStore.open({ id: \"dashboard-drawer\", meta: { row } });\n  }\n  return `${$$result.head += `<!-- HEAD_svelte-1uz9aip_START -->${$$result.title = `<title>${escape(branding.applicationName)}</title>`, \"\"}<!-- HEAD_svelte-1uz9aip_END -->`, \"\"} ${validate_component(Content, \"Content\").$$render(\n    $$result,\n    {\n      title: \"Data Dashboard\",\n      class: \"content-center\",\n      full: true\n    },\n    {},\n    {\n      default: () => {\n        return `<section id=\"data-container\" class=\"\">${function(__value) {\n          if (is_promise(__value)) {\n            __value.then(null, noop);\n            return ` ${validate_component(ProgressBar, \"ProgressBar\").$$render($$result, { animIndeterminate: \"anim-progress-bar\" }, {}, {})} `;\n          }\n          return function() {\n            return ` ${validate_component(Table, \"Datatable\").$$render(\n              $$result,\n              {\n                tableName,\n                data: currentRows,\n                columns: currentColumns,\n                cellOverides,\n                defaultRowsPerPage: currentRows.length,\n                search: false,\n                showPagination: false,\n                stickyHeader: true,\n                rowClickHandler,\n                isClickable: features.dashboardDrawer\n              },\n              {},\n              {}\n            )} `;\n          }();\n        }(dataLoadPromise)}</section>`;\n      }\n    }\n  )}`;\n});\nexport {\n  Page as default\n};\n"],"names":[],"mappings":"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"}