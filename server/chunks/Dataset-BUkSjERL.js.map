{"version":3,"file":"Dataset-BUkSjERL.js","sources":["../../../.svelte-kit/adapter-node/chunks/Dataset.js"],"sourcesContent":["import { d as derived, w as writable } from \"./index2.js\";\nimport { g as get, b as put } from \"./User.js\";\nimport { g as get_store_value } from \"./utils.js\";\nfunction secondsToDate(seconds) {\n  const dt = new Date(seconds);\n  const year = dt.toLocaleString(\"default\", { year: \"numeric\" });\n  const month = dt.toLocaleString(\"default\", { month: \"2-digit\" });\n  const day = dt.toLocaleString(\"default\", { day: \"2-digit\" });\n  return year + \"-\" + month + \"-\" + day;\n}\nfunction mapDataset(data) {\n  let query, federated;\n  try {\n    const jsonQuery = JSON.parse(data.query.query);\n    query = jsonQuery?.query;\n    if (jsonQuery?.commonAreaUUID) {\n      federated = {\n        commonId: jsonQuery?.commonAreaUUID\n      };\n    }\n  } catch (_) {\n    query = {};\n  }\n  const dataset = {\n    uuid: data.uuid,\n    user: data.user,\n    name: data.name,\n    archived: data.archived,\n    metadata: data.metadata,\n    query,\n    federated,\n    queryId: data.query.uuid,\n    startTime: secondsToDate(data.query.startTime),\n    rawStartTime: data.query.startTime\n  };\n  return dataset;\n}\nconst datasets = writable([]);\nconst active = derived(\n  datasets,\n  ($ds) => $ds.filter((ds) => !ds.archived).sort((a, b) => b.rawStartTime - a.rawStartTime)\n);\nconst archived = derived(datasets, ($ds) => $ds.filter((ds) => ds.archived));\nasync function loadDatasets() {\n  const res = await get(\"picsure/dataset/named\");\n  datasets.set(res.map(mapDataset));\n}\nasync function toggleArchived(uuid) {\n  const store = get_store_value(datasets);\n  const datasetIndex = store.findIndex((ds) => ds.uuid === uuid);\n  if (datasetIndex === -1) {\n    return Promise.reject(\"Could not find dataset in store.\");\n  }\n  const dataset = store[datasetIndex];\n  const request = {\n    queryId: dataset?.queryId,\n    name: dataset?.name,\n    metadata: dataset?.metadata,\n    archived: !dataset?.archived\n  };\n  const res = await put(`picsure/dataset/named/${uuid}`, request);\n  store[datasetIndex] = mapDataset(res);\n  datasets.set(store);\n}\nasync function getDataset(uuid) {\n  const store = get_store_value(datasets);\n  const datasetIndex = store.findIndex((ds) => ds.uuid === uuid);\n  if (datasetIndex > -1) {\n    return store[datasetIndex];\n  }\n  const res = await get(`picsure/dataset/named/${uuid}`);\n  return mapDataset(res);\n}\nconst DataSetStore = {\n  subscribe: datasets.subscribe,\n  active,\n  archived,\n  loadDatasets,\n  toggleArchived,\n  getDataset\n};\nexport {\n  DataSetStore as D\n};\n"],"names":[],"mappings":"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"}