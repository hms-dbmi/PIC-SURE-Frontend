{"version":3,"file":"_page.svelte-DQJsUPOn.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(picsure)/(authorized)/(admin)/admin/users/_page.svelte.js"],"sourcesContent":["import { A as push, E as attr, G as stringify, F as escape_html, C as pop, I as attr_class, W as head, S as await_block, P as ensure_array_like, K as store_get, M as unsubscribe_stores } from \"../../../../../../../chunks/index.js\";\nimport { r as readable, i as derived } from \"../../../../../../../chunks/exports.js\";\nimport { g as goto } from \"../../../../../../../chunks/client.js\";\nimport { b as branding } from \"../../../../../../../chunks/configuration.js\";\nimport { C as Content } from \"../../../../../../../chunks/Content.js\";\nimport { S as StaticTable } from \"../../../../../../../chunks/StaticTable.js\";\nimport { t as toaster } from \"../../../../../../../chunks/toaster.js\";\nimport { g as getUser, u as updateUser, U as UsersStore } from \"../../../../../../../chunks/Users.js\";\nimport { g as getConnection, C as ConnectionsStore } from \"../../../../../../../chunks/Connections.js\";\nimport { g as getRole, R as RoleStore } from \"../../../../../../../chunks/Roles.js\";\nimport { g as getPrivilege } from \"../../../../../../../chunks/Privileges.js\";\nimport { M as Modal_1 } from \"../../../../../../../chunks/Modal.js\";\nimport { L as Loading } from \"../../../../../../../chunks/Loading.js\";\nfunction Actions($$payload, $$props) {\n  push();\n  let {\n    data = { cell: \"\", row: { status: \"\", email: \"\" } }\n  } = $$props;\n  const active = data.row.status === \"Active\";\n  async function toggleActivate(active2) {\n    const user = await getUser(data.cell);\n    if (!user) return;\n    const connection = await getConnection(user.connection);\n    const roles = await Promise.all(user.roles.map((uuid) => getRole(uuid).then((role) => ({\n      ...role,\n      privileges: role.privileges.map((uuid2) => getPrivilege(uuid2))\n    }))));\n    if (!(user && connection && roles.length > 0)) return;\n    let newUser = { ...user, active: active2, connection, roles };\n    try {\n      await updateUser(newUser);\n      toaster.success({\n        title: `Successfully ${active2 ? \"r\" : \"d\"}eactivated user '${newUser.email}'`\n      });\n    } catch (error) {\n      console.error(error);\n      toaster.error({\n        title: `An error occured while ${active2 ? \"r\" : \"d\"}eactivating user '${user.email}'`\n      });\n    }\n  }\n  if (active) {\n    $$payload.out += \"<!--[-->\";\n    $$payload.out += `<button${attr(\"data-testid\", `user-${stringify(data.cell)}-edit-btn`)} type=\"button\" title=\"Edit\" aria-label=\"Edit\" class=\"btn-icon-color\"><i class=\"fa-solid fa-pen-to-square fa-xl\"></i></button>`;\n  } else {\n    $$payload.out += \"<!--[!-->\";\n  }\n  $$payload.out += `<!--]--> `;\n  {\n    let trigger = function($$payload2) {\n      $$payload2.out += `<button${attr(\"data-testid\", `user-${stringify(active ? \"d\" : \"r\")}eactivate-btn-${stringify(data.cell)}`)} type=\"button\"${attr(\"title\", `${stringify(active ? \"D\" : \"R\")}eactivate user`)}${attr(\"aria-label\", `${stringify(active ? \"D\" : \"R\")}eactivate user`)} class=\"btn-icon-color\"><i${attr_class(`fa-solid fa-trash${stringify(active ? \"\" : \"-arrow-up\")} fa-xl`)}></i></button>`;\n    };\n    Modal_1($$payload, {\n      \"data-testid\": `user-${stringify(data.cell)}-${stringify(active ? \"D\" : \"R\")}eactivate-btn`,\n      title: `${stringify(active ? \"D\" : \"R\")}eactivate User?`,\n      confirmText: `${stringify(active ? \"D\" : \"R\")}eactivate`,\n      onconfirm: () => toggleActivate(!active),\n      withDefault: true,\n      trigger,\n      children: ($$payload2) => {\n        $$payload2.out += `<!---->Are you sure you want to ${escape_html(active ? \"d\" : \"r\")}eactiveate user '${escape_html(data.row.email)}'?`;\n      },\n      $$slots: { trigger: true, default: true }\n    });\n  }\n  $$payload.out += `<!---->`;\n  pop();\n}\nfunction Status($$payload, $$props) {\n  push();\n  let { data = { cell: \"\", row: {} } } = $$props;\n  $$payload.out += `<span${attr_class(`badge last:p-1 rounded-sm preset-filled-${data.cell === \"Active\" ? \"success\" : \"error\"}-500`)}>${escape_html(data.cell)}</span>`;\n  pop();\n}\nfunction _page($$payload, $$props) {\n  push();\n  var $$store_subs;\n  let { users, loadUsers } = UsersStore;\n  let { connections, loadConnections } = ConnectionsStore;\n  let { roles, loadRoles } = RoleStore;\n  let usersByConnection = readable([]);\n  const columns = [\n    {\n      dataElement: \"email\",\n      label: \"Username\",\n      sort: true,\n      class: \"w-1/3\"\n    },\n    {\n      dataElement: \"roles\",\n      label: \"Role(s)\",\n      sort: true,\n      class: \"normal-case!\"\n    },\n    {\n      dataElement: \"status\",\n      label: \"Status\",\n      sort: true,\n      class: \"w-24 text-center\"\n    },\n    {\n      dataElement: \"uuid\",\n      label: \"Actions\",\n      sort: false,\n      class: \"w-24 text-center\"\n    }\n  ];\n  const cellOverides = { status: Status, uuid: Actions };\n  async function load() {\n    await loadConnections();\n    await loadRoles();\n    await loadUsers();\n    usersByConnection = derived([users, connections, roles], ([$u, $c, $r]) => {\n      return $c.map((connection) => ({\n        label: connection.label,\n        users: $u.filter((user) => connection.uuid === user.connection).map((row) => ({\n          uuid: row.uuid || \"\",\n          email: row.email || \"uuid:\" + row.uuid,\n          roles: row.roles.length === 0 ? \"none\" : row.roles.map((role) => $r.find((r) => r.uuid === role)?.name).sort().join(\", \"),\n          status: row.active ? \"Active\" : \"Inactive\"\n        })).sort((uA, uB) => uA.status.localeCompare(uB.status))\n      }));\n    });\n  }\n  const rowClickHandler = (row) => {\n    row?.uuid;\n    goto();\n  };\n  head($$payload, ($$payload2) => {\n    $$payload2.title = `<title>${escape_html(branding.applicationName)} | Manage Users</title>`;\n  });\n  Content($$payload, {\n    title: \"Manage Users\",\n    children: ($$payload2) => {\n      await_block(\n        $$payload2,\n        load(),\n        () => {\n          Loading($$payload2, {});\n        },\n        () => {\n          const each_array = ensure_array_like(store_get($$store_subs ??= {}, \"$usersByConnection\", usersByConnection));\n          $$payload2.out += `<div class=\"flex gap-4 mb-6\"><div class=\"flex-auto\"><a data-testid=\"add-user-btn\" class=\"btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500\" href=\"/admin/users/new\">+ Add User</a></div></div> <!--[-->`;\n          for (let $$index = 0, $$length = each_array.length; $$index < $$length; $$index++) {\n            let connection = each_array[$$index];\n            $$payload2.out += `<div${attr(\"id\", `user-table-${connection.label.replaceAll(\" \", \"_\")}`)} class=\"mb-10\">`;\n            StaticTable($$payload2, {\n              tableName: `Users-${stringify(connection.label)}`,\n              data: connection.users,\n              columns,\n              cellOverides,\n              title: connection.label,\n              rowClickHandler,\n              isClickable: true,\n              searchable: true,\n              tableAuto: false\n            });\n            $$payload2.out += `<!----></div>`;\n          }\n          $$payload2.out += `<!--]-->`;\n        }\n      );\n      $$payload2.out += `<!--]-->`;\n    }\n  });\n  if ($$store_subs) unsubscribe_stores($$store_subs);\n  pop();\n}\nexport {\n  _page as default\n};\n"],"names":[],"mappings":"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"}