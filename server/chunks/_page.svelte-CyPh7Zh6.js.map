{"version":3,"file":"_page.svelte-CyPh7Zh6.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(picsure)/(public)/dashboard/_page.svelte.js"],"sourcesContent":["import { g as get_store_value, i as is_promise, a as noop } from \"../../../../../chunks/utils.js\";\nimport { c as create_ssr_component, a as add_attribute, o as onDestroy, e as escape, v as validate_component } from \"../../../../../chunks/ssr.js\";\nimport \"../../../../../chunks/ProgressBar.svelte_svelte_type_style_lang.js\";\nimport { P as ProgressBar } from \"../../../../../chunks/ProgressBar.js\";\nimport { f as features, b as branding } from \"../../../../../chunks/configuration.js\";\nimport { C as Content } from \"../../../../../chunks/Content.js\";\nimport { T as Table } from \"../../../../../chunks/Table.js\";\nimport { w as writable } from \"../../../../../chunks/index2.js\";\nimport { u as user, g as get } from \"../../../../../chunks/User.js\";\nconst DashboardLink = create_ssr_component(($$result, $$props, $$bindings, slots) => {\n  let { data = {\n    row: {\n      additional_info_link: \"\",\n      consentGranted: false\n    }\n  } } = $$props;\n  let link = data.row.additional_info_link;\n  let consentGranted = data.row.consentGranted;\n  if ($$props.data === void 0 && $$bindings.data && data !== void 0) $$bindings.data(data);\n  return `${consentGranted ? `<i class=\"fa-regular fa-circle-check text-3xl text-success-500\"></i>` : `<a${add_attribute(\"href\", link, 0)} class=\"btn variant-ghost-primary hover:variant-filled-primary\" target=\"_blank\">More Info</a>`}`;\n});\nconst columns = writable([]);\nconst rows = writable([]);\nfunction fetchDashboard() {\n  return get(\"picsure/proxy/dictionary-api/dashboard\");\n}\nfunction isUserLoggedIn() {\n  return false;\n}\nasync function loadDashboardData() {\n  const dashboardData = await fetchDashboard();\n  columns.set(dashboardData.columns);\n  const loggedInUser = get_store_value(user);\n  const useConsents = features.useQueryTemplate && isUserLoggedIn() && loggedInUser?.queryTemplate;\n  let consents = [];\n  if (useConsents) {\n    consents = loggedInUser.queryTemplate?.categoryFilters?.[\"\\\\_consents\\\\\"] || [];\n  }\n  const processedRows = dashboardData.rows.map(processRow(consents));\n  const sortedRows = processedRows.sort((a, b) => {\n    if (a.consentGranted === b.consentGranted) {\n      return sortByAbbreviation(a, b);\n    }\n    return a.consentGranted ? -1 : 1;\n  });\n  rows.set(sortedRows);\n}\nfunction processRow(consents) {\n  return (row) => {\n    if (!row.accession) {\n      return { ...row, consentGranted: false };\n    }\n    const accession = row.accession.toString();\n    const accessionRegex = /^phs\\d+\\.v\\d+\\.p\\d+\\.c\\d+$/;\n    if (accessionRegex.test(accession)) {\n      const accessionBase = accession.replace(/\\.v\\d+\\.p\\d+/, \"\");\n      return { ...row, consentGranted: consents.includes(accessionBase) };\n    }\n    return { ...row, consentGranted: consents.includes(accession) };\n  };\n}\nfunction sortByAbbreviation(a, b) {\n  const aAbbr = a.abbreviation?.toString() || \"\";\n  const bAbbr = b.abbreviation?.toString() || \"\";\n  return aAbbr.localeCompare(bAbbr);\n}\nconst tableName = \"ExplorerTable\";\nconst Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {\n  let currentColumns = [];\n  let currentRows = [];\n  const cellOverides = { additional_info_link: DashboardLink };\n  const dataLoadPromise = loadDashboardData();\n  onDestroy(() => {\n  });\n  return `${$$result.head += `<!-- HEAD_svelte-1uz9aip_START -->${$$result.title = `<title>${escape(branding.applicationName)}</title>`, \"\"}<!-- HEAD_svelte-1uz9aip_END -->`, \"\"} ${validate_component(Content, \"Content\").$$render(\n    $$result,\n    {\n      title: \"Data Dashboard\",\n      class: \"content-center\",\n      full: true\n    },\n    {},\n    {\n      default: () => {\n        return `<section id=\"data-container\" class=\"\">${function(__value) {\n          if (is_promise(__value)) {\n            __value.then(null, noop);\n            return ` ${validate_component(ProgressBar, \"ProgressBar\").$$render($$result, { animIndeterminate: \"anim-progress-bar\" }, {}, {})} `;\n          }\n          return function() {\n            return ` ${validate_component(Table, \"Datatable\").$$render(\n              $$result,\n              {\n                tableName,\n                data: currentRows,\n                columns: currentColumns,\n                cellOverides,\n                defaultRowsPerPage: currentRows.length,\n                search: false,\n                showPagination: false,\n                stickyHeader: true\n              },\n              {},\n              {}\n            )} `;\n          }();\n        }(dataLoadPromise)}</section>`;\n      }\n    }\n  )}`;\n});\nexport {\n  Page as default\n};\n"],"names":[],"mappings":"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"}