{"version":3,"file":"Roles-DREcG-yb.js","sources":["../../../.svelte-kit/adapter-node/chunks/Roles.js"],"sourcesContent":["import { d as derived, w as writable } from \"./index2.js\";\nimport { g as get, p as post, b as put, d as del } from \"./User.js\";\nimport { g as get_store_value } from \"./utils.js\";\nfunction mapRole(data) {\n  return {\n    ...data,\n    privileges: data.privileges ? data.privileges.map((p) => p.uuid) : []\n  };\n}\nconst ROLE_PATH = \"psama/role\";\nconst loaded = writable(false);\nconst roles = writable([]);\nconst roleList = derived(roles, ($r) => $r.map((r) => [r.name, r.uuid || \"\"]), []);\nasync function loadRoles() {\n  if (get_store_value(loaded)) return;\n  const res = await get(ROLE_PATH);\n  roles.set(res.map(mapRole));\n  loaded.set(true);\n}\nasync function getRole(uuid) {\n  const store = get_store_value(roles);\n  const role = store.find((r) => r.uuid === uuid);\n  if (role) {\n    return role;\n  }\n  const res = await get(`${ROLE_PATH}/${uuid}`);\n  return mapRole(res);\n}\nasync function addRole(role) {\n  const res = await post(ROLE_PATH, [\n    {\n      ...role,\n      privileges: role.privileges.map((p) => ({ uuid: p }))\n    }\n  ]);\n  const newRole = mapRole(res.content[0]);\n  const store = get_store_value(roles);\n  store.push(newRole);\n  roles.set(store);\n}\nasync function updateRole(role) {\n  const res = await put(ROLE_PATH, [\n    {\n      ...role,\n      privileges: role.privileges.map((p) => ({ uuid: p }))\n    }\n  ]);\n  const newRole = mapRole(res.content[0]);\n  const store = get_store_value(roles);\n  const roleIndex = store.findIndex((r) => r.uuid === newRole.uuid);\n  if (roleIndex === -1) {\n    store.push(newRole);\n  } else {\n    store[roleIndex] = newRole;\n  }\n  roles.set(store);\n}\nasync function deleteRole(uuid) {\n  await del(`${ROLE_PATH}/${uuid}`);\n  const store = get_store_value(roles);\n  const roleIndex = store.findIndex((r) => r.uuid === uuid);\n  if (roleIndex > -1) {\n    store.splice(roleIndex, 1);\n    roles.set(store);\n  }\n}\nconst RoleStore = {\n  subscribe: roles.subscribe,\n  roles,\n  roleList,\n  loadRoles,\n  getRole,\n  addRole,\n  updateRole,\n  deleteRole\n};\nexport {\n  RoleStore as R\n};\n"],"names":[],"mappings":"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"}