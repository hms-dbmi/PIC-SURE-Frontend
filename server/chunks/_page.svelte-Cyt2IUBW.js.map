{"version":3,"file":"_page.svelte-Cyt2IUBW.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(picsure)/(authorized)/explorer/export/_page.svelte.js"],"sourcesContent":["import { g as get_store_value, a as subscribe } from \"../../../../../../chunks/lifecycle.js\";\nimport { c as create_ssr_component, v as validate_component } from \"../../../../../../chunks/ssr.js\";\nimport { s as state, E as ExportStepper } from \"../../../../../../chunks/ExportStepper.js\";\nimport { f as filters } from \"../../../../../../chunks/Filter.js\";\nimport { E as ExportStore } from \"../../../../../../chunks/Export.js\";\nimport { C as Content } from \"../../../../../../chunks/Content.js\";\nimport { a as resources } from \"../../../../../../chunks/configuration.js\";\nimport \"../../../../../../chunks/User.js\";\nclass Query {\n  categoryFilters;\n  numericFilters;\n  requiredFields;\n  anyRecordOf;\n  fields;\n  crossCountFields;\n  variantInfoFilters;\n  expectedResultType;\n  constructor(newQuery) {\n    this.categoryFilters = newQuery?.categoryFilters || {};\n    this.numericFilters = newQuery?.numericFilters || {};\n    this.requiredFields = newQuery?.requiredFields || [];\n    this.anyRecordOf = newQuery?.anyRecordOf || [];\n    this.crossCountFields = newQuery?.crossCountFields || void 0;\n    this.fields = newQuery?.fields || [];\n    const variantInfoFilter = newQuery?.variantInfoFilters?.[0] || {\n      categoryVariantInfoFilters: {},\n      numericVariantInfoFilters: {}\n    };\n    this.variantInfoFilters = [variantInfoFilter];\n    this.expectedResultType = newQuery?.expectedResultType || \"COUNT\";\n  }\n  addCategoryFilter(key, value) {\n    this.categoryFilters[key] = value;\n  }\n  removeCategoryFilter(key) {\n    delete this.categoryFilters[key];\n  }\n  addNumericFilter(key, min, max) {\n    this.numericFilters[key] = {\n      min: min.toString(),\n      max: max.toString()\n    };\n  }\n  addCategoryVariantInfoFilters(filter) {\n    this.variantInfoFilters[0].categoryVariantInfoFilters = {\n      Gene_with_variant: filter.Gene_with_variant,\n      Variant_consequence_calculated: filter.Variant_consequence_calculated,\n      Variant_frequency_as_text: filter.Variant_frequency_as_text\n    };\n  }\n  setCrossCountFields(fields) {\n    this.crossCountFields = fields;\n  }\n  addSnpFilter(snps) {\n    snps.forEach((snp) => {\n      {\n        this.categoryFilters[snp.search] = snp.constraint.split(\",\");\n      }\n    });\n  }\n  addRequiredField(field) {\n    this.requiredFields.push(field);\n  }\n  addAnyRecordOf(field) {\n    this.anyRecordOf.push(field);\n  }\n  hasFilter() {\n    const Gene_with_variant = this.variantInfoFilters[0]?.categoryVariantInfoFilters?.Gene_with_variant?.length || 0;\n    const Variant_consequence_calculated = this.variantInfoFilters[0]?.categoryVariantInfoFilters?.Variant_consequence_calculated?.length || 0;\n    const Variant_frequency_as_text = this.variantInfoFilters[0]?.categoryVariantInfoFilters?.Variant_frequency_as_text?.length || 0;\n    return Object.keys(this.categoryFilters).length + Object.keys(this.numericFilters).length + Gene_with_variant + Variant_consequence_calculated + Variant_frequency_as_text + this.requiredFields.length + this.anyRecordOf.length;\n  }\n}\nfunction getQueryRequest(addConsents = true, resourceUUID = resources.hpds, expectedResultType = \"COUNT\") {\n  let query = new Query();\n  get_store_value(filters).forEach((filter) => {\n    if (filter.filterType === \"Categorical\") {\n      if (filter.displayType === \"restrict\") {\n        query.addCategoryFilter(filter.id, filter.categoryValues);\n      } else {\n        query.addRequiredField(filter.id);\n      }\n    } else if (filter.filterType === \"numeric\") {\n      query.addNumericFilter(filter.id, filter.min || \"\", filter.max || \"\");\n    } else if (filter.filterType === \"genomic\") {\n      query.addCategoryVariantInfoFilters({\n        Gene_with_variant: filter.Gene_with_variant,\n        Variant_consequence_calculated: filter.Variant_consequence_calculated,\n        Variant_frequency_as_text: filter.Variant_frequency_as_text\n      });\n    } else if (filter.filterType === \"snp\") {\n      query.addSnpFilter(filter.snpValues);\n    }\n  });\n  query.expectedResultType = expectedResultType;\n  return {\n    query,\n    resourceUUID\n  };\n}\nconst Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {\n  let $filters, $$unsubscribe_filters;\n  let $exports, $$unsubscribe_exports;\n  let $state, $$unsubscribe_state;\n  $$unsubscribe_filters = subscribe(filters, (value) => $filters = value);\n  $$unsubscribe_state = subscribe(state, (value) => $state = value);\n  let { exports } = ExportStore;\n  $$unsubscribe_exports = subscribe(exports, (value) => $exports = value);\n  let queryRequest = getQueryRequest(true);\n  let exportRows = $exports.map((exp) => {\n    return {\n      ref: exp,\n      selected: true,\n      variableId: exp.conceptPath,\n      variableName: exp.display || exp.searchResult?.display,\n      description: exp.searchResult?.description,\n      type: exp.searchResult?.type\n    };\n  });\n  let filterRows = $filters.map((filter) => {\n    return {\n      ref: filter,\n      selected: true,\n      variableId: filter.id,\n      variableName: filter.searchResult?.display || filter.variableName,\n      description: filter.searchResult?.description,\n      type: filter.searchResult?.type\n    };\n  });\n  state.set({ current: 0, total: 0 });\n  $$unsubscribe_filters();\n  $$unsubscribe_exports();\n  $$unsubscribe_state();\n  return `${validate_component(Content, \"Content\").$$render(\n    $$result,\n    {\n      backUrl: \"/explorer\",\n      backTitle: \"Back to Explore\",\n      backAction: () => {\n        $state.current = 0;\n      },\n      title: \"Export Data for Research Analysis\"\n    },\n    {},\n    {\n      default: () => {\n        return `${$exports.length > 0 || $filters.length > 0 ? `<section class=\"flex justify-center items-center w-full h-full mt-8\">${validate_component(ExportStepper, \"ExportStepper\").$$render(\n          $$result,\n          {\n            query: queryRequest,\n            rows: [...filterRows, ...exportRows]\n          },\n          {},\n          {}\n        )}</section>` : `<div class=\"flex flex-col items-center justify-center m-8\"><p data-svelte-h=\"svelte-1xd42eg\">No filters or exports have been created.</p> <div class=\"flex gap-4\"><button class=\"btn variant-filled-primary m-4\" data-svelte-h=\"svelte-1yq884x\">Learn How</button></div></div>`}`;\n      }\n    }\n  )}`;\n});\nexport {\n  Page as default\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAQA,MAAM,KAAK,CAAC;AACZ,EAAE,eAAe;AACjB,EAAE,cAAc;AAChB,EAAE,cAAc;AAChB,EAAE,WAAW;AACb,EAAE,MAAM;AACR,EAAE,gBAAgB;AAClB,EAAE,kBAAkB;AACpB,EAAE,kBAAkB;AACpB,EAAE,WAAW,CAAC,QAAQ,EAAE;AACxB,IAAI,IAAI,CAAC,eAAe,GAAG,QAAQ,EAAE,eAAe,IAAI,EAAE;AAC1D,IAAI,IAAI,CAAC,cAAc,GAAG,QAAQ,EAAE,cAAc,IAAI,EAAE;AACxD,IAAI,IAAI,CAAC,cAAc,GAAG,QAAQ,EAAE,cAAc,IAAI,EAAE;AACxD,IAAI,IAAI,CAAC,WAAW,GAAG,QAAQ,EAAE,WAAW,IAAI,EAAE;AAClD,IAAI,IAAI,CAAC,gBAAgB,GAAG,QAAQ,EAAE,gBAAgB,IAAI,KAAK,CAAC;AAChE,IAAI,IAAI,CAAC,MAAM,GAAG,QAAQ,EAAE,MAAM,IAAI,EAAE;AACxC,IAAI,MAAM,iBAAiB,GAAG,QAAQ,EAAE,kBAAkB,GAAG,CAAC,CAAC,IAAI;AACnE,MAAM,0BAA0B,EAAE,EAAE;AACpC,MAAM,yBAAyB,EAAE;AACjC,KAAK;AACL,IAAI,IAAI,CAAC,kBAAkB,GAAG,CAAC,iBAAiB,CAAC;AACjD,IAAI,IAAI,CAAC,kBAAkB,GAAG,QAAQ,EAAE,kBAAkB,IAAI,OAAO;AACrE;AACA,EAAE,iBAAiB,CAAC,GAAG,EAAE,KAAK,EAAE;AAChC,IAAI,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,GAAG,KAAK;AACrC;AACA,EAAE,oBAAoB,CAAC,GAAG,EAAE;AAC5B,IAAI,OAAO,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC;AACpC;AACA,EAAE,gBAAgB,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE;AAClC,IAAI,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,GAAG;AAC/B,MAAM,GAAG,EAAE,GAAG,CAAC,QAAQ,EAAE;AACzB,MAAM,GAAG,EAAE,GAAG,CAAC,QAAQ;AACvB,KAAK;AACL;AACA,EAAE,6BAA6B,CAAC,MAAM,EAAE;AACxC,IAAI,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC,0BAA0B,GAAG;AAC5D,MAAM,iBAAiB,EAAE,MAAM,CAAC,iBAAiB;AACjD,MAAM,8BAA8B,EAAE,MAAM,CAAC,8BAA8B;AAC3E,MAAM,yBAAyB,EAAE,MAAM,CAAC;AACxC,KAAK;AACL;AACA,EAAE,mBAAmB,CAAC,MAAM,EAAE;AAC9B,IAAI,IAAI,CAAC,gBAAgB,GAAG,MAAM;AAClC;AACA,EAAE,YAAY,CAAC,IAAI,EAAE;AACrB,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,KAAK;AAC1B,MAAM;AACN,QAAQ,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC;AACpE;AACA,KAAK,CAAC;AACN;AACA,EAAE,gBAAgB,CAAC,KAAK,EAAE;AAC1B,IAAI,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC;AACnC;AACA,EAAE,cAAc,CAAC,KAAK,EAAE;AACxB,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC;AAChC;AACA,EAAE,SAAS,GAAG;AACd,IAAI,MAAM,iBAAiB,GAAG,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,EAAE,0BAA0B,EAAE,iBAAiB,EAAE,MAAM,IAAI,CAAC;AACpH,IAAI,MAAM,8BAA8B,GAAG,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,EAAE,0BAA0B,EAAE,8BAA8B,EAAE,MAAM,IAAI,CAAC;AAC9I,IAAI,MAAM,yBAAyB,GAAG,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,EAAE,0BAA0B,EAAE,yBAAyB,EAAE,MAAM,IAAI,CAAC;AACpI,IAAI,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,MAAM,GAAG,iBAAiB,GAAG,8BAA8B,GAAG,yBAAyB,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM;AACrO;AACA;AACA,SAAS,eAAe,CAAC,WAAW,GAAG,IAAI,EAAE,YAAY,GAAG,SAAS,CAAC,IAAI,EAAE,kBAAkB,GAAG,OAAO,EAAE;AAC1G,EAAE,IAAI,KAAK,GAAG,IAAI,KAAK,EAAE;AACzB,EAAE,eAAe,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,CAAC,MAAM,KAAK;AAC/C,IAAI,IAAI,MAAM,CAAC,UAAU,KAAK,aAAa,EAAE;AAC7C,MAAM,IAAI,MAAM,CAAC,WAAW,KAAK,UAAU,EAAE;AAC7C,QAAQ,KAAK,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,cAAc,CAAC;AACjE,OAAO,MAAM;AACb,QAAQ,KAAK,CAAC,gBAAgB,CAAC,MAAM,CAAC,EAAE,CAAC;AACzC;AACA,KAAK,MAAM,IAAI,MAAM,CAAC,UAAU,KAAK,SAAS,EAAE;AAChD,MAAM,KAAK,CAAC,gBAAgB,CAAC,MAAM,CAAC,EAAE,EAAE,MAAM,CAAC,GAAG,IAAI,EAAE,EAAE,MAAM,CAAC,GAAG,IAAI,EAAE,CAAC;AAC3E,KAAK,MAAM,IAAI,MAAM,CAAC,UAAU,KAAK,SAAS,EAAE;AAChD,MAAM,KAAK,CAAC,6BAA6B,CAAC;AAC1C,QAAQ,iBAAiB,EAAE,MAAM,CAAC,iBAAiB;AACnD,QAAQ,8BAA8B,EAAE,MAAM,CAAC,8BAA8B;AAC7E,QAAQ,yBAAyB,EAAE,MAAM,CAAC;AAC1C,OAAO,CAAC;AACR,KAAK,MAAM,IAAI,MAAM,CAAC,UAAU,KAAK,KAAK,EAAE;AAC5C,MAAM,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC,SAAS,CAAC;AAC1C;AACA,GAAG,CAAC;AACJ,EAAE,KAAK,CAAC,kBAAkB,GAAG,kBAAkB;AAC/C,EAAE,OAAO;AACT,IAAI,KAAK;AACT,IAAI;AACJ,GAAG;AACH;AACK,MAAC,IAAI,GAAG,oBAAoB,CAAC,CAAC,QAAQ,EAAE,OAAO,EAAE,UAAU,EAAE,KAAK,KAAK;AAC5E,EAAE,IAAI,QAAQ,EAAE,qBAAqB;AACrC,EAAE,IAAI,QAAQ,EAAE,qBAAqB;AACrC,EAAE,IAAI,MAAM,EAAE,mBAAmB;AACjC,EAAE,qBAAqB,GAAG,SAAS,CAAC,OAAO,EAAE,CAAC,KAAK,KAAK,QAAQ,GAAG,KAAK,CAAC;AACzE,EAAE,mBAAmB,GAAG,SAAS,CAAC,KAAK,EAAE,CAAC,KAAK,KAAK,MAAM,GAAG,KAAK,CAAC;AACnE,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,WAAW;AAC/B,EAAE,qBAAqB,GAAG,SAAS,CAAC,OAAO,EAAE,CAAC,KAAK,KAAK,QAAQ,GAAG,KAAK,CAAC;AACzE,EAAE,IAAI,YAAY,GAAG,eAAe,CAAC,IAAI,CAAC;AAC1C,EAAE,IAAI,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK;AACzC,IAAI,OAAO;AACX,MAAM,GAAG,EAAE,GAAG;AACd,MAAM,QAAQ,EAAE,IAAI;AACpB,MAAM,UAAU,EAAE,GAAG,CAAC,WAAW;AACjC,MAAM,YAAY,EAAE,GAAG,CAAC,OAAO,IAAI,GAAG,CAAC,YAAY,EAAE,OAAO;AAC5D,MAAM,WAAW,EAAE,GAAG,CAAC,YAAY,EAAE,WAAW;AAChD,MAAM,IAAI,EAAE,GAAG,CAAC,YAAY,EAAE;AAC9B,KAAK;AACL,GAAG,CAAC;AACJ,EAAE,IAAI,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK;AAC5C,IAAI,OAAO;AACX,MAAM,GAAG,EAAE,MAAM;AACjB,MAAM,QAAQ,EAAE,IAAI;AACpB,MAAM,UAAU,EAAE,MAAM,CAAC,EAAE;AAC3B,MAAM,YAAY,EAAE,MAAM,CAAC,YAAY,EAAE,OAAO,IAAI,MAAM,CAAC,YAAY;AACvE,MAAM,WAAW,EAAE,MAAM,CAAC,YAAY,EAAE,WAAW;AACnD,MAAM,IAAI,EAAE,MAAM,CAAC,YAAY,EAAE;AACjC,KAAK;AACL,GAAG,CAAC;AACJ,EAAE,KAAK,CAAC,GAAG,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC;AACrC,EAAE,qBAAqB,EAAE;AACzB,EAAE,qBAAqB,EAAE;AACzB,EAAE,mBAAmB,EAAE;AACvB,EAAE,OAAO,CAAC,EAAE,kBAAkB,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC,QAAQ;AAC3D,IAAI,QAAQ;AACZ,IAAI;AACJ,MAAM,OAAO,EAAE,WAAW;AAC1B,MAAM,SAAS,EAAE,iBAAiB;AAClC,MAAM,UAAU,EAAE,MAAM;AACxB,QAAQ,MAAM,CAAC,OAAO,GAAG,CAAC;AAC1B,OAAO;AACP,MAAM,KAAK,EAAE;AACb,KAAK;AACL,IAAI,EAAE;AACN,IAAI;AACJ,MAAM,OAAO,EAAE,MAAM;AACrB,QAAQ,OAAO,CAAC,EAAE,QAAQ,CAAC,MAAM,GAAG,CAAC,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,qEAAqE,EAAE,kBAAkB,CAAC,aAAa,EAAE,eAAe,CAAC,CAAC,QAAQ;AAClM,UAAU,QAAQ;AAClB,UAAU;AACV,YAAY,KAAK,EAAE,YAAY;AAC/B,YAAY,IAAI,EAAE,CAAC,GAAG,UAAU,EAAE,GAAG,UAAU;AAC/C,WAAW;AACX,UAAU,EAAE;AACZ,UAAU;AACV,SAAS,CAAC,UAAU,CAAC,GAAG,CAAC,8QAA8Q,CAAC,CAAC,CAAC;AAC1S;AACA;AACA,GAAG,CAAC,CAAC;AACL,CAAC;;;;"}