{"version":3,"file":"Dataset-cbZBLonT.js","sources":["../../../.svelte-kit/adapter-node/chunks/Dataset.js"],"sourcesContent":["import { i as derived, w as writable, j as get$1 } from \"./exports.js\";\nimport { g as get, e as Picsure } from \"./User.js\";\nfunction secondsToDate(seconds) {\n  const dt = new Date(seconds);\n  const year = dt.toLocaleString(\"default\", { year: \"numeric\" });\n  const month = dt.toLocaleString(\"default\", { month: \"2-digit\" });\n  const day = dt.toLocaleString(\"default\", { day: \"2-digit\" });\n  return year + \"-\" + month + \"-\" + day;\n}\nfunction mapDataset(data) {\n  let query, federated;\n  try {\n    const jsonQuery = JSON.parse(data.query.query);\n    query = jsonQuery?.query;\n    if (jsonQuery?.commonAreaUUID) {\n      federated = {\n        commonId: jsonQuery?.commonAreaUUID\n      };\n    }\n  } catch (_) {\n    query = {};\n  }\n  const dataset = {\n    uuid: data.uuid,\n    user: data.user,\n    name: data.name,\n    archived: data.archived,\n    metadata: data.metadata,\n    query,\n    federated,\n    queryId: data.query.uuid,\n    startTime: secondsToDate(data.query.startTime),\n    rawStartTime: data.query.startTime\n  };\n  return dataset;\n}\nconst datasets = writable([]);\nconst active = derived(\n  datasets,\n  ($ds) => $ds.filter((ds) => !ds.archived).sort((a, b) => b.rawStartTime - a.rawStartTime)\n);\nderived(\n  datasets,\n  ($ds) => $ds.filter((ds) => ds.archived)\n);\nasync function loadDatasets() {\n  const res = await get(Picsure.NamedDataSet);\n  datasets.set(res.map(mapDataset));\n}\nasync function getDataset(uuid) {\n  const store = get$1(datasets);\n  const datasetIndex = store.findIndex((ds) => ds.uuid === uuid);\n  if (datasetIndex > -1) {\n    return store[datasetIndex];\n  }\n  const res = await get(`${Picsure.NamedDataSet}/${uuid}`);\n  return mapDataset(res);\n}\n({\n  subscribe: datasets.subscribe\n});\nexport {\n  active as a,\n  getDataset as g,\n  loadDatasets as l\n};\n"],"names":[],"mappings":"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"}