{"version":3,"file":"Privileges-CBKVrBv7.js","sources":["../../../.svelte-kit/adapter-node/chunks/Privileges.js"],"sourcesContent":["import { d as derived, w as writable } from \"./index2.js\";\nimport { m as mapPrivilege } from \"./configuration.js\";\nimport { g as get, p as post, b as put, d as del } from \"./User.js\";\nimport { g as get_store_value } from \"./lifecycle.js\";\nconst PRIV_PATH = \"psama/privilege\";\nconst loaded = writable(false);\nconst privileges = writable([]);\nconst privilegeList = derived(privileges, ($p) => $p.map((p) => [p.name, p.uuid || \"\"]), []);\nasync function loadPrivileges() {\n  if (get_store_value(loaded)) return;\n  const res = await get(PRIV_PATH);\n  privileges.set(res.map(mapPrivilege));\n  loaded.set(true);\n}\nasync function getPrivilege(uuid) {\n  const store = get_store_value(privileges);\n  const privilege = store.find((p) => p.uuid === uuid);\n  if (privilege) {\n    return privilege;\n  }\n  const res = await get(`${PRIV_PATH}/${uuid}`);\n  return mapPrivilege(res);\n}\nasync function addPrivilege(privilege) {\n  const res = await post(PRIV_PATH, [\n    {\n      ...privilege,\n      application: { uuid: privilege.application }\n    }\n  ]);\n  const newPriv = mapPrivilege(res.content[0]);\n  const store = get_store_value(privileges);\n  store.push(newPriv);\n  privileges.set(store);\n}\nasync function updatePrivilege(privilege) {\n  const res = await put(PRIV_PATH, [\n    {\n      ...privilege,\n      application: { uuid: privilege.application }\n    }\n  ]);\n  const newPriv = mapPrivilege(res.content[0]);\n  const store = get_store_value(privileges);\n  const privIndex = store.findIndex((p) => p.uuid === newPriv.uuid);\n  if (privIndex === -1) {\n    store.push(newPriv);\n  } else {\n    store[privIndex] = newPriv;\n  }\n  privileges.set(store);\n}\nasync function deletePrivilege(uuid) {\n  await del(`${PRIV_PATH}/${uuid}`);\n  const store = get_store_value(privileges);\n  const privIndex = store.findIndex((p) => p.uuid === uuid);\n  if (privIndex > -1) {\n    store.splice(privIndex, 1);\n    privileges.set(store);\n  }\n}\nconst PrivilegesStore = {\n  subscribe: privileges.subscribe,\n  privileges,\n  privilegeList,\n  loadPrivileges,\n  getPrivilege,\n  addPrivilege,\n  updatePrivilege,\n  deletePrivilege\n};\nexport {\n  PrivilegesStore as P\n};\n"],"names":[],"mappings":"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"}