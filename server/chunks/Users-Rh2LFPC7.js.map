{"version":3,"file":"Users-Rh2LFPC7.js","sources":["../../../.svelte-kit/adapter-node/chunks/Users.js"],"sourcesContent":["import { w as writable, j as get } from \"./exports.js\";\nimport { g as get$1, e as put } from \"./User.js\";\nfunction mapExtendedUser(data) {\n  return {\n    ...data,\n    connection: data.connection ? data.connection.uuid : \"\",\n    roles: data.roles ? data.roles.map((r) => r.uuid) : []\n  };\n}\nconst USER_URL = \"psama/user\";\nconst loaded = writable(false);\nconst users = writable([]);\nasync function loadUsers() {\n  if (get(loaded)) return;\n  const res = await get$1(USER_URL);\n  users.set(res.map(mapExtendedUser));\n  loaded.set(true);\n}\nasync function getUser(uuid) {\n  const store = get(users);\n  const user = store.find((u) => u.uuid === uuid);\n  if (user) {\n    return user;\n  }\n  const res = await get$1(`${USER_URL}/${uuid}`);\n  return mapExtendedUser(res);\n}\nasync function updateUser(user) {\n  const res = await put(USER_URL, [user]);\n  const newUser = mapExtendedUser(res[0]);\n  const store = get(users);\n  const roleIndex = store.findIndex((r) => r.uuid === newUser.uuid);\n  if (roleIndex === -1) {\n    store.push(newUser);\n  } else {\n    store[roleIndex] = newUser;\n  }\n  users.set(store);\n}\nconst UsersStore = {\n  subscribe: users.subscribe,\n  users,\n  loadUsers,\n  getUser\n};\nexport {\n  UsersStore as U,\n  getUser as g,\n  updateUser as u\n};\n"],"names":[],"mappings":";;;AAEA,SAAS,eAAe,CAAC,IAAI,EAAE;AAC/B,EAAE,OAAO;AACT,IAAI,GAAG,IAAI;AACX,IAAI,UAAU,EAAE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,GAAG,EAAE;AAC3D,IAAI,KAAK,EAAE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,GAAG;AACxD,GAAG;AACH;AACA,MAAM,QAAQ,GAAG,YAAY;AAC7B,MAAM,MAAM,GAAG,QAAQ,CAAC,KAAK,CAAC;AAC9B,MAAM,KAAK,GAAG,QAAQ,CAAC,EAAE,CAAC;AAC1B,eAAe,SAAS,GAAG;AAC3B,EAAE,IAAI,GAAG,CAAC,MAAM,CAAC,EAAE;AACnB,EAAE,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,QAAQ,CAAC;AACnC,EAAE,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;AACrC,EAAE,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC;AAClB;AACA,eAAe,OAAO,CAAC,IAAI,EAAE;AAC7B,EAAE,MAAM,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;AAC1B,EAAE,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC;AACjD,EAAE,IAAI,IAAI,EAAE;AACZ,IAAI,OAAO,IAAI;AACf;AACA,EAAE,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;AAChD,EAAE,OAAO,eAAe,CAAC,GAAG,CAAC;AAC7B;AACA,eAAe,UAAU,CAAC,IAAI,EAAE;AAChC,EAAE,MAAM,GAAG,GAAG,MAAM,GAAG,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,CAAC;AACzC,EAAE,MAAM,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACzC,EAAE,MAAM,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;AAC1B,EAAE,MAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,KAAK,OAAO,CAAC,IAAI,CAAC;AACnE,EAAE,IAAI,SAAS,KAAK,EAAE,EAAE;AACxB,IAAI,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC;AACvB,GAAG,MAAM;AACT,IAAI,KAAK,CAAC,SAAS,CAAC,GAAG,OAAO;AAC9B;AACA,EAAE,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC;AAClB;AACK,MAAC,UAAU,GAAG;AACnB,EAAE,SAAS,EAAE,KAAK,CAAC,SAAS;AAC5B,EAAE,KAAK;AACP,EAAE,SAAS;AACX,EAAE;AACF;;;;"}