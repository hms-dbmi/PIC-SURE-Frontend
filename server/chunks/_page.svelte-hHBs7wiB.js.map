{"version":3,"file":"_page.svelte-hHBs7wiB.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(picsure)/(authorized)/(admin)/admin/configuration/terms/edit/_page.svelte.js"],"sourcesContent":["import { A as push, T as bind_props, D as pop, W as copy_payload, X as assign_payload, a0 as head, E as escape_html, _ as await_block, O as store_get, P as unsubscribe_stores } from \"../../../../../../../../../chunks/index.js\";\nimport { g as goto } from \"../../../../../../../../../chunks/client2.js\";\nimport { c as isTopAdmin, g as get, P as Psama, p as post, t as toaster } from \"../../../../../../../../../chunks/User.js\";\nimport { b as branding } from \"../../../../../../../../../chunks/configuration.js\";\nimport { s as sanitizeHTML } from \"../../../../../../../../../chunks/HTML.js\";\nimport { C as Content } from \"../../../../../../../../../chunks/Content.js\";\nimport { E as ErrorAlert } from \"../../../../../../../../../chunks/ErrorAlert.js\";\nimport { L as Loading } from \"../../../../../../../../../chunks/Loading.js\";\nimport { M as Modal_1 } from \"../../../../../../../../../chunks/Modal.js\";\nimport { h as html } from \"../../../../../../../../../chunks/html2.js\";\nfunction Editor($$payload, $$props) {\n  push();\n  let {\n    content = void 0,\n    embedOptions = false,\n    fontOptions = false,\n    headerDropdown = true,\n    alignOptions = true\n  } = $$props;\n  $$payload.out.push(`<div id=\"editor\" class=\"bg-white dark:bg-black\"></div>`);\n  bind_props($$props, { content });\n  pop();\n}\nfunction _page($$payload, $$props) {\n  push();\n  var $$store_subs;\n  let terms = \"\";\n  let original = \"\";\n  let dirty = terms !== original;\n  let modalOpen = false;\n  async function load() {\n    terms = await get(Psama.TOS + \"/latest\");\n    original = terms;\n  }\n  async function onCommit() {\n    await post(Psama.TOS + \"/update\", terms, { \"Content-Type\": \"text/html\" }).then(() => {\n      toaster.success({ description: \"Terms have been successfully published.\" });\n      goto();\n    }).catch(() => toaster.error({\n      description: \"An error occured while publishing these terms. Make a backup and try again or contact an administrator.\"\n    }));\n  }\n  let $$settled = true;\n  let $$inner_payload;\n  function $$render_inner($$payload2) {\n    head($$payload2, ($$payload3) => {\n      $$payload3.title = `<title>${escape_html(branding.applicationName)} | Edit Terms of Service</title>`;\n    });\n    Content($$payload2, {\n      title: \"Edit Terms of Service\",\n      backUrl: \"/admin/configuration\",\n      backTitle: \"Back to Configuration\",\n      children: ($$payload3) => {\n        await_block(\n          $$payload3,\n          load(),\n          () => {\n            Loading($$payload3, {});\n          },\n          () => {\n            if (!store_get($$store_subs ??= {}, \"$isTopAdmin\", isTopAdmin)) {\n              $$payload3.out.push(\"<!--[-->\");\n              ErrorAlert($$payload3, {\n                \"data-testid\": \"admin-warning\",\n                title: \"Top Administrator Only\",\n                color: \"warning\",\n                children: ($$payload4) => {\n                  $$payload4.out.push(`<p>Configurations are READ ONLY for admin users. Please contact your administrator to make\n          changes.</p>`);\n                }\n              });\n              $$payload3.out.push(`<!----> <div id=\"terms-of-service\" class=\"bg-white dark:bg-black border px-2\">${html(sanitizeHTML(terms))}</div>`);\n            } else {\n              $$payload3.out.push(\"<!--[!-->\");\n              Editor($$payload3, {\n                fontOptions: true,\n                get content() {\n                  return terms;\n                },\n                set content($$value) {\n                  terms = $$value;\n                  $$settled = false;\n                }\n              });\n            }\n            $$payload3.out.push(`<!--]--> <div class=\"flex justify-end\">`);\n            {\n              let trigger = function($$payload4) {\n                $$payload4.out.push(`<!---->Publish`);\n              };\n              Modal_1($$payload3, {\n                title: \"Publish\",\n                width: \"w-1/3\",\n                \"data-testid\": \"publish-terms\",\n                triggerBase: \"btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500 mt-3\",\n                open: modalOpen,\n                disabled: !store_get($$store_subs ??= {}, \"$isTopAdmin\", isTopAdmin) || !dirty,\n                withDefault: true,\n                onconfirm: onCommit,\n                cancelClass: \"border preset-tonal-error hover:preset-filled-error-500\",\n                trigger,\n                children: ($$payload4) => {\n                  $$payload4.out.push(`<div>Once published, these terms will be live and every user will be prompted to accept them on\n          their next login.</div> <div class=\"mt-3\">Do you wish to continue?</div>`);\n                },\n                $$slots: { trigger: true, default: true }\n              });\n            }\n            $$payload3.out.push(`<!----></div>`);\n          }\n        );\n        $$payload3.out.push(`<!--]-->`);\n      }\n    });\n  }\n  do {\n    $$settled = true;\n    $$inner_payload = copy_payload($$payload);\n    $$render_inner($$inner_payload);\n  } while (!$$settled);\n  assign_payload($$payload, $$inner_payload);\n  if ($$store_subs) unsubscribe_stores($$store_subs);\n  pop();\n}\nexport {\n  _page as default\n};\n"],"names":[],"mappings":"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"}