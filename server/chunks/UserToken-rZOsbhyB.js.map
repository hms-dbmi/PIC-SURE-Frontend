{"version":3,"file":"UserToken-rZOsbhyB.js","sources":["../../../.svelte-kit/adapter-node/chunks/UserToken.js"],"sourcesContent":["import { O as store_get, _ as await_block, P as unsubscribe_stores, D as pop, A as push, E as escape_html, F as attr_class, J as stringify } from \"./index.js\";\nimport { n as getTokenExpiration, t as toaster, o as getUser, a as user, q as getTokenExpirationAsDate, s as refreshLongTermToken } from \"./User.js\";\nimport { d as debounce } from \"./Forms.js\";\nimport { C as CopyButton } from \"./CopyButton.js\";\nimport { M as Modal_1 } from \"./Modal.js\";\nimport { L as Loading } from \"./Loading.js\";\nfunction UserToken($$payload, $$props) {\n  push();\n  var $$store_subs;\n  const defaultRefreshText = \"Refresh\";\n  const placeHolderToken = \"••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••\";\n  let account = store_get($$store_subs ??= {}, \"$user\", user)?.email || \"There was an error retrieving your account.\";\n  let refreshButtonDisabled = false;\n  let refreshPromise = Promise.resolve(defaultRefreshText);\n  let token = store_get($$store_subs ??= {}, \"$user\", user)?.token;\n  let expires = token ? extractExperationDate(token) : 0;\n  let badge = expires && checkIfExpired();\n  function checkIfExpired() {\n    if (!expires || expires === 0) {\n      return \"unknown\";\n    }\n    const daysLeftOnToken = Math.floor((expires - Date.now()) / (1e3 * 60 * 60 * 24));\n    if (expires < Date.now()) {\n      return \"expired\";\n    } else if (daysLeftOnToken < 7) {\n      return \"expiring soon\";\n    } else {\n      return \"valid for \" + daysLeftOnToken + \" more days\";\n    }\n  }\n  function extractExperationDate(token2) {\n    if (!token2) return 0;\n    try {\n      return getTokenExpiration(token2);\n    } catch (error) {\n      console.error(error);\n      toaster.error({\n        title: \"An error occured while parsing your token. Please try again later. If this problem persists, please contact an administrator.\"\n      });\n      return 0;\n    }\n  }\n  function refreshToken() {\n    refreshButtonDisabled = true;\n    refreshPromise = refreshLongTermToken().then(() => \"Refreshed!\").catch((e) => {\n      console.log(\"Error: \", e);\n      toaster.error({\n        title: \"An error occured while refreshing your token. Please try again later. If this problem persists, please contact an administrator.\"\n      });\n      return \"Error\";\n    }).finally(debounce(\n      () => {\n        refreshPromise = Promise.resolve(\"Refresh\");\n        refreshButtonDisabled = false;\n      },\n      5e3\n    ));\n  }\n  $$payload.out.push(`<div id=\"user-token-container\" class=\"svelte-ogor50\">`);\n  await_block(\n    $$payload,\n    getUser(true, true),\n    () => {\n      Loading($$payload, { ring: true, size: \"medium\" });\n    },\n    () => {\n      $$payload.out.push(`<div id=\"user-token\" class=\"card preset-filled-sureface-500 svelte-ogor50\"><header class=\"card-header\"><h4>Personal Access Token</h4></header> <section class=\"p-4 grid grid-cols-2 gap-y-2 items-center svelte-ogor50\"><label for=\"account\" class=\"svelte-ogor50\">Account:</label> <span id=\"account\" class=\"w-full\">${escape_html(account)}</span> <label for=\"token\" class=\"svelte-ogor50\">Token:</label> <div id=\"token\">${escape_html(placeHolderToken)}</div> <label for=\"expires\" class=\"svelte-ogor50\">Expires:</label> <div><span id=\"expires\" class=\"w-1/3 mr-2\">${escape_html(getTokenExpirationAsDate(store_get($$store_subs ??= {}, \"$user\", user)?.token || \"\")?.toString()?.substring(0, 24))}</span> `);\n      if (badge) {\n        $$payload.out.push(\"<!--[-->\");\n        $$payload.out.push(`<span id=\"expires-badge\"${attr_class(`badge ${stringify(badge)}`)} data-testid=\"expires-badge\">${escape_html(badge.toUpperCase())}</span>`);\n      } else {\n        $$payload.out.push(\"<!--[!-->\");\n      }\n      $$payload.out.push(`<!--]--></div></section> <footer class=\"card-footer mt-2\">`);\n      CopyButton($$payload, {\n        itemToCopy: store_get($$store_subs ??= {}, \"$user\", user).token || \"\",\n        class: \"preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500\"\n      });\n      $$payload.out.push(`<!----> `);\n      {\n        let trigger = function($$payload2) {\n          await_block(\n            $$payload2,\n            refreshPromise,\n            () => {\n              Loading($$payload2, { ring: true, size: \"micro\", label: \"Refreshing\" });\n            },\n            (text) => {\n              $$payload2.out.push(`${escape_html(text)}`);\n            }\n          );\n          $$payload2.out.push(`<!--]-->`);\n        };\n        Modal_1($$payload, {\n          \"data-testid\": \"refresh\",\n          title: \"Please Confirm\",\n          onconfirm: refreshToken,\n          disabled: refreshButtonDisabled,\n          triggerBase: \"btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500\",\n          footerButtons: true,\n          withDefault: true,\n          trigger,\n          children: ($$payload2) => {\n            $$payload2.out.push(`<!---->Are you sure you wish to invalidate your old token and create a new one?`);\n          },\n          $$slots: { trigger: true, default: true }\n        });\n      }\n      $$payload.out.push(`<!----> <button data-testid=\"reveal-btn\" class=\"btn preset-tonal-primary border border-primary-500 hover:preset-filled-primary-500\">${escape_html(\"Reveal\")}</button></footer></div>`);\n    }\n  );\n  $$payload.out.push(`<!--]--></div>`);\n  if ($$store_subs) unsubscribe_stores($$store_subs);\n  pop();\n}\nexport {\n  UserToken as U\n};\n"],"names":[],"mappings":"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"}