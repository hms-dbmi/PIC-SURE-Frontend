{"version":3,"file":"Connections-CD63sofG.js","sources":["../../../.svelte-kit/adapter-node/chunks/Connections.js"],"sourcesContent":["import { w as writable } from \"./index2.js\";\nimport { g as get, p as post, b as put } from \"./User.js\";\nimport { g as get_store_value } from \"./lifecycle.js\";\nfunction mapExtendedUser(data) {\n  return {\n    ...data,\n    connection: data.connection ? data.connection.uuid : \"\",\n    roles: data.roles ? data.roles.map((r) => r.uuid) : []\n  };\n}\nconst USER_URL = \"psama/user\";\nconst loaded$1 = writable(false);\nconst users = writable([]);\nasync function loadUsers() {\n  if (get_store_value(loaded$1)) return;\n  const res = await get(USER_URL);\n  users.set(res.map(mapExtendedUser));\n  loaded$1.set(true);\n}\nasync function getUser(uuid) {\n  const store = get_store_value(users);\n  const user = store.find((u) => u.uuid === uuid);\n  if (user) {\n    return user;\n  }\n  const res = await get(`${USER_URL}/${uuid}`);\n  return mapExtendedUser(res);\n}\nasync function addUser(user) {\n  const res = await post(USER_URL, [user]);\n  const newRole = mapExtendedUser(res.content[0]);\n  const store = get_store_value(users);\n  store.push(newRole);\n  users.set(store);\n}\nasync function updateUser(user) {\n  const res = await put(USER_URL, [user]);\n  const newUser = mapExtendedUser(res.content[0]);\n  const store = get_store_value(users);\n  const roleIndex = store.findIndex((r) => r.uuid === newUser.uuid);\n  if (roleIndex === -1) {\n    store.push(newUser);\n  } else {\n    store[roleIndex] = newUser;\n  }\n  users.set(store);\n}\nconst UsersStore = {\n  subscribe: users.subscribe,\n  users,\n  loadUsers,\n  getUser,\n  addUser,\n  updateUser\n};\nconst CONN_URL = \"psama/connection\";\nconst loaded = writable(false);\nconst connections = writable([]);\nasync function loadConnections() {\n  if (get_store_value(loaded)) return;\n  const res = await get(CONN_URL);\n  connections.set(res);\n  loaded.set(true);\n}\nasync function getConnection(uuid) {\n  const store = get_store_value(connections);\n  const connection = store.find((r) => r.uuid === uuid);\n  if (connection) {\n    return connection;\n  }\n  const res = await get(`${CONN_URL}/${uuid}`);\n  return res;\n}\nconst ConnectionsStore = {\n  subscribe: connections.subscribe,\n  connections,\n  loadConnections,\n  getConnection\n};\nexport {\n  ConnectionsStore as C,\n  UsersStore as U\n};\n"],"names":[],"mappings":"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"}